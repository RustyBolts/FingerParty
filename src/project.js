require=function a(c,s,r){function l(e,t){if(!s[e]){if(!c[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var n=s[e]={exports:{}};c[e][0].call(n.exports,function(t){return l(c[e][1][t]||t)},n,n.exports,a,c,s,r)}return s[e].exports}for(var u="function"==typeof require&&require,t=0;t<r.length;t++)l(r[t]);return l}({BargameClient:[function(t,e,i){"use strict";cc._RF.push(e,"40069jxiQRPpYljMDdRfVkr","BargameClient");var u=t("MessageManager"),o=t("Notifier");cc.Class({extends:cc.Component,properties:{TouchPoint:cc.Node,ClientUINode:cc.Node},onLoad:function(){o.mapClient(this),this._profileData=t("DataModal").getInstance().profileData,this.TouchPoint.active=!1,this._addTouchListener()},start:function(){this._setIDNickname(),this.init()},onDestroy:function(){o.removeClient(),this._removeTouchListener()},_addTouchListener:function(){var i=this;this._touchStartCallback=null,this._touchEndCallback=null;var t=this.node;this._startHandler=function(t){var e=t.touch;return i._touchStartCallback&&i._touchStartCallback(e.getLocation())},this._endHandler=function(t){var e=t.touch;return i._touchEndCallback&&i._touchEndCallback(e.getLocation())},t.on(cc.Node.EventType.TOUCH_START,this._startHandler,this),t.on(cc.Node.EventType.TOUCH_END,this._endHandler,this),t.on(cc.Node.EventType.TOUCH_CANCEL,this._endHandler,this)},_removeTouchListener:function(){n.off(cc.Node.EventType.TOUCH_START,this._startHandler,this),n.off(cc.Node.EventType.TOUCH_END,this._endHandler,this),n.off(cc.Node.EventType.TOUCH_CANCEL,this._endHandler,this)},_setIDNickname:function(){var t=(new Date).getTime().toString(16),e=LocalCache.getItem("user_uniqueid",t),i=LocalCache.getItem("user_nickname","");this._profileData.uniqueid=this._uniqueid=e,this._profileData.nickname=this._nickname=i,i?o.notifyHost("player_join",{player:{uniqueid:e,nickname:i}}):this.load_ui({name:"PersonalBoard"})},_setColor:function(){return[cc.Color.RED,cc.Color.GREEN,cc.Color.BLUE,cc.Color.YELLOW,cc.Color.ORANGE,cc.Color.CYAN,cc.Color.MAGENTA].sort(function(t){return Math.random()-.5})[0]},init:function(){this._touchStartCallback=this._initiateHandler.bind(this,1),this._touchEndCallback=this._initiateHandler.bind(this,0),this._playerPoint={},this._rgbcolor=this._setColor(),this._profileData.setRgba(this._rgbcolor)},initiate:function(t){1==t.join?(t.player.uniqueid!=this._uniqueid&&(cc.log("有人發起活動"),this._touchStartCallback=this._inactiveHandler.bind(this,1),this._touchEndCallback=this._inactiveHandler.bind(this,0)),this.inactive(t)):this.init()},inactive:function(t){var e=t.join,i=t.player,o=this._playerPoint[i.uniqueid];cc.log("inactive event:",t),e&&(o||((o=cc.instantiate(this.TouchPoint)).parent=this.ClientUINode,this._playerPoint[i.uniqueid]=o),o.active=!0,o.children[0].color=new cc.Color(t.rgba),o.children[1].getComponent(cc.Label).string=i.nickname,o.setPosition(t.position))},play:function(t){var e=this;this._touchStartCallback=null,this._touchEndCallback=null,Object.keys(this._playerPoint).forEach(function(t){e._playerPoint[t].active=!1})},roulette:function(t){var e=this,i=Math.max(0,.001*(t.start-(new Date).getTime())),o=t.players,n=o.findIndex(function(t){return t.uniqueid==e._uniqueid}),a=o.length,c=t.form,s=t.to,r=s-c,l=1/a;this.node.runAction(cc.sequence(cc.delayTime(i),cc.repeat(cc.sequence(cc.callFunc(function(t){n==c%a&&(u.warn({color:e._rgbcolor}),l=1/(s+1-c)),c++}),cc.delayTime(l)),r),cc.callFunc(function(t){return e.finish({player:o[s%a]})})))},finish:function(t){var e=t.player;e.uniqueid==this._uniqueid&&u.addMessage({text:e.nickname+"中獎！",callback:this.final.bind(this)})},final:function(){var e=this;Object.keys(this._playerPoint).forEach(function(t){e._playerPoint[t].destroy()}),this.init()},load_ui:function(t){var o=t.name,n=t.callback;cc.loader.loadRes("prefabs/"+o,function(t,e){if(t)return cc.error(t);var i=cc.instantiate(e);i.parent=this.node,n&&i.getComponent(o)[n.method](n)}.bind(this))},_initiateHandler:function(t,e){this._profileData.position=e,o.notifyHost("initiate",{join:t,game:"countRoulette",player:{uniqueid:this._uniqueid,nickname:this._nickname},position:e,rgba:this._profileData.rgba}),u.closeAllMessage()},_inactiveHandler:function(t,e){this._profileData.position=e,o.notifyHost("inactive",{game:"countRoulette",join:t,player:{uniqueid:this._uniqueid,nickname:this._nickname},position:e,rgba:this._profileData.rgba}),u.closeAllMessage()}}),cc._RF.pop()},{DataModal:"DataModal",MessageManager:"MessageManager",Notifier:"Notifier"}],BargameHost:[function(t,e,i){"use strict";cc._RF.push(e,"32811DOdqhFD7yq3ixFersh","BargameHost");var o=t("Notifier");cc.Class({extends:cc.Component,onLoad:function(){o.mapHost(this),this.clear()},clear:function(){this._playerList=[],this._chipList={}},initiate:function(t){if(1==t.join)this.pushPlayer(t.player),this._notifyInitiate(t);else if(2<this.getPlayerCount()){var e=o.notifyClient;e("load_ui",{name:"HitBall",callback:{method:"startHit",game:t.game,duration:2}}),e("play")}else this.clear(),o.notifyClient("final")},inactive:function(t){1==t.join?this.pushPlayer(t.player):this.popPlayer(t.player),this._notifyInactive(t)},bet_chips:function(t){if(this._chipList[t.player.uniqueid]=t.chip,Object.keys(this._chipList).length==this.getPlayerCount()){var i=this._chipList,e=Object.keys(i).reduce(function(t,e){return(i[t]||t)+i[e]},0);this._notifyRoulette(e),this.final()}},final:function(t){this.clear()},pushPlayer:function(t){this._playerList.push(t)},popPlayer:function(e){var t=this._playerList.findIndex(function(t){return t.uniqueid==e.uniqueid});this._playerList.splice(t,1)},getPlayerCount:function(){return cc.log("playerList:",this._playerList),this._playerList.length},_notifyInitiate:function(t){o.notifyClient("initiate",{game:t.game,join:t.join,player:t.player,position:t.position,rgba:t.rgba,count:this.getPlayerCount()})},_notifyInactive:function(t){cc.log(t),o.notifyClient("inactive",{game:t.game,join:t.join,player:t.player,position:t.position,rgba:t.rgba,count:this.getPlayerCount()})},_notifyRoulette:function(t){o.notifyClient("roulette",{start:(new Date).getTime()+1e3,players:this._playerList,form:0,to:t})}}),cc._RF.pop()},{Notifier:"Notifier"}],BargameNotifier:[function(t,e,i){"use strict";cc._RF.push(e,"8c89355HWRDo5jsKyLdta0w","BargameNotifier");var o=cc.Enum({INITIATE:-1,INACTIVE:-1,PLAY:-1,BET:-1,ROULETTE:-1});cc.Class({extends:t("Notifier"),statics:{type:o},start:function(){this.setGameParam("Bargame","BarGamer")},_hostEventHandler:function(t){switch(t.type){case o.INITIATE:this.Host.initiate(t);break;case o.INACTIVE:this.Host.inactive(t);break;case o.PLAY:this.Host.play(t);break;case o.BET:this.Host.bet(t)}},_userEventHandler:function(e){switch(e.type){case o.INITIATE:this.Clients.forEach(function(t){return t.initiate(e)});break;case o.INACTIVE:this.Clients.forEach(function(t){return t.inactive(e)});break;case o.PLAY:this.Clients.forEach(function(t){return t.play(e)});break;case o.ROULETTE:this.Clients.forEach(function(t){return t.roulette(e)})}}}),cc._RF.pop()},{Notifier:"Notifier"}],ButtonListDialog:[function(t,e,i){"use strict";cc._RF.push(e,"402a4khDBpEpLeXucGFxO0o","ButtonListDialog"),cc.Class({extends:cc.Component,properties:{EditboxNode:cc.Node,ButtonNode:cc.Node},show:function(){this.node.active=!0},addButtons:function(t,a){var c=this;return this.Inputs=[],t.forEach(function(t,e){var i=cc.instantiate(c.ButtonNode);i.parent=c.node,i.active=!0,i.y=0,i.getComponent("EventButton").setParams(t,function(t){return a&&a.call(c,e)});var o=cc.instantiate(c.EditboxNode);o.parent=i,o.actvie=!0,o.y=0,o.x+=i.width,o.width=48;var n=o.getComponentInChildren(cc.EditBox);n.node.width=o.width,n.placeholder="ok",c.Inputs.push(n)}),this},getContent:function(){return this.Inputs.map(function(t){return t.string||t.placeholder})}}),cc._RF.pop()},{}],1:[function(t,e,i){"use strict";e.exports=function(t,e,i,o){e=e||"&",i=i||"=";var n={};if("string"!=typeof t||0===t.length)return n;var a=/\+/g;t=t.split(e);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var s,r,l=t.length;0<c&&c<l&&(l=c);for(var u=0;u<l;++u){var h,d,f,p,g=t[u].replace(a,"%20"),m=g.indexOf(i);0<=m?(h=g.substr(0,m),d=g.substr(m+1)):(h=g,d=""),f=decodeURIComponent(h),p=decodeURIComponent(d),s=n,r=f,Object.prototype.hasOwnProperty.call(s,r)?C(n[f])?n[f].push(p):n[f]=[n[f],p]:n[f]=p}return n};var C=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],2:[function(t,e,i){"use strict";var a=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(i,o,n,t){return o=o||"&",n=n||"=",null===i&&(i=void 0),"object"==typeof i?s(r(i),function(t){var e=encodeURIComponent(a(t))+n;return c(i[t])?s(i[t],function(t){return e+encodeURIComponent(a(t))}).join(o):e+encodeURIComponent(a(i[t]))}).join(o):t?encodeURIComponent(a(t))+n+encodeURIComponent(a(i)):""};var c=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function s(t,e){if(t.map)return t.map(e);for(var i=[],o=0;o<t.length;o++)i.push(e(t[o],o));return i}var r=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},{}],3:[function(t,e,i){"use strict";i.decode=i.parse=t("./decode"),i.encode=i.stringify=t("./encode")},{"./decode":1,"./encode":2}],CanvasResize:[function(t,e,i){"use strict";cc._RF.push(e,"f0150BCF7lLjqr/PB1lQcIS","CanvasResize"),cc.Class({extends:cc.Component,onLoad:function(){var t=this.node.getComponent(cc.Canvas);t.designResolution=cc.size(t.width,t.height)}}),cc._RF.pop()},{}],ChatBar:[function(t,e,i){"use strict";cc._RF.push(e,"1eda2p7WL5I+IYBDVTkPvMY","ChatBar");var o=t("Notifier");cc.Class({extends:cc.Component,properties:{Input:cc.EditBox},onLoad:function(){this._profileData=t("DataModal").getInstance().profileData},onSendClicked:function(){if(""!=this.Input.string){var t=this.Input.string.split("\n\n"),e=o.isHost()?"":this._profileData.uniqueid;t.forEach(function(t){o.notifyHost("utter",{player:e,text:t})}),this.Input.string=""}}}),cc._RF.pop()},{DataModal:"DataModal",Notifier:"Notifier"}],ClickBoardDialog:[function(t,e,i){"use strict";cc._RF.push(e,"2963ax24IRGf5AK4xoNzcK2","ClickBoardDialog"),cc.Class({extends:cc.Component,properties:{ClickNode:cc.Node,CircleNode:cc.Node},_init:function(){this._clickCount=0,this.ClickNode.active=!0,this.CircleNode.setScale(1);var t=cc.Canvas.instance.node,e=1.5*t.width,i=1.5*t.height,o=Math.max(e,i);this.ClickNode.setContentSize(o,o),this.CircleNode.setContentSize(o,o)},show:function(t){var e=this;this._init(),this.CircleNode.stopAllActions(),this.CircleNode.runAction(cc.sequence(cc.scaleTo(t,.01),cc.callFunc(function(t){return e.ClickNode.active=!1})))},getCount:function(){return this._clickCount},onClicked:function(){this._clickCount++}}),cc._RF.pop()},{}],Client:[function(t,e,i){"use strict";cc._RF.push(e,"f3b53utwn1FCKg2I1j9jb5b","Client"),cc.Class({extends:cc.Component}),cc._RF.pop()},{}],DataModal:[function(e,t,i){"use strict";cc._RF.push(t,"e6cb4SXd7lBLZ/OGWE39tyr","DataModal");var o=null,n=cc.Class({statics:{getInstance:function(){return o||(o=new n),o}},ctor:function(){var t=e("ProfileData");this.profileData=new t}});cc._RF.pop()},{ProfileData:"ProfileData"}],DialogManager:[function(t,e,i){"use strict";cc._RF.push(e,"dd4b7LVfGZMvIG1axBVwztP","DialogManager");var o=null,c=[];cc.Class({extends:cc.Component,statics:{addDialog:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];o&&o.addDialog(t,e)},removeDialog:function(){}},properties:{DialogView:t("DialogView")},onLoad:function(){(o=this)._isShow=!1,EVENT.addListener("NotifyDialogClose",this._notifyDialogClose,this)},addDialog:function(t){var e=t.method,i=t.buttons,o=t.param,n=t.callback,a=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];o.method=e,o.buttons=i,o.callback=n,a?c.push(o):c.unshift(o),this.showDialog(a)},showDialog:function(t){c.length&&(t&&this._isShow||(this._isShow=!0,this.DialogView.setParam(c.shift()),this.DialogView.show()))},closeDialog:function(){},_notifyDialogClose:function(t){this._isShow=!1,this.showDialog()}}),cc._RF.pop()},{DialogView:"DialogView"}],DialogView:[function(t,e,i){"use strict";cc._RF.push(e,"49eecNAGfpAk4BBj2FSpEJ0","DialogView"),cc.Class({extends:cc.Component,properties:{BlockNode:cc.Node,ContentRoot:cc.Node,ButtonRoot:cc.Node},start:function(){var t=cc.Canvas.instance.node;this.BlockNode.setContentSize(t.width,t.height)},setParam:function(t){this._param=t,this.BlockNode.color=t.blockColor||cc.Color.WHITE;var e=this[t.method];e&&e.call(this)},show:function(){this.openAnimate()},hide:function(){},close:function(){this.closeAnimate()},openAnimate:function(){var e=this;this.node.active=!0,this.BlockNode.active=!0,this.BlockNode.opacity=0,this.BlockNode.runAction(cc.sequence(cc.fadeTo(.1,this._param.blockOpacity||105),cc.callFunc(function(t){e.BlockNode.y=-e.BlockNode.parent.y}))),this.ContentRoot.children.forEach(function(t){return t.active=!0}),this.ContentRoot.runAction(cc.fadeTo(.1,255)),this.ButtonRoot.opacity=0,this.ButtonRoot.runAction(cc.fadeTo(.2,255)),this.ButtonRoot.children.forEach(function(t){t.setPosition(t.x,.25*-t.height),t.runAction(cc.moveTo(.2,0,0))})},closeAnimate:function(){var e=this;this.BlockNode.runAction(cc.sequence(cc.fadeTo(.1,0),cc.callFunc(function(t){return e.BlockNode.active=!1})));var i=this.ContentRoot.children;this.ContentRoot.runAction(cc.sequence(cc.fadeTo(.1,0),cc.callFunc(function(t){return i.forEach(function(t){return t.destroy()})})));var o=this.ButtonRoot.children;this.ButtonRoot.runAction(cc.sequence(cc.fadeTo(.2,0),cc.callFunc(function(t){o.forEach(function(t){return t.destroy()}),EVENT.dispatchNotify("NotifyDialogClose",e)})))},_addComponent:function(t,e){var i=cc.instantiate(t);return i.parent=this.ContentRoot,i.getComponent(e)},_addButtons:function(e){var i=this,t=e.buttons;t&&t.forEach(function(t){i._addButton(t,e.callback,e.inputText)})},_addButton:function(t,e,i){this.ButtonRoot.active=!0;var o=this.ButtonRoot.childrenCount,n=cc.instantiate(this.ButtonNode);n.parent=this.ButtonRoot,n.active=!0,n.y=0,n.getComponent("EventButton").setParams(t,function(){e&&e.call(this,o,i),this.close()}.bind(this))}}),cc._RF.pop()},{}],DiceDialog:[function(t,e,i){"use strict";cc._RF.push(e,"f1ddcq8/rJImqIP6EKsedrC","DiceDialog"),cc.Class({extends:cc.Component,properties:{ResultLabel:cc.Label},onLoad:function(){},show:function(t,e,i){this._isDicing=!1,this.node.active=!0,this._event=t,this._makerData=e,this._skill=i,this.ResultLabel.string=""},close:function(){this.unscheduleAllCallbacks(),this._event=null,this._makerData=null,this.ResultLabel.string="",this.node.active=!1},_roll:function(){this._isDicing=!0;for(var t=parseInt(this._makerData.skill[this._skill],10),e=this._makerData.ability[this._event.ability],i=[0,0,1,1,1,2],o=i.length,n=[],a=0;a<e;a++)n.push(i[Math.floor(1e3*Math.random())%o]);return n.push(t),n},clickOnRoll:function(e){var i=this;if(!this._isDicing){var o=this._roll(),n=o.length,a=0;EVENT.dispatchNotify("NotifyHostEvent",{type:t("Notifier").type.DICE,targets:this._event.targets,describe:this._event.describe,ability:this._event.ability,testValue:o,who:this._makerData.nickname,goal:this._event.goal}),this.ResultLabel.string=o[a++],this.schedule(function(t){a<n?i.ResultLabel.string+="+"+o[a]:a==n?i.ResultLabel.string+="="+o.reduce(function(t,e){return t+e}):(i.close(),e&&e()),a++},.5,o.length)}},clickOnCancel:function(){this.node.emit("EmitDiceCancel"),this.close()}}),cc._RF.pop()},{Notifier:"Notifier"}],DndMapRole:[function(t,e,i){"use strict";cc._RF.push(e,"8c8e36QvABJaoajZfokRn/g","DndMapRole");var o=t("Notifier");cc.Class({extends:cc.Component,properties:{ColorNode:cc.Node,ColorRoot:cc.Node,ColorDemoNode:cc.Node,NameInput:cc.EditBox,NameDemoText:cc.Label,SpedInput:cc.EditBox},onLoad:function(){this._profileData=t("DataModal").getInstance().profileData,o.mapClient(this),this._colorPettle()},start:function(){cc.log("~~~~~~~",this._profileData.nickname),this.NameInput.string=this._profileData.nickname},onDestroy:function(){o.removeClient(this)},map_role_close:function(){this.node.destroy()},_colorPettle:function(){var i=this;[cc.Color.RED,cc.Color.GREEN,cc.Color.BLUE,cc.Color.YELLOW,cc.Color.ORANGE,cc.Color.CYAN,cc.Color.MAGENTA].forEach(function(t){var e=cc.instantiate(i.ColorNode);e.parent=i.ColorRoot,e.active=!0,e.color=t})},_colorTransferAnimation:function(t){var e=t.r,i=t.b,o=t.g;this.ColorDemoNode.stopAllActions(),this.ColorDemoNode.runAction(cc.sequence(cc.scaleTo(.1,.8,.8),cc.spawn(cc.tintTo(.2,e,o,i),cc.scaleTo(.2,1.5,1.5).easing(cc.easeInOut(3))),cc.scaleTo(.2,1,1).easing(cc.easeInOut(3))))},onNameTextChanged:function(){this.NameDemoText.string=this.NameInput.string},onTarnsferColorClicked:function(t){var e=t.target;this._colorTransferAnimation(e.color)},onConfirmClicked:function(){o.notifyHost("role_join",{player:this._profileData.uniqueid,rgba:this.ColorDemoNode.color,name:this.NameInput.string,sped:parseInt(this.SpedInput.string,10)||1}),this.node.active=!1}}),cc._RF.pop()},{DataModal:"DataModal",Notifier:"Notifier"}],EditStoryDialog:[function(t,e,i){"use strict";cc._RF.push(e,"4349ehMoctAK4mJt/ytsBA4","EditStoryDialog"),cc.Class({extends:cc.Component,properties:{MainEditbox:cc.EditBox,ReplaceEditboxNode:cc.Node,ReplaceEditboxRoot:cc.Node},show:function(t){this.node.active=!0,this.ReplaceEditboxNode.active=!1,this.MainEditbox.string="",this.MainEditbox.placeholder=t||""},getParams:function(){return{input:this.MainEditbox.string}},onAddReplaceClicked:function(){var t=cc.instantiate(this.ReplaceEditboxNode);t.parent=this.ReplaceEditboxRoot,t.active=!0},onReplaceClicked:function(){var i=this;this.ReplaceEditboxRoot.children.forEach(function(t){var e=t.getComponent(cc.EditBox).string.split("=");i.MainEditbox.string=i.MainEditbox.string.replace(new RegExp(" "+e[0]+" ","gi"),e[1]),t.destroy()})},onClearInputClicked:function(){this.MainEditbox.string="",this.ReplaceEditboxRoot.children.forEach(function(t){return t.destroy})}}),cc._RF.pop()},{}],Entrace:[function(t,e,i){"use strict";cc._RF.push(e,"058cas9r/ZD1bk5O/F6M3AE","Entrace");t("Identitiy");cc.Class({extends:cc.Component,statics:{},properties:{Dialog:t("StoryDialog")},onLoad:function(){cc.view.enableAutoFullScreen(!1)},start:function(){this.Dialog.editText(300)}}),cc._RF.pop()},{Identitiy:"Identitiy",StoryDialog:"StoryDialog"}],EventButton:[function(t,e,i){"use strict";cc._RF.push(e,"0f215BLlFZMCJcg8nLLA57i","EventButton"),cc.Class({extends:cc.Component,properties:{EventName:cc.Label},setParams:function(t,e){this.EventName.string=t,this._callback=e},onClicked:function(){this._callback&&this._callback()}}),cc._RF.pop()},{}],EventRemover:[function(t,e,i){"use strict";cc._RF.push(e,"effaeb+2phELoiQQT5+Y30F","EventRemover"),cc.Class({extends:cc.Component,addEventParam:function(t){this._registeredEventList=this._registeredEventList?this._registeredEventList.push(t):[t]},onDestroy:function(){this._registeredEventList&&this._registeredEventList.forEach(function(t){EVENT.removeListener(t.name,t.func,t.target)})}}),cc._RF.pop()},{}],Firelink:[function(t,e,i){"use strict";cc._RF.push(e,"921fbAR3AlH7ZGzCAcHjlfE","Firelink"),cc.Class({ctor:function(t,e){this.db=Firebase.link.bind(this,t,e)},push:function(i,o){var n=this;return new Promise(function(e,t){i?n.db().then(function(t){return e(t.ref(i).push(o).getKey())}):t("none_ref")})},write:function(i,o){var n=this;return new Promise(function(e,t){i?n.db().then(function(t){return t.ref(i).set(o,function(t){return e({success:null==t})})}):t("none ref")})},remove:function(e){e?this.db().then(function(t){return t.ref(e).remove()}):cc.error("none ref")},read:function(e){var t=this;return new Promise(function(i){t.db().then(function(t){return t.ref(e).once("value",function(t){var e=t.val();i(null!=e?{success:!0,data:e,num:t.numChildren()}:{success:!1})})})})},notify:function(e,i){e?this.db().then(function(t){t.ref(e).set(i),t.ref(e).remove()}):cc.error("none ref")},addListener:function(e,i){this.db().then(function(t){return t.ref(e).on("value",function(t){var e=t.val();i(null!=e?{success:!0,data:e,num:t.numChildren()}:{success:!1})})})},removeListener:function(e){this.db().then(function(t){return t.ref(e).off()})}}),cc._RF.pop()},{}],GameEnum:[function(t,e,i){"use strict";cc._RF.push(e,"8b43f0iRd5MR7/YHBwvTfab","GameEnum");var o,n,a,c=cc.Enum({StoryTeller:-1}),s=(o={},n=c.StoryTeller,a="StoryTeller",n in o?Object.defineProperty(o,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[n]=a,o);e.exports={Games:c,GameName:s},cc._RF.pop()},{}],HitBall:[function(n,t,e){"use strict";cc._RF.push(t,"503a4DisYVBtK19/2vsA/V6","HitBall");var a=n("BargameNotifier");cc.Class({extends:cc.Component,properties:{CircleNode:cc.Node,ClickNode:cc.Node},onLoad:function(){a.mapClient(this),this._clickCount=0,this._profileData=n("DataModal").getInstance().profileData,this.CircleNode.setScale(1),this.CircleNode.setPosition(this._profileData.position.x-.5*this.node.width,this._profileData.position.y-.5*this.node.height),this.ClickNode.color=new cc.Color(this._profileData.rgba);var t=cc.Canvas.instance.node,e=1.5*t.width,i=1.5*t.height,o=Math.max(e,i);this.CircleNode.setContentSize(o,o),this.ClickNode.setContentSize(o,o)},onDestroy:function(){a.removeClient()},startHit:function(t){var e=this,i=t.duration;this.ClickNode.active=!0,this.CircleNode.stopAllActions(),this.CircleNode.runAction(cc.sequence(cc.scaleTo(i,.01),cc.callFunc(function(t){a.notifyHost("bet_chips",{player:{uniqueid:e._profileData.uniqueid,nickname:e._profileData.nickname},chip:e._clickCount})})))},roulette:function(){this.node.destroy()},onClicked:function(){this._clickCount++}}),cc._RF.pop()},{BargameNotifier:"BargameNotifier",DataModal:"DataModal"}],HostUI:[function(t,e,i){"use strict";cc._RF.push(e,"ca03dLE8g9BIbPmAGh/Mgjc","HostUI"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){t("Notifier").isHost()?(this._oriButtonsPos=this.node.children.map(function(t){return t.getPosition()}),this._isExpend=!0,this.onClicked()):this.node.active=!1},start:function(){},_collection:function(t){t.forEach(function(e){e.runAction(cc.sequence(cc.spawn(cc.moveTo(.2,0,0),cc.fadeTo(.1,0)),cc.callFunc(function(t){return e.getComponent(cc.Button).interactable=!1})))})},_expend:function(o){this._oriButtonsPos.forEach(function(t,e){var i=o[e];i.runAction(cc.sequence(cc.spawn(cc.moveTo(.2,t),cc.fadeTo(.1,255)),cc.callFunc(function(t){return i.getComponent(cc.Button).interactable=!0})))})},onClicked:function(){var t=this.node.children;(this._isExpend=!this._isExpend)?this._expend(t):this._collection(t)}}),cc._RF.pop()},{Notifier:"Notifier"}],Host:[function(t,e,i){"use strict";cc._RF.push(e,"95d91HbqEhPfKuQv6TtOVDJ","Host"),cc.Class({extends:cc.Component}),cc._RF.pop()},{}],Identitiy:[function(t,e,i){"use strict";cc._RF.push(e,"246015Sd+VNsrmY6vvXOeoD","Identitiy");var c=t("Notifier").Link,s=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return(new Date).getTime().toString(16)+"_"+t};e.exports={getSession:function(e){return new Promise(function(o,t){var n=LocalCache.getItem("user_nickname",e),a=LocalCache.getItem("user_uniqueid",s());c.read("Users/"+a).then(function(t){var e=t.success,i=t.data;e?(cc.log("有資料",a,i.nickname),o({uniqueid:a,nickname:i.nickname})):(cc.log("沒資料"),o({uniqueid:a,nickname:n}))})})},trilLogin:function(t){return new Promise(function(o,n){c.read("Users/"+t).then(function(t){var e=t.success,i=t.data;e?o(i):n(null)})})},login:function(a,t){return new Promise(function(o,n){Config.LocalMode?o(s()):a&&t&&c.read("Users/").then(function(t){var e=t.success,i=t.data;e?Object.keys(i).some(function(t){if(t.split("_")[1]==a)return o(i),!0}):n(null)})})},logout:function(){LocalCache.removeItem("user_nickname"),LocalCache.removeItem("user_uniqueid")},timestampid:s,register:function(t,e,i){return t&&LocalCache.setItem("user_nickname",t),uniqueid&&LocalCache.setItem("user_uniqueid",s(e)),i&&LocalCache.setItem("user_password",i),c.write("Users/"+uniqueid,{nickname:t,password:i})},guestNickname:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Guest",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:3,i=t,o=0;o<e;o++)i+=(Math.round(100*Math.random())%10).toString();return i}},cc._RF.pop()},{Notifier:"Notifier"}],InputDialog:[function(t,e,i){"use strict";cc._RF.push(e,"eb36a6F1q5HqqCjapDwQBM3","InputDialog"),cc.Class({extends:cc.Component,properties:{Editbox:cc.EditBox,ButtonNode:cc.Node},onLoad:function(){this._oriEditboxHeight=this.Editbox.node.height},show:function(t,e){this.node.active=!0,this._addedTexts=[],this.Editbox.placeholder=t||"",this.Editbox.string=e||""},hide:function(){this.node.active=!1},inputFlag:function(t){return this.Editbox.inputFlag=t,this},setInputMode:function(t,e){return this.Editbox.inputMode=t,this.Editbox.node.height=e||this._oriEditboxHeight,this.node.height=this.Editbox.node.height,this},setReplaceInput:function(o){var n=this;return this.insertButtons(["取代"],function(t){if(0===t){var e=n.Editbox.string.split("="),i=o.Editbox.string.replace(new RegExp(" "+e[0]+" ","gi"),e[1]);o.Editbox.string=i}}),this},insertButtons:function(t,o){var n=this;t.forEach(function(t,e){var i=cc.instantiate(n.ButtonNode);i.parent=n.node,i.active=!0,i.y=0,i.getComponent("EventButton").setParams(t,function(t){return o&&o.call(n,e)})})},addContent:function(t){this.Editbox.string+=" "+t,this._addedTexts.push(t)},delContent:function(t){var e=this.Editbox.string;this.Editbox.string=e.substring(0,e.lastIndexOf(t)-1),this._addedTexts.pop(t)},getParams:function(){return this.Editbox.node.height=this._oriEditboxHeight,{input:this.Editbox.string,added:this._addedTexts}},getContent:function(){return this.Editbox.string},onClearInputClicked:function(){this.Editbox.string=""}}),cc._RF.pop()},{}],IntegratedDialogView:[function(t,e,i){"use strict";cc._RF.push(e,"4ca09y7gvtGtoPEyO43cJBp","IntegratedDialogView"),cc.Class({extends:t("DialogView"),properties:{InputNode:cc.Node,TextNode:cc.Node,ClickNode:cc.Node,ChooseNode:cc.Node,ButtonNode:cc.Node},login:function(){var t=this._param,e=this._addComponent(this.InputNode,"InputDialog"),i=this._addComponent(this.InputNode,"InputDialog"),o=this._addComponent(this.InputNode,"InputDialog");e.show(t.nickname);var n=t.account;n?(n=n.substr(6),i.show("手機末四碼 "+n)):i.show("手機號碼");var a=t.password;o.inputFlag(0),a?o.show("",a):o.hide(),this._addButtons(t)},textMessage:function(){var t=this._param;this._addComponent(this.InputNode,"InputDialog").setInputMode(0,t.height).show(t.text),this._addButtons(t)},replaceText:function(){var t=this._param,e=this._addComponent(this.InputNode,"InputDialog");e.setInputMode(0,t.height).show(t.text),this._addComponent(this.InputNode,"InputDialog").setReplaceInput(e).show("等號取代文字，以逗號隔開多筆資料"),t.inputText=e,this._addButtons(t)},message:function(){var t=this._param;this._addComponent(this.TextNode,cc.Label).string=t.text||"",this.unscheduleAllCallbacks();var e=t.duration;e?this.scheduleOnce(this.close.bind(this),e):this._addButtons(t)},choose:function(){var e=this,i=this._param;this._addComponent(this.TextNode,cc.Label).string=i.text||"";var o=this._addComponent(this.ChooseNode,"ButtonListDialog").addButtons(i.buttons,function(t){i.callback&&i.callback(t),e.close()});o.show(),this._addButton("調整",function(t){0===t&&cc.log(o.getContent())}.bind(this)),this._addButton("取消")},countClicked:function(){var e=this,i=this._param,o=this._addComponent(this.ClickNode,"ClickBoardDialog");o.show(i.duration),this.scheduleOnce(function(t){i.callback&&i.callback(o.getCount()),e.close()},i.duration)}}),cc._RF.pop()},{DialogView:"DialogView"}],MapGridItem:[function(t,e,i){"use strict";cc._RF.push(e,"6b73ewCIfdJ+6pbsidI1NGF","MapGridItem"),cc.Class({extends:cc.Component,properties:{ColorBoard:cc.Node},onLoad:function(){},setGridSize:function(t,e){this.node.setContentSize(t),this.ColorBoard.setContentSize(t.width+e,t.height+e)},setOpacity:function(t){this.ColorBoard.opacity=t},setColor:function(t){return this.ColorBoard.color=t,this},setRole:function(t){t.parent=this.node,t.active=!0},getSiblingIndex:function(){return this.node.getSiblingIndex()},getColor:function(){return this.ColorBoard.color},onClicked:function(){EVENT.dispatchNotify("NotifyClickMapGridItem",this)}}),cc._RF.pop()},{}],MapGrid:[function(t,e,i){"use strict";cc._RF.push(e,"205f9iZdsxEGJtVelBycVcq","MapGrid");var a=t("Notifier");cc.Class({extends:cc.Component,properties:{RoleList:t("RoleList"),RoleNode:cc.Node},onLoad:function(){this._profileData=t("DataModal").getInstance().profileData,this._roleNodes={},this._rgbaColor={},this._playerCount=0,a.mapClient(this),EVENT.addListener("NotifyClickMapGridItem",this._notifyClickMapGridItem,this)},onDestroy:function(){EVENT.removeListener("NotifyClickMapGridItem",this._notifyClickMapGridItem,this)},_setRoleColor:function(t){var e=t.r,i=t.g,o=t.b,n=t.a,a=void 0===n?255:n;this._rgbaColor={r:e,g:i,b:o,a:a}},show_map:function(e){var i=this,t=e.url;this._loadMapPicture(t),this.node.active=!0,e.roleEvents.map(function(t){return i._roleJoin(t)}).forEach(function(t){t.setSiblingIndex(e.sped),i.RoleList.pushRole(cc.instantiate(t))})},_roleJoin:function(t){var e=t,i=e.player,o=cc.instantiate(this.RoleNode);return o.name=i,o.color=new cc.Color(t.rgba),o.setPosition(0,0),o.getComponentInChildren(cc.Label).string=e.name,e.player==this._profileData.uniqueid&&this._setRoleColor(e.rgba),this._selectPlayer=i,this._roleNodes[i]=o,this._playerCount++,o},_loadMapPicture:function(t){var i=this.node.getComponent(cc.Sprite),o=this._rematchSize.bind(this);cc.loader.load({url:t,type:"png"},function(t,e){if(t)return cc.error(t);i.spriteFrame=new cc.SpriteFrame(e),o()})},move:function(t){var e=t.position;e.next&&this.node.children[e.next].getComponent("MapGridItem").setColor(new cc.Color(t.rgba)),e.prev&&this.node.children[e.prev].getComponent("MapGridItem").setColor(cc.Color.WHITE),e.curr&&this.node.children[e.curr].getComponent("MapGridItem").setRole(this._roleNodes[t.player])},_rematchSize:function(){this.node.children.forEach(function(t,e){return 0<e&&t.destroy()});var t=cc.size(36.5,36.5),e=this.node.children[0].getComponent("MapGridItem");e.setGridSize(t,2),e.setOpacity(70),e.setColor(cc.Color.WHITE);var i=this.node.getContentSize(),o=i.width/36.5*i.height/36.5;o--;for(var n=0;n<o;n++){cc.instantiate(this.node.children[0]).parent=this.node}cc.log(this._selectPlayer,this._roleNodes[this._selectPlayer]),this.node.children[this._playerCount].getComponent("MapGridItem").setRole(this._roleNodes[this._selectPlayer])},_notifyClickMapGridItem:function(t){var e=t.detail;if(e.getColor()._val==cc.Color.WHITE._val){var i=e.getSiblingIndex();if(a.isHost())var o=this._selectPlayer,n={curr:i};else o=this._profileData.uniqueid,n={next:i,prev:this._position};a.notifyHost("move",{pic:"pic_02",rgba:this._rgbaColor,player:o,position:n}),this._position=n.next}},onHostMoveRoleClicked:function(t){var e=t.target.parent;a.isHost()&&(this._selectPlayer=e.name)},onHostRemoveRoleClicked:function(t){var e=t.target.parent;a.isHost()&&(this.RoleList.removeRole(e),this._roleNodes[e.name]&&this._roleNodes[e.name].destroy())}}),cc._RF.pop()},{DataModal:"DataModal",Notifier:"Notifier",RoleList:"RoleList"}],MessageBox:[function(t,e,i){"use strict";cc._RF.push(e,"00b0bArzIRNi6sx54PDq5Rg","MessageBox");t("Notifier");cc.Class({extends:cc.Component,properties:{MessageLine:cc.Node},onLoad:function(){},addMessage:function(t){var e=cc.instantiate(this.MessageLine);e.parent=this.node,e.active=!0,e.getComponent("MessageLine").setParam(t)},onReplaceWordClicked:function(){},onHideClicked:function(){this.node.active=!1}}),cc._RF.pop()},{Notifier:"Notifier"}],MessageLine:[function(t,e,i){"use strict";cc._RF.push(e,"4fecbAahPtEOLllSnsERZXw","MessageLine");var o=t("Notifier");cc.Class({extends:cc.Component,properties:{Label:cc.Label,Editbox:cc.EditBox},onLoad:function(){},setParam:function(t){this._player=t.player||"",this.Label.string=this._player?this._player+": "+t.text:t.text},replaceWord:function(t,e){var i=this.Label.string.replace(new RegExp(" "+t+" ","gi"),e);this.Label.string=i},onFirstClicked:function(){this.Editbox.node.active=!0,this.Label.node.active=!1,this.Editbox.node.height=this.Label.node.height,this.Editbox.string=this.Label.string},onBrocastClicked:function(){this.node.destroy(),o.notifyClient("utter",{player:this._player,text:this.Editbox.string})},onDeleteClicked:function(){this.node.destroy()}}),cc._RF.pop()},{Notifier:"Notifier"}],MessageManager:[function(t,e,i){"use strict";cc._RF.push(e,"7d7a84itmdEEZb0+xV0HzfL","MessageManager");var o=null,n=[];cc.Class({extends:cc.Component,statics:{warn:function(t){o&&o.warn(t)},addMessage:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(o){var i={view:cc.instantiate(o.Message).getComponent("MessageView"),param:t};e?o.addMessage(i):o.showMessage(i)}},closeMessage:function(t){o&&o.closeMessage(t)},closeAllMessage:function(){o&&(n=[],o._activeMessages.forEach(function(t){return o.closeMessage(t)}))}},properties:{Message:cc.Node,Warn:cc.Node},onLoad:function(){(o=this)._activeMessages=[]},warn:function(t){var e=this;this.Warn.color=t.color,this.Warn.active=!0,this.Warn.opacity=0,this.Warn.stopAllActions(),this.Warn.runAction(cc.sequence(cc.fadeTo(.2,255),cc.delayTime(.2),cc.fadeTo(.5,0),cc.callFunc(function(t){return e.Warn.active=!1})))},addMessage:function(t){0==this._activeMessages.length?this.showMessage(t):n.push(t)},showMessage:function(t){if(t){var e=t.view;e.node.parent=this.node,e.setParam(t.param),e.show(),this._activeMessages.push(e)}},closeMessage:function(i){var t=this._activeMessages.findIndex(function(t){var e=t==i;return e&&t.node.destroy(),e});this._activeMessages.splice(t,1),0==this._activeMessages.length&&this.showMessage(n.shift())}}),cc._RF.pop()},{}],MessageView:[function(t,e,i){"use strict";cc._RF.push(e,"4797fkooQ5Oh5SS+d8e3lE6","MessageView");var o=t("MessageManager");cc.Class({extends:cc.Component,properties:{Label:cc.Label},setParam:function(t){this.Label.string=t.text,this._callback=t.callback},show:function(){this.node.active=!0,this._showAnimation()},close:function(){this._closeAnimation()},_showAnimation:function(){this.node.opacity=0,this.node.setScale(.6,.6),this.node.stopAllActions(),this.node.runAction(cc.spawn(cc.fadeTo(.2,220),cc.scaleTo(.2,1)))},_closeAnimation:function(){var e=this;this.node.runAction(cc.sequence(cc.spawn(cc.fadeTo(.2,0),cc.scaleTo(.2,.6)),cc.callFunc(function(t){return o.closeMessage(e)})))},onCloseClicked:function(){this._closeAnimation(),this._callback&&this._callback()}}),cc._RF.pop()},{MessageManager:"MessageManager"}],NewPlayer:[function(e,t,i){"use strict";cc._RF.push(t,"e5ef5VJvPBN37IrnR+AZDLs","NewPlayer");var o=e("Notifier");cc.Class({extends:cc.Component,properties:{NicknameInput:cc.EditBox},onLoad:function(){},onSendClicked:function(){var t=this.NicknameInput.string;e("DataModal").getInstance().profileData.uniqueid=t,LocalCache.getItem("user_nickname",t),o.notifyHost("player_join",{player:{uniqueid:e("DataModal").getInstance().profileData.uniqueid,nickname:t}}),this.node.destroy()}}),cc._RF.pop()},{DataModal:"DataModal",Notifier:"Notifier"}],NodeResize:[function(t,e,i){"use strict";cc._RF.push(e,"d6491AFL1RM24q7fOIDGtq3","NodeResize"),cc.Class({extends:cc.Component,properties:{top:0,bottom:0},onEnable:function(){var t=cc.Canvas.instance.node.getContentSize();this.node.setContentSize(cc.size(t.width-this.top,t.height-this.bottom))}}),cc._RF.pop()},{}],Notifier:[function(e,t,i){"use strict";cc._RF.push(t,"7285at4ESFACqLs3HQeDIqv","Notifier");var o=new(e("Firelink"))("https://www.gstatic.com/firebasejs/4.2.0/firebase.js",{apiKey:"AIzaSyAc5PRwmE14gBH5az8TSoqs9aBrQ8YWa4o",authDomain:"fir-test-756e1.firebaseapp.com",databaseURL:"https://fir-test-756e1.firebaseio.com",projectId:"fir-test-756e1",storageBucket:"fir-test-756e1.appspot.com",messagingSenderId:"182531440628"}),n=null,a=null,c=[],s="",r="";cc.Class({extends:cc.Component,statics:{isHost:function(t){return n._isHost},mapHost:function(t){a=t},mapClient:function(t){c.push(t)},removeClient:function(t){c.splice(c.indexOf(t),1)},notifyHost:function(t,e){n&&(e=Object.assign({notify:t},e),Config.LocalMode?n._hostEventHandler(e):o.notify(s,e))},notifyClient:function(t,e){n&&n._isHost&&(e=Object.assign({notify:t},e),Config.LocalMode?n._userEventHandler(e):o.notify(r,e))}},properties:{},onLoad:function(){n=this;var t=e("querystring").parse(window.location.search.substring(1),"&","=");this._isHost=""==t.host,this.setGameParam("DndGame","dnd")},setGameParam:function(t,e){Config.LocalMode||(s=e+"/NotifierHost/Notify/",r=e+"/NotifierClient/Notify",this._isHost&&o.addListener(s,this._hostDo.bind(this)),o.addListener(r,this._userDo.bind(this)))},onDestroy:function(){Config.LocalMode||(this._isHost&&o.removeListener(s),o.removeListener(r))},_hostDo:function(t){var e=t.success,i=t.data;e&&this._hostEventHandler(i)},_userDo:function(t){var e=t.success,i=t.data;e&&this._userEventHandler(i)},_hostEventHandler:function(t){cc.log("notify host:",t),a[t.notify]&&a[t.notify](t)},_userEventHandler:function(e){cc.log("notify client:",e),c.forEach(function(t){return t[e.notify]&&t[e.notify](e)})}}),cc._RF.pop()},{Firelink:"Firelink",querystring:3}],PickerDialog:[function(t,e,i){"use strict";cc._RF.push(e,"e2189efS7RGm6rJH7kBHkwF","PickerDialog"),cc.Class({extends:cc.Component,properties:{ButtonNode:cc.Node,ButtonRoot:cc.Node},onLoad:function(){},show:function(){this.node.active=!0,cc.log("picker dialog show")},target:function(){},_button:function(t,e){this.ButtonRoot.active=!0;var i=cc.instantiate(this.ButtonNode);i.parent=this.ButtonRoot,i.active=!0,i.y=0,i.getComponent("EventButton").setParams(t,e||this._close.bind(this))}}),cc._RF.pop()},{}],PlayerItem:[function(t,e,i){"use strict";cc._RF.push(e,"bba71ytsYRBHK3IzwEtO1Jv","PlayerItem");var o=t("Notifier");cc.Class({extends:cc.Component,properties:{NicknameLabel:cc.Label,SelectButtonNode:cc.Node},onLoad:function(){},setParam:function(t){this._param=t,this.NicknameLabel.string=t.nickname},onExpendClicked:function(t){this.SelectButtonNode.active=!0},onSelectClicked:function(t){o.notifyHost("target_player",{player:this._param})}}),cc._RF.pop()},{Notifier:"Notifier"}],PlayerList:[function(t,e,i){"use strict";cc._RF.push(e,"d65c9dAVwdLWIuVfSR8ci/1","PlayerList");var o=t("Notifier");cc.Class({extends:cc.Component,properties:{RootNode:cc.Node,ItemNode:cc.Node},onLoad:function(){o.mapClient(this)},refresh_players:function(t){var i=this,o=t.players;Object.keys(o).forEach(function(t){var e=cc.instantiate(i.ItemNode);e.parent=i.RootNode,e.active=!0,e.name=t,e.getComponent("PlayerItem").setParam(o[t])})},onCloseClicked:function(t){o.removeClient(this),this.node.destroy()}}),cc._RF.pop()},{Notifier:"Notifier"}],ProfileData:[function(t,e,i){"use strict";cc._RF.push(e,"770edXB7JFD279LESBpwmZD","ProfileData"),cc.Class({ctor:function(){this.uniqueid="",this.nickname="",this.position=cc.v2(0,0),this.rgba={r:255,g:255,b:255,a:255}},setRgba:function(t){var e=t.r,i=t.g,o=t.b,n=t.a,a=void 0===n?255:n;this.rgba={r:e,g:i,b:o,a:a}}}),cc._RF.pop()},{}],PushDialog:[function(t,e,i){"use strict";cc._RF.push(e,"f3178RVpLNLbr4YUxg7IHS+","PushDialog"),cc.Class({extends:cc.Component,properties:{ButtonNode:cc.Node,ButtonRoot:cc.Node,PushButtonNode:cc.Node,PushRoot:cc.Node},onLoad:function(){},onDisable:function(){this.ButtonRoot.children.forEach(function(t){return t.destroy()})},show:function(t){var o=this;this.node.active=!0,t.forEach(function(i){o._button(o.ButtonNode,o.ButtonRoot,i.name,function(t){var e=i.verb;e&&o.node.emit("EmitPickit",e),o._push(i.group)})})},hide:function(){this.PushRoot.setPosition(this.node.width,0),this.ButtonRoot.setPosition(0,0)},_button:function(t,e,i,o){var n=cc.instantiate(t);n.parent=e,n.active=!0,n.y=0,n.getComponent("EventButton").setParams(i,o)},_push:function(){var i=this,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.PushRoot.children.forEach(function(t){return t.destroy()}),cc.log(o),Object.keys(o).forEach(function(t){var e=t+"("+o[t]+")";i._button(i.PushButtonNode,i.PushRoot,e,i._action.bind(i,"EmitPickit",t))}),this.PushRoot.runAction(cc.moveTo(.1,0,0)),this.ButtonRoot.runAction(cc.moveTo(.1,-this.node.width,0))},pop:function(){this.PushRoot.runAction(cc.sequence(cc.moveTo(.1,this.node.width,0),cc.callFunc(function(t){return cc.log("hi")}))),this.ButtonRoot.runAction(cc.moveTo(.1,0,0))},_action:function(t,e){e&&this.node.emit(t,e),this.pop()}}),cc._RF.pop()},{}],RoleCardData:[function(t,e,i){"use strict";cc._RF.push(e,"bf437hv+tRPr6iZGwn0ZgY2","RoleCardData"),cc.Class({ctor:function(){this.ability={"力量":1,"敏捷":1,"精神":1,"智慧":1}}}),cc._RF.pop()},{}],RoleList:[function(t,e,i){"use strict";cc._RF.push(e,"12129ra1PNEk6gBQ11f7Hzg","RoleList");t("Notifier");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._selectedNode=null},pushRole:function(t){t.parent=this.node,t.active=!0},removeRole:function(e){this.node.children.find(function(t){return t==e&&t.destroy()})},onRoleBoardClicked:function(t){this._selectedNode=t.target}}),cc._RF.pop()},{Notifier:"Notifier"}],RollDice:[function(t,e,i){"use strict";cc._RF.push(e,"4622auOtQRFAKA+nONTUEgU","RollDice");var o=t("Notifier");cc.Class({extends:cc.Component,properties:{DiceNode:cc.Node,PointLabel:cc.Label},onLoad:function(){this._profileData=t("DataModal").getInstance().profileData,this._oriPos=this.DiceNode.getPosition(),this._fallValue=0,this.DiceNode.on(cc.Node.EventType.TOUCH_MOVE,this._touchMove,this),this.DiceNode.on(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.DiceNode.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this)},show_dice:function(t){var e=t.player;t.num,t.point;cc.log("總之叫出骰子囉！",e)},update:function(){if(this._fallValue)if(this._oriPos.y<this.DiceNode.y)this.DiceNode.y+=this._fallValue,this._fallValue--;else{var t=Math.max(Math.floor(100*Math.random()%21),1);this.PointLabel.string=t.toString(),this._fallValue=0,o.notifyHost("roll_dice",{player:{uniqueid:this._profileData.uniqueid,nickname:this._profileData.nickname},point:t})}},_touchMove:function(t){var e=t.touch.getDelta().y,i=this.DiceNode.getPosition();this.DiceNode.setPosition(i.x,i.y+e),this._deltaY=e,this._fallValue=0},_touchEnd:function(t){this._fallValue=-2}}),cc._RF.pop()},{DataModal:"DataModal",Notifier:"Notifier"}],StoryCardCreator:[function(t,e,i){"use strict";cc._RF.push(e,"5206fUn8aZDbqa+BTe4aoSM","StoryCardCreator");var o=t("StoryCard");cc.Class({extends:cc.Component,properties:{ItemNode:cc.Node,ItemRoot:cc.Node,Dialog:t("StoryDialog")},onLoad:function(){EVENT.addListener("NotifyStoryCardSent",this._notifyStoryCardSent,this)},create:function(t){var i=this;t.forEach(function(t){var e=cc.instantiate(i.ItemNode);e.active=!0,e.parent=i.ItemRoot,e.getComponent("StoryCard").setParam(o.type.STORY,t)})},_notifyStoryCardSent:function(){this.node.active=1<this.ItemRoot.childrenCount},onEditStoryClicked:function(){this.Dialog.editStory(300),this.node.active=!0}}),cc._RF.pop()},{StoryCard:"StoryCard",StoryDialog:"StoryDialog"}],StoryCardRecord:[function(t,e,i){"use strict";cc._RF.push(e,"80efeqr2sZNwIim9gaGDH3I","StoryCardRecord");var o=t("StoryCard");cc.Class({extends:cc.Component,properties:{ItemNode:cc.Node,ItemRoot:cc.Node,CardsScrollView:cc.ScrollView,Dialog:t("StoryDialog")},add:function(t){var e=cc.instantiate(this.ItemNode);e.active=!0,e.parent=this.ItemRoot,e.getComponent("StoryCard").setParam(o.type.RECORD,t),this.ItemRoot.parent.height<this.ItemRoot.height&&this.CardsScrollView.scrollToBottom(.5)}}),cc._RF.pop()},{StoryCard:"StoryCard",StoryDialog:"StoryDialog"}],StoryCard:[function(t,e,i){"use strict";cc._RF.push(e,"d87b5lrSXlBsp/Bz7VQZMpG","StoryCard");var o=t("UndermazeNotifier").type,n=cc.Enum({STORY:-1,RECORD:-1});cc.Class({extends:cc.Component,statics:{type:n},properties:{NameLabel:cc.Label,DescribeLabel:cc.Label},setParam:function(t,e){this.DescribeLabel.string=e?"　　"+e:"-----",this._eventData={mode:t,text:e}},onClick:function(){this._eventData.mode==n.STORY&&(EVENT.dispatchNotify("NotifyHostEvent",{type:t("Notifier").type.UTTER,targets:[],describe:this._eventData.describe}),this.node.active=!1)},onClicked:function(){var t,e;this._eventData.mode==n.STORY&&(t=o.UTTER,e={text:this._eventData.text},EVENT.dispatchNotify("NotifyClientEvent",Object.assign({type:t},e)),this.node.destroy(),EVENT.dispatchNotify("NotifyStoryCardSent"))}}),cc._RF.pop()},{Notifier:"Notifier",UndermazeNotifier:"UndermazeNotifier"}],StoryDialog:[function(o,t,e){"use strict";cc._RF.push(t,"9a11c939aJMcKF5T8YVkCvv","StoryDialog");var i=o("Identitiy"),u=o("UndermazeNotifier").type,h=function(t,e){return EVENT.dispatchNotify("NotifyClientEvent",Object.assign({type:t},e))};cc.Class({extends:cc.Component,properties:{DialogManager:o("DialogManager"),CloseButton:cc.Node,ContentRoot:cc.Node,MessageDialog:o("TextDialog"),DiceDialog:o("DiceDialog"),PushDialog:o("PushDialog"),ChangeDialog:o("InputDialog"),InputDialog:o("InputDialog"),EditStoryDialog:o("EditStoryDialog"),ButtonRoot:cc.Node},onLoad:function(){this._targets=[],this._include=[]},start:function(){},login:function(){var e=this,t=i.guestNickname("BarGamer",5);i.getSession(t).then(function(t){e.DialogManager.addDialog({method:"login",buttons:["登入"],param:t,callback:function(t,e){}})})},editStory:function(t){this.DialogManager.addDialog({method:"replaceText",buttons:["生成故事卡片"],param:{height:t},callback:function(t,e){if(0===t){var i=e.getContent();i&&(o=u.STORY,n={text:i.split("\n\n")},EVENT.dispatchNotify("NotifyHostEvent",Object.assign({type:o},n)))}var o,n}})},logout:function(){},alert:function(t,e){this.DialogManager.addDialog({method:"message",buttons:["確定"],param:{text:t,duration:e},callback:function(t){}})},light:function(t,e,i){this.DialogManager.addDialog({method:"message",param:{blockColor:t,blockOpacity:e,duration:i}})},countRoulette:function(t,e){this.DialogManager.addDialog({method:"countClicked",param:{duration:t},callback:e})},profile:function(t){var n=t.makerid,e=t.nickname,i=t.hitpoint,a=t.ability,c=t.skill,s=t.item,o=e,r=function(e){return Object.keys(e).map(function(t){return"["+t+" "+e[t]+"]"})};o+="\n\n生存力\n"+r(i).join(" "),o+="\n\n屬性值\n"+r(a).join(" "),this.DialogManager.addDialog({method:"message",param:{text:o},buttons:["行動","道具","取消"],callback:function(t){var o=this;0===t?this.choose("選擇要執行的動作",c,function(t,e){var i="指定"+n+"進行"+t+"檢定";o.test(n,i,a,t,e)}):1===t&&this.choose("選擇要使用的道具",s,function(t,e){o.alert("使用["+t+"("+e+")]道具"),h(u.CHANGE,{player:n,ability:a})})}.bind(this)})},choose:function(t,o,n){var a=Object.keys(o);this.DialogManager.addDialog({method:"choose",buttons:a,param:{text:t,choose:o},callback:function(t){var e=a[t],i=o[e];n&&n(e,i)}.bind(this)})},trade:function(){this.node.active=!0,cc.log("開啟trade dialog")},change:function(){this.DialogManager.addDialog({method:"change",buttons:Object.keys(skill),param:{text:text},callback:function(t){}})},test:function(i,t,o,n,a){cc.log(o,n,a),this.DialogManager.addDialog({method:"message",buttons:Object.keys(o),param:{text:t},callback:function(t){var e=Object.keys(o)[t-1];cc.log(e,o[e]),h(u.DICE,{player:i,abilityName:e,abilityPoint:o[e],skillName:n,skillPoint:a})}.bind(this)})},dice:function(c,t,s,r,l){this.DialogManager.addDialog({method:"message",buttons:["擲骰","取消"],param:{text:"您正在進行 "+r+" 檢定\n基於"+t+"屬性，您可以使用"+s+"粒骰子進行擲骰\n並獲得["+r+"("+l+")]點基礎值"},callback:function(t){if(cc.log(t),5!==t){for(var e=[0,0,1,1,1,2],i=e.length,o=[],n=0;n<s;n++)o.push(e[Math.floor(1e3*Math.random())%i]);var a=o.reduce(function(t,e){return t+e})+l;this.alert("擲骰結果:"+o.join("+")+"\n並加上"+r+"基礎值"+l+"\n檢定結果為:"+a),h(u.UTTER,{text:c+"擲骰結果: "+a})}}.bind(this)})},_actionButton:function(t){var i=this,e=t.detail;switch(this.InputDialog.addContent(e),e){case"表示":cc.log("目前沒有用到"),this._button("發言",function(t){i._close();var e=i.InputDialog.getParams();EVENT.dispatchNotify("NotifyHostEvent",{type:o("Notifier").type.UTTER,targets:[i._makerid],describe:e.input}),i._targets=[],i._include=[]});break;case"發動":this._button("檢定",function(t){i._close();var e=i.InputDialog.getParams();EVENT.dispatchNotify("NotifyHostEvent",{type:o("Notifier").type.TEST,targets:i._targets,describe:e.input,propty:"skill",include:[e.input.split("發動 ")[1]]}),i._targets=[],i._include=[]}),this._button("取消",this._backButton.bind(this,e));break;case"使用":this._button("使用",function(t){i._close();var e=i.InputDialog.getParams();EVENT.dispatchNotify("NotifyHostEvent",{type:o("Notifier").type.TRADE,targets:[i._targets[0]],describe:e.input,propty:"item",include:[e.input.split("使用 ")[1]||e.input.split("獲得 ")[1]]}),i._include=[]}),this._button("取消",this._backButton.bind(this,e));break;case"投票":this._button("投票",function(t){i._close();var e=i.InputDialog.getParams();EVENT.dispatchNotify("NotifyHostEvent",{type:o("Notifier").type.POLL,targets:[i._makerid],describe:e.input}),i._targets=[]})}},_backButton:function(t){this.ButtonRoot.children.forEach(function(t){return t.destroy()}),this.InputDialog.delContent(t),this.PushDialog.pop()},_button:function(t,e){this.ButtonRoot.active=!0;var i=cc.instantiate(this.ButtonNode);i.parent=this.ButtonRoot,i.active=!0,i.y=0,i.getComponent("EventButton").setParams(t,e||this._close.bind(this))},_close:function(){this.PushDialog.node.active&&this.PushDialog.hide(),this.ButtonRoot.children.forEach(function(t){return t.destroy()}),this.ContentRoot.children.forEach(function(t){return t.active=!1}),this.node.active=!1},onCloseClicked:function(){this._targets=[],this._include=[],this._close()}}),cc._RF.pop()},{DialogManager:"DialogManager",DiceDialog:"DiceDialog",EditStoryDialog:"EditStoryDialog",Identitiy:"Identitiy",InputDialog:"InputDialog",Notifier:"Notifier",PushDialog:"PushDialog",TextDialog:"TextDialog",UndermazeNotifier:"UndermazeNotifier"}],StoryMakerData:[function(t,e,i){"use strict";cc._RF.push(e,"d8c4fQYWfhHZ6AbvVzdhKnN","StoryMakerData"),cc.Class({ctor:function(){this.makerid=0,this.nickname="",this.hitpoint={"體魄":0,"意志":0},this.ability={"力量":0,"敏捷":0,"智慧":0,"精神":0},this.skill={"覺查":1,"妙手":1,"交涉":1,"蠻力":1,"忍耐":1,"避害":1,"運動":1,"操弄":1,"歌頌":1},this.item={"檜木硬幣":1}},getParam:function(){return{makerid:this.makerid,nickname:this.nickname,hitpoint:this.hitpoint,ability:this.ability,skill:this.skill,item:this.item}},randomAbility:function(){var t=[3,3,2,1].sort(function(t){return Math.random()-.5});this.ability={"力量":t[0],"敏捷":t[1],"智慧":t[2],"精神":t[3]},this.hitpoint={"體魄":this.ability["力量"]+this.ability["敏捷"],"意志":this.ability["智慧"]+this.ability["精神"]}}}),cc._RF.pop()},{}],StoryMakerInfo:[function(t,e,i){"use strict";cc._RF.push(e,"66983KhZvJNVYWRMZ/6n1Tb","StoryMakerInfo"),cc.Class({extends:cc.Component,properties:{NameLabel:cc.Label,Dialog:t("StoryDialog")},setParams:function(t){var e=t.makerid,i=t.nickname;this._makerid=e,this._nickname=i,this.NameLabel.string=i},onNotifyInfoClicked:function(){this.Dialog.show(this._makerid,this._nickname)}}),cc._RF.pop()},{StoryDialog:"StoryDialog"}],StoryMaker:[function(s,t,e){"use strict";cc._RF.push(t,"ae0483Dhx9KpoBV/vXJ0XDf","StoryMaker");s("Notifier"),s("StoryMakerData");cc.Class({extends:s("Client"),properties:{StoryCardItem:cc.Node,StoryCardRoot:cc.Node,InfoMakersItem:cc.Node,InfoMakersRoot:cc.Node,CardsScrollView:cc.ScrollView,MakerInfo:s("StoryMakerInfo"),Dialog:s("StoryDialog")},onLoad:function(){this._makerid="",this._makersData=void 0,this.makerData=void 0},start:function(){},makerJoining:function(t){var n=this;this._makersData=t.data,this.makersData=t.data;var a=this.InfoMakersRoot.getChildren();a.forEach(function(t){return t.active=!1}),Object.keys(this._makersData).forEach(function(t,e){if(t!=n._makerid){var i=n._makersData[t],o=a[e]||cc.instantiate(n.InfoMakersItem);o.active=!0,o.parent=n.InfoMakersRoot,o.setPosition(0,-30),o.getComponent("StoryMakerInfo").setParams(i)}}),this._chekMe(t.targets)&&(this.makerData=this._makersData[this._makerid],this.MakerInfo.setParams(this.makerData)),this.print(t)},print:function(t){var e=this,i=(t.type,t.targets),o=t.describe,n=i?i.map(function(t){return e._makersData[t].nickname}):"",a=s("StoryCard").type,c=cc.instantiate(this.StoryCardItem);c.parent=this.StoryCardRoot,c.active=!0,c.getComponent("StoryCard").setParam({targets:i,names:n,describe:o,mode:a.RECORD}),this.scheduleOnce(function(t){return e.CardsScrollView.scrollToBottom()},0)},change:function(t){this.print(t);var e=t.propty,i=t.change,o=i.split("="),n=this._makersData[t.targets[0]],a=o[0],c=o[1],s=n[e];s[a]||(s[a]={}),s[a]=c},dice:function(t){if(this.print(t),this._chekMe(t.targets)){var e=this._makersData[this._makerid];this.Dialog.dice(t,e)}},vote:function(t){var e=t.type,i=t.targets,o=t.describe,n=t.votes;if(this._chekMe(i)){EVENT.dispatchNotify("NotifyHostEvent",{type:e,targets:i,describe:o,votes:n,choice:2})}},_chekMe:function(t){var e=this;return t.some(function(t){return t==e._makerid})},onFullScreenClicked:function(t){cc.screen.fullScreen()?cc.screen.exitFullScreen():cc.screen.requestFullScreen()},onReloadWebClicked:function(t){window.location.reload()}}),cc._RF.pop()},{Client:"Client",Notifier:"Notifier",StoryCard:"StoryCard",StoryDialog:"StoryDialog",StoryMakerData:"StoryMakerData",StoryMakerInfo:"StoryMakerInfo"}],StoryNotifier:[function(t,e,i){"use strict";cc._RF.push(e,"9d084y7dv9Il4Lh01Z+RKn7","StoryNotifier");var o=cc.Enum({STORY:-1,JOIN:-1,QUIT:-1,UTTER:-1,BROADCAST:-1,TRADE:-1,CHANGE:-1,TEST:-1,DICE:-1,POLL:-1,VOTE:-1});cc.Class({extends:t("Notifier"),statics:{type:o},start:function(){this.setGameParam(t("GameEnum").Games.StoryTeller,"DeepPrisoner")},_hostEventHandler:function(t){var e=this;switch(cc.log("==TELLER==\n",t),t.type){case o.STORY:t.data.reverse().forEach(function(t){return e.Host.story(t)});break;case o.JOIN:this.Host.makerJoining(t);break;case o.QUIT:this.Host.makerQuittfed(t);break;case o.UTTER:this.Host.utter(t);break;case o.TRADE:this.Host.trade(t);break;case o.CHANGE:this.Host.change(t);break;case o.TEST:this.Host.test(t);break;case o.DICE:this.Host.resultDice(t);break;case o.POLL:this.Host.pollVote(t);break;case o.VOTE:this.Host.resultVote(t)}},_userEventHandler:function(e){switch(cc.log("==MAKER==\n",e),e.type){case o.JOIN:this.Clients.forEach(function(t){return t.makerJoining(e)});break;case o.QUIT:break;case o.BROADCAST:this.Clients.forEach(function(t){return t.print(e)});break;case o.CHANGE:this.Clients.forEach(function(t){return t.change(e)});break;case o.TEST:this.Clients.forEach(function(t){return t.print(e)});break;case o.DICE:this.Clients.forEach(function(t){return t.dice(e)});break;case o.POLL:break;case o.VOTE:this.Clients.forEach(function(t){return t.vote(e)})}}}),cc._RF.pop()},{GameEnum:"GameEnum",Notifier:"Notifier"}],StoryTeller:[function(l,t,e){"use strict";cc._RF.push(t,"9d320weRBFFmZ4Da5SFzsYd","StoryTeller");var s=l("StoryMakerData");cc.Class({extends:l("Host"),properties:{StoryCardItem:cc.Node,StoryCardRoot:cc.Node,Dialog:l("StoryDialog")},onLoad:function(){this._makers={}},story:function(t){var e=l("StoryCard").type,i=cc.instantiate(this.StoryCardItem);i.parent=this.StoryCardRoot,i.active=!0,i.getComponent("StoryCard").setParam({targets:[],names:["Story teller"],describe:t,mode:e.STORY})},makerJoining:function(t){var i=this,e=t.type,o=t.makerid,n=t.nickname,a=new s;a.makerid=o,a.nickname=n,a.randomAbility(),this._makers[o]=a;var c={};Object.keys(this._makers).map(function(t){var e=i._makers[t];c[t]={makerid:t,nickname:e.nickname}}),EVENT.dispatchNotify("NotifyClientEvent",{type:e,targets:[o],data:this._makers,describe:"歡迎 "+n+" 加入"})},utter:function(t){this.Dialog.broadcast(t)},broadcast:function(t){EVENT.dispatchNotify("NotifyClientEvent",t)},trade:function(t){var e=this._makers[t.targets[0]];cc.log(t.include);var i=e[t.propty],o=t.include[0];t.num=i[o]||0,this.Dialog.change(t)},change:function(t){var e=t.targets,i=t.propty,o=t.change,n=o.split("=");this._makers[e[0]][i][n[0]]=n[1],this.broadcast(t)},test:function(t){this._testResultCount=0,this.Dialog.test(t)},resultDice:function(t){t.type;var e=t.targets,i=(t.describe,t.ability,t.testValue),o=t.who,n=t.goal;this._testResultCount++;var a=e.length==this._testResultCount,c=i.reduce(function(t,e){return t+e}),s="";if(n){var r=c-n;0==r?s="絕對成功":5<=r?s="大成功":2<r?s="成功":0<r?s="小成功":r<=-5?s="大失敗":r<-2?s="失敗":r<0&&(s="小失敗")}else s="無可預測";this.broadcast({type:l("Notifier").type.BROADCAST,targets:[],describe:o+"檢定結果為 "+c+" ("+s+")"}),a&&this.broadcast({type:l("Notifier").type.BROADCAST,targets:[],describe:"===擲骰結束==="})},pollVote:function(t){var e=t.type,i=t.targets,o=t.describe,n=t.votes;this._voteResultCount=0,this._voteBox=[],this._log(o,"\n請投票",n),EVENT.dispatchNotify("NotifyClientEvent",{type:e,targets:i,describe:o,votes:n})},resultVote:function(t){t.type;var e=t.targets,i=(t.describe,t.votes),o=t.choice;this._voteResultCount++,this._voteBox.push(o);var n=e.length==this._voteResultCount;this._log("開票：得一票",o);var a=this._voteBox.sort(function(t,e){return t-e}),c=a[0];n&&this.broadcast({type:l("Notifier").type.BROADCAST,targets:e,describe:"投票結果為 "+a+"，"+i[c]+"獲勝"})},_log:function(){cc.log("<============Teller:",this.node.name);for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];cc.log(JSON.stringify(e.join(" "))),cc.log("Teller============>")},onEditStoryClicked:function(){this.Dialog.editStory()}}),cc._RF.pop()},{Host:"Host",Notifier:"Notifier",StoryCard:"StoryCard",StoryDialog:"StoryDialog",StoryMakerData:"StoryMakerData"}],TextDialog:[function(t,e,i){"use strict";cc._RF.push(e,"c064cq9DndOTZcztu1aBv5t","TextDialog"),cc.Class({extends:cc.Component,properties:{Label:cc.Label},onLoad:function(){},show:function(t){this.node.active=!0,this.Label.string=t},addContent:function(t){this.Label.string+=t},nextContent:function(t){this.Label.string+="\n"+t}}),cc._RF.pop()},{}],UndermazeClient:[function(n,t,e){"use strict";cc._RF.push(t,"03501RKvXhHgrrhcs5rf6YY","UndermazeClient");var i=n("MessageManager"),o=n("Notifier");cc.Class({extends:cc.Component,properties:{StoryCardRecord:n("StoryCardRecord"),Dialog:n("StoryDialog")},onLoad:function(){o.mapClient(this)},start:function(){var t=(new Date).getTime().toString(16),e=LocalCache.getItem("user_uniqueid",t),i=LocalCache.getItem("user_nickname",""),o=n("DataModal").getInstance().profileData;o.uniqueid=e,o.nickname=i,e&&i?this.setPlayer(e,i):this.load_ui({name:"PersonalBoard"})},setPlayer:function(t,e){this._uniqueid=t,this._nickname=e,o.notifyHost("player_join",{player:{uniqueid:t,nickname:e}})},utter:function(t){var e=t;i.addMessage(e)},dice:function(t){var e=t;e.player==this._uniqueid&&this.Dialog.dice(this._uniqueid,e.abilityName,e.abilityPoint,e.skillName,e.skillPoint)},load_ui:function(t){var e=t.name,i=t.callback;cc.loader.loadRes("prefabs/"+e,function(t,e){if(t)return cc.error(t);cc.instantiate(e).parent=this.node,i&&i()}.bind(this))}}),cc._RF.pop()},{DataModal:"DataModal",MessageManager:"MessageManager",Notifier:"Notifier",StoryCardRecord:"StoryCardRecord",StoryDialog:"StoryDialog"}],UndermazeHost:[function(t,e,i){"use strict";cc._RF.push(e,"88f4epU4YRMEI9j4GVif2QL","UndermazeHost");t("MessageManager");var o=t("UndermazeNotifier");o.type;cc.Class({extends:cc.Component,properties:{StoryCardCreator:t("StoryCardCreator"),MessageBox:t("MessageBox"),Dialog:t("StoryDialog")},onLoad:function(){o.mapHost(this),this.clear()},clear:function(){this._players={},this._roleJoinEvents=[]},player_join:function(t){var e=t.player,i=e.uniqueid;this._players[i]=e,cc.log(this._players)},role_join:function(t){this._roleJoinEvents.push(t)},utter:function(t){this.MessageBox.addMessage(t)},move:function(t){o.notifyClient("move",t)},roll_dice:function(t){var e={player:t.player.nickname,text:"骰出"+t.point};this.MessageBox.addMessage(e)},target_player:function(t){this._targetPlayer=t},onPlayerListClicked:function(){var t=o.notifyClient;t("load_ui",{name:"PlayerList",callback:t.bind(this,"refresh_players",{players:this._players})})},onMapRoleClicked:function(){var t=o.notifyClient;t("load_ui",{name:"RoleInMap",callback:t.bind(this,"map_role_create")})},onMapShowClicked:function(){var t=o.notifyClient;t("load_ui",{name:"MapScrollview",callback:t.bind(this,"show_map",{url:"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/2d43b5ce-d5a3-453a-bddf-039cef17b272/db2jgi0-228c2865-68fe-40aa-a6ae-35089f27420c.jpg/v1/fill/w_730,h_1095,q_70,strp/bg_desert_04_by_gogots_db2jgi0-pre.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTUwMCIsInBhdGgiOiJcL2ZcLzJkNDNiNWNlLWQ1YTMtNDUzYS1iZGRmLTAzOWNlZjE3YjI3MlwvZGIyamdpMC0yMjhjMjg2NS02OGZlLTQwYWEtYTZhZS0zNTA4OWYyNzQyMGMuanBnIiwid2lkdGgiOiI8PTEwMDAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.H--o-aVzaIfKl_EIEcJlSqk7IvOsDPhY0QAPMfC9uNE",roleEvents:this._roleJoinEvents})}),t("map_role_close")},onShowDiceClicked:function(t){(0,o.notifyClient)("load_ui",{name:"DiceBoard"})}}),cc._RF.pop()},{MessageBox:"MessageBox",MessageManager:"MessageManager",StoryCardCreator:"StoryCardCreator",StoryDialog:"StoryDialog",UndermazeNotifier:"UndermazeNotifier"}],UndermazeNotifier:[function(t,e,i){"use strict";var o;function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}cc._RF.push(e,"3ada4nH1HRKqKi5UV/SsQxf","UndermazeNotifier");var a=cc.Enum((n(o={JOIN:-1,STORY:-1},"JOIN",-1),n(o,"QUIT",-1),n(o,"UTTER",-1),n(o,"BROADCAST",-1),n(o,"TRADE",-1),n(o,"CHANGE",-1),n(o,"TEST",-1),n(o,"DICE",-1),n(o,"POLL",-1),n(o,"VOTE",-1),n(o,"MAP",-1),n(o,"MOVE",-1),o));cc.Class({extends:t("Notifier"),statics:{type:a,asyncReadData:function(t){return new Promise(function(o,n){Config.LocalMode?n(null):Link.read(t,function(t){var e=t.success,i=t.data;return e?o(i):n(null)})})}},start:function(){this.setGameParam("Undermaze","DeepPrisoner")},_hostEventHandler:function(t){switch(t.type){case a.JOIN:this.Host.join(t);break;case a.STORY:this.Host.story(t);break;case a.MOVE:this.Host.move(t)}},_userEventHandler:function(e){switch(e.type){case a.JOIN:this.Clients.forEach(function(t){return t.join(e)});break;case a.UTTER:this.Clients.forEach(function(t){return t.utter(e)});break;case a.DICE:this.Clients.forEach(function(t){return t.dice(e)});break;case a.MOVE:this.Clients.forEach(function(t){return t.move(e)});break;case a.MAP:this.Clients.forEach(function(t){return t.setMap(e)})}}}),cc._RF.pop()},{Notifier:"Notifier"}],UtterDialog:[function(t,e,i){"use strict";cc._RF.push(e,"9118fOU+ONLuZ97y8QbCwti","UtterDialog"),cc.Class({extends:cc.Component,properties:{Input:cc.EditBox},onLoad:function(){},show:function(t){this.node.active=!0,this.Input.string=t},addContent:function(t){this.Input.string+=t},getParams:function(){return{message:this.Input.string}}}),cc._RF.pop()},{}]},{},["BargameNotifier","Firelink","Notifier","StoryNotifier","UndermazeNotifier","DataModal","GameEnum","ProfileData","RoleCardData","StoryMakerData","ButtonListDialog","ClickBoardDialog","DialogManager","DialogView","DiceDialog","EditStoryDialog","InputDialog","IntegratedDialogView","PickerDialog","PushDialog","StoryDialog","TextDialog","UtterDialog","CanvasResize","EventButton","EventRemover","Identitiy","NodeResize","Client","Entrace","Host","HostUI","NewPlayer","PlayerItem","PlayerList","RollDice","StoryCard","StoryCardCreator","StoryCardRecord","StoryMaker","StoryMakerInfo","StoryTeller","BargameClient","BargameHost","HitBall","DndMapRole","MapGrid","MapGridItem","RoleList","ChatBar","MessageBox","MessageLine","MessageManager","MessageView","UndermazeClient","UndermazeHost"]);