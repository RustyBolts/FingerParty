System.register("chunks:///_virtual/Ability.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"84f08yPe8ZDgIR8CzYwL3b1","Ability",void 0);e("Attribute",function(e){return e.Strength="strength",e.Dexterity="dexterity",e.Intelligence="intelligence",e.Wisdom="wisdom",e.Charisma="charisma",e.Resilience="resilience",e.Constitution="constitution",e.Spirit="spirit",e.Willpower="willpower",e.Athletics="athletics",e.Perception="perception",e.Response="response",e.Figurative="figurative",e}({}));t._RF.pop()}}}));

System.register("chunks:///_virtual/AdventureSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Skill.ts"],(function(e){var i,t,n,r;return{setters:[function(e){i=e.inheritsLoose},function(e){t=e.cclegacy},function(e){n=e.SkillProficiency,r=e.Skill}],execute:function(){t._RF.push({},"ea011GtbgdBdLlhL0aSKFxv","AdventureSkill",void 0);e("Adventure",function(e){return e.Stunts="stunts",e.Stealth="stealth",e.Dexterity="dexterity",e.Knowledge="knowledge",e.Experience="experience",e.Nature="nature",e.Religion="religion",e.Explore="explore",e.Nursing="nursing",e.Awareness="awareness",e.Taming="taming",e.Survival="survival",e.Observation="observation",e.Performance="performance",e.Persuasion="persuasion",e.Intimidation="intimidation",e.Shove="shove",e}({})),e("AdventureSkill",function(e){function t(i,t,r,l,o){var u;return void 0===l&&(l=""),void 0===o&&(o=n.Novice),(u=e.call(this,i,l,o)||this).linkedAttribute=void 0,u.displayName=void 0,u.linkedAttribute=t,u.displayName=r,u}return i(t,e),t.prototype.upgradeSkillProficiency=function(){return this.level!==n.Expert&&(this.level++,!0)},t}(r));t._RF.pop()}}}));

System.register("chunks:///_virtual/ArcherySkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CombatSkill.ts"],(function(e){var t,i,n,a;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.randomRangeInt},function(e){a=e.CombatSkill}],execute:function(){i._RF.push({},"5dd90xf3B1PEpf98SkrtKgN","ArcherySkill",void 0);e("ArcherySkill",function(e){function i(t,i,n){return e.call(this,"弓道",i,t,n)||this}t(i,e);var a=i.prototype;return a.getAffix=function(){return[{name:"射擊:配合呼吸",description:"「冷靜，配合呼吸再放弓…」",effect:{affix:"inspiration",value:1,duration:2}},{name:"射擊:穩定姿態",description:"「讓手指保持穩定…」",effect:{affix:"inspiration",value:n(2,3),duration:2}},{name:"射擊:瞄定再發",description:"「先瞄準，再發射…」",effect:{affix:"precision",value:1,duration:2}},{name:"射擊:預測準星",description:"「我看見了…能命中！」",effect:{affix:"precision",value:n(2,3),duration:2}}]},a.getSkill=function(){return[{name:"xx1",description:"「射擊技能1」",skillType:"DamageExtra",hits:"",damage:"1d4"},{name:"xx2",description:"「射擊技能2」",skillType:"HitExtra",hits:"1d4",damage:""},{name:"xx3",description:"「射擊技能3」",skillType:"HitBonus",hits:"+1",damage:""},{name:"xx4",description:"「射擊技能4」",skillType:"DamageBonus",hits:"",damage:"+1"}]},a.applySkillEffects=function(e,t,i){var a=this;if(i>this.level)console.log("等級不足");else switch(i){case 1:console.log("弱點射擊");var o={affix:"inspiration",value:n(3,6),duration:2};this.activateSkillEffect(e,o);break;case 2:console.log("精準射擊");o={affix:"precision",value:n(1,6),duration:2};this.activateSkillEffect(e,o);break;case 3:console.log("分裂箭");break;case 4:console.log("突襲射擊");break;case 5:t.forEach((function(e){console.log("光眩射擊"),Math.random()<.25&&(console.log(e.name+" is blid."),a.activateSkillEffect(e,{affix:"eye",value:1,duration:3}))}));break;case 6:console.log("末日之雨"),t.forEach((function(e){}))}},a.getSkill1=function(){return[{serialId:"skill1",level:1,name:"復仇",description:"承受攻擊時進行反擊6點。",cost:{type:"Reaction",fee:1},modifiers:[{attribute:"DamageBonus",bonus:"+6",duration:1,conditions:["Melee","UnderDamage"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"閃避反擊",description:"閃避攻擊後進行反擊4點。",cost:{type:"Reaction",fee:1},modifiers:[{attribute:"DamageBonus",bonus:"+4",duration:1,conditions:["Melee","Dodge"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"卸力",description:"在承受傷害時減緩衝擊，以臨時生命6點作為可承受的傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"Defense",bonus:"+6",duration:1,conditions:["Hitpoints"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"預判",description:"察覺敵人動向，提前行動。下一輪攻擊有優勢",cost:{type:"Intent",fee:1},modifiers:[{attribute:"Attack",bonus:"+6",duration:1,conditions:["Advantage"]}],target:"self",range:"Melee",type:"damage",animation:"attack"}]},a.getSkill2=function(){return[{serialId:"skill1",level:1,name:"拳擊",description:"使用拳擊動作助攻，+1命中。徒手時傷害+1。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+1",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+1",duration:1,conditions:["Melee","Unarmed"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"猛擊",description:"使用敲擊動作助攻，+1命中。武器有鈍器屬性時+4點傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+1",duration:1,conditions:["Melee"]},{attribute:"Stun",bonus:"+1",description:"武器有鈍器的特性時目標受暈眩效果。",conditions:["Melee","Bludgeoning"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"斬擊",description:"使用揮砍動作助攻，+1命中。武器有揮砍屬性時+1點傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+1",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+1",duration:1,conditions:["Melee","Slashing"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"突刺",description:"使用穿刺動作助攻，+1命中。若武器有穿刺屬性時+1點傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+1",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+1",duration:1,conditions:["Melee","Piercing"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"反手格擋",description:"攻守合一，+1命中、+1臨時護甲值。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+1",duration:1,conditions:["Melee"]},{attribute:"Defense",bonus:"+1",duration:1,conditions:["Defense"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"專注防禦",description:"專心防禦，+2臨時護甲值。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"Defense",bonus:"+2",duration:1,conditions:["Defense"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"靈活步伐",description:"攻擊時讓腳步靈動，+1命中，+2臨時護甲值。但你穿著重甲時無法靈活行動而失敗。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+1",duration:1,conditions:["Melee","LightArmor"]},{attribute:"Defense",bonus:"+2",duration:1,conditions:["Defense","LightArmor"]}],target:"self",range:"Melee",type:"damage",animation:"attack"}]},a.getSkill3=function(){return[{serialId:"skill1",level:1,name:"拳擊+1",description:"使用拳擊動作助攻，+3命中。徒手時傷害+2。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+3",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+2",duration:1,conditions:["Melee","Unarmed"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"猛擊+1",description:"使用敲擊動作助攻，+2命中。武器有鈍器屬性時+6點傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+2",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+6",duration:1,conditions:["Melee","Bludgeoning"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"斬擊+1",description:"使用揮砍動作助攻，+2命中。武器有揮砍屬性時+4點傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+4",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+2",duration:1,conditions:["Melee","Slashing"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"突刺+1",description:"使用穿刺動作助攻，+2命中。若武器有穿刺屬性時+4點傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+2",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+4",duration:1,conditions:["Melee","Piercing"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"反手格擋+1",description:"攻守合一，+2命中、+2臨時護甲值。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+2",duration:1,conditions:["Melee"]},{attribute:"Defense",bonus:"+2",duration:1,conditions:["Defense"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"力量熟練",description:"若有武器熟練時+2點力量傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"DamageBonus",bonus:"+2",duration:1,conditions:["Melee","strength"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"專注防禦+1",description:"專心防禦，+4臨時護甲值。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"Defense",bonus:"+4",duration:1,conditions:["Defense"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"狡詐技巧",description:"使用假動作誘導敵人，額外造成1d4命中。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitExtra",bonus:"1d4",duration:1,conditions:["Melee"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"靈活步伐+1",description:"攻擊時讓腳步靈動，+2命中，+3臨時護甲值。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+2",duration:1,conditions:["Melee"]},{attribute:"Defense",bonus:"+3",duration:1,conditions:["Defense"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"突襲",description:"趁人不備打擊敵人要害，額外傷害2d4。使用靈活武器時傷害+2",cost:{type:"Intent",fee:1},modifiers:[{attribute:"DamageExtra",bonus:"2d4",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+2",duration:1,conditions:["Melee","Finesse"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"打擊弱點",description:"專心打擊敵人要害，額外傷害1d4。武器有穿刺屬性時傷害+2",cost:{type:"Intent",fee:1},modifiers:[{attribute:"DamageExtra",bonus:"1d4",duration:1,conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+2",duration:1,conditions:["Piercing"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"復仇",description:"承受攻擊時進行反擊6點。",cost:{type:"Reaction",fee:1},modifiers:[{attribute:"DamageBonus",bonus:"+6",duration:1,conditions:["Melee","UnderDamage"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"閃避反擊",description:"閃避攻擊後進行反擊4點。但在穿著重甲時無法靈活地反擊。",cost:{type:"Reaction",fee:1},modifiers:[{attribute:"DamageBonus",bonus:"+4",duration:1,conditions:["Melee","Dodge","LightArmor"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"卸力",description:"在承受傷害時減緩衝擊，以臨時生命6點作為可承受的傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"Defense",bonus:"+6",duration:1,conditions:["Hitpoints"]}],target:"self",range:"Melee",type:"damage",animation:"attack"}]},i}(a));i._RF.pop()}}}));

System.register("chunks:///_virtual/Armor.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Item.ts"],(function(e){var t,r,a;return{setters:[function(e){t=e.inheritsLoose},function(e){r=e.cclegacy},function(e){a=e.Item}],execute:function(){r._RF.push({},"e9232ucOdFK3q1sHt4TR+KC","Armor",void 0);var i=e("ArmorStyle",function(e){return e.AllLightArmors="AllLightArmors",e.Padded="Padded",e.Leather="Leather",e.StuddedLeather="Studded Leather",e.AllMediumArmors="AllMediumArmors",e.Hide="Hide",e.ChainShirt="Chain Shirt",e.ScaleMail="Scale Mail",e.Breastplate="Breastplate",e.HalfPlate="Half Plate",e.AllHeavyArmors="AllHeavyArmors",e.RingMail="Ring Mail",e.ChainMail="Chain Mail",e.Splint="Splint",e.Plate="Plate",e}(i||{}));e("Armor",function(e){function r(t,r,a,i,l,n,s,o){var u;return(u=e.call(this,t,a,i,1)||this).armorClassBase=void 0,u.strengthRequirement=void 0,u.stealthDisadvantage=void 0,u.armorType=void 0,u.iconName=void 0,u.iconName=r,u.armorClassBase=l,u.strengthRequirement=n,u.stealthDisadvantage=s,u.armorType=o,u}t(r,e);var a=r.prototype;return a.calculateArmorClass=function(e){var t=this.getMaxDexBonus(),r=null!==t?Math.min(e,t):e;return this.armorClassBase+r},a.getMaxDexBonus=function(){switch(this.armorType){case"Light":return null;case"Medium":return 2;case"Heavy":return 0;default:return null}},r}(a));r._RF.pop()}}}));

System.register("chunks:///_virtual/ArmorDraggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Draggable.ts","./EventManager.ts","./EquipmentDropZone.ts"],(function(e){var n,t,r,o,a,i,s,l;return{setters:[function(e){n=e.inheritsLoose,t=e.createClass},function(e){r=e.cclegacy,o=e._decorator,a=e.Label},function(e){i=e.Draggable},function(e){s=e.EventManager},function(e){l=e.EquipmentDropZoneIndex}],execute:function(){var c;r._RF.push({},"47b056lZsJImI5+vts2KNpl","ArmorDraggable",void 0);var u=o.ccclass;o.property,e("ArmorDraggable",u("ArmorDraggable")(c=function(e){function r(){for(var n,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(n=e.call.apply(e,[this].concat(r))||this).nameLabel=null,n._armor=null,n.equipmentIndex=l.None,n}return n(r,e),r.prototype.onTouchStart=function(n){if(e.prototype.onTouchStart.call(this,n),this.equipmentIndex!==l.None){var t=this.zone;s.instance.emit("CharacterEquipArmor",{index:t.serialIndex,item:null}),this.equipmentIndex=l.None}},t(r,[{key:"armor",set:function(e){this._armor=e,console.log("Armor = ",e),this.nameLabel=this.node.getComponentInChildren(a),this.nameLabel.string=e.name,this.setPhotoImage(e.iconName)}},{key:"item",get:function(){return this._armor}}]),r}(i))||c);r._RF.pop()}}}));

System.register("chunks:///_virtual/AttributeAllocation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,n,o,a,l,s,r;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,l=t._decorator,s=t.Label,r=t.Component}],execute:function(){var c,u,p,b,A;a._RF.push({},"1ad13PVlEBAPb3cnjqRj12a","AttributeAllocation",void 0);var h=l.ccclass,d=l.property;t("AttributeAllocation",(c=h("AttributeAllocation"),u=d(s),c((A=i((b=function(t){function i(){for(var i,e=arguments.length,a=new Array(e),l=0;l<e;l++)a[l]=arguments[l];return i=t.call.apply(t,[this].concat(a))||this,n(i,"pointsAvailableLabel",A,o(i)),i.totalPoints=0,i.pointsUsed=0,i}e(i,t);var a=i.prototype;return a.onLoad=function(){this.updatePointsAvailableLabel()},a.allocatePoints=function(t){return this.pointsUsed+t<=this.totalPoints&&(this.pointsUsed+=t,this.updatePointsAvailableLabel(),!0)},a.freePoints=function(t){this.pointsUsed-=t,this.updatePointsAvailableLabel()},a.updatePointsAvailableLabel=function(){this.pointsAvailableLabel.string="Available Points: "+(this.totalPoints-this.pointsUsed)},i}(r)).prototype,"pointsAvailableLabel",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=b))||p));a._RF.pop()}}}));

System.register("chunks:///_virtual/AttributeComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AttributeAllocation.ts"],(function(t){var e,i,n,r,a,u,o,l,c,s,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized,a=t.createClass},function(t){u=t.cclegacy,o=t._decorator,l=t.Label,c=t.Button,s=t.Component},function(t){b=t.AttributeAllocation}],execute:function(){var p,f,h,m,y,d,A,_,g,V,B,L,v;u._RF.push({},"587242a40JCjqpB/v5QWP6G","AttributeComponent",void 0);var z=o.ccclass,C=o.property;t("AttributeComponent",(p=z("AttributeComponent"),f=C(l),h=C(l),m=C(c),y=C(c),d=C(b),p((g=e((_=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),u=0;u<i;u++)a[u]=arguments[u];return e=t.call.apply(t,[this].concat(a))||this,n(e,"attributeNameLabel",g,r(e)),n(e,"attributeValueLabel",V,r(e)),n(e,"increaseButton",B,r(e)),n(e,"decreaseButton",L,r(e)),n(e,"allocation",v,r(e)),e._attributeName="",e._attributeValue=0,e}i(e,t);var u=e.prototype;return u.onLoad=function(){this.increaseButton.node.on("click",this.increaseAttribute,this),this.decreaseButton.node.on("click",this.decreaseAttribute,this)},u.increaseAttribute=function(){this.allocation.allocatePoints(1)&&this.Value++},u.decreaseAttribute=function(){this._attributeValue>0&&(this.allocation.freePoints(1),this.Value--)},a(e,[{key:"Value",get:function(){return this._attributeValue},set:function(t){this._attributeValue=t,this.attributeValueLabel.string=this._attributeName+": "+this._attributeValue}},{key:"Name",get:function(){return this._attributeName},set:function(t){this._attributeName=t}}]),e}(s)).prototype,"attributeNameLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(_.prototype,"attributeValueLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(_.prototype,"increaseButton",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(_.prototype,"decreaseButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(_.prototype,"allocation",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=_))||A));u._RF.pop()}}}));

System.register("chunks:///_virtual/AudioController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var e,t,r,n,i,u,c,a,l;return{setters:[function(o){e=o.applyDecoratedDescriptor,t=o.inheritsLoose,r=o.initializerDefineProperty,n=o.assertThisInitialized},function(o){i=o.cclegacy,u=o._decorator,c=o.AudioSource,a=o.assert,l=o.Component}],execute:function(){var s,p,d,f,y;i._RF.push({},"c714bqcI0FN4Y+9uQVoTRJe","AudioController",void 0);var h=u.ccclass,v=u.property;o("AudioController",(s=h("AudioController"),p=v(c),s((y=e((f=function(o){function e(){for(var e,t=arguments.length,i=new Array(t),u=0;u<t;u++)i[u]=arguments[u];return e=o.call.apply(o,[this].concat(i))||this,r(e,"_audioSource",y,n(e)),e}t(e,o);var i=e.prototype;return i.onLoad=function(){var o=this.node.getComponent(c);a(o),this._audioSource=o},i.start=function(){var o=this,e=document.querySelector("video");if(e){var t=e.play();void 0!==t&&t.then((function(e){o.play()})).catch((function(o){console.log("Autoplay prevented")}))}},i.play=function(){this._audioSource.play()},i.pause=function(){this._audioSource.pause()},e}(l)).prototype,"_audioSource",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=f))||d));i._RF.pop()}}}));

System.register("chunks:///_virtual/BaseCardDisplay.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CardComponent2.ts"],(function(e){var n,t,o,i,r,a,l,s,c,d,u,p,f,h,C,g,v,b;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,l=e.Prefab,s=e.Node,c=e.CCInteger,d=e.Sprite,u=e.Color,p=e.UITransform,f=e.Layout,h=e.Button,C=e.Vec3,g=e.tween,v=e.Component},function(e){b=e.CardComponent}],execute:function(){var m,P,y,N,S,w,I,x,M,z,D;r._RF.push({},"bf0beYLhbxN67m5aSRVMCJL","BaseCardDisplay",void 0);var L=a.ccclass,B=a.property;e("BaseCardDisplay",(m=L("BaseCardDisplay"),P=B(l),y=B(s),N=B(s),S=B(c),m((x=n((I=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return n=e.call.apply(e,[this].concat(r))||this,o(n,"cardPrefab",x,i(n)),o(n,"positionContainer",M,i(n)),o(n,"cardContainer",z,i(n)),o(n,"selectedPositionY",D,i(n)),n.oriPositionY=0,n.selected=[],n.selectedCardNodes=[],n.originalIndexMap=new Map,n}t(n,e);var r=n.prototype;return r.initPositionNodes=function(e){this.positionContainer.removeAllChildren();for(var n=0;n<e;n++){var t=new s;t.name="Position_"+n,t.parent=this.positionContainer,t.addComponent(d).color=u.RED,t.getComponent(p).setContentSize(100,100)}},r.followPosition=function(){this.node.active=!0,this.updatePositionLayout();var e=this.cardContainer.children,n=this.positionContainer.children;console.log("followPosition cardNodes.length:",e.length),console.log("followPosition positionNodes.length:",n.length),e.length===n.length?n.forEach((function(n,t){e[t].setPosition(n.position),console.log("followPosition positionNode.position:",n.position)})):console.error("卡牌數量與定位節點數量不符")},r.setToggleSelection=function(e){var n=this;void 0===e&&(e=null),this.cardContainer.children.forEach((function(t){t.on("click",(function(){return n.toggleCardSelection(t,e)}),n)}))},r.stopToggleSelection=function(){this.cardContainer.children.forEach((function(e){e.off("click")}))},r.toggleCardSelection=function(e,n){var t=this;void 0===n&&(n=null);var o=this.selectedCardNodes.includes(e);if(o){this.selectedCardNodes=this.selectedCardNodes.filter((function(n){return n!==e}));var i=this.originalIndexMap.get(e)||0;e.setSiblingIndex(i)}else this.selectedCardNodes.push(e),this.originalIndexMap.set(e,e.getSiblingIndex()),e.setSiblingIndex(this.cardContainer.children.length-1);var r=o?0:this.selectedPositionY;this.animateSelectCardMovement(e,r).then((function(){null==n||n(o),console.log("toggleCardSelection selectedCardNodes:",t.selectedCardNodes)}))},r.updatePositionLayout=function(){var e=this.positionContainer.getComponent(f);e.enabled=!0,e.updateLayout(),e.enabled=!1},r.unselectAllCards=function(){var e=this;return console.log("取消所有共",this.selected.length,"張卡牌選取"),this.selected.length=0,Promise.all(this.selectedCardNodes.map((function(n){return e.animateSelectCardMovement(n,0).then((function(){e.selectedCardNodes=e.selectedCardNodes.filter((function(e){return e!==n}));var t=e.originalIndexMap.get(n)||0;n.setSiblingIndex(t)}))})))},r.getCardNodes=function(e){var n=[];return this.cardContainer.children.forEach((function(t){var o=t.getComponent(b);e.find((function(e){o&&o.card===e&&n.push(t)}))})),n},r.animateSelectCardMovement=function(e,n){var t=this,o=e.getComponent(h);return o.interactable=!1,new Promise((function(i){var r=t.oriPositionY+n,a=new C(e.position.x,r,e.position.z);g(e).to(.25,{position:a},{easing:"quadInOut"}).call((function(){o.interactable=!0,i()})).start()}))},n}(v)).prototype,"cardPrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(I.prototype,"positionContainer",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(I.prototype,"cardContainer",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=n(I.prototype,"selectedPositionY",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),w=I))||w));r._RF.pop()}}}));

System.register("chunks:///_virtual/Card.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"b67e4ftXxNI+IGCQiVuo91W","Card",void 0);i("Card",(function(){this.suit=void 0,this.rank=void 0,this.conditions=void 0})),i("CombatCard",(function(){this.name=void 0,this.description=void 0,this.cost=void 0,this.modifiers=void 0,this.target=void 0})),i("TipCard",(function(){this.string=void 0,this.type=void 0,this.description=void 0,this.behavior=void 0,this.action=void 0,this.conditions=void 0,this.coping=void 0,this.response=void 0,this.dc=void 0,this.success=void 0,this.failure=void 0,this.link=void 0,this.value=void 0,this.pic=void 0}));t._RF.pop()}}}));

System.register("chunks:///_virtual/CardCombatTest.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TeamMember.ts","./Ability.ts","./Character.ts","./EventManager.ts","./CharacterInfo.ts","./Weapon.ts","./Armor.ts","./Shield.ts","./ParticleEffectComponent.ts","./Inventory.ts","./ClassFeatureImplementation.ts","./UIManager.ts","./CombatController.ts"],(function(t){var e,n,r,i,a,o,c,l,s,m,h,u,d,f,g,y,p,b,v,C,I,w,E;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){a=t.cclegacy,o=t._decorator,c=t.instantiate,l=t.randomRangeInt,s=t.Component},function(t){m=t.TeamMember},function(t){h=t.Attribute},function(t){u=t.Character},function(t){d=t.EventManager},function(t){f=t.CharacterInfo},function(t){g=t.Weapon,y=t.WeaponStyle},function(t){p=t.Armor},function(t){b=t.Shield},function(t){v=t.ParticleEffectComponent},function(t){C=t.Inventory},function(t){I=t.warriorFeatures},function(t){w=t.UIEvent},function(t){E=t.CombatControllerEvent}],execute:function(){var S,A,M,P,T,D,L,z,F;a._RF.push({},"67cf2gqfz5JJKd+peoFZl++","CardCombatTest",void 0);var x=o.ccclass,_=o.property;t("default",(S=x("CardCombatCheckTest"),A=_(f),M=_(v),P=_(C),S((L=e((D=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a))||this,r(e,"characterInfo",L,i(e)),r(e,"particleEffect",z,i(e)),r(e,"inventory",F,i(e)),e.monsterEmeny=null,e.emenyParam={constitution:5,spirit:20,willpower:15},e.emenyAC=10,e}n(e,t);var a=e.prototype;return a.start=function(){var t,e=this;d.instance.on("battleStart",this.battleStart,this),[new g("長劍","15 gold",3,y.Longsword,"long_swood",{dice:"1d8",dice2:"1d10",type:"Slashing"},["Versatile"],"Melee"),new g("銅錘","2 gold",2,y.LightHammer,"hammer",{dice:"1d4",type:"Bludgeoning"},["Light","Thrown"],"Melee"),new g("匕首","2 gold",1,y.Dagger,"dagger",{dice:"1d4",type:"Piercing"},["Finesse","Light","Thrown"],"Melee"),new g("手斧","5 gold",2,y.Handaxe,"axe",{dice:"1d6",type:"Slashing"},["Light","Thrown"],"Melee")].forEach((function(t){return e.inventory.addItem(t)})),[new p("綿甲","padded","5 gold",8,11,0,"Disadvantage","Light"),new p("生皮甲","rawhide","10 gold",12,12,0,"None","Medium"),new p("鎖子甲","chainmail","75 gold",55,16,13,"Disadvantage","Heavy")].forEach((function(t){return e.inventory.addItem(t)})),this.inventory.addItem(new b("盾牌","shield","5 gold",9,2));var n=((t={})[h.Strength]=15,t[h.Dexterity]=14,t[h.Intelligence]=13,t[h.Wisdom]=12,t[h.Charisma]=10,t[h.Resilience]=8,t);this.characterInfo.character=new u("warrior",1,n,I),this.characterInfo.rollInitiativeOrder(),d.instance.emit(w.BaseAbilityAllocation,{allocatePoints:0,baseAbilities:n});var r=c(this.characterInfo.member.node);this.monsterEmeny=r.getComponent(m)},a.onDestroy=function(){d.instance.off("battleStart",this.battleStart,this)},a.battleStart=function(){this.characterInfo.rollInitiativeOrder(),this.emenyParam.constitution+=l(1,10),this.emenyAC=Math.min(18,Math.max(this.emenyAC,this.emenyAC+l(-1,2))),this.monsterEmeny.monsterInitial("monster",this.emenyParam,this.emenyAC),this.monsterEmeny.rollInitiativeOrder(1);var t=this.characterInfo.member;d.instance.emit(E.InitiativeOrder,{mainCharacter:t,team:[[t],[this.monsterEmeny]]})},a.onBattleStartClicked=function(t){t.target.active=!1,this.battleStart()},e}(s)).prototype,"characterInfo",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(D.prototype,"particleEffect",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(D.prototype,"inventory",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=D))||T));a._RF.pop()}}}));

System.register("chunks:///_virtual/CardComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var t,n,e,i,a,o,c,u;return{setters:[function(r){t=r.applyDecoratedDescriptor,n=r.inheritsLoose,e=r.initializerDefineProperty,i=r.assertThisInitialized},function(r){a=r.cclegacy,o=r._decorator,c=r.Label,u=r.Component}],execute:function(){var l,s,p,d,f,h,y;a._RF.push({},"398eaEOcg5IPKuVXD3G9D9s","CardComponent",void 0);var g=o.ccclass,m=o.property;r("CardComponent",(l=g("CardComponent"),s=m(c),p=m(c),l((h=t((f=function(r){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=r.call.apply(r,[this].concat(a))||this,e(t,"cardSuit",h,i(t)),e(t,"cardRank",y,i(t)),t.card=null,t}return n(t,r),t.prototype.setup=function(r){this.card=r,this.cardSuit.string=r.name,this.cardRank.string=r.description},t}(u)).prototype,"cardSuit",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(f.prototype,"cardRank",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=f))||d));a._RF.pop()}}}));

System.register("chunks:///_virtual/CardComponent2.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var t,n,e,i,a,o,c,u;return{setters:[function(r){t=r.applyDecoratedDescriptor,n=r.inheritsLoose,e=r.initializerDefineProperty,i=r.assertThisInitialized},function(r){a=r.cclegacy,o=r._decorator,c=r.Label,u=r.Component}],execute:function(){var l,s,p,d,f,h,y;a._RF.push({},"a2c30irv0FH6YP5VA6kIv7h","CardComponent",void 0);var v=o.ccclass,C=o.property;r("CardComponent",(l=v("CardComponent"),s=C(c),p=C(c),l((h=t((f=function(r){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=r.call.apply(r,[this].concat(a))||this,e(t,"cardSuit",h,i(t)),e(t,"cardRank",y,i(t)),t.card=void 0,t}return n(t,r),t.prototype.setup=function(r){this.card=r,this.cardSuit.string=["♠","♥","♦","♣"][r.suit],this.cardRank.string=r.rank},t}(u)).prototype,"cardSuit",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(f.prototype,"cardRank",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=f))||d));a._RF.pop()}}}));

System.register("chunks:///_virtual/CardMover.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,o,r,a,i,c;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,o=n._decorator,r=n.UITransform,a=n.tween,i=n.Vec3,c=n.Component}],execute:function(){var s;e._RF.push({},"84f9242HqlIxoYCUsq4N1ow","CardMover",void 0);var u=o.ccclass;n("CardMover",u("CardMover")(s=function(n){function e(){return n.apply(this,arguments)||this}return t(e,n),e.moveCard=function(n,t,e,o,a){void 0===o&&(o=.02),void 0===a&&(a=.25);var i=n.parent;if(i===t)return this.animateCardMovement(n,e,o,a);var c=i.getComponent(r).convertToWorldSpaceAR(n.position);n.removeFromParent(),n.parent=t;var s=t.getComponent(r).convertToNodeSpaceAR(c);return n.setPosition(s),this.animateCardMovement(n,e,o,a)},e.animateCardMovement=function(n,t,e,o){return new Promise((function(r){var i=a().delay(e).call((function(){return r()})),c=a(n).to(o,{position:t},{easing:"quadInOut"});a(n).parallel(c,i).start()}))},e.scatterCards=function(n,t,e,o){return new Promise((function(r){n.forEach((function(n){var c=e[0],s=e[1],u=2*Math.random()*Math.PI,d=c+Math.random()*(s-c),v=new i(Math.cos(u),Math.sin(u),0),l=i.scaleAndAdd(new i,t.position,v,d);a(n).to(o,{position:l},{easing:"cubicOut"}).call((function(){return r()})).start()}))}))},e}(c))||s);e._RF.pop()}}}));

System.register("chunks:///_virtual/CardReward.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RewardCards.ts","./EventManager.ts","./GameEvents.ts"],(function(e){var r,t,n,a,i,o,c,s,l,d,u,p,f,y;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){i=e.cclegacy,o=e._decorator,c=e.Node,s=e.Vec3,l=e.UIOpacity,d=e.tween,u=e.Component},function(e){p=e.RewardCards},function(e){f=e.EventManager},function(e){y=e.PlayerHandCardEvent}],execute:function(){var w,v,h,C,b,g,R;i._RF.push({},"48690Waly9Mo67Q2dd2F4P4","CardReward",void 0);var m=o.ccclass,E=o.property;e("CardReward",(w=m("CardReward"),v=E(c),h=E(p),w((g=r((b=function(e){function r(){for(var r,t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return r=e.call.apply(e,[this].concat(i))||this,n(r,"blocker",g,a(r)),n(r,"rewardCards",R,a(r)),r}t(r,e);var i=r.prototype;return i.show=function(e){this.node.position=s.ZERO,this.node.active=e;var r=this.blocker.getComponent(l);r.opacity=0,e&&d(r).delay(.1).to(.25,{opacity:185},{easing:"linear"}).start()},i.init=function(e){f.instance.emit(y.ShowCards,e)},r}(u)).prototype,"blocker",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=r(b.prototype,"rewardCards",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=b))||C));i._RF.pop()}}}));

System.register("chunks:///_virtual/Character.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Ability.ts"],(function(i){var e,t,r,o;return{setters:[function(i){e=i.extends,t=i.createForOfIteratorHelperLoose},function(i){r=i.cclegacy},function(i){o=i.Attribute}],execute:function(){r._RF.push({},"0514f2WZqhIVoc4soO6O7Rc","Character",void 0);i("Character",function(){function i(i,e,t,r,o){void 0===o&&(o=30),this.name=void 0,this.level=void 0,this.abilities=void 0,this.primaryAttribute=null,this.savingThrowProficiencies=[],this.armorProficiencies=[],this.weaponProficiencies=[],this.movement=void 0,this.ethnicity=void 0,this.skills={},this.name=i,this.level=e,this.abilities=t,this.primaryAttribute=r.primaryAttribute,this.savingThrowProficiencies=r.savingThrowProficiencies,this.armorProficiencies=r.armorProficiencies,this.weaponProficiencies=r.weaponProficiencies,this.movement=o}var r=i.prototype;return r.calculateClassProficiencyBonus=function(){return this.level>=17?6:this.level>=13?5:this.level>=9?4:this.level>=5?3:2},r.calculateAbilityScoreModifier=function(i){return Math.floor(this.abilities[i]/2)-5},r.calculateProficienciesBonus=function(){for(var i,r,c=((i={})[o.Strength]=this.calculateAbilityScoreModifier(o.Strength),i[o.Dexterity]=this.calculateAbilityScoreModifier(o.Dexterity),i[o.Intelligence]=this.calculateAbilityScoreModifier(o.Intelligence),i[o.Wisdom]=this.calculateAbilityScoreModifier(o.Wisdom),i[o.Charisma]=this.calculateAbilityScoreModifier(o.Charisma),i[o.Resilience]=this.calculateAbilityScoreModifier(o.Resilience),i),s=this.calculateClassProficiencyBonus(),l=e({},c),n=t(this.savingThrowProficiencies);!(r=n()).done;){var a=r.value;console.log("豁免:",a),l[a]+=s}return l},r.calculateCompositeAbilities=function(){var i,e=this.abilities,t=e.strength,r=e.dexterity,c=e.intelligence,s=e.wisdom,l=e.charisma,n=e.resilience;return(i={})[o.Constitution]=Math.floor((2*t+r+n)/2)+10,i[o.Spirit]=Math.floor((2*c+s)/2)+10,i[o.Willpower]=Math.floor((2*n+l)/2)+10,i},i}());r._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterCard.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts","./EventManager.ts","./CharacterCreation.ts","./DataModal.ts"],(function(t){var e,r,a,n,c,i,o,l,s,u,h,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,a=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){c=t.cclegacy,i=t._decorator,o=t.Node,l=t.Component},function(t){s=t.UIEvent},function(t){u=t.EventManager},function(t){h=t.CharacterCreation},function(t){p=t.DataModal}],execute:function(){var f,C,d,v,g,y,b;c._RF.push({},"32d14+mAKBH+pOsmuI+4ah2","CharacterCard",void 0);var m=i.ccclass,D=i.property;t("CharacterCard",(f=m("CharacterCard"),C=D(o),d=D(h),f((y=e((g=function(t){function e(){for(var e,r=arguments.length,c=new Array(r),i=0;i<r;i++)c[i]=arguments[i];return e=t.call.apply(t,[this].concat(c))||this,a(e,"closeBtn",y,n(e)),a(e,"characterCreation",b,n(e)),e._character=null,e}r(e,t);var c=e.prototype;return c.onLoad=function(){this._character=p.getInstance().playerCharacter,this.closeBtn.active=!!this._character},c.onClicked=function(){this.closeBtn.active||(this.characterCreation.phaseID="ethnicity",this.node.active=!1)},c.onDeleteClicked=function(){u.instance.emit(s.PopupWindow,"刪除角色","你確定要刪除這個角色嗎？",[{label:"確定",callback:function(){return console.log("退出游戏")}},{label:"取消",callback:function(){return console.log("取消操作")}}])},e}(l)).prototype,"closeBtn",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=e(g.prototype,"characterCreation",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=g))||v));c._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterCreation.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts","./DescriptionCrossword.ts","./DescriptionScrollView.ts","./FillBlanks.ts","./DataModal.ts","./Character.ts","./ClassFeatureImplementation.ts","./UIManager.ts","./InventoryCollection.ts"],(function(e){var t,i,o,n,s,r,c,a,l,p,h,d,u,w,f,C,_,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized,s=e.createClass},function(e){r=e.cclegacy,c=e._decorator,a=e.Component},function(e){l=e.EventManager},function(e){p=e.CrosswordType},function(e){h=e.DescriptionScrollView},function(e){d=e.FillBlanks},function(e){u=e.DataModal},function(e){w=e.Character},function(e){f=e.rogueFeatures,C=e.warriorFeatures},function(e){_=e.UIEvent},function(e){g=e.InventoryCollection}],execute:function(){var v,D,y,I,b,k,S;r._RF.push({},"ec9a6Q1sMdCpKlzblxIIDFj","CharacterCreation",void 0);var V=c.ccclass,F=c.property;e("CharacterCreation",(v=V("CharacterCreation"),D=F(g),y=F(h),v((k=t((b=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return t=e.call.apply(e,[this].concat(s))||this,o(t,"inventoryCollection",k,n(t)),o(t,"descriptionScrollView",S,n(t)),t._keepWords=[],t._phaseId="",t._linkId="",t._responseId="",t._copingChance=0,t._choiceCallback=null,t._optionData=null,t.characterName=void 0,t.characterLevel=1,t.characterAbilities=void 0,t.classFeature=void 0,t._ethnicity="",t}i(t,e);var r=t.prototype;return r.onEnable=function(){l.instance.on("DescriptionScrollViewEnd",this.onDescriptionScrollViewEnd,this),l.instance.on("DescriptionCrosswordAnswered",this.onDescriptionCrosswordAnswered,this)},r.onDisable=function(){l.instance.off("DescriptionScrollViewEnd",this.onDescriptionScrollViewEnd,this),l.instance.off("DescriptionCrosswordAnswered",this.onDescriptionCrosswordAnswered,this)},r.onDescriptionScrollViewEnd=function(e){var t=this;if(console.log("this.data:",this._optionData),0!==this._optionData.chance){var i=this.descriptionScrollView.tipCards;0===i.length?this._linkId!=this._phaseId?this.descriptionScrollView.setChooseButtons([{text:"繼續",callback:function(){return t.phaseID=t._linkId}}]):this.closeDescriptionView():this.nextStep(i)}else this.closeDescriptionView()},r.onDescriptionCrosswordAnswered=function(e){var t,i=this,o=e.answers,n=e.sentence;if(console.log("answers:",o,"sentence:",n,"this._responseId:",this._responseId),this._responseId){var s=this._optionData.behavior.response[this._responseId];this._responseId="",d.replaceMarkedWithKeywords(s,[]).forEach((function(e,t){console.log("replaced content:",e);e.tipCards.forEach((function(e){if("_"===e.string?Object.keys(e).every((function(t){return"string"===t||(console.log("檢查條件:",t),o.some((function(i){return i[t]===e[t]})))})):e.string===o[0].string){var r=d.answerQuestion(s[t],o.map((function(e){return e.string})));console.log("questionAnswer:",r),i.descriptionScrollView.addNewData([n,r])}}))}))}else console.log("沒有後續，用問答題組回應"),this.descriptionScrollView.addNewData([n]);null==(t=this._choiceCallback)||t.call(this,o)},r.start=function(){},r.closeDescriptionView=function(){var e=this;this.descriptionScrollView.setChooseButtons([{text:"關閉",callback:function(){e.descriptionScrollView.show(!1);var t=new w("char name",1,e.characterAbilities,e.classFeature);t.ethnicity=e._ethnicity,u.getInstance().playerCharacter=t,console.log("完成角色建構"),l.instance.emit("StartStory"),e.node.active=!1}}])},r.setDescriptionCrossword=function(e,t,i){var o=e.choice[t.response],n=d.replaceMarkedWithKeywords([o],[])[0],s=this.descriptionScrollView.tipCards;l.instance.emit(p.SetAnswerQuestion,s,n.text,n.tipCards,i)},r.creationChoiceByType=function(e){var t=this;switch(console.log("tipCard:",e),e.type){case"ethnicity":this._responseId=e.response,this._choiceCallback=function(e){var i=e[0];t._ethnicity=i.string,t._linkId="ability"};break;case"ability":this._responseId="",this._choiceCallback=function(e){var i=[15,14,13,12,10,8],o={};e.forEach((function(e){var t=e.coping;return o[t]=i.shift()})),t.characterAbilities=o,t._linkId="classFeature"};break;case"classFeature":this._responseId=e.response,this._choiceCallback=function(e){var i=e[0];switch(console.log("選擇",i.string),i.coping){case"warrior":t.classFeature=C;break;case"rogue":t.classFeature=f}u.getInstance().playerCharacter=new w("warrior",1,t.characterAbilities,t.classFeature),l.instance.emit(_.UpdateCharacterInfo)};break;case"armor":this._responseId=e.response,console.log("tipCard.response:",e.response),this._choiceCallback=function(e){var t=e[0];console.log("選擇護甲",t.string)};break;case"weapon":this._responseId=e.response,console.log("tipCard.response:",e.response),this._choiceCallback=function(e){var t=e[0];console.log("選擇武器",t.string)}}},r.nextStep=function(e){var t=this,i=this._optionData.behavior,o=[];e.forEach((function(e){if("choice"===e.behavior)t.descriptionScrollView.deleteCard(e),t.setDescriptionCrossword(i,e,["type"]),t.creationChoiceByType(e),t.descriptionScrollView.clearTipCards(),o.push("choice "+e.behavior);else if("collect"===e.action)t.descriptionScrollView.deleteCard(e),t.inventoryCollection.collect(e),o.push("collect: "+e.string);else if(e.response){t.descriptionScrollView.deleteCard(e),t._responseId=e.response;var n=i.response[e.response];t.descriptionScrollView.addNewData(n),o.push("response "+e.response)}else e.link&&(t.descriptionScrollView.deleteCard(e),t.descriptionScrollView.setChooseButtons([{text:e.string,callback:function(){return t.phaseID=e.link}}]),o.push("link "+e.link))})),console.log("處理的工作:",o)},s(t,[{key:"phaseID",set:function(e){if(this._phaseId=this._linkId=e,this._optionData=u.getInstance().storyData.options[e],this._optionData){console.log("set linkID:",e,"data:",this._optionData);var t=this._optionData,i=t.chance,o=(t.response,t.descriptions);this._copingChance=i,this.descriptionScrollView.setData(o),this.descriptionScrollView.show()}else console.error("找不到"+e+"的資料")}}]),t}(a)).prototype,"inventoryCollection",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(b.prototype,"descriptionScrollView",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=b))||I));r._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterInfo.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TeamMember.ts","./Character.ts","./Ability.ts","./EventManager.ts","./CardMover.ts","./AdventureSkill.ts","./Skill.ts","./ClassFeatureImplementation.ts"],(function(e){var t,i,n,r,a,o,s,c,l,h,u,m,f,p,d,b,C,v,g,_,w,k,S;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.createClass,o=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){c=e.cclegacy,l=e._decorator,h=e.Node,u=e.RichText,m=e.Vec3,f=e.randomRangeInt,p=e.Component},function(e){d=e.TeamMember},function(e){b=e.Character},function(e){C=e.Attribute},function(e){v=e.EventManager},function(e){g=e.CardMover},function(e){_=e.AdventureSkill,w=e.Adventure},function(e){k=e.SkillProficiency},function(e){S=e.warriorFeatures}],execute:function(){var y,A,I,E,q,x,D,B,P;c._RF.push({},"82acfU+CGFNcJsOleMa9nq0","CharacterInfo",void 0);var W=l.ccclass,M=l.property;e("CharacterInfo",(y=W("CharacterInfo"),A=M(d),I=M(h),E=M(u),y((D=t((x=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,n(t,"member",D,r(t)),n(t,"characterInfoPos",B,r(t)),n(t,"abilitiesInfoText",P,r(t)),t._character=null,t._proficiencyAbilities=null,t._combatCardDeck=[],t._combatSkills=[],t._weapons=[],t._armor=null,t._shield=null,t._adventureSkills=[],t._missions=[],t}i(t,e);var c=t.prototype;return c.onLoad=function(){v.instance.on("CharacterEquipWeapon",this.onEquipWeapon,this),v.instance.on("CharacterEquipArmor",this.onEquipArmor,this),v.instance.on("CharacterEquipShield",this.onEquipShield,this),v.instance.on("CharacterUnequip",this.onUnequip,this),v.instance.on("ResultBattle",this.onResultBattle,this),v.instance.on("CopingSkillButtonClickEvent",this.onCopingSkillButtonClickEvent,this),v.instance.on("UnderAttackDamage",this.onUnderAttackDamage,this)},c.onDestroy=function(){v.instance.off("CharacterEquipWeapon",this.onEquipWeapon,this),v.instance.off("CharacterEquipArmor",this.onEquipArmor,this),v.instance.off("CharacterEquipShield",this.onEquipShield,this),v.instance.off("CharacterUnequip",this.onUnequip,this),v.instance.off("ResultBattle",this.onResultBattle,this),v.instance.off("CopingSkillButtonClickEvent",this.onCopingSkillButtonClickEvent,this),v.instance.off("UnderAttackDamage",this.onUnderAttackDamage,this)},c.start=function(){this.node.position=m.ZERO},c.init=function(){this._adventureSkills=[new _(w.Stunts,C.Dexterity,"特技","肢體動作能演繹出超乎常人的巧妙"),new _(w.Stealth,C.Dexterity,"隱匿","身形藏於目標的眼光之外而被忽視"),new _(w.Dexterity,C.Dexterity,"巧手","細微且冷靜地靈活運用手腕乃至手指"),new _(w.Knowledge,C.Intelligence,"知識","常鑽研書中的事物而獲得深厚的學問"),new _(w.Experience,C.Intelligence,"閱歷","長期冒險時得到的經驗與觀察力"),new _(w.Nature,C.Intelligence,"自然","遵循萬物平衡真理而存留下的軌跡"),new _(w.Religion,C.Intelligence,"宗教","從信仰的神明到儀式的文化有所認識"),new _(w.Explore,C.Intelligence,"探索","從調查細節乃搜索區域而得到訊息"),new _(w.Nursing,C.Wisdom,"護理","發現生理結構的徴結而掌握的救護"),new _(w.Awareness,C.Wisdom,"覺察","藉由察顏觀色而獲得行動先機"),new _(w.Taming,C.Wisdom,"馴服","理解並能受到動物的認同而接受指令"),new _(w.Survival,C.Wisdom,"生存","在野外生存或遭受意外的判斷與技巧"),new _(w.Observation,C.Wisdom,"觀察","敏銳抓出細節差異或感受違和的發展"),new _(w.Performance,C.Charisma,"表演","將肢體化為語言來傳達的藝術表現"),new _(w.Persuasion,C.Charisma,"說服","藉由靈活的口才令聞者動搖心智"),new _(w.Intimidation,C.Charisma,"威嚇","以言語或動作表情傳達出脅迫之意"),new _(w.Shove,C.Strength,"推撞","以自身的力量推撞對手而使其退開")],v.instance.emit("InitAdventureSkills",this._adventureSkills)},c.refreshCharacterInfo=function(){var e=this;this.init(),this.member.characterInitial(this._character),this.member.disableSelect(),this._proficiencyAbilities=this._character.calculateProficienciesBonus();var t=this._character.calculateProficienciesBonus(),i=this._character.calculateCompositeAbilities(),n=this._character.abilities,r=n.strength,a=n.dexterity,o=n.intelligence,s=n.wisdom,c=n.charisma,l=n.resilience;this.abilitiesInfoText.string="姓名: "+this._character.name+"\n等級: "+this._character.level+"\n力量: "+r+"(+"+t.strength+")\n敏捷: "+a+"(+"+t.dexterity+")\n智力: "+o+"(+"+t.intelligence+")\n睿知: "+s+"(+"+t.wisdom+")\n魅力: "+c+"(+"+t.charisma+")\n韌性: "+l+"(+"+t.resilience+")\n體質: "+i.constitution+"\n精神: "+i.spirit+"\n意志: "+i.willpower+"\n"+this._adventureSkills.map((function(t){return t.displayName+": "+t.description+" | +"+e.getAdventureSkillModifier(t.name)})).join("\n")},c.upgradeAdventureSkill=function(e){var t;return!(null==(t=this._adventureSkills.find((function(t){return t.name===e})))||!t.upgradeSkillProficiency())},c.acceptMission=function(e){this._missions.push(e)},c.getAdventureSkillModifier=function(e){var t=this._adventureSkills.find((function(t){return t.name===e})),i=t.level,n=t.linkedAttribute,r=this._character.calculateAbilityScoreModifier(n);switch(i){case k.Proficient:r+=this._character.calculateClassProficiencyBonus();break;case k.Expert:r+=2*this._character.calculateClassProficiencyBonus()}return r},c.onCopingSkillButtonClickEvent=function(e){var t=e.name,i=e.copings,n=this.getAdventureSkillModifier(t),r=f(1,20);v.instance.emit("PerformCopingSkillCheck",r,n,t,i)},c.rollInitiativeOrder=function(){this.member.rollInitiativeOrder(this._proficiencyAbilities.dexterity)},c.addCombatCard=function(e){this._combatCardDeck.push(e)},c.getCombatCards=function(){return this._combatCardDeck},c.onEquipWeapon=function(e){var t=e.index,i=e.item;console.log("onEquipWeapon",t,i);var n=this._character.primaryAttribute,r=this._proficiencyAbilities[n];this.member.setWeapon(t,i,r),this.member.showCharacterInfo(),this._weapons[t]=i},c.onEquipArmor=function(e){var t=e.index,i=e.item;this.member.setArmor(t,i),this.member.showCharacterInfo(),this._armor=i},c.onEquipShield=function(e){var t=e.index,i=e.item;this.member.setShield(t,i),this.member.showCharacterInfo(),this._shield=i},c.onUnequip=function(e){var t=e.index;console.log("onCharacterUnequip",t),this.member.setWeapon(t,null),this.member.showCharacterInfo(),this._weapons[t]=null},c.onUnderAttackDamage=function(e){console.log("onDamage",e),this.member.changeHpBar(-e)},c.refreshItemInfo=function(){var e=this;this._weapons.forEach((function(t,i){var n=e._character.primaryAttribute,r=e._proficiencyAbilities[n];e.member.setWeapon(i,t,r),e.member.showCharacterInfo()})),this._armor&&this.member.setArmor(0,this._armor),this._shield&&this.member.setShield(0,this._shield)},c.onResultBattle=function(){var e=o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.moveCard(this.member.node,this.characterInfoPos,new m(0,0,0));case 2:this.member.leaveCombatTeam();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.sample=function(){var e,t=((e={})[C.Strength]=15,e[C.Dexterity]=14,e[C.Intelligence]=13,e[C.Wisdom]=12,e[C.Charisma]=10,e[C.Resilience]=8,e);this._character=new b("warrior",1,t,S)},a(t,[{key:"character",set:function(e){this._character=e,this.member.characterInitial(e),this.refreshCharacterInfo()}}]),t}(p)).prototype,"member",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(x.prototype,"characterInfoPos",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(x.prototype,"abilitiesInfoText",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=x))||q));c._RF.pop()}}}));

System.register("chunks:///_virtual/ClassFeatureImplementation.ts",["cc","./Ability.ts","./AdventureSkill.ts","./Armor.ts","./Weapon.ts"],(function(e){var r,i,a,t,n;return{setters:[function(e){r=e.cclegacy},function(e){i=e.Attribute},function(e){a=e.Adventure},function(e){t=e.ArmorStyle},function(e){n=e.WeaponStyle}],execute:function(){r._RF.push({},"390f3OgRrNHhbeJPh79FV1O","ClassFeatureImplementation",void 0);var o=[t.Padded,t.Leather,t.StuddedLeather],s=[t.Hide,t.ChainShirt,t.ScaleMail,t.Breastplate,t.HalfPlate],l=[t.RingMail,t.ChainMail,t.Splint,t.Plate],c=[n.Club,n.Dagger,n.Greatclub,n.Handaxe,n.Javelin,n.LightHammer,n.Mace,n.Quarterstaff,n.Sickle,n.Spear,n.LightCrossbow,n.Dart,n.Shortbow,n.Sling],m=[n.Battleaxe,n.Flail,n.Glaive,n.Greataxe,n.Greatsword,n.Halberd,n.Lance,n.Longsword,n.Maul,n.Morningstar,n.Pike,n.Rapier,n.Scimitar,n.ShortSword,n.Trident,n.WarPick,n.Warhammer,n.Whip,n.Blowgun,n.HandCrossbow,n.HeavyCrossbow,n.Longbow,n.Net],u=e("ClassFeatureImplementation",(function(e,r,i,a,u,h){var S=this;this.primaryAttribute=null,this.savingThrowProficiencies=[],this.armorProficiencies=[],this.weaponProficiencies=[],this.adventureProficiencies=[],this.additionalFeatures=[],this.primaryAttribute=e,this.savingThrowProficiencies=r,i.forEach((function(e){e===t.AllLightArmors?S.armorProficiencies.concat(o):e===t.AllMediumArmors?S.armorProficiencies.concat(s):e===t.AllHeavyArmors?S.armorProficiencies.concat(l):S.armorProficiencies.push(e)})),a.forEach((function(e){e===n.AllSimpleWeapons?S.weaponProficiencies=S.weaponProficiencies.concat(c):e===n.AllMartialWeapons?S.weaponProficiencies=S.weaponProficiencies.concat(m):S.weaponProficiencies.push(e)})),this.additionalFeatures=h}));e("warriorFeatures",new u(i.Strength,[i.Strength,i.Resilience],[t.AllLightArmors,t.AllMediumArmors,t.AllHeavyArmors],[n.AllSimpleWeapons,n.AllMartialWeapons],[a.Stunts,a.Taming,a.Experience,a.Awareness,a.Intimidation,a.Survival],["Combat versatility","Second wind"])),e("rogueFeatures",new u(i.Dexterity,[i.Dexterity,i.Intelligence],[t.AllLightArmors],[n.AllSimpleWeapons,n.HandCrossbow,n.Longsword,n.ShortSword,n.Rapier],[a.Stunts,a.Persuasion,a.Awareness,a.Explore,a.Performance,a.Dexterity,a.Stealth],["Expertise","Sneak attack","Thieves' cant"])),e("bardFeatures",new u(i.Charisma,[i.Charisma,i.Dexterity],[t.AllLightArmors],[n.AllSimpleWeapons,n.Dagger,n.Dart,n.Shortbow,n.ShortSword,n.Flail,n.Greataxe,n.Greatsword,n.Scimitar,n.Warhammer,n.Whip],[a.Stunts,a.Stealth,a.Dexterity,a.Knowledge,a.Experience,a.Nature,a.Religion,a.Explore,a.Nursing,a.Awareness,a.Taming,a.Survival,a.Observation,a.Performance,a.Persuasion,a.Intimidation],["Bardic Inspiration","Song of Rest","Spellcasting"])),e("warlockFeatures",new u(i.Charisma,[i.Charisma,i.Wisdom],[t.AllLightArmors],[n.AllSimpleWeapons],[a.Knowledge,a.Persuasion,a.Experience,a.Intimidation,a.Explore,a.Nature,a.Religion],["Eldritch Blast","Pact Magic","Shadow Magic"])),e("druidFeatures",new u(i.Wisdom,[i.Intelligence,i.Wisdom],[t.AllLightArmors,t.AllMediumArmors],[n.Club],[a.Knowledge,a.Taming,a.Observation,a.Nursing,a.Nature,a.Awareness,a.Religion,a.Survival],[])),e("monkFeatures",new u(i.Strength,[i.Strength,i.Dexterity],[],[n.AllSimpleWeapons,n.ShortSword],[a.Stunts,a.Experience,a.Experience,a.Observation,a.Religion,a.Stealth],["Unarmored Defense","Martial Arts","Deflect Missiles"])),e("wizardFeatures",new u(i.Intelligence,[i.Intelligence,i.Wisdom],[],[n.Dagger,n.Dart,n.Shortbow,n.ShortSword,n.Flail,n.Greataxe,n.Greatsword,n.Scimitar,n.Warhammer,n.Whip],[a.Knowledge,a.Experience,a.Observation,a.Explore,a.Nursing,a.Religion],["Arcane Recovery","Arcane Tradition","Spell Mastery"])),e("clericFeatures",new u(i.Wisdom,[i.Wisdom,i.Charisma],[t.AllLightArmors,t.AllMediumArmors],[n.AllSimpleWeapons],[a.Experience,a.Observation,a.Nursing,a.Performance,a.Religion],["Divine Intervention","Lay on Hands","Sacred Weapon"])),e("paladinFeatures",new u(i.Charisma,[i.Charisma,i.Wisdom],[t.AllLightArmors,t.AllMediumArmors,t.AllHeavyArmors],[n.AllSimpleWeapons,n.Dagger,n.Dart,n.Shortbow,n.ShortSword,n.Flail,n.Greataxe,n.Greatsword,n.Scimitar,n.Warhammer,n.Whip],[a.Stunts,a.Observation,a.Intimidation,a.Nursing,a.Persuasion,a.Religion],["Divine Sense","Lay on Hands","Divine Smite"])),e("sorcererFeatures",new u(i.Charisma,[i.Charisma,i.Resilience],[],[n.Dagger,n.Dart,n.Shortbow,n.ShortSword,n.Flail,n.Greataxe,n.Greatsword,n.Scimitar,n.Warhammer,n.Whip],[a.Knowledge,a.Persuasion,a.Observation,a.Intimidation,a.Religion],["Sorcerous Origin","Sorcerous Inspiration","Sorcerous Defense"])),e("rangerFeatures",new u(i.Dexterity,[i.Dexterity,i.Strength],[t.AllLightArmors,t.AllMediumArmors],[n.AllSimpleWeapons,n.AllMartialWeapons],[a.Taming,a.Stunts,a.Observation,a.Explore,a.Nature,a.Dexterity,a.Stealth,a.Survival],["Feral Instinct","Natural Explorer","Primal Path"])),e("barbarianFeatures",new u(i.Strength,[i.Strength,i.Resilience],[t.AllLightArmors,t.AllMediumArmors],[n.AllSimpleWeapons,n.AllMartialWeapons],[a.Taming,a.Stunts,a.Intimidation,a.Nature,a.Awareness,a.Survival],["Rage","Unarmored Defense","Reckless Attack"]));r._RF.pop()}}}));

System.register("chunks:///_virtual/CombatArmor.ts",["cc"],(function(s){var t;return{setters:[function(s){t=s.cclegacy}],execute:function(){t._RF.push({},"f8fbbhTLSdFFInIexPelVQ6","CombatArmor",void 0);s("CombatArmor",function(){function s(s,t,r){this.name=void 0,this.dexterity=void 0,this.shielded=!1,this.armorClass=void 0,this.armorDefault=null,this.isLightArmor=!1,this.isCasterArmor=!1,this.name=s||"無裝甲",this.dexterity=t,this.armorDefault=r,this.armorClass=r.calculateArmorClass(this.dexterity),console.log("this.dexterity:",this.dexterity),console.log("this.armorClass:",this.armorClass)}var t=s.prototype;return t.dress=function(s){this.armorClass=0,s?(this.armorClass=s.calculateArmorClass(this.dexterity),this.isCasterArmor="Light"===s.armorType,this.isCasterArmor||"Medium"===s.armorType?this.isLightArmor=!0:(this.isCasterArmor=!1,this.isLightArmor=!1)):(this.name="無裝甲",this.armorClass=this.armorDefault.calculateArmorClass(this.dexterity),this.isLightArmor=!0),console.log("this.dexterity:",this.dexterity),console.log("this.armorClass:",this.armorClass),console.log("this.isLightArmor:",this.isLightArmor),console.log("this.isCasterArmor:",this.isCasterArmor)},t.shield=function(s){this.shielded=s},s}());t._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCharacter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CombatEntity.ts"],(function(t){var o,e,a;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy},function(t){a=t.CombatEntity}],execute:function(){e._RF.push({},"54634mJR51DG5Lnnb/s3y99","CombatCharacter",void 0);t("CombatCharacter",function(t){function e(o,e,a,n,i){var s;return(s=t.call(this,o,e,a.dexterity,i)||this).proficiencyBonus=void 0,s.proficiencyBonus=a,s.weaponProficiencies=n,s}o(e,t);var a=e.prototype;return a.hit=function(){return this.attackHitRoll=this.rollHit(0),this.attackHitRoll},a.advantageHit=function(){var t=[this.rollHit(0),this.rollHit(0)];return this.attackHitRoll=t.sort((function(t,o){return o.roll-t.roll}))[0],t},a.disadvantageHit=function(){var t=[this.rollHit(0),this.rollHit(0)];return this.attackHitRoll=t.sort((function(t,o){return t.roll-o.roll}))[0],t},a.attack=function(t,o){var e=!1;this.bonusHitRolls.length=0,this.extraHitRolls.length=0,this.totalDamageRolls.length=0,console.log("combatWeapons:",this.combatWeapons);var a=this.combatWeapons[o],n=this.attackHitRoll;if(this.weaponProficiencyBonus=a.weaponProficiency,this.bonusHitRolls=a.hitBonus.slice(),this.extraHitRolls=a.hitExtraBonus.slice(),a.resultHitBonus(),a.hitCheck(n.roll,t.ac)){var i=a.damage,s=this.rollDamage(i);n.isFull&&(console.log("滿骰傷害值"),s+=this.rollDamage(i)),this.totalDamageRolls=[s],console.log("主手武器基本傷害:",s),this.totalDamageRolls=this.totalDamageRolls.concat(a.damageExtraBonus,a.damageBonus),t.receiveAttack(this.totalDamageRolls.reduce((function(t,o){return t+o}),0)),t.affixEffects.stun=a.stunEffect,t.affixEffects.stun>0&&t.intentContents.push("(暈眩)"),e=!0}return a.resetCombatBonus(),e||t.receiveAttack(0),e},a.counterattack=function(t){var o=this.counterattackDamageValue+this.dodgeCounterattackDamageValue;return console.log("反擊",t.name,o),t.receiveAttack(o),o>0},a.intent=function(t){var o=this,e=this.combatIntent.getModifiers();return console.log("modifiers:",e),e.forEach((function(e){var a=o.getApplicableWeapon(e);if(a){var n=o.rollDice(e.bonus);o.applyModifier(a,e.attribute,n)}var i=e.conditions,s=o.combatArmor,r=(s.isCasterArmor,s.isLightArmor);if(i.includes("Defense")){if(i.includes("LightArmor")&&!r)return void console.log("穿重甲時無法使身法靈活");o.temporaryArmor+=parseInt(e.bonus,10),t.acLabel.string="AC(+"+o.temporaryArmor+"): "+o.ac}i.includes("Hitpoints")&&(o.tempHP+=parseInt(e.bonus,10)),e.conditions.includes("Advantage")&&(o.isAdvantage=!0)})),this.combatWeapons[0].showAttackParams(),this.combatWeapons[1].showAttackParams(),this.combatIntent},a.getApplicableWeapon=function(t){var o=t.conditions;return this.actionPoints.Bonus>0&&o.includes("OffHand")&&this.checkWeaponConditions(o,this.combatWeapons[1])?this.combatWeapons[1]:this.actionPoints.Action>0&&this.checkWeaponConditions(o,this.combatWeapons[0])?this.combatWeapons[0]:(this.combatArmor.shielded&&console.log("是盾牌武器喔!!!!!!"),console.log("沒有武器適用條件"),null)},a.checkWeaponConditions=function(t,o){var e=o.range,a=o.damage,n=o.properties,i=o.weaponProficiency,s=this.combatArmor,r=s.isCasterArmor,c=s.isLightArmor,l=t.every((function(t){return a.type==t||(e==t||(!!n.some((function(o){return o==t}))||(i[t]>0||(!(!c||"LightArmor"!=t)||!(!r||"CasterArmor"!=t)))))}));return console.log("--- "+t+" Result: "+l),l},a.applyModifier=function(t,o,e){switch(console.log("Applying "+o+" bonus of "+e+" to "+t.name),o){case"HitBonus":t.hitBonusAdd(e);break;case"HitExtra":t.hitExtraAdd(e);break;case"DamageBonus":t.damageAdd(e);break;case"DamageExtra":t.extraDamageAdd(e);break;case"Stun":t.stunEffectAdd(e)}},a.reaction=function(){var t=this,o=!1,e=this.combatIntent.getReactionIntent();console.log("reactionModifiers length:",e.length);var a=this.combatArmor,n=(a.isCasterArmor,a.isLightArmor);return e.forEach((function(e){var a=e.conditions;if(a.includes("UnderDamage"))t.counterattackDamageValue=t.rollDice(e.bonus),console.log("反擊效果: 反擊傷害值: "+t.counterattackDamageValue),o=!0;else if(a.includes("Dodge")){if(a.includes("LightArmor")&&!n)return void console.log("穿重甲時無法閃避反擊");t.dodgeCounterattackDamageValue=t.rollDice(e.bonus),console.log("閃避後反擊效果: 反擊傷害值: "+t.dodgeCounterattackDamageValue),o=!0}else if(a.includes("Defense")){if(a.includes("LightArmor")&&!n)return void console.log("穿重甲時無法使身法靈活");o=!0}})),o},e}(a));e._RF.pop()}}}));

System.register("chunks:///_virtual/CombatController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CombatFormation.ts","./CombatVisualizer.ts","./EventManager.ts","./EventSystem.ts","./CombatOption.ts","./TipText.ts","./EnemySkill.ts","./UIManager.ts"],(function(t){var e,n,i,o,a,r,c,s,m,u,l,h,b,f,d,C,v,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){c=t.cclegacy,s=t._decorator,m=t.Button,u=t.Component},function(t){l=t.CombatFormation},function(t){h=t.CombatVisualizer},function(t){b=t.EventManager},function(t){f=t.EventBus},function(t){d=t.CombatOption},function(t){C=t.TipType},function(t){v=t.EnemySkill},function(t){p=t.UIEvent}],execute:function(){var S,F,g,y,E,I,_,M,O,w,x;c._RF.push({},"61afb+V25xNe6d0eOXfpZsI","CombatController",void 0);var z=s.ccclass,k=s.property,T=t("CombatControllerEvent",function(t){return t.InitiativeOrder="combat_controller_event_initative_order",t.SelectCharacter="combat_controller_event_select_character",t.SelectMonster="combat_controller_event_select_monster",t.EndCombat="combat_controller_event_end_combat",t.ChoiceCard="combat_controller_event_choice_card",t}({}));t("CombatController",(S=z("CombatController"),F=k(l),g=k(h),y=k(d),E=k(m),S((M=e((_=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,i(e,"combatFormations",M,o(e)),i(e,"combatVisualizer",O,o(e)),i(e,"combatOption",w,o(e)),i(e,"attackButton",x,o(e)),e.eventBus=null,e.combatQueue=[],e.initiativeIndex=0,e.mainCharacter=null,e.currentAttacker=null,e.currentDefenders=[],e}n(e,t);var c=e.prototype;return c.onLoad=function(){b.instance.on(T.InitiativeOrder,this.onInitiativeOrder,this),b.instance.on(T.SelectCharacter,this.onSelectCharacter,this),b.instance.on(T.SelectMonster,this.onSelectMonster,this),b.instance.on(T.EndCombat,this.onEndCombat,this),b.instance.on("SubmitSelectedCards",this.onSubmitSelectedCards,this),this.eventBus=new f},c.onDestroy=function(){b.instance.off(T.InitiativeOrder,this.onInitiativeOrder,this),b.instance.off(T.SelectCharacter,this.onSelectCharacter,this),b.instance.off(T.SelectMonster,this.onSelectMonster,this),b.instance.off(T.EndCombat,this.onEndCombat,this),b.instance.off("SubmitSelectedCards",this.onSubmitSelectedCards,this)},c.joinCombat=function(t,e,n){console.log("joinCombat",t,e,n);var i=this.combatFormations[t];0===n?i.addFrontMemeber(e):i.addBackMember(e),0===n&&e.showCharacterInfo()},c.leaveCombat=function(t,e){this.combatFormations[t].removeMember(e)},c.startCombat=function(){var t=a(r().mark((function t(){var e,n,i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.combatVisualizer.node.active=!0,e=this.combatFormations[0].fighters,n=this.combatFormations[1].fighters,i=0===this.currentAttacker.camp?1:-1,console.log("第一次"),t.next=7,this.combatVisualizer.showCombat(e,n,i,0);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.combatRound=function(){this.attackButton.node.active=!1;var t=this.combatQueue[this.initiativeIndex];if(null!=t){if(this.currentAttacker=t,t===this.mainCharacter)b.instance.emit(C.Normal,"玩家回合"),this.combatFormations[0].pushFighter(t),this.onSelectCharacter(t);else{if(b.instance.emit(C.Normal,"怪物回合"),t.roundOver(),0===t.camp){var e=this.combatFormations[1].teamMembers[0][0];this.combatFormations[0].pushFighter(t),this.combatFormations[1].pushFighter(e),this.onEnemyExecuteIntent(t,e)}else{var n=this.combatFormations[0].teamMembers[0][0];this.combatFormations[0].pushFighter(n),this.combatFormations[1].pushFighter(t),this.onEnemyExecuteIntent(t,n)}this.scheduleOnce(this.startCombat.bind(this),1)}this.initiativeIndex=(this.initiativeIndex+1)%this.combatQueue.length}else console.error("Combat queue is empty",this.initiativeIndex)},c.onEnemyExecuteIntent=function(t,e){var n=new v("monsterkill","怪物技能",1,this.eventBus).getSkill1();console.log("playCard",n),t.combatCardsToIntent(n.sort((function(){return Math.random()-.5})).slice(0,2)),t.intent(),t.showIntent()},c.onEndCombat=function(){this.combatVisualizer.node.active=!1,this.onUpdateFormation(!0),this.endCombat()},c.endCombat=function(){var t=-1;this.combatFormations.forEach((function(e,n){e.isAllDead()&&(t=n)})),-1===t?this.combatRound():(b.instance.emit("ResultBattle"),0===t?b.instance.emit(C.Normal,"<color=#ff0000>失敗！<br/>玩家陣亡</color>"):(b.instance.emit(C.Normal,"<color=#00ff00>勝利！<br/>敵隊陣亡，請選擇一張卡牌加入你的牌庫</color>"),b.instance.emit("ChoiceCard")),this.combatFormations.forEach((function(t){return t.clear()}))),this.combatVisualizer.closeHitTips()},c.onUpdateFormation=function(t){void 0===t&&(t=!0),this.combatFormations.forEach((function(e){return e.rearrangeMembers(t)}))},c.onInitiativeOrder=function(t){var e=this;b.instance.emit(p.InventoryShowUI,!1);var n=t.mainCharacter,i=t.team,o=i[0],a=i[1];this.mainCharacter=n,this.combatOption.init(this.eventBus,n),o.sort((function(t,e){return t.initiative-e.initiative})).forEach((function(t,n){t.joinCombatTeam(),t.disableSelect(),e.joinCombat(0,t,n)})),a.sort((function(t,e){return t.initiative-e.initiative})).forEach((function(t,n){t.joinCombatTeam(),t.disableSelect(),e.joinCombat(1,t,n)})),this.combatQueue=[].concat(o,a).sort((function(t,e){return e.initiative-t.initiative})),this.initiativeIndex=0,this.combatRound()},c.onSelectCharacter=function(t){var e=this;this.scheduleOnce((function(){e.combatOption.show(t)}),1.5)},c.onCharacterSelected=function(){this.combatFormations[1].updateTeamStatus()},c.onSelectMonster=function(t){this.combatFormations[1].pushFighter(t),this.startCombat()},c.onSubmitSelectedCards=function(){this.mainCharacter.joinCombatTeam(),this.onUpdateFormation(!1),this.combatOption.close();var t=this.combatFormations[1],e=t.teamMembers.flat(1);1===e.length?this.onSelectMonster(e[0]):t.updateTeamStatus()},e}(u)).prototype,"combatFormations",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),O=e(_.prototype,"combatVisualizer",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(_.prototype,"combatOption",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(_.prototype,"attackButton",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=_))||I));c._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEntity.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Armor.ts","./Weapon.ts","./CombatArmor.ts","./CombatIntent.ts","./CombatWeapon.ts"],(function(t){var i,n,e,o,a,s,r,l,h;return{setters:[function(t){i=t.createClass},function(t){n=t.cclegacy,e=t.randomRangeInt},function(t){o=t.Armor},function(t){a=t.Weapon,s=t.WeaponStyle},function(t){r=t.CombatArmor},function(t){l=t.CombatIntent},function(t){h=t.CombatWeapon}],execute:function(){n._RF.push({},"4e13fNneedFd5X9ywtAW5KB","CombatEntity",void 0);t("CombatEntity",function(){function t(t,i,n,e){this.name=void 0,this.hitPoints=void 0,this.sanityPoints=void 0,this.moralePoints=void 0,this.isDead=!1,this.actionPoints=void 0,this.combatWeapons=[],this.combatArmor=null,this.affixEffects=void 0,this.naturalWeapon=void 0,this.attackHitRoll=void 0,this.hitCriticalPoint=20,this.weaponProficiencyBonus=0,this.weaponProficiencies=[],this.bonusHitRolls=[],this.extraHitRolls=[],this.totalDamageRolls=[],this.underAttackDamageValue=0,this.isAdvantage=!1,this.combatIntent=void 0,this.dodgeCounterattackDamageValue=0,this.counterattackDamageValue=0,this.intentContents=[],this.temporaryArmor=0,this.tempHP=0,this.name=t,this.hitPoints=i.constitution,this.sanityPoints=i.spirit,this.moralePoints=i.willpower,this.combatArmor=new r("",n,new o("","","0 gold",1,0,0,"None","Light")),this.naturalWeapon=e?{name:"天生武器",damage:e,range:"Melee"}:{name:"拳擊",damage:{dice:"1d4",type:"Unarmed"},range:"Melee"},this.unequipWeapon(),this.combatIntent=new l,this.resetBonuses()}var n=t.prototype;return n.applyEffect=function(t,i){void 0!==this.affixEffects[t]&&(this.affixEffects[t]+=i,console.log(this.name+"'s "+t+" changed by "+i+". Now: "+this.affixEffects[t]))},n.receiveAttack=function(t){this.underAttackDamageValue=t,console.log(this.name+" received "+t+" damage and now has "+this.hitPoints+" hit points.")},n.resultDamage=function(){var t=this.underAttackDamageValue;return this.underAttackDamageValue=0,0===t?0:(this.hitPoints-=t-this.tempHP,console.log("傷害執行完成 HP:",this.hitPoints,"(-",t,")"),this.isDead=this.hitPoints<=0,this.isDead&&console.log(this.name+" is dead."),t)},n.roll=function(t,i){return void 0===i&&(i=0),e(1,t)+i},n.rollHit=function(t){var i;return i=this.affixEffects.blind?this.rollHitWithDisadvantage():this.roll(20),console.log(this.name+" hit "+i+" + "+t),{roll:i+t,isFull:i>=this.hitCriticalPoint}},n.rollHitWithAdvantage=function(){return Math.max(this.roll(20),this.roll(20))},n.rollHitWithDisadvantage=function(){return Math.min(this.roll(20),this.roll(20))},n.rollDamage=function(t){return this.rollDice(t.dice)},n.rollDice=function(t){if(console.log(this.name+" rolled "+t),0===t.indexOf("-"))return parseInt(t,10);var i,n=t.split("+");if(""===n[0])return parseInt(n[1],10);i=2===n.length?n[0].split("d"):t.split("d");for(var o=parseInt(i[0],10),a=parseInt(i[1],10),s=0,r=0;r<o;r++)s+=e(1,a);return n.length>1&&(s+=parseInt(n[1],10)),s},n.resetBonuses=function(){this.affixEffects={hitBonus:0,damageBonus:0,poison:0,bleeding:0,frenzy:0,stun:0,blind:0,paralyze:0,confusion:0},this.actionPoints={Move:1,Reaction:1,Action:1,Bonus:1}},n.equipWeapon=function(t,i,n){var e=new h(i,n);this.combatWeapons[t]=e},n.unequipWeapon=function(t){var i=new a(this.naturalWeapon.name,"0 gold",0,s.Unarmed,"",this.naturalWeapon.damage,[],this.naturalWeapon.range);if(void 0===t)return this.combatWeapons=[new h(i),new h(i)],void console.log(this.name+" has unequipped all weapons.");t<this.combatWeapons.length?(console.log(this.name+" has unequipped "+this.combatWeapons[t].name+"."),this.combatWeapons[t]=new h(i)):console.log("Invalid weapon index.")},n.equipArmor=function(t){this.combatArmor.dress(t)},n.unequipArmor=function(){this.combatArmor.dress(null)},n.equipShield=function(t){this.combatArmor.shield(!0)},n.unequipShield=function(){this.combatArmor.shield(!1)},i(t,[{key:"ac",get:function(){var t=this.combatArmor.shielded?2:0;return console.log("shieldArmor:",t),this.combatArmor.armorClass+t+this.temporaryArmor}}]),t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/CombatFormation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,o,i,a,s,c,m,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,s=e.Prefab,c=e.Node,m=e.Vec3,f=e.Component}],execute:function(){var h,u,d,b,l,p,w,M,v,g,x;i._RF.push({},"7f9f64EH6dO3L/eG9tWsVmH","CombatFormation",void 0);var R=a.ccclass,I=a.property;e("CombatFormation",(h=R("CombatFormation"),u=I(s),d=I(c),b=I(c),h((w=t((p=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,r(t,"characterPrefab",w,o(t)),r(t,"frontRoot",M,o(t)),r(t,"backRoot",v,o(t)),r(t,"distanceBetweenRows",g,o(t)),r(t,"distanceBetweenMembers",x,o(t)),t.frontRow=[],t.backRow=[],t.teamMembers=[[],[]],t.fighters=[],t}n(t,e);var i=t.prototype;return i.onLoad=function(){this.frontRow=this.frontRoot.children,this.backRow=this.backRoot.children},i.addFrontMemeber=function(e){var t=this,n=this.teamMembers[0];n.push(e),n.forEach((function(e,n){e.teamIndex=n,e.node.parent=t.frontRow[n],e.node.setPosition(new m(0,0,0))}))},i.addBackMember=function(e){var t=this,n=this.frontRow.length,r=this.teamMembers[1];r.unshift(e),r.forEach((function(e,r){e.teamIndex=r+n,e.node.parent=t.backRow[r],e.node.setPosition(new m(0,0,0))}))},i.addMember=function(e){e.teamIndex<0?this.addFrontMemeber(e):e.teamIndex>=0&&this.addBackMember(e)},i.removeFrontMember=function(e){this.teamMembers[0].splice(this.teamMembers[0].indexOf(e),1)},i.removeBackMember=function(e){this.teamMembers[1].splice(this.teamMembers[1].indexOf(e),1)},i.removeMember=function(e){e.teamIndex<this.frontRow.length?this.removeFrontMember(e):this.removeBackMember(e)},i.moveFrontMember=function(e,t){var n=this,r=this.frontRow.length,o=e.teamIndex;if(o>=r)return this.removeBackMember(e),void this.addFrontMemeber(e);var i=this.teamMembers[0];o+t<=0?e.teamIndex=0:e.teamIndex+=t;var a=i[e.teamIndex];a&&(a.teamIndex+=.1*Math.sign(t)),i.sort((function(e,t){return e.teamIndex-t.teamIndex})),i.forEach((function(e,t){e.teamIndex=t,e.node.parent=n.frontRow[t],e.node.setPosition(new m(0,0,0))}))},i.moveBackMember=function(e,t){var n=this,r=this.frontRow.length,o=e.teamIndex;if(o<r)return this.removeFrontMember(e),void this.addBackMember(e);var i=this.teamMembers[1];o+t<=r?e.teamIndex=r:e.teamIndex+=t;var a=i[e.teamIndex];a&&(a.teamIndex+=.1*Math.sign(t)),i.sort((function(e,t){return e.teamIndex-t.teamIndex})),i.forEach((function(e,t){e.teamIndex=t+r,e.node.parent=n.backRow[t],e.node.setPosition(new m(0,0,0))}))},i.updateTeamStatus=function(){this.teamMembers.forEach((function(e){e.forEach((function(e){e.enableSelect()}))}))},i.pushFighter=function(e){this.fighters.push(e)},i.rearrangeMembers=function(e){var t=this,n=this.frontRow.length;this.fighters.forEach((function(e){e.teamIndex<n?e.node.parent=t.frontRow[e.teamIndex]:e.node.parent=t.backRow[e.teamIndex-n],e.endFight(),e.node.setPosition(new m(0,0,0))})),e&&(this.fighters.length=0)},i.isAllDead=function(){return this.teamMembers.every((function(e){return e.every((function(e){return e.isDead}))}))},i.clear=function(){this.backRow.forEach((function(e){return e.removeAllChildren()})),this.frontRow.forEach((function(e){return e.removeAllChildren()})),this.teamMembers=[[],[]],this.fighters.length=0,this.fighters.forEach((function(e){return e.updateInfo()}))},t}(f)).prototype,"characterPrefab",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(p.prototype,"frontRoot",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(p.prototype,"backRoot",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=t(p.prototype,"distanceBetweenRows",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),x=t(p.prototype,"distanceBetweenMembers",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),l=p))||l));i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatIntent.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"a7478VvwtVBn6bQSwOLGDnB","CombatIntent",void 0);t("CombatIntent",function(){function t(){this.modifiers=void 0,this.targetRestriction=void 0,this.reactionModifiers=[],this.modifiers=[],this.reactionModifiers=[],this.targetRestriction=null}var i=t.prototype;return i.clearIntents=function(){this.modifiers.length=0,this.reactionModifiers.length=0,this.targetRestriction=null},i.addIntent=function(t,i){return console.log("Adding intent with target type "+i+"."),null===this.targetRestriction?(this.targetRestriction=i,this.modifiers.push(t),!0):this.targetRestriction===i?(this.modifiers.push(t),!0):(console.log("Failed to add intent: target type "+i+" does not match current restriction "+this.targetRestriction+"."),!1)},i.setReactionIntent=function(t){console.log("設定反應的意圖"),this.reactionModifiers=t},i.getReactionIntent=function(){return this.reactionModifiers},i.getCurrentTargetRestriction=function(){return this.targetRestriction},i.getModifiers=function(){return this.modifiers},i.executeIntents=function(t){},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatMonster.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CombatEntity.ts"],(function(t){var n,e,o;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy},function(t){o=t.CombatEntity}],execute:function(){e._RF.push({},"73712Al6IREEbBkckTU263x","CombatMonster",void 0);t("CombatMonster",function(t){function e(n,e,o,a,i){var s;return(s=t.call(this,n,e,o,i)||this).hitBonus=0,s.hitBonus=a,s}n(e,t);var o=e.prototype;return o.hit=function(){return this.rollHit(0)},o.advantageHit=function(){var t=[this.rollHit(0),this.rollHit(0)];return this.attackHitRoll=t.sort((function(t,n){return n.roll-t.roll}))[0],t},o.disadvantageHit=function(){var t=[this.rollHit(0),this.rollHit(0)];return this.attackHitRoll=t.sort((function(t,n){return t.roll-n.roll}))[0],t},o.attack=function(t){var n=!1;this.bonusHitRolls.length=0,this.extraHitRolls.length=0,this.totalDamageRolls.length=0;var e=this.combatWeapons[0],o=this.rollHit(0);if(this.attackHitRoll=o,console.log("combatWeapon:",this.combatWeapons),e.resultHitBonus(),this.bonusHitRolls=e.hitBonus.slice(),this.extraHitRolls=e.hitExtraBonus.slice(),e.resultHitBonus(),e.hitCheck(o.roll,t.ac)){var a=e.damage,i=this.rollDamage(a);o.isFull&&(console.log("滿骰傷害值"),i+=this.rollDamage(a)),this.totalDamageRolls=[i],console.log("主手武器基本傷害:",i),this.totalDamageRolls=this.totalDamageRolls.concat(e.damageExtraBonus,e.damageBonus),t.receiveAttack(this.totalDamageRolls.reduce((function(t,n){return t+n}),0)),n=!0}return e.resetCombatBonus(),n||(t.receiveAttack(0),console.log(this.name+" misses.")),n},o.counterattack=function(t){var n=this.counterattackDamageValue+this.dodgeCounterattackDamageValue;return console.log("反擊",t.name,n),t.receiveAttack(n),n>0},o.intent=function(t){var n=this,e=this.combatIntent.getModifiers();return console.log("modifiers:",e),e.forEach((function(e){var o=n.getApplicableWeapon(e);if(o){var a=n.rollDice(e.bonus);n.applyModifier(o,e.attribute,a)}e.conditions.includes("Defense")&&(n.temporaryArmor+=parseInt(e.bonus,10),t.acLabel.string="AC(+"+n.temporaryArmor+"): "+n.ac,n.intentContents.push("增加臨時AC: "+n.temporaryArmor)),e.conditions.includes("Hitpoints")&&(n.tempHP+=parseInt(e.bonus,10),n.intentContents.push("增加臨時HP: "+n.tempHP)),e.conditions.includes("Advantage")&&(n.isAdvantage=!0,n.intentContents.push("下一回合有優勢"))})),this.combatIntent},o.getApplicableWeapon=function(t){var n=t.conditions;return this.actionPoints.Bonus>0&&n.includes("OffHand")&&this.checkWeaponConditions(n,this.combatWeapons[1])?this.combatWeapons[1]:this.actionPoints.Action>0&&this.checkWeaponConditions(n,this.combatWeapons[0])?this.combatWeapons[0]:(this.combatArmor.shielded&&console.log("是盾牌武器喔!!!!!!"),console.log("沒有武器適用條件"),null)},o.checkWeaponConditions=function(t,n){var e=n.range,o=n.damage,a=n.properties,i=n.weaponProficiency,s=t.every((function(t){return console.log("Checking weapon condition: "+t+" - damageType: "+o.type+"("+(o.type==t)+") - "+e+"("+(e==t)+") - "+a+" ("+a.every((function(n){return n==t}))+")"),o.type==t||(e==t||(!!a.every((function(n){return n==t}))||i[t]>0))}));return console.log("Result: "+s),s},o.applyModifier=function(t,n,e){switch(console.log("Applying "+n+" bonus of "+e+" to "+t.name),n){case"HitBonus":t.hitBonusAdd(e),this.intentContents.push("增加命中: "+e);break;case"HitExtra":t.hitExtraAdd(e),this.intentContents.push("增加額外命中: "+e);break;case"DamageBonus":t.damageAdd(e),this.intentContents.push("增加傷害: "+e);break;case"DamageExtra":t.extraDamageAdd(e),this.intentContents.push("增加額外傷害: "+e)}},o.reaction=function(){var t=this,n=!1,e=this.combatIntent.getReactionIntent();return console.log("reactionModifiers length:",e.length),e.forEach((function(e){var o=e.conditions;o.includes("UnderDamage")?(t.counterattackDamageValue=t.rollDice(e.bonus),console.log("反擊效果: 反擊傷害值: "+t.counterattackDamageValue),t.intentContents.push("復仇反擊效果: 反擊傷害值: "+t.counterattackDamageValue),n=!0):o.includes("Dodge")?(t.dodgeCounterattackDamageValue=t.rollDice(e.bonus),console.log("閃避後反擊效果: 反擊傷害值: "+t.dodgeCounterattackDamageValue),t.intentContents.push("閃避後反擊效果: 反擊傷害值: "+t.dodgeCounterattackDamageValue),n=!0):o.includes("Defense")&&(n=!0)})),n},e}(o));e._RF.pop()}}}));

System.register("chunks:///_virtual/CombatOption.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CardMover.ts","./EventManager.ts","./GameEvents.ts","./CardReward.ts","./HitCheckCounter.ts","./UIManager.ts","./MeleeSkill.ts","./TipText.ts"],(function(e){var t,n,i,r,a,o,c,s,u,l,h,d,f,p,m,C,k,y,v,w,b,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){c=e.cclegacy,s=e._decorator,u=e.Node,l=e.randomRangeInt,h=e.Component,d=e.tween,f=e.Vec3,p=e.UIOpacity},function(e){m=e.CardMover},function(e){C=e.EventManager},function(e){k=e.DeckPileEvent},function(e){y=e.CardReward},function(e){v=e.HitCheckCounter},function(e){w=e.UIEvent},function(e){b=e.MeleeSkill},function(e){g=e.TipType}],execute:function(){var R,D,S,T,_,E,x,I,O,M,L,q,z;c._RF.push({},"6a99fkqaBFLvo9h4DAXxJT0","CombatOption",void 0);var A=s.ccclass,B=s.property;e("CombatOption",(R=A("CombatOption"),D=B(u),S=B(u),T=B(u),_=B(v),E=B(y),R((O=t((I=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"blocker",O,r(t)),i(t,"layout",M,r(t)),i(t,"hitLayout",L,r(t)),i(t,"counter",q,r(t)),i(t,"cardReward",z,r(t)),t.eventBus=null,t.myTeamCharacter=null,t.combatSkill=null,t._deck=[],t}n(t,e);var c=t.prototype;return c.onLoad=function(){C.instance.on("ExecuteIntent",this.onExecuteIntent,this),C.instance.on("ShuffleDeckRequest",this.shuffleDeckRequest,this),C.instance.on("ChoiceCard",this.onChoiceCard,this),C.instance.on("SelectedRewardCard",this.onSelectedRewardCard,this)},c.onDestroy=function(){C.instance.off("ExecuteIntent",this.onExecuteIntent,this),C.instance.off("ShuffleDeckRequest",this.shuffleDeckRequest,this),C.instance.off("ChoiceCard",this.onChoiceCard,this),C.instance.off("SelectedRewardCard",this.onSelectedRewardCard,this)},c.start=function(){this.node.active=!1,this.combatSkill=new b(1,"近戰技能",this.eventBus),this.initDeck(1)},c.init=function(e,t){this.eventBus=e,this.myTeamCharacter=t,this.shuffleDeck(),C.instance.emit(k.ShowCards,this._deck.slice())},c.initDeck=function(e){this._deck.length=0;var t=this.combatSkill.getSkill(0);this._deck=t.slice()},c.shuffleDeckRequest=function(){this.shuffleDeck(),C.instance.emit(k.ShowCards,this._deck.slice()),this.scheduleOnce((function(){console.log("shuffleDeckRequest 後開始發牌，6張"),C.instance.emit(k.DealPlayerCards,6)}),1)},c.shuffleDeck=function(){for(var e=0;e<this._deck.length;e++){var t=l(0,e+1),n=[this._deck[t],this._deck[e]];this._deck[e]=n[0],this._deck[t]=n[1]}},c.show=function(){var e=a(o().mark((function e(t){var n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.position=f.ZERO,this.node.active=!0,(n=this.blocker.getComponent(p)).opacity=0,e.next=6,m.moveCard(t.node,this.layout,f.ZERO);case 6:t.node.parent=this.layout,d(n).to(.25,{opacity:205},{easing:"linear"}).call((function(){if(C.instance.emit(k.DealPlayerCards,6),i.onRoundOver(),i.myTeamCharacter.isAdvantage()){var e=i.myTeamCharacter.hits("Advantage").map((function(e){return e.roll}));i.counter.node.parent=i.hitLayout,i.counter.checkType="Advantage",i.counter.count=e[0],i.counter.count=e[1]}else{var t=i.myTeamCharacter.hit();console.log("hitRoll",t),i.counter.node.parent=i.hitLayout,i.counter.count=t.roll,i.counter.counterEffect()}i.myTeamCharacter.leaveCombatTeam()})).start();case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.close=function(){this.node.active=!1},c.onRoundOver=function(){this.myTeamCharacter.roundOver()},c.choiceCard=function(){var e=a(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cardReward.show(!0);case 2:t=this.combatSkill.getSkill(1),this.cardReward.init(t.sort((function(){return Math.random()-.5})).slice(0,5));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.onExecuteIntent=function(e){console.log("playCard",e),this.myTeamCharacter.combatCardsToIntent(e),this.myTeamCharacter.intent()},c.onSelectedRewardCard=function(e){var t=e;this._deck.push(t),console.log("卡片牌庫",this._deck),this.cardReward.show(!1),C.instance.emit(w.DescriptionScrollViewShowUI,!0),C.instance.emit(g.Hide)},c.onChoiceCard=function(){this.choiceCard()},t}(h)).prototype,"blocker",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(I.prototype,"layout",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(I.prototype,"hitLayout",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(I.prototype,"counter",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(I.prototype,"cardReward",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=I))||x));c._RF.pop()}}}));

System.register("chunks:///_virtual/CombatSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventSystem.ts","./Skill.ts"],(function(t){var e,i,n,f;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy},function(t){n=t.NotifyEvent},function(t){f=t.Skill}],execute:function(){i._RF.push({},"f7e8dqswFlIPpZLoBm4xBmY","CombatSkill",void 0);t("CombatSkill",function(t){function i(e,i,n,f){var l;return(l=t.call(this,e,i,n)||this).eventBus=void 0,l.eventBus=f,l}e(i,t);var f=i.prototype;return f.activateSkillEffect=function(t,e){this.eventBus.publish(new n("effectSkillApplied",{target:t,effect:e}))},f.activateAffixEffect=function(t,e){this.eventBus.publish(new n("affixEffectApplied",{target:t,effect:e}))},i}(f));i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatVisualizer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ParticleEffectComponent.ts","./TipClipsAnimation.ts","./EventManager.ts","./HitCheckCounter.ts","./CombatController.ts"],(function(e){var t,n,i,a,o,r,s,u,l,c,p,d,f,g,h,b,y,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){s=e.cclegacy,u=e._decorator,l=e.Node,c=e.Vec3,p=e.tween,d=e.Component,f=e.UIOpacity},function(e){g=e.ParticleEffectComponent},function(e){h=e.TipClipsAnimation},function(e){b=e.EventManager},function(e){y=e.HitCheckCounter},function(e){w=e.CombatControllerEvent}],execute:function(){var m,C,x,v,k,O,T,q,E,P,I,H,R,S,z;s._RF.push({},"0cdb7l2d8hPfrJX3uzWvMCY","CombatVisualizer",void 0);var A=u.ccclass,F=u.property;e("CombatVisualizer",(m=A("CombatVisualizer"),C=F(l),x=F(l),v=F(l),k=F(l),O=F(l),T=F(y),m((P=t((E=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return t=e.call.apply(e,[this].concat(o))||this,i(t,"blocker",P,a(t)),i(t,"layout",I,a(t)),i(t,"resultSuccessTip",H,a(t)),i(t,"resultFailTip",R,a(t)),i(t,"hitLayout",S,a(t)),i(t,"counter",z,a(t)),t}n(t,e);var s=t.prototype;return s.start=function(){this.node.position=c.ZERO,this.node.active=!1},s.delayAsync=function(){var e=o(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n.scheduleOnce((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.showCombat=function(){var e=o(r().mark((function e(t,n,i,a){var o,s,u,l,d,y,m,C,x,v,k,O,T,q,E,P,I,H,R,S,z,A=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i>0?(o=t[0],s=n[0]):(o=n[0],s=t[0]),o.startFight(),s.startFight(),this.blocker.active=!0,this.resultSuccessTip.active=!1,this.resultFailTip.active=!1,(u=this.blocker.getComponent(f)).opacity=0,p(u).to(.25,{opacity:185},{easing:"linear"}).start(),t.forEach((function(e){e.node.parent=A.layout,e.node.setPosition(new c(-200,0,0))})),n.forEach((function(e){e.node.parent=A.layout,e.node.setPosition(new c(200,0,0))})),l=o.attack(s,a),d=l.bonusHitRolls,y=l.extraHitRolls,m=l.totalDamageRolls,C=l.affixEffects,x=l.attackHitRoll,v=l.weaponProficiencyBonus,!(C.stun>0)){e.next=20;break}return console.log("要處理眩暈的特效"),C.stun--,p(o.node).to(.5,{position:new c(-220*i,0,0)},{easing:"bounceInOut"}).start(),e.next=18,new Promise((function(e){return A.scheduleOnce(e,1)}));case 18:return b.instance.emit(w.EndCombat),e.abrupt("return");case 20:if(x.isFull&&console.log("要處理爆骰的特效"),this.counter.node.parent=this.hitLayout,!(i<0)){e.next=28;break}return this.counter.checkType="Neutral",this.counter.count=x.roll,this.counter.counterEffect(),e.next=28,this.delayAsync(.25);case 28:if(!(v>0)){e.next=32;break}return this.counter.addCount(v,"武器熟練加值"),e.next=32,this.delayAsync(.5);case 32:if(!(d.length>0)){e.next=48;break}return p(o.node).to(.25,{position:c.ZERO},{easing:"quadOut"}).call((function(){var e=o.getComponentInChildren(g);null==e||e.setupEffect(),null==e||e.playEffect()})).start(),e.next=36,this.delayAsync(.25);case 36:k=0;case 37:if(!(k<d.length)){e.next=45;break}return console.log("bonusHitRolls[",k,"]:",d[k]),this.counter.addCount(d[k],"命中加值"),e.next=42,this.delayAsync(.25);case 42:k++,e.next=37;break;case 45:return e.next=47,this.delayAsync(1+.25*d.length);case 47:p(o.node).to(.15,{position:new c(-200*i,0,0)},{easing:"quadOut"}).start();case 48:O=new c(0,0,0),T=0;case 50:if(!(T<y.length)){e.next=58;break}return e.next=53,this.battle1(t[0],n[0],i,O);case 53:console.log("extraHitRolls[",T,"]:",y[T]),this.counter.addCount(y[T],"額外命中");case 55:T++,e.next=50;break;case 58:return y.length=0,e.next=61,this.delayAsync(.5);case 61:if(q=s.resultDamage(),console.log("damageResult:",q),E=s.reaction(o),P=E.dodgeCounterattackDamageValue,I=E.counterattackDamageValue,console.log("閃避反擊:",P,"復仇:",I),s.getTempHP(),!(q>0)){e.next=88;break}return this.resultSuccessTip.active=!0,p(this.resultSuccessTip).to(.25,{scale:new c(1.2,1.2,1)}).to(.25,{scale:c.ONE}).start(),H=null,console.log("totalDamageRolls:",m),m.length>0&&(R=s.getComponentInChildren(h),H=function(){return R.spreadCards(m.map((function(e){return e.toString()})))}),e.next=74,this.battleSuccess(t[0],n[0],i,O,H);case 74:return s.changeHpBar(-q),e.next=77,this.delayAsync(1.5);case 77:if(!I){e.next=86;break}return O=new c(0,0,0),S=function(){return o.getComponentInChildren(h).spreadCards([I.toString()])},e.next=82,this.battleSuccess(s,o,-i,O,S);case 82:return o.changeHpBar(-I),o.resultDamage(),e.next=86,this.delayAsync(1.5);case 86:e.next=101;break;case 88:return this.resultFailTip.active=!0,p(this.resultFailTip).to(.25,{scale:new c(1.2,1.2,1)}).to(.25,{scale:c.ONE}).start(),e.next=92,this.battleFail(t[0],n[0]);case 92:if(!P){e.next=101;break}return O=new c(0,0,0),z=function(){return o.getComponentInChildren(h).spreadCards([P.toString()])},e.next=97,this.battleSuccess(s,o,-i,O,z);case 97:return o.changeHpBar(-P),o.resultDamage(),e.next=101,this.delayAsync(1.5);case 101:return e.next=103,new Promise((function(e){return A.scheduleOnce(e,1)}));case 103:b.instance.emit(w.EndCombat);case 104:case"end":return e.stop()}}),e,this)})));return function(t,n,i,a){return e.apply(this,arguments)}}(),s.closeHitTips=function(){this.resultSuccessTip.active=!1,this.resultFailTip.active=!1},s.addHitBouns=function(e,t){return new Promise((function(t){p(e.node).to(.25,{position:c.ZERO},{easing:"quadOut"}).delay(1).to(.15,{position:new c(-200,0,0)},{easing:"quadOut"}).call((function(){t()})).start()}))},s.battle1=function(e,t,n,i){return void 0===n&&(n=1),void 0===i&&(i=new c(0,0,0)),new Promise((function(a){var o=i.clone(),r=i.clone();p(e.node).to(.25,{position:o.add(new c(-200,0,0))},{easing:"quadOut"}).delay(.05).by(.15,{position:new c(120,0,0)},{easing:"quadIn"}).by(.15,{position:o},{easing:"quadOut"}).call((function(){i.add(new c(10*n,0,0)),a()})).start(),p(t.node).to(.25,{position:r.add(new c(200,0,0))},{easing:"quadOut"}).delay(.05).by(.15,{position:new c(-120,0,0)},{easing:"quadIn"}).by(.15,{position:r},{easing:"quadOut"}).start()}))},s.battleFail=function(e,t){return new Promise((function(n){p(e.node).to(.15,{position:new c(0,0,0)},{easing:"linear"}).to(.25,{position:new c(-200,0,0)},{easing:"quadIn"}).call((function(){n()})).start(),p(t.node).to(.15,{position:new c(0,0,0)},{easing:"linear"}).to(.25,{position:new c(200,0,0)},{easing:"quadIn"}).start()}))},s.battleSuccess=function(e,t,n,i,a){return void 0===n&&(n=1),void 0===i&&(i=new c(0,0,0)),void 0===a&&(a=null),new Promise((function(o){i.clone();var r=i.clone();n>0?(p(e.node).to(.15,{position:new c(-200,0,0)},{easing:"linear"}).by(.15,{position:new c(220,0,0)},{easing:"quadIn"}).start(),p(t.node).to(.25,{position:r.add(new c(100,0,0))},{easing:"quadOut"}).parallel(p(t.node).by(.15,{position:new c(80,0,0)},{easing:"quadIn"}),p(t.node).to(.25,{angle:-45*n},{easing:"linear"})).call((function(){null==a||a()})).delay(1.25).to(.25,{angle:0},{easing:"linear"}).call((function(){o()})).start()):(p(e.node).to(.25,{position:r.add(new c(-100,0,0))},{easing:"quadOut"}).parallel(p(t.node).by(.15,{position:new c(-80,0,0)},{easing:"quadIn"}),p(t.node).to(.25,{angle:45},{easing:"linear"})).to(.25,{angle:0},{easing:"linear"}).call((function(){o()})).start(),p(t.node).to(.15,{position:new c(200,0,0)},{easing:"linear"}).by(.15,{position:new c(-220,0,0)},{easing:"quadIn"}).start())}))},t}(d)).prototype,"blocker",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(E.prototype,"layout",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(E.prototype,"resultSuccessTip",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(E.prototype,"resultFailTip",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(E.prototype,"hitLayout",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(E.prototype,"counter",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=E))||q));s._RF.pop()}}}));

System.register("chunks:///_virtual/CombatWeapon.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"93c86HlJdFEX6Ji+MXKRl1f","CombatWeapon",void 0);t("CombatWeapon",function(){function t(t,i){void 0===i&&(i=0),this.name=void 0,this.weaponProficiency=0,this.damage=void 0,this.properties=void 0,this.range=void 0,this.hitBonus=[],this.hitExtraBonus=[],this.totalHitRaise=0,this.damageBonus=[],this.damageExtraBonus=[],this.stunEffect=0,this.inBattle=!1;var s=t.name,n=t.damage,o=t.properties,e=t.range;this.name=s,this.weaponProficiency=i,this.damage=n,this.properties=o,this.range=e,this.resetCombatBonus()}var i=t.prototype;return i.resetCombatBonus=function(){this.hitBonus.length=0,this.hitExtraBonus.length=0,this.damageBonus.length=0,this.damageExtraBonus.length=0,this.stunEffect=0,this.totalHitRaise=0,this.inBattle=!1},i.hitBonusAdd=function(t){this.hitBonus.push(t),this.inBattle=!0},i.hitExtraAdd=function(t){this.hitExtraBonus.push(t),this.inBattle=!0},i.damageAdd=function(t){this.damageBonus.push(t),this.inBattle=!0},i.extraDamageAdd=function(t){this.damageExtraBonus.push(t),this.inBattle=!0},i.stunEffectAdd=function(t){this.stunEffect+=t,this.inBattle=!0},i.resultHitBonus=function(){return this.totalHitRaise=this.hitBonus.reduce((function(t,i){return t+i}),0)+this.hitExtraBonus.reduce((function(t,i){return t+i}),0),this.hitBonus.length=0,this.hitExtraBonus.length=0,this.totalHitRaise},i.hitCheck=function(t,i,s){return console.log("命中檢定: "+i+" vs "+t+" + "+this.weaponProficiency+" + "+this.totalHitRaise),i<=t+this.weaponProficiency+this.totalHitRaise},i.showAttackParams=function(){console.log("武器名稱: "+this.name),console.log("武器屬性: "+this.properties.join(", ")),console.log("武器傷害: "+JSON.stringify(this.damage)),console.log("武器射程: "+this.range.toString()),console.log("命中加值: "+this.totalHitRaise),console.log("hitExtra:",this.hitExtraBonus),console.log("hitBonus:",this.hitBonus),console.log("damageBonus:",this.damageBonus),console.log("damageExtra:",this.damageExtraBonus)},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/CommunityCards.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseCardDisplay.ts","./GameEvents.ts","./EventManager.ts","./CardMover.ts"],(function(t){var n,e,r,a,s,o,i,c,u;return{setters:[function(t){n=t.inheritsLoose,e=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){a=t.cclegacy,s=t._decorator},function(t){o=t.BaseCardDisplay},function(t){i=t.CommunityCardEvent},function(t){c=t.EventManager},function(t){u=t.CardMover}],execute:function(){var d;a._RF.push({},"90a78ICHwpA4pICKifRn8Oe","CommunityCards",void 0);var C=s.ccclass;s.property,t("default",C("CommunityCards")(d=function(t){function a(){return t.apply(this,arguments)||this}n(a,t);var s=a.prototype;return s.onLoad=function(){c.instance.on(i.DealCards,this.onDealCards,this),c.instance.on(i.ShowCards,this.onShowCards,this),c.instance.on(i.CompareCards,this.eventCompareCards,this)},s.onDestroy=function(){c.instance.off(i.DealCards,this.onDealCards,this),c.instance.off(i.ShowCards,this.onShowCards,this),c.instance.off(i.CompareCards,this.eventCompareCards,this)},s.start=function(){this.initPositionNodes(5),this.node.active=!1},s.dealCards=function(t){this.updatePositionLayout()},s.moveDealCard=function(t,n){this.node.active=!0;return u.moveCard(n,this.cardContainer,this.positionContainer.children[t].position,.75,.15*(t+1))},s.dropCards=function(t){},s.clearCards=function(){this.cardContainer.removeAllChildren(),this.selected=[]},s.compareCards=function(t){var n=this,e=t[0];this.getCardNodes(e).forEach((function(t){n.toggleCardSelection(t)}))},s.onDealCards=function(){var t=e(r().mark((function t(n){var e;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.node.active=!0,t.next=3,this.unselectAllCards();case 3:e=n,this.dealCards(e);case 5:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),s.onShowCards=function(){var t=e(r().mark((function t(n){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.node.active=!0,t.next=3,this.unselectAllCards();case 3:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),s.eventCompareCards=function(t){this.compareCards(t)},a}(o))||d);a._RF.pop()}}}));

System.register("chunks:///_virtual/CommunityCardsTest.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ExplorationCard.ts","./EventManager.ts","./GameEvents.ts"],(function(t){var e,n,r,a,o,i,s,c,u,l,d;return{setters:[function(t){e=t.inheritsLoose,n=t.createForOfIteratorHelperLoose,r=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){o=t.cclegacy,i=t._decorator,s=t.Component},function(t){c=t.CardSuit},function(t){u=t.EventManager},function(t){l=t.GameLogicEvent,d=t.DeckPileEvent}],execute:function(){var h;o._RF.push({},"faad3On/mtH5KVc6qwVVcPK","CommunityCardsTest",void 0);var p=i.ccclass;i.property,t("default",p("CommunityCardsTest")(h=function(t){function o(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this)._deck=[],e}e(o,t);var i=o.prototype;return i.onLoad=function(){u.instance.on(l.GameRoundStartDealCards,this.onGameRoundStartDealCards,this)},i.start=function(){this.initializeDeck(),u.instance.emit(d.ShowCards,this._deck,this)},i.initializeDeck=function(){for(var t=["2","3","4","5","6","7","8","9","10","J","Q","K","A"],e=["stealth","power","wisdom","speed","luck"],r=0,a=[c.Prop,c.Clue,c.Doubt,c.Presage];r<a.length;r++)for(var o,i=a[r],s=n(t);!(o=s()).done;){for(var u=o.value,l=Math.floor(3*Math.random())+1,d=[],h=0;h<l;h++)d.push(e[Math.floor(Math.random()*e.length)]);this._deck.push({suit:i,rank:u,conditions:d})}},i.onGameRoundStartDealCards=function(){var t=r(a().mark((function t(){var e=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u.instance.emit(d.DealCommunityCards,this._deck.splice(0,5)),t.next=3,new Promise((function(t){return e.scheduleOnce(t,.5)}));case 3:u.instance.emit(d.DealPlayerCards,[this._deck.splice(0,2),this._deck.splice(0,2),this._deck.splice(0,2)]);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),o}(s))||h);o._RF.pop()}}}));

System.register("chunks:///_virtual/CopingSkillButton.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts"],(function(n){var e,i,t,o,a,r,l,s,c;return{setters:[function(n){e=n.applyDecoratedDescriptor,i=n.inheritsLoose,t=n.initializerDefineProperty,o=n.assertThisInitialized},function(n){a=n.cclegacy,r=n._decorator,l=n.Label,s=n.Component},function(n){c=n.EventManager}],execute:function(){var u,p,h,v,g;a._RF.push({},"0695ao7Bt1ERrk196i3eJGK","CopingSkillButton",void 0);var m=r.ccclass,f=r.property;n("CopingSkillButton",(u=m("CopingSkillButton"),p=f(l),u((g=e((v=function(n){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=n.call.apply(n,[this].concat(a))||this,t(e,"nameLabel",g,o(e)),e._adventureName="",e._behaviorCoping=[],e}i(e,n);var a=e.prototype;return a.onLoad=function(){c.instance.on("CopingDramaBehavior",this.onCopingDramaBehavior,this)},a.onDestroy=function(){c.instance.off("CopingDramaBehavior",this.onCopingDramaBehavior,this)},a.onCopingDramaBehavior=function(n){var e=n[this._adventureName];e&&e.length>0?(this._behaviorCoping=e,this.node.active=!0):this.node.active=!1},a.setAdventureSkill=function(n){this._adventureName=n.name,this.nameLabel.string=n.displayName},a.onClicked=function(){c.instance.emit("CopingSkillButtonClickEvent",{name:this._adventureName,copings:this._behaviorCoping})},e}(s)).prototype,"nameLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=v))||h));a._RF.pop()}}}));

System.register("chunks:///_virtual/CopingSkillCheck.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CounterComponent.ts","./EventManager.ts","./CopingSkillButton.ts","./DescriptionScrollView.ts","./FillBlanks.ts","./DescriptionCrossword.ts","./DataModal.ts","./UIManager.ts"],(function(t){var e,n,o,i,s,r,c,a,l,p,u,h,d,f,g,w,C,v,S,k,b,_,m,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,s=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){c=t.cclegacy,a=t._decorator,l=t.Node,p=t.Label,u=t.Sprite,h=t.instantiate,d=t.Vec3,f=t.RichText,g=t.Component},function(t){w=t.CounterComponent},function(t){C=t.EventManager},function(t){v=t.CopingSkillButton},function(t){S=t.DescriptionScrollView},function(t){k=t.FillBlanks},function(t){b=t.default,_=t.CrosswordType},function(t){m=t.DataModal},function(t){y=t.UIEvent}],execute:function(){var D,V,B,N,L,x,E,R,A,F,I,O,T,W,z,M,P,U,j;c._RF.push({},"247caaPyyFNNI1WTnlyJBUy","CopingSkillCheck",void 0);var K=a.ccclass,Q=a.property;t("CopingSkillCheck",(D=K("CopingSkillCheck"),V=Q(w),B=Q(l),N=Q(v),L=Q(S),x=Q(p),E=Q(l),R=Q(b),A=Q(u),D((O=e((I=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s))||this,o(e,"counter",O,i(e)),o(e,"copingLayout",T,i(e)),o(e,"copingSkillButtonPrefab",W,i(e)),o(e,"descriptionScrollView",z,i(e)),o(e,"titleLabel",M,i(e)),o(e,"responseButtonLayout",P,i(e)),o(e,"descriptionCrossword",U,i(e)),o(e,"bgSprite",j,i(e)),e._optionsContent=[],e._keepWords=[],e._copingChance=0,e._responseId="",e._hadNewContent=!1,e._isSkillAction=!1,e._isWaitingForResponseClick=!1,e._data=void 0,e.isTipOpened=!1,e}n(e,t);var c=e.prototype;return c.onLoad=function(){},c.onDestroy=function(){},c.onEnable=function(){C.instance.on("DescriptionScrollViewEnd",this.onDescriptionScrollViewEnd,this),C.instance.on("DescriptionCrosswordAnswered",this.onDescriptionCrosswordAnswered,this),C.instance.on("PerformCopingSkillCheck",this.performCheck,this)},c.onDisable=function(){C.instance.off("DescriptionScrollViewEnd",this.onDescriptionScrollViewEnd,this),C.instance.off("DescriptionCrosswordAnswered",this.onDescriptionCrosswordAnswered,this),C.instance.off("PerformCopingSkillCheck",this.performCheck,this)},c.onInitAdventureSkills=function(t){this.setCopingSkillButtons(t)},c.onDescriptionScrollViewEnd=function(t){this._isWaitingForResponseClick?this.responseButtonLayout.active=!0:(console.log(this._copingChance,"次, this.data:",this._data),console.log("this._hadNewContent:",this._hadNewContent),this.nextStep())},c.onDescriptionCrosswordAnswered=function(t){var e=this,n=t.answers,o=t.sentence;console.log("answers:",n,"sentence:",o);var i=this._data.behavior.response[this._responseId],s=k.replaceMarkedWithKeywords(i,[]);s.forEach((function(t){console.log("replaced content:",t);t.tipCards.forEach((function(r,c){if("_"===r.string?Object.keys(r).every((function(t){return"string"===t||(console.log("檢查條件:",t),n.some((function(e){return e[t]===r[t]})))})):r.string===n[0].string){var a=[];if(e._isSkillAction){e._isSkillAction=!1;var l=s.filter((function(t){return t.tipCards.some((function(t){return t.string===r.string}))}));console.log("keywrodsCard:",l),a=l.map((function(t){return t.text})),l.forEach((function(t){return t.tipCards.forEach((function(t){return t.response&&e._data.behavior.response[t.response].forEach((function(t){return a.push(t)}))}))}))}else a=i.map((function(t){return k.answerQuestion(t,n.map((function(t){return t.string})))}));e.descriptionScrollView.addNewData([o].concat(a)),e._hadNewContent=!0}else console.log("沒有符合條件的 tip card, 取消顯示:",t)}))}))},c.start=function(){this.counter.node.active=!1,this.node.active=!1},c.setQuestData=function(t){this._data=t,this._keepWords.length=0,this._hadNewContent=!0;var e=t.descriptions,n=t.options;this.descriptionScrollView.setData(e),this.descriptionScrollView.show(),this._copingChance=0,this._optionsContent=[].concat(n)},c.setDramaData=function(t){this._data=t,this._keepWords.length=0,console.log("data:",t);var e=t.chance,n=t.descriptions,o=t.options;this.descriptionScrollView.setData(n),this.descriptionScrollView.show(),this._copingChance=e,this._hadNewContent=!0,this._optionsContent=[].concat(o)},c.setCopingSkillButtons=function(t){var e=this.copingLayout;e.removeAllChildren();var n=this.copingSkillButtonPrefab.node;t.forEach((function(t){var o=h(n);o.parent=e,o.active=!0,o.name=t.name,o.position=d.ZERO,o.getComponent(v).setAdventureSkill(t)})),e.active=!1},c.showResponseContentOrFinish=function(){var t=this;if(console.log("closeDescriptionView",this._hadNewContent,this._optionsContent),this.responseButtonLayout.active)return console.log("尚未選取應對，需要延後處理"),this._hadNewContent=!0,void console.log("把chance增加修改為直接改_responseContent為真值");if(this._optionsContent.length>0){if(!this._hadNewContent)return;this._hadNewContent=!1;var e=[],n=k.replaceMarkedWithKeywords(this._optionsContent,[]);if(n.forEach((function(o){console.log("replaced content:",o);var i=o.text;o.tipCards.forEach((function(o){"end"===o.behavior?e.push({text:o.string,callback:function(){t.descriptionScrollView.show(!1),t.copingLayout.active=!1,t.responseButtonLayout.active=!1,t.bgSprite.spriteFrame=null}}):o.dc?(t.descriptionScrollView.addNewData(n.map((function(t){return t.text}))),e.push({text:o.string,callback:function(){return t.checkRoll(t._data.behavior,o)}})):o.link?(t.descriptionScrollView.addNewData(n.map((function(t){return t.text}))),e.push({text:o.string,callback:function(){return t.setDramaData(m.getInstance().storyData.dramas[o.link])}})):o.response&&(console.log("總之走這樣就測到了！"),e.push({text:o.string,callback:function(){t.descriptionScrollView.addNewData([i].concat(t._data.behavior.response[o.response]))}}),console.log("結束對話，並新增內容"))}))})),console.log("buttons:",e),e.length>0)return this.descriptionScrollView.scrollToBottom(),void this.descriptionScrollView.setChooseButtons(e)}this.setScrollviewChooseButtons([{text:"關閉",callback:function(){t.descriptionScrollView.show(!1)}}])},c.setScrollviewChooseButtons=function(t){this.descriptionScrollView.setChooseButtons(t),this.copingLayout.active=!1,this.responseButtonLayout.active=!1},c.performCheck=function(){var t=s(r().mark((function t(e,n,o,i){var s,c,a=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.counter.node.active=!0,this.counter.count=e,this.counter.counterEffect(),this.titleLabel.string=o,t.next=6,new Promise((function(t){a.scheduleOnce(t,1)}));case 6:this.counter.addCount(n,"技能熟練",20),s=e+n,c=i.filter((function(t){return t[0]<=s})),this._copingChance--,console.log("copingList:",c),this.setCopingDescription(c);case 12:case"end":return t.stop()}}),t,this)})));return function(e,n,o,i){return t.apply(this,arguments)}}(),c.setCopingDescription=function(t){var e=this,n=this.responseButtonLayout.children;n.forEach((function(t){t.off("click"),t.active=!1}));var o=[],i={},s=0;t.forEach((function(t){t[0];var r=t[1],c=t[2],a=t[3];switch(console.log(c,"content:",r),console.log("this._responseContent:",e._optionsContent),c){case"describe":e.descriptionScrollView.addNewData(r),e._hadNewContent=!0;break;case"response":console.log("response content:",r),e.setResponseOption(n[s]||h(n[0]),r,(function(){e.descriptionScrollView.addNewData(e._data.behavior.response[a])})),s++;break;case"action to target":var l=k.replaceMarkedWithKeywords([r],[])[0];o.push.apply(o,l.tipCards);var p=[],u=Object.keys(o).every((function(t){if("string"===t)return!0;console.log("檢查條件:",t);var e=l.tipCards.some((function(e){return e[t]===o[t]}));return e&&p.push(o[t]),e}));console.log("是否重複:::::",u);var d=p.sort().join(""),f=i[d]||n[s]||h(n[0]);e.setResponseOption(f,l.text,(function(){var t=e.descriptionScrollView.tipCards;C.instance.emit(_.SetAnswerQuestion,t,l.text,l.tipCards,["type"]),e._responseId=a,console.log("this._responseId:",e._responseId),console.log("question.tipCards:",l.tipCards)})),i[d]=f,u||(console.log("不重複，index 繼續增加"),s++),e._isSkillAction=!0}}))},c.setResponseOption=function(t,e,n){var o=this;t.parent=this.responseButtonLayout,t.active=!0,t.getComponentInChildren(f).string=e,t.off("click"),t.on("click",(function(){o._hadNewContent=!0,o._isWaitingForResponseClick=!1,o.responseButtonLayout.active=!1,n()})),this._isWaitingForResponseClick=!0,this.responseButtonLayout.active=this.descriptionScrollView.isBottom,this.copingLayout.active=!1,this.descriptionScrollView.hideButtonLayout(),this.descriptionScrollView.scrollToBottom()},c.combat=function(t,e){var n=this;this.descriptionScrollView.deleteCard(e),this._hadNewContent=!1,this._copingChance=0,this.setScrollviewChooseButtons([{text:"戰鬥",callback:function(){e.response&&(n._optionsContent=[].concat(t.response[e.response]),n._hadNewContent=!0),n.showResponseContentOrFinish(),n.descriptionScrollView.hide();var o=e.coping;C.instance.emit("battleStart",o),C.instance.emit(y.MapConnectionShowUI,!1)}},{text:"-10hp跳過戰鬥",callback:function(){if(C.instance.emit("UnderAttackDamage",10),e.response){n._optionsContent=[].concat(t.response[e.response]);n.descriptionScrollView.addNewData(["一場激烈的戰鬥後，你受到10點傷害。"]),n._hadNewContent=!0}}}])},c.checkRoll=function(t,e){var n=e.dc.split("-"),o=parseInt(n[0]),i=n[1],s=e.success,r=e.failure;console.log(o,i,s,r),console.log(t.response[s]),console.log(t.response[r]);m.getInstance().playerCharacter.calculateProficienciesBonus()[i];var c=[];c.push("(骰子結果：1)"),1>=o?c.push.apply(c,t.response[s]):c.push.apply(c,t.response[r]),this.descriptionScrollView.addNewData(c),this.descriptionScrollView.deleteCard(e),this._hadNewContent=!0,console.log("checkRoll descriptions:",c)},c.setChooseOptionsForDrama=function(t){var e=this;this.descriptionScrollView.clear(),console.log("setChooseOptionsForDrama:",t.link),this.setScrollviewChooseButtons([{text:t.string,callback:function(){return e.setDramaData(m.getInstance().storyData.dramas[t.link])}}])},c.nextStep=function(){var t=this,e=this._data.behavior,n=!(null==e||!e.coping)&&this._copingChance>0,o=[];this.descriptionScrollView.tipCards.forEach((function(i){"end"===i.behavior?(n=!1,t.setScrollviewChooseButtons([{text:i.string,callback:function(){t.descriptionScrollView.show(!1),t.bgSprite.spriteFrame=null}}]),o.push("end "+i.string)):"combat"===i.action?(n=!1,t.combat(e,i),o.push("combat "+i.string)):"damage"===i.action?(n=!1,t.descriptionScrollView.deleteCard(i),console.log("受傷:",i.value),C.instance.emit("UnderAttackDamage",parseInt(i.value,10)),console.log("tip:",i),i.response&&(t.descriptionScrollView.addNewData(e.response[i.response]),t._hadNewContent=!0),o.push("damage "+i.string)):i.dc?(n=!1,t.setScrollviewChooseButtons([{text:i.string,callback:function(){return t.checkRoll(e,i)}}]),o.push("check roll "+i.string)):i.link&&(n=!1,t.setChooseOptionsForDrama(i),o.push("link "+i.link))})),console.log("處理的工作:",o),console.log("needEmit:",n,":::: hadNewContent:",this._hadNewContent),this.counter.node.active=this.copingLayout.active=n,n&&C.instance.emit("CopingDramaBehavior",e.coping),this.showResponseContentOrFinish()},c.onShowTipClicked=function(){this.isTipOpened?this.descriptionCrossword.closeAnswer():this.descriptionCrossword.setAnswer(this.descriptionScrollView.tipCards),this.isTipOpened=!this.isTipOpened},e}(g)).prototype,"counter",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(I.prototype,"copingLayout",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(I.prototype,"copingSkillButtonPrefab",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(I.prototype,"descriptionScrollView",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(I.prototype,"titleLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(I.prototype,"responseButtonLayout",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(I.prototype,"descriptionCrossword",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(I.prototype,"bgSprite",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=I))||F));c._RF.pop()}}}));

System.register("chunks:///_virtual/CounterComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,o,r,i,u,a,c,s,l,p,f,d;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized,i=t.createClass},function(t){u=t.cclegacy,a=t._decorator,c=t.Label,s=t.Node,l=t.Vec3,p=t.tween,f=t.UIOpacity,d=t.Component}],execute:function(){var C,h,b,v,m;u._RF.push({},"a4592V7k85I6Y4OVwBiWMQr","CounterComponent",void 0);var y=a.ccclass,g=a.property;t("CounterComponent",(C=y("CounterComponent"),h=g(c),C((m=n((v=function(t){function n(){for(var n,e=arguments.length,i=new Array(e),u=0;u<e;u++)i[u]=arguments[u];return n=t.call.apply(t,[this].concat(i))||this,o(n,"counterLabel",m,r(n)),n.minCount=1,n.currentCount=0,n.deprecatedCount=0,n}e(n,t);var u=n.prototype;return u.start=function(){this.count=this.currentCount},u.updateLabel=function(){this.counterLabel.string=this.currentCount.toString()},u.addCount=function(t,n,e){var o=this;void 0===n&&(n=""),void 0===e&&(e=30),this.currentCount=Math.max(this.currentCount+t,this.minCount);var r=new s;r.parent=this.node;var i=r.addComponent(c);t>0?(r.position=new l(0,-80,0),i.string="+"+t+"\n"+n,i.fontSize=e,p(r).to(.5,{position:new l(0,0,0)},{easing:"cubicOut"}).call((function(){o.updateLabel(),o.counterEffect()})).removeSelf().start()):(r.position=new l(0,0,0),i.string=t+"\n"+n,i.fontSize=e,this.counterEffect(),p(r).to(.5,{position:new l(0,-80,0)},{easing:"cubicOut"}).call((function(){o.updateLabel()})).removeSelf().start());var u=r.addComponent(f);p(u).to(.7,{opacity:120},{easing:"cubicOut"}).to(.1,{opacity:0}).start()},u.counterEffect=function(){p(this.counterLabel.node).to(.01,{scale:new l(1.5,1.5,1)}).to(.2,{scale:new l(1,1,1)}).start()},i(n,[{key:"count",set:function(t){this.currentCount=t,this.updateLabel()}}]),n}(d)).prototype,"counterLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=v))||b));u._RF.pop()}}}));

System.register("chunks:///_virtual/CrosswordController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts"],(function(o){var r,s,e,n,t;return{setters:[function(o){r=o.inheritsLoose},function(o){s=o.cclegacy,e=o._decorator,n=o.Component},function(o){t=o.EventManager}],execute:function(){var l;s._RF.push({},"e759bUpeHdMQ728ij6qKovR","CrosswordController",void 0);var d=e.ccclass,c=(e.property,o("CrosswordEvent",function(o){return o.CrosswordSolved="crossword_event_crossword_solved",o.CrosswordFailed="crossword_event_crossword_failed",o.CrosswordCellCleared="crossword_event_crossword_cell_cleared",o}({})));o("CrosswordController",d("CrosswordController")(l=function(o){function s(){return o.apply(this,arguments)||this}r(s,o);var e=s.prototype;return e.onLoad=function(){t.instance.on(c.CrosswordSolved,this.onCrosswordSolved,this),t.instance.on(c.CrosswordCellCleared,this.onCrosswordCellCleared,this)},e.onDestroy=function(){t.instance.off(c.CrosswordSolved,this.onCrosswordSolved,this),t.instance.off(c.CrosswordCellCleared,this.onCrosswordCellCleared,this)},e.onCrosswordSolved=function(o){},e.onCrosswordCellCleared=function(o){},s}(n))||l);s._RF.pop()}}}));

System.register("chunks:///_virtual/DataModal.ts",["cc","./StoryData.ts"],(function(t){var a,n;return{setters:[function(t){a=t.cclegacy},function(t){n=t.StoryData}],execute:function(){a._RF.push({},"ef40bRP1clLMaIn/nRX0fUM","DataModal",void 0),t("DataModal",function(){function t(){this.wordPuzzleData=void 0,this.storyData=void 0,this.playerCharacter=void 0,this.storyData=new n}return t.getInstance=function(){return t.instance||(t.instance=new t)},t}()).instance=void 0,a._RF.pop()}}}));

System.register("chunks:///_virtual/debug-view-runtime-control.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,n,s,l,r,a,g,h,p,c,C,d,m,u,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,a=t.Color,g=t.Canvas,h=t.UITransform,p=t.instantiate,c=t.Label,C=t.RichText,d=t.Toggle,m=t.Button,u=t.director,L=t.Component}],execute:function(){var f,M,b,v,T,S,x,E,I;s._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var A=l.ccclass,y=l.property;t("DebugViewRuntimeControl",(f=A("internal.DebugViewRuntimeControl"),M=y(r),b=y(r),v=y(r),f((x=e((S=function(t){function e(){for(var e,o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"compositeModeToggle",x,n(e)),i(e,"singleModeToggle",E,n(e)),i(e,"EnableAllCompositeModeButton",I,n(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e.hideButtonLabel=void 0,e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[a.WHITE,a.BLACK,a.RED,a.GREEN,a.BLUE],e}o(e,t);var s=e.prototype;return s.start=function(){if(this.node.parent.getComponent(g)){var t=this.node.parent.getComponent(h),e=.5*t.width,o=.5*t.height,i=.1*e-e,n=o-.1*o,s=this.node.getChildByName("MiscMode"),l=p(s);l.parent=this.node,l.name="Buttons";var r=p(s);r.parent=this.node,r.name="Titles";for(var u=0;u<2;u++){var L=p(this.EnableAllCompositeModeButton.getChildByName("Label"));L.setPosition(i+(u>0?450:150),n,0),L.setScale(.75,.75,.75),L.parent=r;var f=L.getComponent(c);f.string=u?"----------Composite Mode----------":"----------Single Mode----------",f.color=a.WHITE,f.overflow=0,this.labelComponentList[this.labelComponentList.length]=f}n-=20;for(var M=0,b=0;b<this.strSingle.length;b++,M++){b===this.strSingle.length>>1&&(i+=200,M=0);var v=b?p(this.singleModeToggle):this.singleModeToggle;v.setPosition(i,n-20*M,0),v.setScale(.5,.5,.5),v.parent=this.singleModeToggle.parent;var T=v.getComponentInChildren(C);T.string=this.strSingle[b],this.textComponentList[this.textComponentList.length]=T,this.textContentList[this.textContentList.length]=T.string,v.on(d.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[b]=v}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,n,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(m.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=l;var S=this.EnableAllCompositeModeButton.getComponentInChildren(c);this.labelComponentList[this.labelComponentList.length]=S;var x=p(this.EnableAllCompositeModeButton);x.setPosition(i+90,n,0),x.setScale(.5,.5,.5),x.on(m.EventType.CLICK,this.changeTextColor,this),x.parent=l,(S=x.getComponentInChildren(c)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=S;var E=p(this.EnableAllCompositeModeButton);E.setPosition(i+200,n,0),E.setScale(.5,.5,.5),E.on(m.EventType.CLICK,this.hideUI,this),E.parent=this.node.parent,(S=E.getComponentInChildren(c)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=S,this.hideButtonLabel=S,n-=40;for(var I=0;I<this.strMisc.length;I++){var A=p(this.compositeModeToggle);A.setPosition(i,n-20*I,0),A.setScale(.5,.5,.5),A.parent=s;var y=A.getComponentInChildren(C);y.string=this.strMisc[I],this.textComponentList[this.textComponentList.length]=y,this.textContentList[this.textContentList.length]=y.string,A.getComponent(d).isChecked=!!I,A.on(d.EventType.TOGGLE,I?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[I]=A}n-=150;for(var D=0;D<this.strComposite.length;D++){var B=D?p(this.compositeModeToggle):this.compositeModeToggle;B.setPosition(i,n-20*D,0),B.setScale(.5,.5,.5),B.parent=this.compositeModeToggle.parent;var w=B.getComponentInChildren(C);w.string=this.strComposite[D],this.textComponentList[this.textComponentList.length]=w,this.textContentList[this.textContentList.length]=w.string,B.on(d.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[D]=B}}else console.error("debug-view-runtime-control should be child of Canvas")},s.isTextMatched=function(t,e){var o=new String(t),i=o.search(">");return-1===i?t===e:(o=(o=o.substr(i+1)).substr(0,o.search("<")))===e},s.toggleSingleMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strSingle.length;i++)this.isTextMatched(o.string,this.strSingle[i])&&(e.singleMode=i)},s.toggleCompositeMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strComposite.length;i++)this.isTextMatched(o.string,this.strComposite[i])&&e.enableCompositeMode(i,t.isChecked)},s.toggleLightingWithAlbedo=function(t){u.root.debugView.lightingWithAlbedo=t.isChecked},s.toggleCSMColoration=function(t){u.root.debugView.csmLayerColoration=t.isChecked},s.enableAllCompositeMode=function(t){var e=u.root.debugView;e.enableAllCompositeMode(!0);for(var o=0;o<this.compositeModeToggleList.length;o++){this.compositeModeToggleList[o].getComponent(d).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(d);i.isChecked=!1,e.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(d)).isChecked=!0,e.lightingWithAlbedo=!0},s.hideUI=function(t){var e=this.node.getChildByName("Titles"),o=!e.active;this.singleModeToggleList[0].parent.active=o,this.miscModeToggleList[0].parent.active=o,this.compositeModeToggleList[0].parent.active=o,this.EnableAllCompositeModeButton.parent.active=o,e.active=o,this.hideButtonLabel.string=o?"Hide UI":"Show UI"},s.changeTextColor=function(t){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(var o=0;o<this.labelComponentList.length;o++)this.labelComponentList[o].color=this.color[this._currentColorIndex]},s.onLoad=function(){},s.update=function(t){},e}(L)).prototype,"compositeModeToggle",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(S.prototype,"singleModeToggle",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(S.prototype,"EnableAllCompositeModeButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=S))||T));s._RF.pop()}}}));

System.register("chunks:///_virtual/DeckCards.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseCardDisplay.ts","./CardComponent.ts"],(function(e){var t,n,r,o,c,s;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,r=e._decorator,o=e.instantiate},function(e){c=e.BaseCardDisplay},function(e){s=e.CardComponent}],execute:function(){var a;n._RF.push({},"0e8f90i+8xITrVmsrBey4CN","DeckCards",void 0);var i=r.ccclass;r.property,e("default",i("DeckCards")(a=function(e){function n(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this).discardLimit=3,t}t(n,e);var r=n.prototype;return r.doShowCard=function(e){this.showCards(e)},r.showCards=function(e){var t=this;this.positionContainer.children.length===e.length?(this.selectedCardNodes.length>0&&console.error("已經有選取的卡片，請先清除之前的選取"),this.cardContainer.removeAllChildren(),e.forEach((function(e,n){var r=o(t.cardPrefab);r.name="Card_"+n,r.getComponent(s).setup(e),r.parent=t.cardContainer}))):console.error("卡牌數量與定位節點數量不符")},r.toggleCardSelection=function(t){e.prototype.toggleCardSelection.call(this,t);var n=t.getComponent(s).card;this.selected.includes(n)},r.confirmSelection=function(){var e=this.selected.length>0;return e?console.log("Discarding cards:",this.selected):console.log("No card selected."),e},r.getSelectedCards=function(){return this.selected},r.getCardContentNodes=function(){return this.cardContainer.children},n}(c))||a);n._RF.pop()}}}));

System.register("chunks:///_virtual/DeckCards2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseCardDisplay.ts","./GameEvents.ts","./EventManager.ts","./CardComponent2.ts"],(function(e){var t,n,r,o,a,c,s,i,l,d;return{setters:[function(e){t=e.inheritsLoose,n=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){o=e.cclegacy,a=e._decorator,c=e.instantiate},function(e){s=e.BaseCardDisplay},function(e){i=e.GameUIEvent},function(e){l=e.EventManager},function(e){d=e.CardComponent}],execute:function(){var u;o._RF.push({},"a133dU/5xNPzr4FEm/RU8Jy","DeckCards",void 0);var h=a.ccclass;a.property,e("default",h("DeckCards")(u=function(e){function o(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this).discardLimit=3,t}t(o,e);var a=o.prototype;return a.setCards=function(e){var t=this;this.positionContainer.children.length===e.length?(this.selectedCardNodes.length>0&&console.error("已經有選取的卡片，請先清除之前的選取"),this.cardContainer.removeAllChildren(),e.forEach((function(e,n){var r=c(t.cardPrefab);r.name="Card_"+n,r.getComponent(d).setup(e),r.parent=t.cardContainer}))):console.error("卡牌數量與定位節點數量不符")},a.toggleCardSelection=function(t){e.prototype.toggleCardSelection.call(this,t);var n=t.getComponent(d).card;this.selected.includes(n)?l.instance.emit(i.DeckCardUnselected,n):l.instance.emit(i.DeckCardSelected,n)},a.confirmSelection=function(){var e=this.selected.length>0;return e?console.log("Discarding cards:",this.selected):console.log("No card selected."),e},a.discardSelectedCards=function(){var e=n(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.unselectAllCards();case 2:this.updatePositionLayout(),this.followPosition();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.getSelectedCards=function(){return this.selected},a.getCardContentNodes=function(){return this.cardContainer.children},o}(s))||u);o._RF.pop()}}}));

System.register("chunks:///_virtual/DeckCardsPile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameEvents.ts","./HandEvaluator.ts","./EventManager.ts","./CardMover.ts","./CardComponent2.ts","./DeckCards2.ts","./CommunityCards.ts","./PlayerHandCards2.ts"],(function(e){var n,t,r,a,i,s,c,o,d,u,l,h,f,C,p,m,v,k,y,D,g;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized,i=e.asyncToGenerator,s=e.regeneratorRuntime,c=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,d=e._decorator,u=e.Node,l=e.Vec3,h=e.Component},function(e){f=e.DeckPileEvent,C=e.GameLogicEvent},function(e){p=e.HandEvaluator},function(e){m=e.EventManager},function(e){v=e.CardMover},function(e){k=e.CardComponent},function(e){y=e.default},function(e){D=e.default},function(e){g=e.default}],execute:function(){var x,w,P,b,G,E,S,H,R,A,z,O,N;o._RF.push({},"2412cS1sUJNnI5q2nUpqzA/","DeckCardsPile",void 0);var T=d.ccclass,L=d.property;e("default",(x=T("DeckCardsPile"),w=L(u),P=L(u),b=L(u),G=L(D),E=L(g),x((R=n((H=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return n=e.call.apply(e,[this].concat(i))||this,r(n,"deckPile",R,a(n)),n.deckCardsPile=void 0,r(n,"deckGatherings",A,a(n)),r(n,"deckDiscard",z,a(n)),r(n,"communityCards",O,a(n)),r(n,"playerHands",N,a(n)),n}t(n,e);var o=n.prototype;return o.onLoad=function(){m.instance.on(f.ShowCards,this.onShowCards,this),m.instance.on(f.DeckGatherings,this.onDeckGatherings,this),m.instance.on(f.DiscardCards,this.onDiscardCards,this),m.instance.on(f.DealCommunityCards,this.onDealCommunityCards,this),m.instance.on(f.DealPlayerCards,this.onDealPlayerCards,this),m.instance.on(f.HideCards,this.eventHideCards,this),this.deckCardsPile=this.deckPile.getComponentsInChildren(y)},o.onDestroy=function(){m.instance.off(f.ShowCards,this.onShowCards,this),m.instance.off(f.DeckGatherings,this.onDeckGatherings,this),m.instance.off(f.DiscardCards,this.onDiscardCards,this),m.instance.off(f.DealCommunityCards,this.onDealCommunityCards,this),m.instance.off(f.DealPlayerCards,this.onDealPlayerCards,this),m.instance.off(f.HideCards,this.eventHideCards,this)},o.start=function(){this.node.position=l.ZERO},o.showdDeckPile=function(e){this.deckCardsPile.forEach((function(e){return e.node.active=!0}));var n=p.groupBySuit(e);this.deckCardsPile.forEach((function(e,t){var r=n[t];e.initPositionNodes(r.length),e.showCards(r),e.followPosition(),e.setToggleSelection()}))},o.collectAllCardsToDeckGatherings=function(){var e=i(s().mark((function e(){var n,t,r,a,i,o,d,u=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=c(this.deckCardsPile);case 1:if((t=n()).done){e.next=16;break}return r=t.value,e.next=5,r.unselectAllCards();case 5:r.stopToggleSelection(),a=r.getCardContentNodes().slice(),i=c(a);case 8:if((o=i()).done){e.next=14;break}return d=o.value,e.next=12,v.moveCard(d,this.deckGatherings,l.ZERO);case 12:e.next=8;break;case 14:e.next=1;break;case 16:return e.next=18,new Promise((function(e){return u.scheduleOnce(e,.25)}));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onShowCards=function(e){this.node.active=!0,this.communityCards.clearCards(),this.playerHands.forEach((function(e){return e.clearCards()})),this.deckGatherings.removeAllChildren(),this.deckDiscard.removeAllChildren(),this.showdDeckPile(e)},o.onDeckGatherings=function(){var e=i(s().mark((function e(n){var t,r,a,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.node.active=!0,t=c(this.deckDiscard.children.slice());case 2:if((r=t()).done){e.next=8;break}return a=r.value,e.next=6,v.moveCard(a,this.deckGatherings,l.ZERO);case 6:e.next=2;break;case 8:return e.next=10,new Promise((function(e){return i.scheduleOnce(e,.25)}));case 10:console.log("重洗"),m.instance.emit(C.GameRoundNextPlayerTurn);case 12:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}(),o.onDiscardCards=function(){var e=i(s().mark((function e(n){var t,r,a,o,d,u=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,t=n,e.next=4,this.communityCards.unselectAllCards();case 4:r=this.communityCards.getCardNodes(t).slice(),a=c(r);case 6:if((o=a()).done){e.next=12;break}return d=o.value,e.next=10,v.moveCard(d,this.deckDiscard,l.ZERO);case 10:e.next=6;break;case 12:return e.next=14,this.playerHands.forEach(i(s().mark((function e(n){var a,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.unselectAllCards();case 2:r=n.getCardNodes(t).slice(),a=c(r);case 4:if((i=a()).done){e.next=10;break}return o=i.value,e.next=8,v.moveCard(o,u.deckDiscard,l.ZERO);case 8:e.next=4;break;case 10:case"end":return e.stop()}}),e)}))));case 14:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}(),o.onDealCommunityCards=function(e){var n=this;this.node.active=!0;var t=this.deckGatherings.children,r=e;console.log(r);var a=0;r.forEach(i(s().mark((function e(r){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=t[t.length-1]).getComponent(k).setup(r),e.next=4,n.communityCards.moveDealCard(a++,i);case 4:case"end":return e.stop()}}),e)}))))},o.onDealPlayerCards=function(e){var n=this,t=this.deckGatherings.children;e.forEach((function(e,r){n.playerHands[r].dealCards(e,t)}))},o.eventHideCards=function(e){this.node.active=!1},o.onDiscardClicked=function(){var e=[];this.deckCardsPile.forEach((function(n){n.confirmSelection()&&(n.discardSelectedCards(),e=e.concat(n.getSelectedCards()))})),0!=e.length&&m.instance.emit(C.GameRoundStartDiscardCards,e)},o.onGameStartDealClicked=function(){var e=i(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.collectAllCardsToDeckGatherings();case 2:this.deckCardsPile.forEach((function(e){return e.node.active=!1})),m.instance.emit(C.GameRoundStartDealCards);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n}(h)).prototype,"deckPile",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(H.prototype,"deckGatherings",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(H.prototype,"deckDiscard",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=n(H.prototype,"communityCards",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(H.prototype,"playerHands",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),S=H))||S));o._RF.pop()}}}));

System.register("chunks:///_virtual/DeckCardsPile2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CardMover.ts","./EventManager.ts","./GameEvents.ts","./DeckCards.ts"],(function(e){var n,t,r,i,a,s,c,o,l,d,u,h,f,k,C,p,v;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.asyncToGenerator,s=e.regeneratorRuntime,c=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,l=e._decorator,d=e.Node,u=e.Vec3,h=e.Component},function(e){f=e.CardMover},function(e){k=e.EventManager},function(e){C=e.DeckPileEvent,p=e.PlayerHandCardEvent},function(e){v=e.default}],execute:function(){var g,P,D,y,m,w,b,x,E;o._RF.push({},"a010fbX4oxEuZIxUUTL9QBb","DeckCardsPile",void 0);var G=l.ccclass,S=l.property;e("default",(g=G("DeckCardsPile"),P=S(d),D=S(d),y=S(d),g((b=n((w=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return n=e.call.apply(e,[this].concat(a))||this,r(n,"deckPile",b,i(n)),n.deckCardsPile=void 0,r(n,"deckGatherings",x,i(n)),r(n,"deckDiscard",E,i(n)),n.cards=[],n}t(n,e);var o=n.prototype;return o.onLoad=function(){k.instance.on(C.ShowCards,this.onShowCards,this),k.instance.on(C.DealPlayerCards,this.onDealPlayerCards,this),this.deckCardsPile=this.deckPile.getComponentsInChildren(v)},o.onDestroy=function(){k.instance.off(C.ShowCards,this.onShowCards,this),k.instance.off(C.DealPlayerCards,this.onDealPlayerCards,this)},o.start=function(){this.node.position=u.ZERO},o.showdDeckPile=function(e){this.cards=e,this.deckCardsPile.forEach((function(n,t){n.initPositionNodes(e.length),n.doShowCard(e),n.setToggleSelection(),n.followPosition()}))},o.collectAllCardsToDeckGatherings=function(){var e=a(s().mark((function e(){var n,t,r,i,a,o,l,d=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=c(this.deckCardsPile);case 1:if((t=n()).done){e.next=13;break}r=t.value,i=r.getCardContentNodes().slice(),a=c(i);case 5:if((o=a()).done){e.next=11;break}return l=o.value,e.next=9,f.moveCard(l,this.deckGatherings,u.ZERO);case 9:e.next=5;break;case 11:e.next=1;break;case 13:return e.next=15,new Promise((function(e){return d.scheduleOnce(e,.25)}));case 15:this.deckCardsPile.forEach((function(e){return e.node.active=!1}));case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onShowCards=function(e){this.node.active=!0,this.deckGatherings.removeAllChildren(),this.deckDiscard.removeAllChildren();var n=e;this.showdDeckPile(n),this.collectAllCardsToDeckGatherings()},o.onDeckGatherings=function(){var e=a(s().mark((function e(){var n,t,r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.node.active=!0,n=c(this.deckDiscard.children.slice());case 2:if((t=n()).done){e.next=8;break}return r=t.value,e.next=6,f.moveCard(r,this.deckGatherings,u.ZERO);case 6:e.next=2;break;case 8:return e.next=10,new Promise((function(e){return i.scheduleOnce(e,.25)}));case 10:console.log("重洗");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onDealPlayerCards=function(e){var n=e;this.cards.length<n?k.instance.emit("ShuffleDeckRequest"):k.instance.emit(p.DealCards,{cards:this.cards.splice(0,n),deckGatherings:this.deckGatherings})},o.eventHideCards=function(e){this.node.active=!1},o.onDiscardClicked=function(){var e=[];this.deckCardsPile.forEach((function(n){n.confirmSelection()&&(n.discardSelectedCards(),e=e.concat(n.getSelectedCards()))})),e.length},n}(h)).prototype,"deckPile",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(w.prototype,"deckGatherings",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(w.prototype,"deckDiscard",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=w))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/DescriptionCrossword.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HandCards.ts","./FillBlanks.ts","./EventManager.ts","./TipText.ts","./Card.ts"],(function(n){var t,s,e,i,o,r,a,c,u,d,l,h,p,w;return{setters:[function(n){t=n.applyDecoratedDescriptor,s=n.inheritsLoose,e=n.initializerDefineProperty,i=n.assertThisInitialized},function(n){o=n.cclegacy,r=n._decorator,a=n.RichText,c=n.Vec3,u=n.Component},function(n){d=n.HandCards},function(n){l=n.FillBlanks},function(n){h=n.EventManager},function(n){p=n.TipType},function(n){w=n.TipCard}],execute:function(){var f,y,v,C,b,g,H;o._RF.push({},"3b007pSbVhMyYZDcoIimcDH","DescriptionCrossword",void 0);var A=r.ccclass,q=r.property,D=n("CrosswordType",function(n){return n.SetAnswerQuestion="crossword_type_set_answer_question",n}({}));n("default",(f=A("DescriptionCrossword"),y=q(a),v=q(d),f((g=t((b=function(n){function t(){for(var t,s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return t=n.call.apply(n,[this].concat(o))||this,e(t,"questionLabel",g,i(t)),e(t,"answerHandCards",H,i(t)),t.question="",t.conditions=[],t.solutions=[],t}s(t,n);var o=t.prototype;return o.onLoad=function(){h.instance.on(D.SetAnswerQuestion,this.onSetAnswerQuestion,this)},o.onDestroy=function(){h.instance.off(D.SetAnswerQuestion,this.onSetAnswerQuestion,this)},o.onSetAnswerQuestion=function(n,t,s,e){this.setQuestion(t,s,e),this.setAnswer(n)},o.onSendAnswer=function(n){var t=this,s=this.conditions.length>0;this.solutions.every((function(e,i){var o=n[i];return!!o&&(s?t.conditions.every((function(n){return e[n]===o[n]})):""!=o.string)}))?(h.instance.emit(p.NormalDelay,"輸入成功！",2),h.instance.emit("DescriptionCrosswordAnswered",{answers:n,sentence:this.questionLabel.string}),this.questionLabel.string="",this.answerHandCards.clear(),this.answerHandCards.show(!1),this.node.active=!1):(this.questionLabel.string=this.question,h.instance.emit(p.Error,"輸入的條件與填入內容不符合"))},o.sample=function(){this.node.active=!0;var n="aaa[_ | type:ok],bbb[_ | type:okla],ccc[_ | type:ok]",t=["type"],s=l.replaceMarkedWithKeywords([n],[]);console.log(s[0]);var e=s[0].tipCards;this.setQuestion(s[0].text,e,t);for(var i=[],o=0;o<3;o++){var r=new w;r.string="card"+o,r.type="ok",i.push(r)}i[1].type="okla",this.setAnswer(i)},o.start=function(){this.node.position=c.ZERO,this.node.active=!1},o.setQuestion=function(n,t,s){void 0===t&&(t=[]),void 0===s&&(s=[]),this.questionLabel.string=this.question=n,this.solutions=t,this.conditions=s,this.answerHandCards.setSendData(this.solutions.length,this.onSendAnswer.bind(this)),this.answerHandCards.show(!1),this.answerHandCards.lock(!0),this.node.active=!0},o.setAnswer=function(n){var t=this;this.answerHandCards.show(!0),this.answerHandCards.list(n,(function(n,s){t.questionLabel.string=l.answerQuestion(t.question,s.map((function(n){return n.string})))})),this.answerHandCards.lock(!1)},o.closeAnswer=function(){this.answerHandCards.show(!1)},t}(u)).prototype,"questionLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(b.prototype,"answerHandCards",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=b))||C));o._RF.pop()}}}));

System.register("chunks:///_virtual/DescriptionScrollView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FillBlanks.ts","./TipClipsAnimation.ts","./EventManager.ts"],(function(t){var i,e,n,o,r,s,c,l,a,h,u,d,p,f,g,v,w,m,C,y,V,b,S,x,B;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,c=t._decorator,l=t.ScrollView,a=t.Node,h=t.Sprite,u=t.v3,d=t.UITransform,p=t.Vec3,f=t.instantiate,g=t.RichText,v=t.UIOpacity,w=t.tween,m=t.resources,C=t.SpriteFrame,y=t.Texture2D,V=t.Label,b=t.Component},function(t){S=t.FillBlanks},function(t){x=t.TipClipsAnimation},function(t){B=t.EventManager}],execute:function(){var F,T,D,k,L,E,A,I,N,P,R;s._RF.push({},"d4350Skx8NN8IRsBjiAsG5J","DescriptionScrollView",void 0);var z=c.ccclass,H=c.property;t("DescriptionScrollView",(F=z("DescriptionScrollView"),T=H(l),D=H(x),k=H(a),L=H(h),F((I=i((A=function(t){function i(){for(var i,e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return i=t.call.apply(t,[this].concat(r))||this,n(i,"scrollView",I,o(i)),n(i,"answerClipsAnimation",N,o(i)),n(i,"chooseButtonLayout",P,o(i)),n(i,"bgSprite",R,o(i)),i.centerPosition=u(),i.quarterHeight=0,i.index=0,i.needScroll=!1,i.descriptions=[],i.tipCards=[],i}e(i,t);var s=i.prototype;return s.onLoad=function(){var t;this.scrollView?(this.quarterHeight=3*this.scrollView.getComponent(d).height/4,this.centerPosition=this.scrollView.content.getComponent(d).convertToWorldSpaceAR(new p(0,0,0)),null==(t=this.scrollView)||t.node.on("scrolling",this.onScrolling,this)):console.warn("ScrollView component is not assigned.")},s.onDestroy=function(){var t;null==(t=this.scrollView)||t.node.off("scrolling",this.onScrolling,this)},s.onScrolling=function(){if(this.needScroll)for(var t=this.scrollView.content.children,i=this.scrollView.content.getComponent(d),e=this.descriptions.length,n=0;n<t.length;n++){var o=t[n],r=i.convertToWorldSpaceAR(o.position);if(p.distance(r,this.centerPosition)<=this.quarterHeight&&n===this.index){if(this.index++,e<=this.index){console.log("DescriptionScrollView: 滾動到底部",e,"<=",this.index),this.index=e,this.needScroll=!1,B.instance.emit("DescriptionScrollViewEnd");break}var s=this.descriptions[this.index];this.descriptionFadin(s,t);break}}},s.descriptionFadin=function(t,i){var e=i[this.index]||f(i[0]);e.parent=this.scrollView.content,e.position=p.ZERO,e.active=!0;var n=e.getComponent(g);n.string=this.describe(t),n.enabled=!1,n.enabled=!0;var o=e.getComponent(v);o.opacity=0,w(o).to(.5,{opacity:255}).start()},s.describe=function(t){var i=this,e=this.tipCards.map((function(t){return t.string})),n=S.replaceMarkedWithKeywords([t],e)[0],o=n.text,r=n.tipCards.filter((function(t){return!i.tipCards.some((function(i){return i.string===t.string}))}));if(console.log("new tips:",r),r.length>0){this.answerClipsAnimation.spreadCards(r.map((function(t){return t.string}))),this.tipCards=this.tipCards.concat(r);var s=r.find((function(t){return!!t.pic}));s&&this.setPhotoImage(s.pic)}return o},s.setPhotoImage=function(t){var i=this.bgSprite,e="maps/"+t+"/spriteFrame";m.load(e,C,(function(t,e){t?console.error("Failed to load image: "+t):(i.spriteFrame=e,i.spriteFrame.texture.setFilters(y.Filter.NONE,y.Filter.NONE))}))},s.hideButtonLayout=function(){this.chooseButtonLayout.active=!1},s.setData=function(t){if(t){console.log("set descriptions data:",t),this.scrollView.scrollToTop();var i=this.scrollView.content.children;i.forEach((function(t){return t.active=!1})),this.index=0;var e=i[this.index];e.active=!0,this.descriptions=[].concat(t);var n=this.descriptions[this.index];e.getComponent(g).string=this.describe(n),this.chooseButtonLayout.active=!1,this.needScroll=!0}else console.log("設定時未正確輸入資料!!!")},s.addNewData=function(t){if(t){console.log("add new descriptions data:",t),this.descriptions=this.descriptions.concat(t);var i=this.descriptions[this.index];if(i){var e=this.scrollView.content.children;this.descriptionFadin(i,e),this.chooseButtonLayout.active=!1,this.needScroll=!0}else console.error(this.index,"DescriptionScrollView: 描述資料不存在!!!")}else console.log("新增時未正確輸入資料!!!")},s.deleteCard=function(t){this.tipCards.splice(this.tipCards.findIndex((function(i){return i===t})),1),console.log("tipCards:",this.tipCards)},s.setChooseButtons=function(t){var i=this;this.chooseButtonLayout.active=!0;var e=this.chooseButtonLayout.children;e.forEach((function(t){t.off("click"),t.active=!1})),console.log("set choose buttons:",t),t.forEach((function(t,n){var o=e[n]||f(e[0]);o.active=!0,o.parent=i.chooseButtonLayout;var r=o.getComponentInChildren(V);r.string=t.text,o.on("click",(function(){r.string="--",o.off("click"),t.callback()}))}))},s.show=function(t){void 0===t&&(t=!0),this.node.active=t,t||(this.scrollView.content.children.forEach((function(t){return t.active=!1})),this.scrollView.scrollToPercentVertical(0),this.clear())},s.clear=function(){this.index=0,this.descriptions.length=0,this.clearTipCards(),this.scrollView.content.children.forEach((function(t,i){return i>0&&t.destroy()}))},s.clearTipCards=function(){this.tipCards.length=0},s.hide=function(){this.node.active=!1},s.scrollToBottom=function(){this.scrollView.scrollToBottom(1)},s.onClicked=function(t,i){this.show(!1)},r(i,[{key:"isBottom",get:function(){return this.index>=this.descriptions.length-1}}]),i}(b)).prototype,"scrollView",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=i(A.prototype,"answerClipsAnimation",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=i(A.prototype,"chooseButtonLayout",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=i(A.prototype,"bgSprite",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=A))||E));s._RF.pop()}}}));

System.register("chunks:///_virtual/DiscardCardsPile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CardComponent2.ts"],(function(n){var t,r,e,i,a,o,s,c,u,l,p,f,d,m,h;return{setters:[function(n){t=n.applyDecoratedDescriptor,r=n.inheritsLoose,e=n.initializerDefineProperty,i=n.assertThisInitialized,a=n.asyncToGenerator,o=n.regeneratorRuntime},function(n){s=n.cclegacy,c=n._decorator,u=n.Prefab,l=n.Node,p=n.Vec3,f=n.tween,d=n.Component,m=n.instantiate},function(n){h=n.CardComponent}],execute:function(){var v,C,P,w,b,g,y;s._RF.push({},"62966EzVs5FsrwzsHD7VcvV","DiscardCardsPile",void 0);var D=c.ccclass,x=c.property;n("default",(v=D("DiscardCardsPile"),C=x(u),P=x(l),v((g=t((b=function(n){function t(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=n.call.apply(n,[this].concat(a))||this,e(t,"cardPrefab",g,i(t)),e(t,"discardPileContainer",y,i(t)),t.animating=!1,t}r(t,n);var s=t.prototype;return s.addCardToDiscardPile=function(){var n=a(o().mark((function n(t){var r;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.animating){n.next=3;break}return n.next=3,this.waitForAnimation();case 3:return this.animating=!0,(r=m(this.cardPrefab)).getComponent(h).setup(t),r.parent=this.discardPileContainer,r.position=p.ZERO,n.next=10,this.animateCard(r);case 10:this.animating=!1;case 11:case"end":return n.stop()}}),n,this)})));return function(t){return n.apply(this,arguments)}}(),s.waitForAnimation=function(){var n=a(o().mark((function n(){var t=this;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n){!function r(){t.animating?setTimeout(r,100):n(!0)}()})));case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),s.animateCard=function(n){return new Promise((function(t){var r=new p(200,100,0);f(n).to(1,{position:r}).call((function(){t(!0)})).start()}))},t}(d)).prototype,"cardPrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(b.prototype,"discardPileContainer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=b))||w));s._RF.pop()}}}));

System.register("chunks:///_virtual/Draggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DropZone.ts"],(function(t){var o,e,n,i,r,s,a,h,c,l,d,u,p,T;return{setters:[function(t){o=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,i=t._decorator,r=t.Sprite,s=t.resources,a=t.SpriteFrame,h=t.Texture2D,c=t.Vec3,l=t.Node,d=t.UITransform,u=t.director,p=t.Component},function(t){T=t.DropZone}],execute:function(){var f;n._RF.push({},"249d3/MwIlD0L9q0+4YCk49","Draggable",void 0);var g=i.ccclass;i.property,t("Draggable",g("Draggable")(f=function(t){function n(){for(var o,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(o=t.call.apply(t,[this].concat(n))||this).startParent=null,o.zone=null,o}o(n,t);var i=n.prototype;return i.start=function(){this.startParent=this.node.parent},i.setPhotoImage=function(t){var o=this.node.getComponent(r),e="maps/"+t+"/spriteFrame";s.load(e,a,(function(t,e){t?console.error("Failed to load image: "+t):(o.spriteFrame=e,o.spriteFrame.texture.setFilters(h.Filter.NONE,h.Filter.NONE))}))},i.touchCancel=function(){this.node.parent=this.startParent,this.node.setPosition(c.ZERO)},i.onEnable=function(){this.node.on(l.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(l.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(l.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(l.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},i.onDisable=function(){this.node.off(l.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(l.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(l.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(l.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},i.onTouchStart=function(t){var o=this.startParent.getComponent(d).convertToWorldSpaceAR(this.node.position),e=o.x,n=o.y;this.node.parent=u.getScene().children[0],this.node.setWorldPosition(new c(e,n,0)),console.log("onTouchStart",this.node.name)},i.onTouchMove=function(t){var o=t.getUIDelta();this.node.setPosition(this.node.position.x+o.x,this.node.position.y+o.y)},i.onTouchEnd=function(t){var o=this.node.scene.getComponentsInChildren(T).filter((function(t){return t.node.active})),n=!1,i=this.node.getWorldPosition(),r=i.x,s=i.y;console.log("dropZones length:",o.length,"("+r+", "+s+")");for(var a,h=e(o);!(a=h()).done;){var l=a.value;if(c.len(l.node.getWorldPosition().clone().subtract3f(r,s,0))<50){n=!0,this.zone=l,console.log("dropped to zone:",l.node.name),l.node.emit("drop",{draggableItem:this,dropZone:l});break}}n||(this.node.parent=this.startParent,this.node.setPosition(c.ZERO))},i.onTouchCancel=function(t){this.touchCancel()},n}(p))||f);n._RF.pop()}}}));

System.register("chunks:///_virtual/DropZone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Draggable.ts"],(function(e){var o,t,n,r,i,a,l,s,c,p;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,l=e.Node,s=e.Vec3,c=e.Component},function(e){p=e.Draggable}],execute:function(){var h,u,d,f,g;i._RF.push({},"ae71cnkrp1Nopo6XFRtfKkQ","DropZone",void 0);var D=a.ccclass,b=a.property;e("DropZone",(h=D("DropZone"),u=b(l),h((g=o((f=function(e){function o(){for(var o,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return o=e.call.apply(e,[this].concat(i))||this,n(o,"placeholder",g,r(o)),o}t(o,e);var i=o.prototype;return i.onEnable=function(){this.node.on("drop",this.onDrop,this)},i.onDisable=function(){this.node.off("drop",this.onDrop,this)},i.onDrop=function(e){var o=e.draggableItem;if(this.placeholder){var t=this.placeholder.children[0];t&&(console.log("道具已存在，交换位置"),t.parent=o.startParent,t.setPosition(new s(0,0,0)),t.getComponent(p).startParent=t.parent),o.node.parent=this.placeholder,o.node.setPosition(new s(0,0,0)),o.startParent=this.placeholder,console.log("道具已放置")}},o}(c)).prototype,"placeholder",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=f))||d));i._RF.pop()}}}));

System.register("chunks:///_virtual/Dungeon.ts",["cc"],(function(t){var s;return{setters:[function(t){s=t.cclegacy}],execute:function(){s._RF.push({},"9b9b3IiH/9IjYT1OxoCsK5v","Dungeon",void 0);var o=t("Direction",function(t){return t[t.North=0]="North",t[t.South=1]="South",t[t.East=2]="East",t[t.West=3]="West",t}({})),i=t("Room",function(){function t(t,s){this.instanceNode=null,this.x=void 0,this.y=void 0,this.icon=void 0,this.name=void 0,this.descriptions=void 0,this.connections=void 0,this.question=void 0,this.cards=void 0,this.x=t,this.y=s,this.connections=[]}var s=t.prototype;return s.setInfo=function(t){this.icon=t.icon,this.name=t.name,this.descriptions=t.descriptions,this.question=t.question,this.cards=t.cards},s.connectWith=function(t){this.x<t.x?(this.connections.push(o.East),t.connections.push(o.West)):this.x>t.x?(this.connections.push(o.West),t.connections.push(o.East)):this.y<t.y?(this.connections.push(o.North),t.connections.push(o.South)):this.y>t.y&&(this.connections.push(o.South),t.connections.push(o.North))},t}());t("DungeonMaze",function(){function t(t,s){this.rooms=void 0,this.width=void 0,this.height=void 0,this.width=t,this.height=s,this.rooms=Array.from({length:s},(function(s,o){return Array.from({length:t},(function(t,s){return new i(s,o)}))}))}var s=t.prototype;return s.generateMaze=function(t,s){void 0===t&&(t=0),void 0===s&&(s=0);var o=[],i=this.rooms[t][s],n=new Set;for(n.add(i),o.push(i);o.length>0;){i=o.pop();var h=this.getUnvisitedNeighbors(i,n);if(h.length>0){o.push(i);var e=h[Math.floor(Math.random()*h.length)];i.connectWith(e),n.add(e),o.push(e)}}},s.getUnvisitedNeighbors=function(t,s){var o=[],i=t.x,n=t.y;return i>0&&!s.has(this.rooms[n][i-1])&&o.push(this.rooms[n][i-1]),i<this.width-1&&!s.has(this.rooms[n][i+1])&&o.push(this.rooms[n][i+1]),n>0&&!s.has(this.rooms[n-1][i])&&o.push(this.rooms[n-1][i]),n<this.height-1&&!s.has(this.rooms[n+1][i])&&o.push(this.rooms[n+1][i]),o},s.findExit=function(t,s){var o=[],i=new Set,n=this.rooms[s][t];for(i.add(n),o.push(n);o.length>0;){var h=o.shift();if(h!==n&&1===h.connections.length)return h;this.getNeighbors(h).forEach((function(t){i.has(t)||(i.add(t),o.push(t))})),console.log(o.length)}return null},s.getNeighbors=function(t){var s=[],i=t.x,n=t.y;return t.connections.includes(o.South)&&n>0&&s.push(this.rooms[n-1][i]),t.connections.includes(o.North)&&n<this.height-1&&s.push(this.rooms[n+1][i]),t.connections.includes(o.West)&&i>0&&s.push(this.rooms[n][i-1]),t.connections.includes(o.East)&&i<this.width-1&&s.push(this.rooms[n][i+1]),s},t}());s._RF.pop()}}}));

System.register("chunks:///_virtual/DungeonEscapeHandler.ts",["cc","./SocketBridge.ts","./DungeonEscapeRecord.ts"],(function(t){var i,e,n,s;return{setters:[function(t){i=t.cclegacy,e=t.randomRangeInt},function(t){n=t.SocketBridge},function(t){s=t.DungeonEscapeRecord}],execute:function(){i._RF.push({},"d68b09aVpdIe4fyzggjYLzz","DungeonEscapeHandler",void 0);t("DungeonEscapeHandler",function(){function t(t,i,e,n,s,o,a){this._honstGameRecord=void 0,this._roomID=void 0,this._isHonster=!1,this._masterID="",this._playerID="",this._myNickname="",this._players=void 0,this._gameView=void 0,this._communityCards=[],this._gameView=t,this._gameView.requestApplicate=this._applicate.bind(this),this._isHonster=i,i&&(this._players=a),this._gameView.init(e,n,s),this.startGame(e,o,a)}var i=t.prototype;return i._applicate=function(t,i){void 0===i&&(i=""),this._isHonster?(console.log("====== Applicate "+t+" 事件不透過連線發給自己:",i),this["notify_"+t](this._roomID,t,i)):n.Instance.applicate(t,i)},i._broadcast=function(t,i,e){if(void 0===i&&(i=""),this._isHonster){if(e===this._playerID)return console.log("====== Broadcast "+t+" 事件不透過連線發給自己:\n",i);n.Instance.broadcast(t,i,e)}},i.startGame=function(t,i,e){this._roomID=t,e&&(this._isHonster=!0,this._honstGameRecord=new s,i?this._honstGameRecord.readData():this._honstGameRecord.players=e),n.Instance.addDispatcher(t,this,{alert:this.notify_alert,update_game_step:this.notify_update_game_step,exploration:this.notify_exploration,reconnect:this.notify_reconnect}),this._isHonster,i&&this._applicate("reconnect",this._playerID)},i.endGame=function(t){n.Instance.removeDispatcher(t,this),this._isHonster&&(this._honstGameRecord.clearData(),this._honstGameRecord=null),this._masterID="",this._playerID="",this._myNickname=""},i.onExploration=function(t,i){e(1,20);return[]},i.notify_alert=function(t,i,e){this._gameView.onShowTip(e)},i.notify_update_game_step=function(t,i,e){},i.notify_quick_view=function(t,i,e){var n,s;if(this._isHonster){n=e.split(" ")[0];this.onExploration(n,6),e=n+" "+this._communityCards,this._broadcast(i,e)}var o=e.split(" ");n=o[0],s=o[1],this._gameView.onExplorationEvent(n,s)},i.notify_exploration=function(t,i,e){var n,s,o;if(this._isHonster){var a=e.split(" ");e=(n=a[0])+" "+(s=this.onExploration(n,60))+" "+this._communityCards,this._broadcast(i,e)}var r=e.split(" ");n=r[0],s=r[1],o=r[2],this._gameView.onExplorationEvent(n,o,s)},i.notify_reconnect=function(t,i,e){this._gameView.onShowTip("重連"+t)},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/DungeonEscapeRecord.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RandomString.ts"],(function(e){var r,t,n;return{setters:[function(e){r=e.createClass},function(e){t=e.cclegacy},function(e){n=e.RandomString}],execute:function(){t._RF.push({},"baba1oKE25Nga8ScDrOg25J","DungeonEscapeRecord",void 0);var a="DE_GAME_RECORD_INFO",s=e("Role",function(e){return e[e.PLAYER=0]="PLAYER",e[e.MASTER=1]="MASTER",e}({})),o=e("GameStatus",function(e){return e[e.GAMING=0]="GAMING",e}({})),i=e("AreaDirection",function(e){return e[e.UP=0]="UP",e[e.LEFT=1]="LEFT",e[e.DOWN=2]="DOWN",e[e.RIGHT=3]="RIGHT",e}({}));e("DungeonEscapeRecord",function(){function e(){this.masterID="",this._players={},this._roundPlayers=[],this._roundIndex=0,this._areaInfos={},this._doors={}}var t=e.prototype;return t.addPlayer=function(e,r,t){this._players[e]={nickname:r,gameStatus:t,role:s.PLAYER},this._roundPlayers=Object.keys(this._players)},t.delPlayer=function(e){delete this._players[e]},t.selectPlayer=function(e){return this._players[e]},t.nextPlayer=function(){this._roundIndex=(this._roundIndex+1)%this._roundPlayers.length},t.clearData=function(){this._players={},this._roundPlayers.length=0,this._roundIndex=0,localStorage.removeItem(a)},t.readData=function(){var e=JSON.parse(localStorage.getItem(a));console.log("Read data:",e),e&&(this.masterID=e.masterID,this._players=e.players,this._roundPlayers=e.roundPlayers)},t.writeData=function(){var e={masterID:this.masterID,players:this._players,roundPlayers:this._roundPlayers};localStorage.setItem(a,JSON.stringify(e))},t.dropAnswerHandCards=function(e,r){this.dropHandCard(this._players[e].answerHandCards,r)},t.dropHandCard=function(e,r){return r.every((function(r){return e.find((function(e,t,n){if(e===r)return n.splice(t,1),!0}))}))},t.createArea=function(e){var r;this._areaInfos[e]={doors:(r={},r[i.UP]="",r[i.LEFT]="",r[i.DOWN]="",r[i.RIGHT]="",r)}},t.linkDoor=function(e,r,t){var a,s,o,u,c=r.split("-"),l=parseInt(c[0]),d=parseInt(c[1]);switch(a=l+"-"+d,o=this._areaInfos[a],e){case i.UP:d++;break;case i.LEFT:l--;break;case i.DOWN:d--;break;case i.RIGHT:l++}s=l+"-"+d;var h=n.generate();t?(u=this._areaInfos[s],o.doors[e]=h,u.doors[(e+2)%4]=h):(this.createArea(s),this._areaInfos[s].doors[e]=h),this._doors[h]={rooms:[a,s]}},r(e,[{key:"players",set:function(e){var r=this;this._roundPlayers=Object.keys(e),this._roundPlayers.forEach((function(t){r.addPlayer(t,e[t],o.GAMING)}))}},{key:"roundPlayers",get:function(){return this._roundPlayers}}]),e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/DungeonEscapeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HandCards.ts","./EventManager.ts","./TipText.ts"],(function(e){var n,t,i,r,o,a,u,l,c,s,p,d,f;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,u=e.Label,l=e.Node,c=e.Vec3,s=e.Component},function(e){p=e.HandCards},function(e){d=e.EventManager},function(e){f=e.TipType}],execute:function(){var b,g,y,w,v,h,m,C,D,H,E;o._RF.push({},"86bf6dCbFdKo7HRujQDV1To","DungeonEscapeView",void 0);var z=a.ccclass,L=a.property;e("DungeonEscapeView",(b=z("DungeonEscapeView"),g=L(p),y=L(p),w=L(u),v=L(l),b((C=n((m=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,i(n,"questionHandCards",C,r(n)),i(n,"answerHandCards",D,r(n)),i(n,"infoLabel",H,r(n)),i(n,"blockNode",E,r(n)),n}t(n,e);var o=n.prototype;return o.onLoad=function(){this.node.setPosition(c.ZERO)},o.sendMessage=function(e){d.instance.emit(f.Normal,e)},n}(s)).prototype,"questionHandCards",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=n(m.prototype,"answerHandCards",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=n(m.prototype,"infoLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(m.prototype,"blockNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=m))||h));o._RF.pop()}}}));

System.register("chunks:///_virtual/DungeonTest.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Rogue.ts","./Ability.ts","./Character.ts","./CharacterInfo.ts","./ClassFeatureImplementation.ts","./EventManager.ts","./UIManager.ts","./DataModal.ts","./Weapon.ts","./Inventory.ts","./Armor.ts","./TeamMember.ts","./CombatController.ts"],(function(t){var e,n,r,i,a,o,c,s,l,u,m,h,f,y,g,p,v,d,I,b,w,C;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){a=t.cclegacy,o=t._decorator,c=t.instantiate,s=t.Component},function(t){l=t.default},function(t){u=t.Attribute},function(t){m=t.Character},function(t){h=t.CharacterInfo},function(t){f=t.warriorFeatures},function(t){y=t.EventManager},function(t){g=t.UIEvent},function(t){p=t.DataModal},function(t){v=t.Weapon,d=t.WeaponStyle},function(t){I=t.Inventory},function(t){b=t.Armor},function(t){w=t.TeamMember},function(t){C=t.CombatControllerEvent}],execute:function(){var D,S,E,M,A,T,L,P,_;a._RF.push({},"f4526RX+5hPcLHQlE2ZMXV7","DungeonTest",void 0);var z=o.ccclass,F=o.property;t("DungeonTest",(D=z("DungeonTest"),S=F(l),E=F(h),M=F(I),D((L=e((T=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a))||this,r(e,"rogue",L,i(e)),r(e,"characterInfo",P,i(e)),r(e,"inventory",_,i(e)),e.monsterEmeny=null,e.emenyParam={constitution:5,spirit:20,willpower:15},e.emenyAC=10,e}n(e,t);var a=e.prototype;return a.onLoad=function(){y.instance.on("battleStart",this.battleStart,this)},a.onDestroy=function(){y.instance.off("battleStart",this.battleStart,this)},a.start=function(){var t;y.instance.emit("QuestAccept","kuai_kuai_cat1");var e=((t={})[u.Strength]=15,t[u.Dexterity]=14,t[u.Intelligence]=13,t[u.Wisdom]=12,t[u.Charisma]=10,t[u.Resilience]=8,t);this.characterInfo.node.active=!0,p.getInstance().playerCharacter=new m("warrior",1,e,f),this.characterInfo.character=p.getInstance().playerCharacter,y.instance.emit(g.BaseAbilityAllocation,{allocatePoints:0,baseAbilities:e});var n=c(this.characterInfo.member.node);this.monsterEmeny=n.getComponent(w),this.setInventory()},a.setInventory=function(){var t=this;y.instance.emit(g.InventoryShowUI,!0),[new v("銅錘","2 gold",2,d.LightHammer,"hammer",{dice:"1d4",type:"Bludgeoning"},["Light","Thrown"],"Melee"),new v("匕首","2 gold",1,d.Dagger,"dagger",{dice:"1d4",type:"Piercing"},["Finesse","Light","Thrown"],"Melee")].forEach((function(e){return t.inventory.addItem(e)})),[new b("生皮甲","rawhide","10 gold",12,12,0,"None","Medium")].forEach((function(e){return t.inventory.addItem(e)})),y.instance.emit(g.InventoryShowUI,!1)},a.battleStart=function(t){this.characterInfo.rollInitiativeOrder();var e=p.getInstance().storyData.monsters[t],n=e.icon,r=e.ac,i=e.dex,a=e.constitution;e.spirit,e.willpower;this.emenyParam.constitution=a,this.monsterEmeny.monsterInitial(n,this.emenyParam,r),this.monsterEmeny.rollInitiativeOrder(i);var o=this.characterInfo.member;y.instance.emit(C.InitiativeOrder,{mainCharacter:o,team:[[o],[this.monsterEmeny]]})},a.onBattleStartClicked=function(t){t.target.active=!1,y.instance.emit(g.DescriptionScrollViewShowUI,!1),this.battleStart("goblinLv1")},e}(s)).prototype,"rogue",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(T.prototype,"characterInfo",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(T.prototype,"inventory",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=T))||A));a._RF.pop()}}}));

System.register("chunks:///_virtual/DynamicWidthScrollView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,n,e,o,r,l,c,a,s,h,u,p;return{setters:[function(i){t=i.applyDecoratedDescriptor,n=i.inheritsLoose,e=i.initializerDefineProperty,o=i.assertThisInitialized,r=i.createForOfIteratorHelperLoose},function(i){l=i.cclegacy,c=i._decorator,a=i.ScrollView,s=i.UITransform,h=i.Vec3,u=i.v3,p=i.Component}],execute:function(){var d,m,f,w,g,v,W,y;l._RF.push({},"97f47FpcPJIjKbS1g4ndve0","DynamicWidthScrollView",void 0);var V=c.ccclass,b=c.property;i("DynamicWidthScrollView",(d=V("DynamicWidthScrollView"),m=b(a),d((g=t((w=function(i){function t(){for(var t,n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return t=i.call.apply(i,[this].concat(r))||this,e(t,"scrollView",g,o(t)),e(t,"maxWidth",v,o(t)),e(t,"minWidth",W,o(t)),e(t,"spacingX",y,o(t)),t.centerPosition=void 0,t}n(t,i);var l=t.prototype;return l.onLoad=function(){var i,t;this.scrollView?(this.centerPosition=this.scrollView.getComponent(s).convertToWorldSpaceAR(new h(0,0,0)),null==(i=this.scrollView)||null==(t=i.node)||t.on("scrolling",this.onScrolling,this)):console.warn("ScrollView component is not assigned.")},l.onDestroy=function(){var i,t;null==(i=this.scrollView)||null==(t=i.node)||t.off("scrolling",this.onScrolling,this)},l.onScrolling=function(){for(var i,t=this.scrollView.content.children,n=this.scrollView.content.getComponent(s),e=r(t);!(i=e()).done;){var o=i.value,l=n.convertToWorldSpaceAR(o.position),c=h.distance(l,this.centerPosition),a=this.calculateWidth(c);o.getComponent(s).width=a;var p=Math.min(1+a/this.maxWidth,1.3);o.scale=u(p,p,1)}},l.calculateWidth=function(i){var t=this.scrollView.node.getComponent(s).width/2,n=this.minWidth+(this.maxWidth-this.minWidth)*(1-i/t);return n=Math.max(this.minWidth,Math.min(this.maxWidth,n))},t}(p)).prototype,"scrollView",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(w.prototype,"maxWidth",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),W=t(w.prototype,"minWidth",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),y=t(w.prototype,"spacingX",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),f=w))||f));l._RF.pop()}}}));

System.register("chunks:///_virtual/EffectManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,f;return{setters:[function(e){t=e.createClass},function(e){f=e.cclegacy}],execute:function(){f._RF.push({},"b2f1eX9FQRE4L/7VMvooGDE","EffectManager",void 0),e("EffectManager",function(){function e(){this.effects=new Map}var f=e.prototype;return f.addEffect=function(e,t){var f=this.effects.get(e)||[];f.push(t),this.effects.set(e,f),console.log("this.effects:",JSON.stringify(this.effects))},f.removeEffect=function(e,t){var f=this.effects.get(e)||[],n=f.indexOf(t);-1!==n&&f.splice(n,1),0===f.length&&this.effects.delete(e),console.log("Effect removed from "+e.name)},f.applySkillEffects=function(e,t){},f.updateEffects=function(){var e=this;console.log("updateEffects",this.effects),this.effects.forEach((function(t,f){f.resetBonuses(),e.effects.set(f,t.filter((function(t){return t.duration>0&&(t.duration--,!(t.duration<=0)||(e.removeEffect(f,t),!1))}))),0===t.length&&e.clearEffects(f)}))},f.clearEffects=function(e){this.effects.delete(e),console.log("All effects cleared from "+e.name)},t(e,null,[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}())._instance=void 0,f._RF.pop()}}}));

System.register("chunks:///_virtual/EnemySkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CombatSkill.ts"],(function(e){var t,i,n,a;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.randomRangeInt},function(e){a=e.CombatSkill}],execute:function(){i._RF.push({},"3fc85sLUQZJ1aKlSIc/AZ84","EnemySkill",void 0);e("EnemySkill",function(e){function i(){return e.apply(this,arguments)||this}t(i,e);var a=i.prototype;return a.getAffix=function(){return[{name:"射擊:配合呼吸",description:"「冷靜，配合呼吸再放弓…」",effect:{affix:"inspiration",value:1,duration:2}},{name:"射擊:穩定姿態",description:"「讓手指保持穩定…」",effect:{affix:"inspiration",value:n(2,3),duration:2}},{name:"射擊:瞄定再發",description:"「先瞄準，再發射…」",effect:{affix:"precision",value:1,duration:2}},{name:"射擊:預測準星",description:"「我看見了…能命中！」",effect:{affix:"precision",value:n(2,3),duration:2}}]},a.applySkillEffects=function(e,t,i){var a=this;if(i>this.level)console.log("等級不足");else switch(i){case 1:console.log("弱點射擊");var o={affix:"inspiration",value:n(3,6),duration:2};this.activateSkillEffect(e,o);break;case 2:console.log("精準射擊");o={affix:"precision",value:n(1,6),duration:2};this.activateSkillEffect(e,o);break;case 3:console.log("分裂箭");break;case 4:console.log("突襲射擊");break;case 5:t.forEach((function(e){console.log("光眩射擊"),Math.random()<.25&&(console.log(e.name+" is blid."),a.activateSkillEffect(e,{affix:"eye",value:1,duration:3}))}));break;case 6:console.log("末日之雨"),t.forEach((function(e){}))}},a.getSkill1=function(){return[{serialId:"skill1",level:1,name:"攻擊",description:"攻擊6點。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"DamageBonus",bonus:"+6",duration:1,conditions:["Melee"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"精準",description:"命中提升4點。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitBonus",bonus:"+4",duration:1,conditions:["Melee"]}],target:"self",range:"Melee",type:"damage",animation:"attack"},{serialId:"skill1",level:1,name:"防禦",description:"專注防禦，+4臨時護甲值。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"Defense",bonus:"+4",duration:1,conditions:["Defense"]}],target:"self",range:"Melee",type:"damage",animation:"attack"}]},i}(a));i._RF.pop()}}}));

System.register("chunks:///_virtual/EquipmentDropZone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DropZone.ts","./WeaponDraggable.ts","./EventManager.ts","./ArmorDraggable.ts","./ShieldDraggable.ts"],(function(e){var n,t,i,o,r,a,p,l,u,s,c,d;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,p=e.Enum},function(e){l=e.DropZone},function(e){u=e.WeaponDraggable},function(e){s=e.EventManager},function(e){c=e.ArmorDraggable},function(e){d=e.ShieldDraggable}],execute:function(){var m,h,g,f,x,D;r._RF.push({},"a3adfkKUFhPtb2tHmzEtFBZ","EquipmentDropZone",void 0);var q=a.ccclass,I=a.property,b=e("EquipmentDropZoneIndex",function(e){return e[e.None=0]="None",e[e.WeaponOrShield=1]="WeaponOrShield",e[e.Armor=2]="Armor",e}({}));p(b);e("EquipmentDropZone",(m=q("EquipmentDropZone"),h=I({type:b}),m((x=n((f=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return n=e.call.apply(e,[this].concat(r))||this,i(n,"equipmentIndex",x,o(n)),i(n,"serialIndex",D,o(n)),n}return t(n,e),n.prototype.onDrop=function(t){var i=t.draggableItem,o=t.dropZone;return console.log("Drop on equipmentDropZone",o instanceof n,this.equipmentIndex),this.equipmentIndex===b.WeaponOrShield&&i instanceof u?(e.prototype.onDrop.call(this,t),console.log("Weapon dropped",i.item),i.equipmentIndex=this.equipmentIndex,void s.instance.emit("CharacterEquipWeapon",{index:this.serialIndex,item:i.item})):this.equipmentIndex===b.Armor&&i instanceof c?(e.prototype.onDrop.call(this,t),console.log("Armor dropped",i.item),i.equipmentIndex=this.equipmentIndex,void s.instance.emit("CharacterEquipArmor",{index:this.serialIndex,item:i.item})):this.equipmentIndex===b.WeaponOrShield&&i instanceof d?(e.prototype.onDrop.call(this,t),console.log("Armor dropped",i.item),i.equipmentIndex=this.equipmentIndex,void s.instance.emit("CharacterEquipShield",{index:this.serialIndex,item:i.item})):void i.touchCancel()},n}(l)).prototype,"equipmentIndex",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return b.WeaponOrShield}}),D=n(f.prototype,"serialIndex",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),g=f))||g));r._RF.pop()}}}));

System.register("chunks:///_virtual/EventManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"65c67rVRUBMuLluwFwAgOe1","EventManager",void 0),e("EventManager",function(){function e(){this._listeners=new Map}var n=e.prototype;return n.on=function(e,t,n){this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).push({method:t,scope:n})},n.emit=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];this._listeners.has(e)&&this._listeners.get(e).forEach((function(e){var t=e.method,s=e.scope;return t.call.apply(t,[s].concat(n))}))},n.off=function(e,t,n){if(this._listeners.has(e)){var s=this._listeners.get(e),i=s.findIndex((function(e){return e.method===t&&e.scope===n}));i>-1&&s.splice(i,1)}},t(e,null,[{key:"instance",get:function(){return this._instance||(this._instance=new e),this._instance}}]),e}())._instance=void 0,n._RF.pop()}}}));

System.register("chunks:///_virtual/EventSystem.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"211fa4FmRNN/rOqFXMgfjsU","EventSystem",void 0);t("NotifyEvent",(function(t,e){this.type=void 0,this.detail=void 0,this.type=t,this.detail=e})),t("EventBus",function(){function t(){this.listeners={}}var e=t.prototype;return e.subscribe=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.unsubscribe=function(t,e){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter((function(t){return t!==e})))},e.publish=function(t){(this.listeners[t.type]||[]).forEach((function(e){return e(t.detail)}))},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/ExplorationCard.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Card.ts"],(function(e){var r,t,o,u,n;return{setters:[function(e){r=e.inheritsLoose,t=e.createClass},function(e){o=e.cclegacy,u=e.randomRangeInt},function(e){n=e.Card}],execute:function(){o._RF.push({},"0d421D24X1A45qQ4UMTsZR2","ExplorationCard",void 0);var s=e("CardSuit",function(e){return e[e.Prop=0]="Prop",e[e.Clue=1]="Clue",e[e.Doubt=2]="Doubt",e[e.Presage=3]="Presage",e}({}));e("ExplorationCard",function(e){function o(){for(var r,t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return(r=e.call.apply(e,[this].concat(o))||this)._intro="",r}r(o,e);var n=o.prototype;return n.getPropSetting=function(){var e=["夾層","書頁","文字","藏匿點","密道","機關"];return e[u(0,e.length-1)]},n.getClueSetting=function(){var e=["刻痕","沾染","燒焦","足跡","排序","留言","紀錄","手感"];return e[u(0,e.length-1)]},n.getDoubtSetting=function(){var e=["滅跡","缺失","短少","矛盾","陌生","異樣"];return e[u(0,e.length-1)]},n.getPresageSetting=function(){var e=["記憶","好奇","違和","不安","導引","聯想"];return e[u(0,e.length-1)]},n.getReasoning=function(e){var r=[this.test0(),this.test00(),this.test1(),this.test2(),this.test3(),this.test4(),this.test5()];return r[e%r.length]},n.test0=function(){var e,r;return{question:"這一道門上鎖了，找出[鑰匙]後即可<color=#ffcc00>開門</color>。",cards:[(e={},e[s.Prop]="[鑰匙]掛在牆壁上。",e[s.Presage]="牆上閃著銀色光芒，是一把[鑰匙]",e[s.Clue]="牆上有一把[鑰匙]，似乎可以用來開門。",e[s.Doubt]="[鑰匙]？看來這個難題太過容易。",e),(r={},r[s.Prop]="房間空盪盪，沒有其他東西。",r[s.Presage]="地板上似乎有些腐朽。",r[s.Clue]="牆上掛著一個小物件。",r[s.Doubt]="門真的鎖上了嗎？",r)]}},n.test00=function(){var e,r,t;return{question:"對應著上鎖的紅色門，找出[紅鑰匙]後即可<color=#ffcc00>開門</color>。",cards:[(e={},e[s.Prop]="[綠鑰匙]掛在牆壁上。",e[s.Presage]="牆上閃著銀色光芒，是一把[綠鑰匙]",e[s.Clue]="牆上有一把[綠鑰匙]，似乎可以用來開門。",e[s.Doubt]="[綠鑰匙]？看來這個難題太過容易。",e),(r={},r[s.Prop]="桌子上有一串鑰匙。",r[s.Presage]="藍色的[藍鑰匙]在桌子上很顯眼。",r[s.Clue]="桌上有一把[藍鑰匙]，似乎可以用來開門。",r[s.Doubt]="[藍鑰匙]？看來這個難題太過容易。",r),(t={},t[s.Prop]="枯死的盆栽在角落有些可憐。",t[s.Presage]="似乎在盆栽的深些有個紅色的東西",t[s.Clue]="探索盆栽後，有一個紅色的[紅鑰匙]。",t[s.Doubt]="盆栽是紅色的，是否跟紅色的門與鑰匙有關？",t)]}},n.test1=function(){var e,r,t;return{question:"輸入[三碼數字]的密碼解鎖[密碼鎖]後，順利打開[盒子]後從裡面取出一把精美的<color=#ffcc00>寶石匕首</color>。",cards:[(e={},e[s.Prop]="牆角邊有一個普通的木桶。",e[s.Presage]="木桶似乎有些新的小洞口。",e[s.Clue]="木桶的裡面有一個小小的洞，透過洞望進去可以看到一張寫著[三碼數字]的小紙條。",e[s.Doubt]="木桶的洞似乎被不斷挖開過，也許有些人想從中掏出什麼？",e),(r={},r[s.Prop]="[盒子]用[密碼鎖]上鎖了。",r[s.Presage]="[盒子]有些沉重，裡面裝著什麼。",r[s.Clue]="[盒子]上的鎖，是個三位數的[密碼鎖]。",r[s.Doubt]="[盒子]有個鎖，裡面的東西似乎很重要？",r),(t={},t[s.Prop]="一扇被破壞過的窗戶。",t[s.Presage]="窗戶上的窗簾看起來很破舊。",t[s.Clue]="窗簾似乎被巨大的爪子抓過…",t[s.Doubt]="窗戶的玻璃全被敲破，因此釘上許多木板，也許曾經有人想突破進來？",t)]}},n.test2=function(){var e,r,t,o;return{question:"透過寫在[照片]背面的開啟方法，打開[密封罐]後從中掏出一卷<color=#ffcc00>紅印文件</color>。",cards:[(e={},e[s.Prop]="展示櫃內部陳列著各式各樣的收藏品。",e[s.Presage]="當靠近展示櫃時，可以聽到微弱的機械運作聲。",e[s.Clue]="展示櫃的一個[密封罐]的位置發現了被頻繁觸碰或移動的磨損痕跡。",e[s.Doubt]="展示櫃中一件展品標籤與其他似乎略有不同",e),(r={},r[s.Prop]="展示櫃的[密封罐]中裝有一卷羊皮紙。",r[s.Presage]="[密封罐]外觀與它應有的重量還來得輕。",r[s.Clue]="[密封罐]的蓋子有特殊的旋轉機制，需按照特定順序旋轉才能打開。",r[s.Doubt]="罐內的物品看起來與展示櫃中其它展示物毫無關聯。",r),(t={},t[s.Prop]="[文書匣]內部分類細緻，但其中一個隔層異常緊固。",t[s.Presage]="打開[文書匣]時，一股陳年的紙張氣味撲面而來，中間卻夾帶著一絲[新墨水]的氣味。",t[s.Clue]="文書匣中一份文件因[紅色印記]而十分顯眼，但明顯是偽造的，用來掩蓋真實文件的存在。",t[s.Doubt]="[文書匣]中某些文件顯示出被重新放置的痕跡，似乎有人試圖隱藏或更改某些信息。",t),(o={},o[s.Prop]="相框是普通的裝飾品，背板可以拆卸取出[照片]",o[s.Presage]="觀察相框時，可以發現框架的某部分略有色差。",o[s.Clue]="相框中的[照片]的背面寫上如何開啟[密封罐]的方法。",o[s.Doubt]="照片中的人物與房間內其他照片的人物不同",o)]}},n.test3=function(){var e,r,t,o;return{question:"在[矮櫃]裡發現了一本[記事本]，用[鑰匙]開啟小鎖後從書頁中抽出一張<color=#ffcc00>邀請卡</color>。",cards:[(e={},e[s.Prop]="一張精緻的[茶几]，表面雕刻複雜，似乎能夠滑動，隱藏著一個[秘密抽屜]。",e[s.Presage]="靠近[茶几]時，你注意到桌面略有灰塵，但一個區域異常潔净，似乎有物體經常被放置在此。",e[s.Clue]="[茶几]上有明顯的刮痕，好像有重物被頻繁拖動過。",e[s.Doubt]="[茶几]的一個角落經常被某物撞擊，使得那裡的木材顯得略微凹陷。",e),(r={},r[s.Prop]="[矮櫃]裡藏有多個抽屜和小隔間，一個隔間似乎比其他的更難打開。",r[s.Presage]="打開[矮櫃]的時候，摸索後發現[木夾板]是用一本[記事本]偽裝而成的。",r[s.Clue]="[矮櫃]的背板有輕微的移動痕跡，暗示背後可能有[隱藏空間]。",r[s.Doubt]="[矮櫃]頂面有一塊顏色不匹配的[木夾板]，看起來是後來更換的。",r),(t={},t[s.Prop]="一本木制封面的記事本，皮革書封用[小鎖]鎖住無法打開這本記事，似乎藏有重要的秘密。",t[s.Presage]="輕撫記事本的書緣時，感覺到某些頁面比其他頁厚重。",t[s.Clue]="記事本的邊緣有奇怪的磨損，顯示經常被翻到某幾頁。",t[s.Doubt]="木製的封面將記事本偽裝成木夾板，是否意味著記事本的內容十分重要？",t),(o={},o[s.Prop]="這支筆外形奢華，裝有特殊的墨水，似乎只有特定的光線下才能看見其書寫的內容。",o[s.Presage]="拿起筆寫字時較沉重，且筆身搖動時有異音，讓人感覺它不只是用來寫字。",o[s.Clue]="筆桿被精心設計，可以轉動中間的金環，變成一支[鑰匙]。",o[s.Doubt]="筆的一端略顯磨損，不符合其整體保存狀態，似乎常被用於非正常用途？",o)]}},n.test4=function(){var e,r,t;return{question:"掀開[紅地毯]後發現下面有個方形[卡槽]，將[八音盒]放入其中後開始運作並奏著美妙的旋律，隨之在中心發現<color=#ffcc00>源質核心</color>。",cards:[(e={},e[s.Prop]="一幅描繪古典音樂家的[畫作]。",e[s.Presage]="畫框略顯老舊，但特定角度下會發現一個簽名。",e[s.Clue]="[畫作]的一個角落藏有微小的文字，提供了開啟[木盒]的線索。",e[s.Doubt]="[畫作]的繪製日期與畫框打印的日期相差很遠。",e),(r={},r[s.Prop]="精緻的小[木盒]，從[畫作]中的文字破解後發現這是一個[八音盒]。",r[s.Presage]="觸摸[木盒]時，你感受到一絲不尋常的震動，似乎內部裝有機械裝置，並繪著[音符]。",r[s.Clue]="[木盒]的側面雕刻著[音符]，與[紅地毯]上的圖案驚人地相似。",r[s.Doubt]="[木盒]的鎖看上去新近更換，與盒子的整體古老感覺不符。",r),(t={},t[s.Prop]="厚重的[紅地毯]，其圖案精美。",t[s.Presage]="踩上[紅地毯]後有個區塊有些凹陷，掀開後發現下面有個方形[卡槽]，與[木盒]的底部符合",t[s.Clue]="[紅地毯]的邊緣繪製的圖形與[木盒]底部的方形雕刻相似。",t[s.Doubt]="[紅地毯]有塊凹陷，掀開後發現下面有個方形[卡槽]",t)]}},n.test5=function(){var e,r,t,o,u,n,a;return{question:"跟隨著[箭頭花紋]發現到牆壁上的[畫作]後方的空間，並發現其中的[保險箱]，用薄片狀的[鐵片鑰匙]來開啟，獲得了<color=#ffcc00>金色鑰匙</color>。",cards:[(e={},e[s.Prop]="桌子上放置一個[花瓶]",e[s.Presage]="調整長短不一的桌腳使桌子穩定後，發現桌子底部貼有一本[日記]。",e[s.Clue]="轉動桌面讓符號相呼應後，一個[隱藏抽屜]被啟動，藏有一封[書信]。",e[s.Doubt]="試著解釋桌角磨損的原因後發現桌腳是可以旋轉的，擰開後掉出一張[紙條]。",e),(r={},r[s.Prop]="拉動特定的[書籍]可啟動機關。",r[s.Presage]="將錯位的[書籍]調整正確位置後，[書櫃]的一個[暗格]彈開，裡面有一把鑰匙。",r[s.Clue]="書脊上的隱喻指向[箭頭花紋]引導提示到[書櫃]後方，摸索後發現背後有一把薄片狀的[鐵片鑰匙]。",r[s.Doubt]="填補遺失[書籍]的空位後，觸發一陣機關轉動的聲音後，書櫃旁邊的[隱藏抽屜]打開，裡面有一把鑰匙。",r),(t={},t[s.Prop]="從桌子底下發現一本[日記]，提及[書櫃]的角落藏有某些秘密。",t[s.Presage]="好奇查找[日記]提及的[書櫃]上方角落，找到藏著的一把薄片狀的[鐵片鑰匙]。",t[s.Clue]="日記中提到一個特定日期，按照日期順序排列[書櫃]上的書，彈出[暗格]，發現一個[箭頭花紋]。",t[s.Doubt]="發現並解決[日記]中日期的矛盾後，從日記的暗號中獲得[隱藏抽屜]的提示。",t),(o={},o[s.Prop]="信中提到的秘密會面地點，實際上是指[羊毛毯]下的藏匿著重要的東西。",o[s.Presage]="地點相關聯的線索引導到一個秘密的[隱藏抽屜]，鑰匙孔適用一種薄片狀的鑰匙來開啟。",o[s.Clue]="信件邊緣的撕裂部分藏有一把薄片狀的[鐵片鑰匙]。",o[s.Doubt]="解開時間矛盾後，發現[羊毛毯]下方的[隱藏抽屜]，鑰匙孔適用一種薄片狀的鑰匙來開啟。",o),(u={},u[s.Prop]="移動[畫作]發現牆壁中的[保險箱]，鑰匙孔適用一種薄片狀的鑰匙來開啟。",u[s.Presage]="機械運作的聲音來源是牆後的一個隱藏門，移動[畫作]後可以發現牆壁中的[保險箱]。",u[s.Clue]="探索裂縫延伸而去的方向，意外發現隱藏牆後隱藏著一個放置[保險箱]的空間。",u[s.Doubt]="調查後發現[畫作]與房間的空間細節不符合後，找到畫背後的[保險箱]。",u),(n={},n[s.Prop]="掀開[羊毛毯]後，發現下方的[隱藏抽屜]。",n[s.Presage]="感到[羊毛毯]下的空洞迴響，發現下方的[隱藏抽屜]，使用薄片狀的鑰匙開啟後發現了[箭頭花紋]。",n[s.Clue]="地板符號是一個方向導引，使用薄片狀的鑰匙開啟後發現了[箭頭花紋]。感到[羊毛毯]下的空洞迴響，發現下方的[隱藏抽屜]，使用薄片狀的鑰匙開啟後發現了[箭頭花紋]。",n[s.Doubt]="日記的圖案與地板符號匹配後，使用薄片狀的鑰匙開啟後發現了[箭頭花紋]。",n),(a={},a[s.Prop]="花瓶的底部轉動後，發現藏有一把薄片狀的[鐵片鑰匙]。",a[s.Presage]="花瓶被移動的痕跡指向底座下的秘密抽屜，裡面有一把薄片狀的[鐵片鑰匙]。",a[s.Clue]="花瓶內部的隱藏底部打開，裡面藏有一把薄片狀的[鐵片鑰匙]。",a[s.Doubt]="花的新鮮度異常指引檢查花瓶水的底部，找到一把薄片狀的[鐵片鑰匙]。",a)]}},t(o,[{key:"intro",set:function(e){this._intro=e}}]),o}(n));o._RF.pop()}}}));

System.register("chunks:///_virtual/FillBlanks.ts",["cc","./Card.ts"],(function(r){var t,e;return{setters:[function(r){t=r.cclegacy},function(r){e=r.TipCard}],execute:function(){t._RF.push({},"29ba5DJel5CtJ7/DFwmBiNL","FillBlanks",void 0);r("FillBlanks",function(){function r(){}return r.answerQuestion=function(r,t,e){void 0===e&&(e="#FFFF00");var n=t.slice();return r.replace(/_/g,(function(r){return"<color="+e+">"+(n.shift()||"_")+"</c>"}))},r.replaceKeywordsWidthBlanks=function(r){for(var t=[],e=0;e<r.length;e++){var n=this.replaceAndStore(r[e],/\[(.*?)\]/g,"_"),i=n.text,o=n.keywords;t.push({text:i,keywords:o})}return t},r.replaceMarkedWithKeywords=function(t,e){for(var n=this,i=[],o=function(){var o=t[u],a=n.markNewKeywords(o,e),c=a.text,s=a.keywords,l=[],f=s.map((function(r){var t=n.keywordToTipCard(r);return l.push(t.string),t}));i.push({text:r.answerQuestion(c,l),tipCards:f})},u=0;u<t.length;u++)o();return i},r.keywordToTipCard=function(r){var t=r.split(" | "),n=t.shift(),i=new e;return i.string=n,t.forEach((function(r,t){var e=r.split(":");i[e[0]]=e[1]})),i},r.markNewKeywords=function(r,t){var e=/\[(.*?)\]/g;return t.forEach((function(t){r.indexOf(t)>-1&&(r=r.replace(e,(function(r,e){return e===t?t:r})))})),this.replaceAndStore(r,e,"_")},r.replaceAndStore=function(r,t,e){var n=[];return{text:r.replace(t,(function(r,t){return n.push(t),e})),keywords:n}},r}());t._RF.pop()}}}));

System.register("chunks:///_virtual/FirebaseBridge.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.esm.js","./index-77658911.js","./index.esm20172.js","./index.esm20173.js","./tslib.es6.mjs","./index.esm2017.js"],(function(e){var n,t,o,r,i,a,c,s,u,l,f,p,d,v;return{setters:[function(e){n=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){o=e.cclegacy},null,function(e){r=e.ab,i=e.o},function(e){a=e.initializeApp},null,null,function(e){c=e.onValue,s=e.ref,u=e.off,l=e.set,f=e.get,p=e.child,d=e.push,v=e.getDatabase}],execute:function(){o._RF.push({},"486ceOYX8JNTqCqKaRQagmq","FirebaseBridge",void 0);var h,g="DungeonEscape",m={},b=(e("default",function(){function e(){var e=a({apiKey:"AIzaSyAc5PRwmE14gBH5az8TSoqs9aBrQ8YWa4o",authDomain:"fir-test-756e1.firebaseapp.com",databaseURL:"https://fir-test-756e1.firebaseio.com",projectId:"fir-test-756e1",storageBucket:"fir-test-756e1.appspot.com",messagingSenderId:"182531440628"});h=v(e)}var o=e.prototype;return o.signInWithGoogleEmail=function(){var e=n(t().mark((function e(n,o){var a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r(i(),n,o);case 3:return a=e.sent,e.abrupt("return",a.user.uid);case 7:throw e.prev=7,e.t0=e.catch(0),new Error("登入失敗: "+e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n,t){return e.apply(this,arguments)}}(),o._onReceive=function(e,n){var t,o=n,r="",i=n.indexOf(" ");i>0&&(o=n.slice(0,i),r=n.slice(i+1)),null==(t=m[e])||t.forEach((function(n){return n.onReceive(e,o,r)}))},o.addDispatcher=function(e,n,t){if(""===e)throw new Error("connectID 不能為空白");var o=m[e]||[];o.some((function(e){if(e.scope===n)return Object.keys(t).forEach((function(n){return e.callbackMap[n]=t[n]})),!0}))||o.push(new b(n,t)),m[e]=o},o.removeDispatcher=function(e,n){var t=m[e];if(t){var o=t.findIndex((function(e){return e.scope===n}));-1!==o&&t.splice(o,1),0===t.length&&delete m[e]}},o.addConnection=function(e,n,t){var o=this;void 0===t&&(t="");var r=g+"/C/"+e+"/"+n+"/"+t;c(s(h,r),(function(r){var i=r.val();console.log("[NOTIFY]",n,t,":",i),i&&function(n){o._onReceive(e,n)}(i)})),console.log("加入監聽:",r)},o.delConnection=function(e,n,t){void 0===t&&(t="");var o=g+"/C/"+e+"/"+n+"/"+t;u(s(h,o)),console.log("移除監聽:",o)},o.uploadInfo=function(e,n,t,o,r){void 0===r&&(r="");var i=t?n+" "+t:n;l(s(h,g+"/C/"+e+"/"+o+"/"+r),i)},o.loadAsync=function(e,n){var t=g+"/D/"+e+"/";return new Promise((function(o){f(n?p(s(h,t),n):s(h,t)).then((function(t){var r=t.val();o(r),console.log(e,n,"::::",r)}))}))},o.addDataLabel=function(e,n){void 0===n&&(n=-1);var t=g+"/D";return e?console.log(e+"刷新資料:"+JSON.stringify(n)):e=d(s(h,t)).key||"",l(s(h,t+"/"+e+"/"),n),e},o.delDataLabel=function(e){l(s(h,"DungeonEscape/D/"+e+"/"),null)},e}()),function(){function e(e,n){this.scope=void 0,this.callbackMap=void 0,this.scope=e,this.callbackMap=n}return e.prototype.onReceive=function(e,n,t){var o=this.callbackMap[n];if(o)try{o.call(this.scope,e,n,t)}catch(e){console.error("執行回調時錯誤: "+e.message)}},e}());o._RF.pop()}}}));

System.register("chunks:///_virtual/FloatingTextComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,o,r,a,l,s,u,c,p,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.Color,s=t.Vec3,u=t.Label,c=t.instantiate,p=t.tween,b=t.Component}],execute:function(){var f,g,m,v,h,y,d,C,w,P,z,L,x;r._RF.push({},"6e930lNmNxI/bj5j7OKSnzK","FloatingTextComponent",void 0);var F=a.ccclass,T=a.property;t("FloatingTextComponent",(f=F("FloatingTextComponent"),g=T(l),m=T(l),v=T(s),h=T(s),y=T(u),f((w=e((C=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"positiveColor",w,o(e)),i(e,"negativeColor",P,o(e)),i(e,"startPoint",z,o(e)),i(e,"endPoint",L,o(e)),i(e,"templateLabel",x,o(e)),e}n(e,t);var r=e.prototype;return r.onLoad=function(){this.templateLabel.node.active=!1},r.showNumber=function(t,e){var n=c(this.templateLabel.node);n.setParent(this.node),n.active=!0;var i=n.getComponent(u);i.string=(t>0?"+":"")+t.toString(),i.color=t>0?this.positiveColor:this.negativeColor,n.setPosition(this.startPoint),p(n).to(1.5,{position:this.endPoint},{easing:"elasticOut"}).call((function(){n.destroy(),null==e||e()})).start()},e}(b)).prototype,"positiveColor",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(0,255,0)}}),P=e(C.prototype,"negativeColor",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(255,0,0)}}),z=e(C.prototype,"startPoint",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new s(0,0,0)}}),L=e(C.prototype,"endPoint",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new s(0,100,0)}}),x=e(C.prototype,"templateLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=C))||d));r._RF.pop()}}}));

System.register("chunks:///_virtual/FoldCards.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,o,n,r,i,l,c,s,a,d,u,h,C;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,l=e._decorator,c=e.Node,s=e.Button,a=e.Sprite,d=e.Color,u=e.instantiate,h=e.Label,C=e.Component}],execute:function(){var p,f,_,g,v,b,y;i._RF.push({},"a78ae3xgKlLYqn9+yGYTQTS","FoldCards",void 0);var m=l.ccclass,R=l.property;e("FoldCards",(p=m("FoldCards"),f=R(c),_=R(s),p((b=t((v=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return t=e.call.apply(e,[this].concat(i))||this,n(t,"cardRoot",b,r(t)),n(t,"sendButton",y,r(t)),t.eventSendCallback=null,t._secletedCards=[],t.selectMax=0,t._oriColor=void 0,t}o(t,e);var i=t.prototype;return i.show=function(e){this.node.active=e,this.sendButton.node.active=!1,this._secletedCards.length=0},i.list=function(e,t){var o=this,n=this.cardRoot.children;n.forEach((function(e){return e.active=!1}));var r=n[0].getComponent(a).color;this._oriColor=new d(r.r,r.g,r.b,r.a),e.forEach((function(e,r){var i=n[r];i||((i=u(n[0])).parent=o.cardRoot),i.active=!0,i.getComponentInChildren(h).string=e,i.off("click"),i.on("click",(function(){null==t||t(e),-1===o._secletedCards.indexOf(e)?(o._secletedCards.push(e),i.getComponent(a).color=d.RED):(o._secletedCards.splice(o._secletedCards.findIndex((function(t){return t===e})),1),i.getComponent(a).color=o._oriColor),console.log("this._secletedCards:",o._secletedCards),o.sendButton.node.active=o._secletedCards.length===o.selectMax}),o)}))},i.onSendButtonClicked=function(){var e,t=this;console.log("this._secletedCards:",this._secletedCards),this.cardRoot.children.forEach((function(e){return e.getComponent(a).color=t._oriColor})),null==(e=this.eventSendCallback)||e.call(this,this._secletedCards.slice()),this._secletedCards.length=0},t}(C)).prototype,"cardRoot",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(v.prototype,"sendButton",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=v))||g));i._RF.pop()}}}));

System.register("chunks:///_virtual/GameEvents.ts",["cc"],(function(a){var e;return{setters:[function(a){e=a.cclegacy}],execute:function(){e._RF.push({},"1950a+JJJlGvJeGTM+lZbMJ","GameEvents",void 0);a("GameLogicEvent",function(a){return a.GameStart="game-logic-game-start",a.GameEnd="game-logic-game-end",a.GameResume="game-logic-game-resume",a.GamePause="game-logic-game-pause",a.GameRoundStart="game-logic-game-round-start",a.GameRoundStartShowCards="game-logic-game-round-start-show-cards",a.GameRoundStartConfirmSelection="game-logic-game-round-start-confirm-selection",a.GameRoundPlayerDiscardCards="game-logic-game-round-player-discard-cards",a.GameRoundStartDiscardCards="game-logic-game-round-start-discard-cards",a.GameRoundStartDealCards="game-logic-game-round-start-deal-cards",a.GameRoundStartShowCommunityCards="game-logic-game-round-start-show-community-cards",a.GameRoundStartShowPlayerHands="game-logic-game-round-start-show-player-hands",a.GameRoundStartShowDiscardPile="game-logic-game-round-start-show-discard-pile",a.GameRoundNextPlayerTurn="game-logic-game-round-next-player-turn",a.GameRoundEndShowCards="game-logic-game-round-end-show-cards",a}({})),a("GameUIEvent",function(a){return a.GameStart="game-ui-game-start",a.GameEnd="game-ui-game-end",a.DeckCardSelected="game-ui-card-selected",a.DeckCardUnselected="game-ui-card-unselected",a.DeckCardDiscard="game-ui-card-discard",a.ShowCardConditions="game-ui-show-card-conditions",a.ShowCardConditions2="game-ui-show-card-conditions2",a}({})),a("DeckPileEvent",function(a){return a.ShowCards="deck-card-show-cards",a.DiscardCards="deck-card-discard-cards",a.DealCommunityCards="deck-card-deal-cards",a.DealPlayerCards="deck-card-deal-player-cards",a.DeckGatherings="deck-card-gatherings",a.HideCards="deck-card-hide-cards",a}({})),a("CommunityCardEvent",function(a){return a.DealCards="community-card-deal-cards",a.ShowCards="community-card-show-cards",a.CompareCards="community-card-campare-cards",a}({})),a("PlayerHandCardEvent",function(a){return a.DealCards="player-hand-card-deal-cards",a.ShowCards="player-hand-card-show-cards",a.CompareCards="player-hand-card-compare-cards",a.SendCards="player-hand-card-send-cards",a.ReceiveCards="player-hand-card-receive-cards",a}({})),a("WordPuzzleGameLogicEvent",function(a){return a.WordPuzzleGameStart="word-puzzle-game-start",a.WordPuzzleGameEnd="word-puzzle-game-end",a.ShowQuestion="word-puzzle-game-logic-show-question",a.ShowAnswer="word-puzzle-game-logic-show-answer",a.ShowHint="word-puzzle-game-logic-show-hint",a.TexasGameStart="word-puzzle-game-logic-texas-game-start",a.TexasGameResume="word-puzzle-game-logic-texas-game-resume",a}({}));e._RF.pop()}}}));

System.register("chunks:///_virtual/HandCards.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DynamicWidthScrollView.ts","./Card.ts"],(function(t){var e,n,o,i,r,l,s,c,a,d,u,h,p,C,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,s=t.Node,c=t.Button,a=t.Color,d=t.Sprite,u=t.instantiate,h=t.Label,p=t.Component},function(t){C=t.DynamicWidthScrollView},function(t){f=t.TipCard}],execute:function(){var _,v,b,g,m,y,w,S,x,P,B;r._RF.push({},"880f34hHldLa4t21nW2dLUl","HandCards",void 0);var I=l.ccclass,T=l.property;t("HandCards",(_=I("HandCards"),v=T(s),b=T(c),g=T(C),m=T(a),_((S=e((w=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r))||this,o(e,"cardRoot",S,i(e)),o(e,"sendButton",x,i(e)),o(e,"dwScrollView",P,i(e)),o(e,"selectedColor",B,i(e)),e._selectMax=0,e._secletedCards=[],e._buttonTemps=[],e._eventSendCallback=null,e._oriColor=void 0,e._oriPositionY=void 0,e}n(e,t);var r=e.prototype;return r.setSendData=function(t,e){this._selectMax=t,this._eventSendCallback=e},r.show=function(t){console.log(t?"顯示":"隱藏",this.node.name),this.node.active=t,this.sendButton.node.active=!1},r.list=function(t,e){var n,o=this;void 0===e&&(e=null);var i=this.cardRoot.children,r=i[0].getComponentInChildren(d).color;this._oriColor=new a(r.r,r.g,r.b,r.a),this._oriPositionY=i[0].position.y,i.forEach((function(t){t.setPosition(t.position.x,o._oriPositionY),t.active=!1})),this._buttonTemps.length=0,t.forEach((function(t,n){var r=i[n];r||((r=u(i[0])).parent=o.cardRoot),r.active=!0,r.getComponentInChildren(h).string=t.string;var l=r.getComponentInChildren(c);l?(l.node.off(c.EventType.CLICK),l.node.on(c.EventType.CLICK,(function(){-1===o._secletedCards.indexOf(t)?(o._secletedCards.push(t),r.setPosition(r.position.x,r.position.y+50),r.getComponentInChildren(d).color=o.selectedColor):(o._secletedCards.splice(o._secletedCards.findIndex((function(e){return e===t})),1),r.setPosition(r.position.x,o._oriPositionY),r.getComponentInChildren(d).color=o._oriColor),null==e||e(t,o._secletedCards),o.sendButton.node.active=o._secletedCards.length===o._selectMax}),o),o._buttonTemps.push(l)):console.error("HandCards: cardButton not found")})),null==(n=this.dwScrollView)||n.scrollView.scrollToPercentHorizontal(.5,.1,!0)},r.lock=function(t){void 0===t&&(t=!0),this._buttonTemps.forEach((function(e){return e.enabled=!t}))},r.clear=function(){this.unselect(),this._buttonTemps.length=0,this._selectMax=0,this._eventSendCallback=null,this.sendButton.node.active=!1},r.unselect=function(){var t=this;this.cardRoot.children.forEach((function(e){e.active&&(e.setPosition(e.position.x,t._oriPositionY),e.getComponentInChildren(d).color=t._oriColor)})),this._secletedCards.length=0,this.sendButton.node.active=!1},r.onSendButtonClicked=function(){var t;this._selectMax===this._secletedCards.length&&(null==(t=this._eventSendCallback)||t.call(this,this._secletedCards.slice()),this.unselect())},r.sample=function(){for(var t=[],e=0;e<10;e++){var n=new f;n.string="card"+e,n.type="ok",t.push(n)}this.list(t,(function(t){return console.log(t)})),this.sendButton.node.active=!1,this.lock(!1)},e}(p)).prototype,"cardRoot",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(w.prototype,"sendButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(w.prototype,"dwScrollView",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(w.prototype,"selectedColor",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=w))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/HandEvaluator.ts",["cc","./ExplorationCard.ts"],(function(t){var r,n;return{setters:[function(t){r=t.cclegacy},function(t){n=t.CardSuit}],execute:function(){r._RF.push({},"63e51xG2fRFbK79cjtJZBqy","HandEvaluator",void 0);var u=t("CardEvaluations",function(t){return t.HighCard="High Card",t.OnePair="One Pair",t.TwoPairs="Two Pairs",t.ThreeOfAKind="Three of a Kind",t.Straight="Straight",t.Flush="Flush",t.FullHouse="Full House",t.FourOfAKind="Four of a Kind",t.StraightFlush="Straight Flush",t.RoyalFlush="Royal Flush",t}({}));t("HandEvaluator",function(){function t(){}return t.evaluateHand=function(t){if(5!==t.length)throw new Error("Must evaluate exactly 5 cards.");var r=this.countRanks(t),n=this.groupBySuit(t);return this.isRoyalFlush(n)?u.RoyalFlush:this.isStraightFlush(n)?u.StraightFlush:this.isFourOfAKind(r)?u.FourOfAKind:this.isFullHouse(r)?u.FullHouse:this.isFlush(n)?u.Flush:this.isStraight(t)?u.Straight:this.isThreeOfAKind(r)?u.ThreeOfAKind:this.isTwoPairs(r)?u.TwoPairs:this.isOnePair(r)?u.OnePair:u.HighCard},t.countRanks=function(t){var r={};return t.forEach((function(t){r[t.rank]=(r[t.rank]||0)+1})),r},t.groupBySuit=function(t){var r,u=((r={})[n.Prop]=[],r[n.Clue]=[],r[n.Doubt]=[],r[n.Presage]=[],r);return t.forEach((function(t){return u[t.suit].push(t)})),u},t.isRoyalFlush=function(t){return this.isStraightFlush(t)&&Object.values(t).some((function(t){return t.some((function(t){return"10"===t.rank}))}))},t.isStraightFlush=function(t){var r=this;return Object.values(t).some((function(t){return t.length>=5&&r.isStraight(t)}))},t.isFourOfAKind=function(t){return Object.values(t).some((function(t){return 4===t}))},t.isFullHouse=function(t){var r=Object.values(t).filter((function(t){return 3===t})).length,n=Object.values(t).filter((function(t){return 2===t})).length;return r>0&&(n>0||r>1)},t.isFlush=function(t){return Object.values(t).some((function(t){return t.length>=5}))},t.isStraight=function(t){var r=this;if(t.length<5)return!1;var n=[].concat(new Set(t.map((function(t){return r.getCardValue(t.rank)}))));n.sort((function(t,r){return t-r}));for(var u=0;u<n.length-4;u++){for(var i=!0,e=u;e<u+4;e++)if(n[e+1]!==n[e]+1){i=!1;break}if(i)return!0}return!1},t.isThreeOfAKind=function(t){return Object.values(t).some((function(t){return 3===t}))},t.isTwoPairs=function(t){return Object.values(t).filter((function(t){return 2===t})).length>=2},t.isOnePair=function(t){return Object.values(t).some((function(t){return 2===t}))},t.getCardValue=function(t){var r={2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13,A:14};if(r.hasOwnProperty(t))return r[t];throw new Error("Invalid card rank specified: "+t)},t}());r._RF.pop()}}}));

System.register("chunks:///_virtual/HitCheckCounter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CounterComponent.ts"],(function(t){var e,n,r,i,o,u,s,c,a;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.createClass},function(t){u=t.cclegacy,s=t._decorator,c=t.Label},function(t){a=t.CounterComponent}],execute:function(){var h,l,p,C,d;u._RF.push({},"40236Owx4NFZqNazj3+SPk2","HitCheckCounter",void 0);var y=s.ccclass,f=s.property;t("HitCheckCounter",(h=y("HitCheckCounter"),l=f(c),h((d=e((C=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),u=0;u<n;u++)o[u]=arguments[u];return e=t.call.apply(t,[this].concat(o))||this,r(e,"titleLabel",d,i(e)),e.type="Neutral",e}n(e,t);var u=e.prototype;return u.start=function(){},u.updateLabel=function(){"Neutral"===this.type?this.counterLabel.string=this.currentCount.toString():this.counterLabel.string=this.deprecatedCount+" | "+this.currentCount},o(e,[{key:"checkType",set:function(t){this.type=t}},{key:"count",set:function(t){console.log("CounterComponent: set count to "+t,this.currentCount,this.deprecatedCount),"Neutral"===this.type?(this.currentCount=t,this.titleLabel.string="命中檢定值"):"Advantage"===this.type?(t>this.currentCount?(this.deprecatedCount=this.currentCount,0!==t&&(this.currentCount=t)):t>this.deprecatedCount&&0!==t&&(this.deprecatedCount=t),this.titleLabel.string="(優勢)\n命中檢定值"):"Disadvantage"===this.type&&(t<this.currentCount?(this.deprecatedCount=this.currentCount,0!==t&&(this.currentCount=t)):0===this.currentCount?this.currentCount=t:0!==t&&(this.deprecatedCount=t),this.titleLabel.string="(劣勢)\n命中檢定值"),this.updateLabel()}}]),e}(a)).prototype,"titleLabel",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=C))||p));u._RF.pop()}}}));

System.register("chunks:///_virtual/HitPointsBarComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FloatingTextComponent.ts"],(function(t){var e,n,i,o,r,a,p,s,u,l,c,h,m,H;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){a=t.cclegacy,p=t._decorator,s=t.ProgressBar,u=t.Node,l=t.Label,c=t.Vec3,h=t.tween,m=t.Component},function(t){H=t.FloatingTextComponent}],execute:function(){var f,b,g,d,x,P,y,B,w,C,L;a._RF.push({},"975d2k7B9dAQ7imcn3+VIGb","HitPointsBarComponent",void 0);var _=p.ccclass,v=p.property;t("HitPointsBarComponent",(f=_("HitPointsBarComponent"),b=v(s),g=v(H),d=v(u),x=v(l),f((B=e((y=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"hpBar",B,o(e)),i(e,"floatingTextComponent",w,o(e)),i(e,"textSpawnPoint",C,o(e)),i(e,"hpLabel",L,o(e)),e.curHp=100,e.maxHp=100,e._tempHp=0,e}n(e,t);var a=e.prototype;return a.changeHp=function(t){var e=this,n=Math.min(Math.max(this.curHp+t,0),this.maxHp),i=this.textSpawnPoint.position.clone(),o=t<=0?i.add(new c(0,40,0)):i.add(new c(0,-40,0));this.floatingTextComponent.startPoint=o,this.floatingTextComponent.endPoint=this.textSpawnPoint.position,this.floatingTextComponent.showNumber(t,(function(){e.updateBar(n),e.updateHpLabel()}))},a.updateBar=function(t){this.hpBar.progress;var e=(t+this._tempHp)/this.maxHp;h(this.hpBar).to(.25,{progress:e}).start(),this.curHp=t},a.updateHpLabel=function(){this._tempHp?this.hpLabel.string="HP: "+(this.curHp+this._tempHp)+" (+"+this._tempHp+") / "+this.maxHp:this.hpLabel.string="HP: "+this.curHp+" / "+this.maxHp},r(e,[{key:"defaultHp",set:function(t){this.maxHp=t,this.curHp=t,this.updateBar(this.curHp),this.updateHpLabel()}},{key:"tempHp",get:function(){return this._tempHp},set:function(t){this._tempHp=t,this.updateHpLabel()}}]),e}(m)).prototype,"hpBar",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(y.prototype,"floatingTextComponent",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(y.prototype,"textSpawnPoint",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(y.prototype,"hpLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=y))||P));a._RF.pop()}}}));

System.register("chunks:///_virtual/Inventory.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Weapon.ts","./Armor.ts","./Shield.ts","./WeaponDraggable.ts","./DropZone.ts","./ArmorDraggable.ts","./ShieldDraggable.ts"],(function(e){var t,n,o,r,i,a,s,l,u,c,d,h,m,f,p,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,s=e.Node,l=e.instantiate,u=e.Component},function(e){c=e.Weapon},function(e){d=e.Armor},function(e){h=e.Shield},function(e){m=e.WeaponDraggable},function(e){f=e.DropZone},function(e){p=e.ArmorDraggable},function(e){g=e.ShieldDraggable}],execute:function(){var v,b,y,I,w,S,W,D,x;i._RF.push({},"78b630aLRxGKZeZgGyoku7u","Inventory",void 0);var z=a.ccclass,C=a.property;e("Inventory",(v=z("Inventory"),b=C(s),y=C(s),v((S=t((w=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,o(t,"layout",S,r(t)),o(t,"itemPrefab",W,r(t)),o(t,"maxWeight",D,r(t)),o(t,"maxSlots",x,r(t)),t.items=[],t.currentWeight=0,t.currentSlots=0,t}n(t,e);var i=t.prototype;return i.onLoad=function(){this.show(!0)},i.show=function(e){this.node.active=e},i.instantiate=function(e,t){var n=l(this.itemPrefab);if(n.active=!0,e instanceof c){console.log("Weapon "+e.name+" added to inventory.");var o=n.addComponent(m);o.weapon=e,t.node.emit("drop",{draggableItem:o,dropZone:t})}else if(e instanceof d){console.log("Armor "+e.name+" added to inventory.");var r=n.addComponent(p);r.armor=e,t.node.emit("drop",{draggableItem:r,dropZone:t})}else if(e instanceof h){console.log("Shield "+e.name+" added to inventory.");var i=n.addComponent(g);i.shield=e,t.node.emit("drop",{draggableItem:i,dropZone:t})}return n},i.addItem=function(e){if(this.currentWeight+e.weight>this.maxWeight||this.currentSlots+e.size>this.maxSlots)return console.error("Cannot add item: exceeds weight or slot limit."),!1;var t=this.layout.getComponentsInChildren(f).find((function(e){return 0===e.placeholder.children.length}));if(t){this.items.push(e),this.currentWeight+=e.weight,this.currentSlots+=e.size;this.instantiate(e,t);return!0}return!1},i.removeItem=function(e){var t=this.items.findIndex((function(t){return t.name===e}));if(-1===t)return console.error("Item not found in inventory."),!1;var n=this.items[t];return this.items.splice(t,1),this.currentWeight-=n.weight,this.currentSlots-=n.size,console.log(n.name+" removed from inventory."),!0},i.listItems=function(){return this.items},i.onInventoryButtonClicked=function(){this.show(!this.node.active)},t}(u)).prototype,"layout",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(w.prototype,"itemPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(w.prototype,"maxWeight",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),x=t(w.prototype,"maxSlots",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),I=w))||I));i._RF.pop()}}}));

System.register("chunks:///_virtual/InventoryCollection.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Inventory.ts","./Weapon.ts","./EventManager.ts","./UIManager.ts","./Armor.ts"],(function(e){var n,t,o,i,r,a,d,l,c,g,s,p,h;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,d=e.Component},function(e){l=e.Inventory},function(e){c=e.Weapon,g=e.WeaponStyle},function(e){s=e.EventManager},function(e){p=e.UIEvent},function(e){h=e.Armor}],execute:function(){var y,u,v,m,I;r._RF.push({},"00d9f3yuUpDF6XetP9Xhd00","InventoryCollection",void 0);var f=a.ccclass,w=a.property;e("InventoryCollection",(y=f("InventoryCollection"),u=w(l),y((I=n((m=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return n=e.call.apply(e,[this].concat(r))||this,o(n,"inventory",I,i(n)),n}return t(n,e),n.prototype.collect=function(e){s.instance.emit(p.InventoryShowUI,!0),console.log("取得物品:",e.string),"rawhide"===e.coping?this.inventory.addItem(new h("皮甲","leather","10 gold",10,11,0,"None","Light")):"chainmail"===e.coping?this.inventory.addItem(new h("鎖子甲","chainmail","75 gold",55,16,13,"Disadvantage","Heavy")):"padded"===e.coping?this.inventory.addItem(new h("綿甲","padded","5 gold",8,11,0,"Disadvantage","Light")):"dagger"===e.coping?this.inventory.addItem(new c("匕首","2 gold",1,g.Dagger,"dagger",{dice:"1d4",type:"Piercing"},["Finesse","Light","Thrown"],"Melee")):"longswood"===e.coping?this.inventory.addItem(new c("長劍","15 gold",3,g.Longsword,"long_swood",{dice:"1d8",dice2:"1d10",type:"Slashing"},["Versatile"],"Melee")):"hammer"===e.coping?this.inventory.addItem(new c("銅錘","2 gold",2,g.LightHammer,"hammer",{dice:"1d4",type:"Bludgeoning"},["Light","Thrown"],"Melee")):"axe"===e.coping&&this.inventory.addItem(new c("手斧","5 gold",2,g.Handaxe,"axe",{dice:"1d6",type:"Slashing"},["Light","Thrown"],"Melee"))},n}(d)).prototype,"inventory",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=m))||v));r._RF.pop()}}}));

System.register("chunks:///_virtual/Item.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"416ffYg1JhNjqhpWtayJR5g","Item",void 0);t("Item",(function(t,i,e,s){this.name="",this.cost=void 0,this.weight=0,this.size=1,this.name=t,this.cost=i,this.weight=e,this.size=s}));i._RF.pop()}}}));

System.register("chunks:///_virtual/Logging.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"24ad5yJ7FJOMqUWSZiPBSUY","Logging",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./debug-view-runtime-control.ts","./MainScene.ts","./BaseCardDisplay.ts","./Card.ts","./CardComponent2.ts","./DungeonEscapeHandler.ts","./DungeonEscapeRecord.ts","./DungeonEscapeView.ts","./ExplorationCard.ts","./FoldCards.ts","./HandCards.ts","./HandEvaluator.ts","./NotifyHandler.ts","./StoryCardStack.ts","./StoryDescribeStack.ts","./YellowCardHandler.ts","./YellowCardPanel.ts","./YellowCardRecord.ts","./FirebaseBridge.ts","./SocketBridge.ts","./RoomHandler.ts","./DataModal.ts","./StoryData.ts","./WordPuzzleData.ts","./Ability.ts","./Character.ts","./ClassFeatureImplementation.ts","./Dungeon.ts","./MazeDisplay.ts","./NetworkGraph.ts","./Rogue.ts","./Skill.ts","./AdventureSkill.ts","./AttributeAllocation.ts","./AttributeComponent.ts","./CopingSkillButton.ts","./DescriptionCrossword.ts","./MapConnection.ts","./ArcherySkill.ts","./CombatArmor.ts","./CombatCharacter.ts","./CombatEntity.ts","./CombatIntent.ts","./CombatMonster.ts","./CombatSkill.ts","./CombatWeapon.ts","./EnemySkill.ts","./MeleeSkill.ts","./ArmorDraggable.ts","./EquipmentDropZone.ts","./Inventory.ts","./InventoryCollection.ts","./ShieldDraggable.ts","./WeaponDraggable.ts","./Armor.ts","./Item.ts","./Shield.ts","./Weapon.ts","./CharacterCard.ts","./CharacterCreation.ts","./CopingSkillCheck.ts","./NarratorCore.ts","./StoryCard.ts","./CrosswordController.ts","./EffectManager.ts","./EventManager.ts","./EventSystem.ts","./GameEvents.ts","./TipClipsAnimation.ts","./UIManager.ts","./CardCombatTest.ts","./CommunityCardsTest.ts","./DungeonTest.ts","./ParticleEffectComponent.ts","./CommunityCards.ts","./DeckCards2.ts","./DeckCardsPile.ts","./DiscardCardsPile.ts","./PlayerHandCards2.ts","./TexasGameLogic.ts","./TexasGamePlayer.ts","./TexasGameUI.ts","./AudioController.ts","./CardMover.ts","./CounterComponent.ts","./DescriptionScrollView.ts","./Draggable.ts","./DropZone.ts","./DynamicWidthScrollView.ts","./FillBlanks.ts","./FloatingTextComponent.ts","./HitCheckCounter.ts","./Logging.ts","./PopupWindowComponent.ts","./RandomString.ts","./TipText.ts","./pixel.ts","./CharacterInfo.ts","./HitPointsBarComponent.ts","./CardComponent.ts","./CombatController.ts","./CombatFormation.ts","./CombatOption.ts","./CombatVisualizer.ts","./DeckCards.ts","./DeckCardsPile2.ts","./PlayerHandCards.ts","./TeamMember.ts","./CardReward.ts","./RewardCards.ts","./WordPuzzleGameLogic.ts","./WordPuzzleGameUI.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DungeonEscapeHandler.ts","./DungeonEscapeView.ts"],(function(e){var t,o,n,i,a,r,c,l,s,u,m,d,h,R;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,c=e.Node,l=e.Button,s=e.EditBox,u=e.instantiate,m=e.Label,d=e.Component},function(e){h=e.DungeonEscapeHandler},function(e){R=e.DungeonEscapeView}],execute:function(){var f,v,p,b,y,B,g,w,_,G,H,E,C,x,k,z,S,D,L,M,j,N,O;a._RF.push({},"dc7a4oGyFRBH7m1+WQMgD4/","MainScene",void 0);var V=r.ccclass,I=r.property;e("MainScene",(f=V("MainScene"),v=I(c),p=I(c),b=I(l),y=I(l),B=I(l),g=I(l),w=I(l),_=I(s),G=I(R),H=I(c),f((x=t((C=function(e){function t(){for(var t,o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,n(t,"roomRoot",x,i(t)),n(t,"tableRoot",k,i(t)),n(t,"refreshRoomButton",z,i(t)),n(t,"newRoomButton",S,i(t)),n(t,"leaveRoomButton",D,i(t)),n(t,"readyGameButton",L,i(t)),n(t,"startGameButton",M,i(t)),n(t,"nameEditBox",j,i(t)),n(t,"gameView",N,i(t)),n(t,"spreadCardRoot",O,i(t)),t._roomHandler=null,t._gameHandler=null,t._indexGameReady=0,t._playerLocalCacheName="",t}o(t,e);var a=t.prototype;return a.start=function(){},a.onRenameEndEdit=function(){var e=this.nameEditBox.string;this._roomHandler.nickname=e,localStorage.setItem(this._playerLocalCacheName,JSON.stringify({nickname:e}))},a.onNewRoomClicked=function(){this._roomHandler.newRoom("YC-"+Math.round(1e5*Math.random())),this.roomRoot.active=!1,this.refreshRoomButton.node.active=!1,this.newRoomButton.node.active=!1,this.tableRoot.active=!0,this.readyGameButton.node.active=!1,this.startGameButton.node.active=!0,this.leaveRoomButton.node.active=!0},a.onJoinRoom=function(e,t,o){this.roomRoot.active=!1,this.refreshRoomButton.node.active=!1,this.newRoomButton.node.active=!1,this.nameEditBox.node.active=!1,this.tableRoot.active=!0,this.readyGameButton.node.active=!0,this.startGameButton.node.active=!1,this.leaveRoomButton.node.active=!0,this._roomHandler.joinRoom(e,t,o)},a.onUpdateTableList=function(e){var t=this;this.nameEditBox.node.active=!1;var o=this.tableRoot.children;o.forEach((function(e){return e.active=!1})),Object.keys(e).forEach((function(n,i){var a=e[n],r=o[i];r||((r=u(o[0])).parent=t.tableRoot),r.active=!0,r.getComponentInChildren(m).string=a}))},a.onExitRoomClicked=function(){this._roomHandler.leaveRoom(),this.onUpdateRoomList()},a.onUpdateRoomList=function(){var e=this,t=this.roomRoot.children;t.forEach((function(e){return e.active=!1})),this.roomRoot.active=!0,this.refreshRoomButton.node.active=!0,this.newRoomButton.node.active=!0,this.tableRoot.active=!1,this.readyGameButton.node.active=!1,this.startGameButton.node.active=!1,this.leaveRoomButton.node.active=!1,this.nameEditBox.node.active=!0,this._indexGameReady=0,this._roomHandler.loadRoomsAsync().then((function(o){o&&Object.keys(o).forEach((function(n,i){var a=o[n],r=t[i];r||((r=u(t[0])).parent=e.roomRoot),r.active=!0,r.getComponentInChildren(m).string=n,r.getComponent(l).node.off("click"),r.getComponent(l).node.once("click",(function(){return e.onJoinRoom(n,a)}),e)}))}))},a.onGameReady=function(e,t){console.log("onGameReady:",e,t);var o=this.tableRoot.children;Object.keys(t).forEach((function(n,i){var a=t[n],r=e[n];o[i].getComponentInChildren(m).string=a+" "+["","[READY]","[HONST]"][r]}))},a.onGameStart=function(e,t,o){console.log("開始遊戲",this._roomHandler.isHonster),this.roomRoot.active=!1,this.refreshRoomButton.node.active=!1,this.newRoomButton.node.active=!1,this.tableRoot.active=!1,this.readyGameButton.node.active=!1,this.startGameButton.node.active=!1;this._gameHandler=new h(this.gameView,this._roomHandler.isHonster,e,t,o,!1,this._roomHandler.players),this.leaveRoomButton.node.active=this._roomHandler.isHonster},a.onGameReconnect=function(e,t,o,n){console.log("遊戲重連!!");var i=n&&Object.keys(n).length>0;this._gameHandler=new h(this.gameView,i,e,t,o,!0,this._roomHandler.players),this.roomRoot.active=!1,this.refreshRoomButton.node.active=!1,this.newRoomButton.node.active=!1,this.nameEditBox.node.active=!1,this.leaveRoomButton.node.active=i},a.onRefreshRoomClicked=function(){this.onUpdateRoomList()},a.onGameReadyClicked=function(){this._indexGameReady=(this._indexGameReady+1)%2,this._roomHandler.gameReady(this._indexGameReady)},a.onGameStartClicked=function(){this._roomHandler.tryGameStart()},t}(d)).prototype,"roomRoot",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(C.prototype,"tableRoot",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(C.prototype,"refreshRoomButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(C.prototype,"newRoomButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(C.prototype,"leaveRoomButton",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(C.prototype,"readyGameButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(C.prototype,"startGameButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(C.prototype,"nameEditBox",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(C.prototype,"gameView",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(C.prototype,"spreadCardRoot",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=C))||E));a._RF.pop()}}}));

System.register("chunks:///_virtual/MapConnection.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DescriptionScrollView.ts","./DataModal.ts","./EventManager.ts"],(function(e){var t,n,o,i,r,a,c,l,s,p,u,d,f,m,h,g,v,b,C,y,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,c=e.Node,l=e.Graphics,s=e.Sprite,p=e.resources,u=e.SpriteFrame,d=e.Texture2D,f=e.instantiate,m=e.Label,h=e.UITransform,g=e.Color,v=e.Vec3,b=e.Component},function(e){C=e.DescriptionScrollView},function(e){y=e.DataModal},function(e){w=e.EventManager}],execute:function(){var x,k,F,N,E,L,z,D,S,I,M,V,P;r._RF.push({},"cff84cSH7VCfLN9hrnrJBVi","MapConnection",void 0);var T=a.ccclass,B=a.property;e("MapConnection",(x=T("MapConnection"),k=B(c),F=B(c),N=B(c),E=B(l),L=B(C),x((S=t((D=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"background",S,i(t)),o(t,"mapRoot",I,i(t)),o(t,"locationPrefab",M,i(t)),o(t,"graphics",V,i(t)),o(t,"descriptionScrollView",P,i(t)),t}n(t,e);var r=t.prototype;return r.sample=function(){this.createCenterLocation({name:"long_swood-000:01",bg:"shield",connect:["rawhide-000:00(230,60)","chainmail-000:00(-90,330)","dagger-(-150,200)"]}),this.descriptionScrollView.hide()},r.createCenterLocation=function(e){var t=e.name.split("-")[0],n=this.createLocationNode(t,e.name);n.setPosition(0,0,0),n.parent=this.mapRoot,this.setClickEvent(n,e.name),this.graphics.clear(),this.loadConnections(e.connect,n),this.setBackgroundImage(e.bg)},r.setBackgroundImage=function(e){var t=this.background.getComponent(s),n="maps/"+e+"/spriteFrame";p.load(n,u,(function(e,n){e?console.error("Failed to load image: "+e):(t.spriteFrame=n,t.spriteFrame.texture.setFilters(d.Filter.NONE,d.Filter.NONE))}))},r.createLocationNode=function(e,t){var n=f(this.locationPrefab);n.active=!0;var o=n.getComponent(s),i=n.getComponentInChildren(m),r=y.getInstance().storyData.dramas[t];i.string=r?r.name:e;var a="maps/"+e+"/spriteFrame";p.load(a,u,(function(e,t){e?console.error("Failed to load image: "+e):(o.spriteFrame=t,o.spriteFrame.texture.setFilters(d.Filter.NONE,d.Filter.NONE))}));var c=n.getComponentInChildren(l);return c&&this.drawBorder(c,n.position,n.getComponent(h).contentSize),n},r.loadConnections=function(e,t){var n=this;e.forEach((function(e){var o=e.split("-")[0],i=/([^\(]+)\((\-?\d+),(\-?\d+)\)/.exec(e);if(i){console.log(o,i[1],i[2],i[3]);var r=parseInt(i[2],10),a=parseInt(i[3],10),c=n.createLocationNode(o,e.split("(")[0]);c.setPosition(r,a,0),c.parent=n.mapRoot,n.setClickEvent(c,e.split("(")[0]),n.drawLine(n.graphics,t.position,c.position)}}))},r.drawBorder=function(e,t,n){e.clear(),e.rect(t.x-n.width/2,t.y-n.height/2,n.width,n.height),e.strokeColor=new g(255,255,255,255),e.lineWidth=8,e.stroke()},r.drawLine=function(e,t,n){var o=new v((t.x+n.x)/2,t.y,0),i=new v((t.x+n.x)/2,n.y,0);e.moveTo(t.x,t.y),e.bezierCurveTo(o.x,o.y,i.x,i.y,n.x,n.y),e.strokeColor=new g(0,0,0,255),e.lineWidth=15,e.stroke(),e.moveTo(t.x,t.y),e.bezierCurveTo(o.x,o.y,i.x,i.y,n.x,n.y),e.strokeColor=new g(155,255,155,255),e.lineWidth=7,e.stroke()},r.setClickEvent=function(e,t){e.off("click"),e.on("click",(function(){w.instance.emit("DramaEvent",t)}))},t}(b)).prototype,"background",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(D.prototype,"mapRoot",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(D.prototype,"locationPrefab",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(D.prototype,"graphics",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(D.prototype,"descriptionScrollView",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=D))||z));r._RF.pop()}}}));

System.register("chunks:///_virtual/MazeDisplay.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,n,t,o,i,a,c,l,s,u,p,f;return{setters:[function(e){r=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,c=e.Node,l=e.SpriteFrame,s=e.Sprite,u=e.UITransform,p=e.Color,f=e.Component}],execute:function(){var m,h,d,C,g,y,w,z,v;i._RF.push({},"160b41K30VI/rZHmbk/rqjk","MazeDisplay",void 0);var b=a.ccclass,F=a.property;e("MazeDisplay",(m=b("MazeDisplay"),h=F(c),d=F(l),C=F(l),m((w=r((y=function(e){function r(){for(var r,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return r=e.call.apply(e,[this].concat(i))||this,t(r,"mazeContainer",w,o(r)),t(r,"wallSpriteFrame",z,o(r)),t(r,"floorSpriteFrame",v,o(r)),r.currX=0,r.currY=0,r}n(r,e);var i=r.prototype;return i.start=function(){},i.showDungeon=function(e,r,n,t){var o=this;e.rooms.forEach((function(e,r){e.forEach((function(e,n){var t=new c("Tile-"+n+"-"+r);o.mazeContainer.addChild(t),t.setPosition(62*n,62*r),e.instanceNode=t,t.addComponent(s).spriteFrame=o.floorSpriteFrame;e.connections.forEach((function(e){var i=new c("Passage-"+n+"-"+r);t.addChild(i),i.addComponent(s).spriteFrame=o.wallSpriteFrame;var a=[[0,24],[0,-24],[24,0],[-24,0]][e];i.getComponent(u).setContentSize(16,16),i.setPosition(a[0],a[1])}))}))})),this.currX=r,this.currY=n,e.rooms.forEach((function(e,o){e.forEach((function(e,i){i===r&&o===n?e.instanceNode.getComponent(s).color=new p(0,255,0):e==t&&(e.instanceNode.getComponent(s).color=new p(255,0,0))}))})),this.mazeContainer.getComponent(u).setContentSize(62*(e.width-1),62*(e.height-1))},i.movePlayer=function(e,r,n){var t=this;e.rooms.forEach((function(e,o){e.forEach((function(e,i){i===t.currX&&o===t.currY&&(e.instanceNode.getComponent(s).color=new p(255,255,255)),i===r&&o===n&&(e.instanceNode.getComponent(s).color=new p(0,255,0))}))})),this.currX=r,this.currY=n},r}(f)).prototype,"mazeContainer",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=r(y.prototype,"wallSpriteFrame",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=r(y.prototype,"floorSpriteFrame",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=y))||g));i._RF.pop()}}}));

System.register("chunks:///_virtual/MeleeSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Skill.ts","./CombatSkill.ts"],(function(e){var t,i,n,o,s;return{setters:[function(e){t=e.inheritsLoose,i=e.createClass},function(e){n=e.cclegacy},function(e){o=e.SkillProficiency},function(e){s=e.CombatSkill}],execute:function(){n._RF.push({},"0c53f/evoBBNaN5OiJW18ha","MeleeSkill",void 0);e("MeleeSkill",function(e){function n(t,i,n){return e.call(this,"近戰",i,t,n)||this}t(n,e);var s=n.prototype;return s.getAffix=function(){return[{name:"射擊:配合呼吸",description:"「冷靜，配合呼吸再放弓…」",effect:{affix:"inspiration",value:1,duration:2}}]},s.applySkillEffects=function(e,t,i){},s.getSkill=function(e){switch(e){case o.Novice:return this.getSkill1();case o.Proficient:return this.getSkill2();case o.Expert:return this.getSkill3();default:return this.getSkill1()}},s.getSkill1=function(){return[this.punch,this.punch,this.punch,this.bludgeoning,this.bludgeoning,this.slashing,this.slashing,this.piercing,this.piercing,this.parry,this.parry,this.parry,this.block,this.block,this.block]},s.getSkill2=function(){return[this.punch,this.bludgeoning,this.slashing,this.piercing,this.parry,this.block,this.dodge,this.dodgeCounterattack,this.prejudgment,this.relieveForce,this.revenge,this.raid,this.crafty]},s.getSkill3=function(){return[this.punch,this.bludgeoning,this.slashing,this.piercing,this.parry,this.block,this.dodge]},i(n,[{key:"punch",get:function(){return{name:"拳擊",cost:{type:"Intent",fee:1},description:"使用拳擊動作助攻，+2命中。徒手時傷害+1。",modifiers:[{attribute:"HitBonus",bonus:"+2",description:"",conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+1",description:"",conditions:["Melee","Unarmed"]}],target:"enemy"}}},{key:"bludgeoning",get:function(){return{name:"猛擊",cost:{type:"Intent",fee:1},description:"使用敲擊動作助攻，-2命中，+2傷害。武器有鈍器屬性時造成暈眩效果。",modifiers:[{attribute:"HitBonus",bonus:"-2",description:"提高命中，以猛烈的攻擊動作使主攻擊的命中機會提升。",conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+2",description:"",conditions:["Melee"]},{attribute:"Stun",bonus:"+1",description:"武器有鈍器的特性時目標受暈眩效果。",conditions:["Melee","Bludgeoning"]}],target:"enemy"}}},{key:"slashing",get:function(){return{name:"斬擊",cost:{type:"Intent",fee:1},description:"使用揮砍動作助攻，+1命中。武器有揮砍屬性時+1點傷害。",modifiers:[{attribute:"HitBonus",bonus:"+1",description:"",conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+1",description:"",conditions:["Melee","Slashing"]}],target:"enemy"}}},{key:"piercing",get:function(){return{name:"突刺",cost:{type:"Intent",fee:1},description:"使用穿刺動作助攻，+1命中。若武器有穿刺屬性時+1點傷害。",modifiers:[{attribute:"HitBonus",bonus:"+1",description:"",conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+1",description:"",conditions:["Melee","Piercing"]}],target:"enemy"}}},{key:"parry",get:function(){return{name:"反手格擋",cost:{type:"Intent",fee:1},description:"攻守合一，+1命中、+1臨時護甲值。",modifiers:[{attribute:"HitBonus",bonus:"+1",description:"",conditions:["Melee"]},{attribute:"Defense",bonus:"+1",description:"",conditions:["Defense"]}],target:"enemy"}}},{key:"block",get:function(){return{name:"專注防禦",cost:{type:"Intent",fee:1},description:"-4命中為代價提高防禦，+4臨時護甲值。",modifiers:[{attribute:"HitBonus",bonus:"-4",description:"",conditions:["Melee"]},{attribute:"Defense",bonus:"+4",description:"",conditions:["Defense"]}],target:"enemy"}}},{key:"dodge",get:function(){return{name:"靈活步伐",cost:{type:"Intent",fee:1},description:"攻擊時讓腳步靈動，+1命中，+2臨時護甲值。但你穿著重甲時無法靈活行動而失敗。",modifiers:[{attribute:"HitBonus",bonus:"+1",description:"",conditions:["Melee"]},{attribute:"Defense",bonus:"+2",description:"",conditions:["Defense","LightArmor"]}],target:"enemy"}}},{key:"dodgeCounterattack",get:function(){return{name:"閃避反擊",description:"閃避攻擊後進行反擊4點。但在穿著重甲時無法靈活地反擊。",cost:{type:"Reaction",fee:1},modifiers:[{attribute:"DamageBonus",bonus:"+4",description:"",conditions:["Melee","Dodge","LightArmor"]}],target:"enemy"}}},{key:"prejudgment",get:function(){return{name:"預判",description:"察覺敵人動向，提前行動。下一輪攻擊有優勢",cost:{type:"Intent",fee:1},modifiers:[{attribute:"Attack",bonus:"+6",description:"",conditions:["Advantage"]}],target:"enemy"}}},{key:"relieveForce",get:function(){return{name:"卸力",description:"在承受傷害時減緩衝擊，以臨時生命6點作為可承受的傷害。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"Defense",bonus:"+6",description:"",conditions:["Hitpoints"]}],target:"enemy"}}},{key:"revenge",get:function(){return{name:"復仇",description:"承受攻擊時進行反擊6點。",cost:{type:"Reaction",fee:1},modifiers:[{attribute:"DamageBonus",bonus:"+6",description:"",conditions:["Melee","UnderDamage"]}],target:"enemy"}}},{key:"raid",get:function(){return{name:"突襲",description:"靈活的攻擊攻擊技能直逼敵人要害，造成額外傷害2d4。使用靈活武器時傷害+2",cost:{type:"Intent",fee:1},modifiers:[{attribute:"DamageExtra",bonus:"2d4",description:"",conditions:["Melee"]},{attribute:"DamageBonus",bonus:"+2",description:"",conditions:["Melee","Finesse"]}],target:"enemy"}}},{key:"crafty",get:function(){return{name:"狡詐",description:"使用假動作誘導敵人，額外造成1d4命中。",cost:{type:"Intent",fee:1},modifiers:[{attribute:"HitExtra",bonus:"1d4",description:"",conditions:["Melee"]}],target:"enemy"}}}]),n}(s));n._RF.pop()}}}));

System.register("chunks:///_virtual/NarratorCore.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CounterComponent.ts","./EventManager.ts","./CopingSkillButton.ts","./DescriptionScrollView.ts","./FillBlanks.ts","./DescriptionCrossword.ts","./DataModal.ts","./UIManager.ts","./TipText.ts","./InventoryCollection.ts"],(function(t){var e,n,i,o,s,r,c,a,l,p,u,h,d,f,g,v,C,w,k,S,b,_,m,y,B,D,V,O;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,s=t.createClass,r=t.asyncToGenerator,c=t.regeneratorRuntime},function(t){a=t.cclegacy,l=t._decorator,p=t.Node,u=t.Label,h=t.Sprite,d=t.instantiate,f=t.Vec3,g=t.RichText,v=t.randomRangeInt,C=t.Component},function(t){w=t.CounterComponent},function(t){k=t.EventManager},function(t){S=t.CopingSkillButton},function(t){b=t.DescriptionScrollView},function(t){_=t.FillBlanks},function(t){m=t.default,y=t.CrosswordType},function(t){B=t.DataModal},function(t){D=t.UIEvent},function(t){V=t.TipType},function(t){O=t.InventoryCollection}],execute:function(){var E,L,A,I,x,R,T,N,P,z,M,F,W,U,j,q,K,Q,G,H,J;a._RF.push({},"45e63bPTnxMR6poltA4kyJ6","NarratorCore",void 0);var Z=l.ccclass,X=l.property;t("NarratorCore",(E=Z("NarratorCore"),L=X(w),A=X(p),I=X(S),x=X(b),R=X(u),T=X(p),N=X(m),P=X(O),z=X(h),E((W=e((F=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s))||this,i(e,"counter",W,o(e)),i(e,"copingLayout",U,o(e)),i(e,"copingSkillButtonPrefab",j,o(e)),i(e,"descriptionScrollView",q,o(e)),i(e,"titleLabel",K,o(e)),i(e,"responseButtonLayout",Q,o(e)),i(e,"descriptionCrossword",G,o(e)),i(e,"inventoryCollection",H,o(e)),i(e,"bgSprite",J,o(e)),e._optionsContent=[],e._keepWords=[],e._copingChance=0,e._responseId="",e._activeOptoins=!1,e._isSkillAction=!1,e._isWaitingForResponseClick=!1,e._copingList=[],e._data=void 0,e.isTipOpened=!1,e}n(e,t);var a=e.prototype;return a.onLoad=function(){k.instance.on("InitAdventureSkills",this.onInitAdventureSkills,this)},a.onDestroy=function(){k.instance.off("InitAdventureSkills",this.onInitAdventureSkills,this)},a.onEnable=function(){k.instance.on("DescriptionScrollViewEnd",this.onDescriptionScrollViewEnd,this),k.instance.on("DescriptionCrosswordAnswered",this.onDescriptionCrosswordAnswered,this),k.instance.on("PerformCopingSkillCheck",this.onPerformCopingSkillCheck,this)},a.onDisable=function(){k.instance.off("DescriptionScrollViewEnd",this.onDescriptionScrollViewEnd,this),k.instance.off("DescriptionCrosswordAnswered",this.onDescriptionCrosswordAnswered,this),k.instance.off("PerformCopingSkillCheck",this.onPerformCopingSkillCheck,this)},a.onInitAdventureSkills=function(t){this.setCopingSkillButtons(t)},a.onDescriptionScrollViewEnd=function(t){if(this._isWaitingForResponseClick)this.responseButtonLayout.active=!0;else{console.log(this._copingChance,"次, this.data:",this._data),console.log("this._hadNewContent:",this._activeOptoins);var e=this.processTipCards();e&&this.updateCopingSkillButtons(),this.processOptionsContent(),this.counter.node.active=this.copingLayout.active=e}},a.onDescriptionCrosswordAnswered=function(t){var e=t.answers,n=t.sentence;console.log("answers:",e,"sentence:",n),this.descriptionCrosswordAnswered(e,n)},a.onPerformCopingSkillCheck=function(t,e,n,i){this.performCheck(t,e,n,i)},a.start=function(){this.counter.node.active=!1},a.setCopingSkillButtons=function(t){var e=this.copingLayout;e.removeAllChildren();var n=this.copingSkillButtonPrefab.node;t.forEach((function(t){var i=d(n);i.parent=e,i.active=!0,i.name=t.name,i.position=f.ZERO,i.getComponent(S).setAdventureSkill(t)})),e.active=!1},a.updateCopingSkillButtons=function(){console.log("update coping skill buttons:",this._data.behavior.coping),this.copingLayout.active=!0,k.instance.emit("CopingDramaBehavior",this._data.behavior.coping),this.descriptionScrollView.scrollToBottom()},a.setScrollviewChooseButtons=function(t){this.descriptionScrollView.setChooseButtons(t),this.copingLayout.active=!1,this.responseButtonLayout.active=!1},a.setResponseOption=function(t,e,n){var i=this;t.parent=this.responseButtonLayout,t.active=!0,t.getComponentInChildren(g).string=e,t.off("click"),t.on("click",(function(){i._activeOptoins=!0,i._isWaitingForResponseClick=!1,i.responseButtonLayout.active=!1,n()})),this._isWaitingForResponseClick=!0,this.responseButtonLayout.active=this.descriptionScrollView.isBottom,this.copingLayout.active=!1,this.descriptionScrollView.hideButtonLayout(),this.descriptionScrollView.scrollToBottom()},a.setCopingDescription=function(t){var e=this,n=this.responseButtonLayout.children;n.forEach((function(t){t.off("click"),t.active=!1}));var i=[],o={},s=0;t.forEach((function(t){t[0];var r=t[1],c=t[2],a=t[3];switch(console.log("coping",c," - content:",r),console.log("this._responseContent:",e._optionsContent),c){case"describe":e.descriptionScrollView.addNewData(r),e._activeOptoins=!0;break;case"response":console.log("response content:",r),e.setResponseOption(n[s]||d(n[0]),r,(function(){e.descriptionScrollView.addNewData(e._data.behavior.response[a])})),s++;break;case"action to target":var l=_.replaceMarkedWithKeywords([r],[])[0];i.push.apply(i,l.tipCards);var p=[],u=Object.keys(i).every((function(t){if("string"===t)return!0;console.log("檢查條件:",t);var e=l.tipCards.some((function(e){return e[t]===i[t]}));return e&&p.push(i[t]),e}));console.log("是否重複:::::",u);var h=p.sort().join(""),f=o[h]||n[s]||d(n[0]);e.setResponseOption(f,l.text,(function(){var t=e.descriptionScrollView.tipCards;k.instance.emit(y.SetAnswerQuestion,t,l.text,l.tipCards,["type"]),e._responseId=a,console.log("this._responseId:",e._responseId),console.log("question.tipCards:",l.tipCards)})),o[h]=f,u||(console.log("不重複，index 繼續增加"),s++),e._isSkillAction=!0}}))},a.performCheck=function(){var t=r(c().mark((function t(e,n,i,o){var s,r,a=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.counter.node.active=!0,this.counter.count=e,this.counter.counterEffect(),this.titleLabel.string=i,t.next=6,new Promise((function(t){a.scheduleOnce(t,1)}));case 6:this.counter.addCount(n,"技能熟練",20),s=e+n,r=o.filter((function(t){return t[0]<=s})),this._copingList=r,this.setCopingDescription(r),this._copingChance--,k.instance.emit(D.InventoryShowUI,!1);case 13:case"end":return t.stop()}}),t,this)})));return function(e,n,i,o){return t.apply(this,arguments)}}(),a.combat=function(t){var e=this,n=this._data.behavior;this.descriptionScrollView.deleteCard(t),this._activeOptoins=!1,this._copingChance=0,this.setScrollviewChooseButtons([{text:"戰鬥",callback:function(){t.response&&(e._optionsContent=[].concat(n.response[t.response]),e._activeOptoins=!0),e.processOptionsContent(),e.descriptionScrollView.hide();var i=t.coping;k.instance.emit("battleStart",i),k.instance.emit(D.MapConnectionShowUI,!1)}},{text:"-10hp跳過戰鬥",callback:function(){if(k.instance.emit("UnderAttackDamage",10),t.response){e._optionsContent=[].concat(n.response[t.response]);e.descriptionScrollView.addNewData(["一場激烈的戰鬥後，你受到10點傷害。"]),e._activeOptoins=!0}}}])},a.underattack=function(t){var e=this._data.behavior;this.descriptionScrollView.deleteCard(t),console.log("受傷:",t.value),k.instance.emit("UnderAttackDamage",parseInt(t.value,10)),console.log("tipCard:",t),t.response&&(this.descriptionScrollView.addNewData(e.response[t.response]),this._activeOptoins=!1)},a.checkRoll=function(t){var e=this._data.behavior,n=t.dc.split("-"),i=parseInt(n[0]),o=n[1],s=t.success,r=t.failure,c=B.getInstance().playerCharacter.calculateProficienciesBonus()[o],a=v(1,20)+c,l=[];l.push("(骰子結果："+a+")"),a>=i?l.push.apply(l,e.response[s]):l.push.apply(l,e.response[r]),this.descriptionScrollView.addNewData(l),this.descriptionScrollView.deleteCard(t),this._activeOptoins=!0,console.log("checkRoll descriptions:",l)},a.descriptionCrosswordAnswered=function(t,e){var n=this,i=this._data.behavior.response[this._responseId],o=_.replaceMarkedWithKeywords(i,[]);this._activeOptoins=!1,o.forEach((function(s){console.log("replaced content:",s);s.tipCards.forEach((function(r,c){if("_"===r.string?Object.keys(r).every((function(e){return"string"===e||(console.log("檢查條件:",e),t.some((function(t){return t[e]===r[e]})))})):r.string===t[0].string){var a=[];if(n._isSkillAction){n._isSkillAction=!1;var l=o.filter((function(t){return t.tipCards.some((function(t){return t.string===r.string}))}));console.log("keywrodsCard:",l),a=l.map((function(t){return t.text})),l.forEach((function(t){return t.tipCards.forEach((function(t){return t.response&&n._data.behavior.response[t.response].forEach((function(t){return a.push(t)}))}))}))}else a=i.map((function(e){return _.answerQuestion(e,t.map((function(t){return t.string})))}));n.descriptionScrollView.addNewData([e].concat(a)),n._activeOptoins=!0}else console.log("沒有符合條件的 tip card, 取消顯示:",s)}))})),this._activeOptoins||(k.instance.emit(V.Error,"不正確的輸入"),this.setCopingDescription(this._copingList))},a.getEndButton=function(t){var e=this;return this._activeOptoins=!1,{text:t,callback:function(){e.descriptionScrollView.show(!1),e.copingLayout.active=!1,e.responseButtonLayout.active=!1,e.bgSprite.spriteFrame=null}}},a.getDramaButton=function(t){var e=this;return this._activeOptoins=!1,{text:t.string,callback:function(){return e.drama=t.link}}},a.processTipCards=function(){var t,e=this,n=!(null==(t=this._data.behavior)||!t.coping)&&this._copingChance>0,i=[];return this.descriptionScrollView.tipCards.forEach((function(t){"end"===t.behavior?(n=!1,e.setScrollviewChooseButtons([e.getEndButton(t.string)]),i.push("end "+t.string)):"combat"===t.action?(n=!1,e.combat(t),i.push("combat "+t.string)):"damage"===t.action?(n=!1,e.underattack(t),i.push("damage "+t.string)):t.dc?(n=!1,e.descriptionScrollView.deleteCard(t),e._activeOptoins=!1,e.setScrollviewChooseButtons([{text:t.string,callback:function(){return e.checkRoll(t)}}]),i.push("check roll "+t.string)):t.link?(n=!1,e.descriptionScrollView.deleteCard(t),e.setScrollviewChooseButtons([e.getDramaButton(t)]),i.push("link "+t.link)):"collect"===t.action&&(e.descriptionScrollView.deleteCard(t),e.inventoryCollection.collect(t),i.push("collect: "+t.string))})),console.log("處理的工作:",i),console.log("needEmit:",n,":::: hadNewContent:",this._activeOptoins),n},a.processOptionsContent=function(){var t=this;if(console.log("closeDescriptionView",this._activeOptoins,this._optionsContent),this._activeOptoins){this._activeOptoins=!1;var e=[],n=_.replaceMarkedWithKeywords(this._optionsContent,[]);n.forEach((function(i){console.log("replaced content:",i);var o=i.text;i.tipCards.forEach((function(i){"end"===i.behavior?e.push(t.getEndButton(i.string)):i.dc?(t.descriptionScrollView.addNewData(n.map((function(t){return t.text}))),e.push({text:i.string,callback:function(){return t.checkRoll(i)}})):i.link?(t.descriptionScrollView.addNewData(n.map((function(t){return t.text}))),e.push(t.getDramaButton(i))):i.response&&e.push({text:i.string,callback:function(){t.descriptionScrollView.addNewData([o].concat(t._data.behavior.response[i.response]))}})}))})),e.length>0?this.descriptionScrollView.setChooseButtons(e):this._activeOptoins&&this.setScrollviewChooseButtons([this.getEndButton("關閉")])}},a.onShowTipClicked=function(){this.isTipOpened?this.descriptionCrossword.closeAnswer():this.descriptionCrossword.setAnswer(this.descriptionScrollView.tipCards),this.isTipOpened=!this.isTipOpened},s(e,[{key:"quest",set:function(t){var e=B.getInstance().storyData.quests[t],n=e.descriptions,i=e.options;this.data={chance:0,behavior:null,descriptions:n,options:i}}},{key:"drama",set:function(t){this.data=B.getInstance().storyData.dramas[t]}},{key:"data",set:function(t){this._data=t,this._keepWords.length=0,this.descriptionScrollView.setData(t.descriptions),this.descriptionScrollView.show(),this._copingChance=t.chance,this._activeOptoins=!0,this._optionsContent=[].concat(t.options)}}]),e}(C)).prototype,"counter",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(F.prototype,"copingLayout",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(F.prototype,"copingSkillButtonPrefab",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(F.prototype,"descriptionScrollView",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(F.prototype,"titleLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(F.prototype,"responseButtonLayout",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(F.prototype,"descriptionCrossword",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(F.prototype,"inventoryCollection",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(F.prototype,"bgSprite",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=F))||M));a._RF.pop()}}}));

System.register("chunks:///_virtual/NetworkGraph.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var o,i,t,r,n,a,s,l,d,p,c,y,u,h,f;return{setters:[function(e){o=e.applyDecoratedDescriptor,i=e.inheritsLoose,t=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){n=e.cclegacy,a=e._decorator,s=e.Node,l=e.Vec3,d=e.Button,p=e.Sprite,c=e.resources,y=e.SpriteFrame,u=e.Label,h=e.tween,f=e.Component}],execute:function(){var N,v,m,w,L,g,C;n._RF.push({},"6734eYxrDdCyKvfzNSOwyjw","NetworkGraph",void 0);var b=a.ccclass,D=a.property;e("NetworkGraph",(N=b("NetworkGraph"),v=D(s),m=D(s),N((g=o((L=function(e){function o(){for(var o,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return o=e.call.apply(e,[this].concat(n))||this,t(o,"positionLayer",g,r(o)),t(o,"displayLayer",C,r(o)),o}i(o,e);var n=o.prototype;return n.createInitialNode=function(e,o,i){void 0===i&&(i=null);var t=new s(e);t.setPosition(new l(0,0,0)),this.positionLayer.addChild(t),this.createDisplayNode(t,e,o,i)},n.addNode=function(e,o,i,t,r,n){void 0===n&&(n=null);var a=this.positionLayer.getChildByName(e);if(a){var d=new s("NewNode");d.setPosition(new l(a.position.x+o,a.position.y+i,0)),this.positionLayer.addChild(d),this.createDisplayNode(d,t,r,n)}else console.error("Related node not found")},n.createDisplayNode=function(e,o,i,t){var r=new s("DisplayNode");this.displayLayer.addChild(r),r.setPosition(new l(e.position.x,e.position.y,0)),r.addComponent(d),r.on("click",(function(){console.log("Touch start on "+o),null==t||t(o)}));var n=r.addComponent(p),a="maps/"+o+"/spriteFrame";c.load(a,y,(function(e,o){e?console.error("Failed to load image: "+e):n.spriteFrame=o}));var f=new s("LabelNode");f.parent=r,f.setPosition(new l(0,0,0));var N=f.addComponent(u);N.string=i,N.fontSize=24,h(r).stop().to(.25,{scale:new l(1,1,1)}).start()},n.positionNodes=function(){for(var e=this.positionLayer.children,o=0;o<e.length;o++)for(var i=o+1;i<e.length;i++){var t=e[o].position.subtract(e[i].position).length();if(t<100){var r=100-t,n=e[i].position.subtract(e[o].position).normalize(),a=e[i].position.add(n.multiplyScalar(r));e[i].setPosition(a);var s=this.displayLayer.getChildByName(e[i].name.replace("Node","DisplayNode"));h(s).to(.25,{position:a}).start()}}},n.removeNode=function(e){var o=this.positionLayer.getChildByName(e);if(o){var i=this.displayLayer.getChildByName(e.replace("Node","DisplayNode"));i?(i.destroy(),o.destroy()):console.error("Display node not found")}else console.error("Node not found")},n.removeAllNodes=function(){this.positionLayer.children.forEach((function(e){return e.destroy()})),this.displayLayer.children.forEach((function(e){return e.destroy()}))},o}(f)).prototype,"positionLayer",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=o(L.prototype,"displayLayer",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=L))||w));n._RF.pop()}}}));

System.register("chunks:///_virtual/NotifyHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n;return{setters:[function(t){e=t.createClass},function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"1132caDfNVPAIjfLTH87NX7","NotifyHandler",void 0),t("NotifyHandler",function(){function t(){this._isHonster=!1,this._masterID=void 0,this._playerID=void 0}return t.destroy=function(){this._instance=null},t.prototype.notify=function(t,e,n){var i;void 0===e&&(e=""),this._isHonster&&(i=t(),e&&e!=this._playerID)||null==n||n(undefined,i)},e(t,[{key:"isHonster",set:function(t){this._isHonster=t}},{key:"master",set:function(t){this._masterID?console.error("重複設定 master id:",t,"，請置 NotifyHandler"):this._masterID=t}},{key:"player",set:function(t){this._playerID?this._playerID=t:console.error("重複設定 player id:",t,"，請置 NotifyHandler")}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),t}())._instance=void 0,n._RF.pop()}}}));

System.register("chunks:///_virtual/ParticleEffectComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,r,n,s,c,o,a,l,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,c=t._decorator,o=t.ParticleSystem2D,a=t.Vec2,l=t.Color,p=t.Component}],execute:function(){var y,u,f,m,h;s._RF.push({},"2ab372XCe1K05/29U+TyMEP","ParticleEffectComponent",void 0);var S=c.ccclass,d=c.property;t("ParticleEffectComponent",(y=S("ParticleEffectComponent"),u=d(o),y((h=e((m=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s))||this,r(e,"particleSystem",h,n(e)),e}i(e,t);var s=e.prototype;return s.playEffect=function(){var t=this;if(this.particleSystem){this.particleSystem.resetSystem();var e=this.particleSystem.duration+this.particleSystem.life;console.log("totalDuration",e),this.scheduleOnce((function(){t.particleSystem.stopSystem()}),e)}},s.setupEffect=function(){this.particleSystem.gravity=new a(0,-100),this.particleSystem.speed=50,this.particleSystem.startColor=new l(255,255,255,255),this.particleSystem.endColor=new l(255,255,255,0),this.particleSystem.startSize=10,this.particleSystem.endSize=0,this.particleSystem.duration=1},e}(p)).prototype,"particleSystem",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=m))||f));s._RF.pop()}}}));

System.register("chunks:///_virtual/pixel.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,o,i,c;return{setters:[function(e){t=e.inheritsLoose},function(e){r=e.cclegacy,n=e._decorator,o=e.Sprite,i=e.Texture2D,c=e.Component}],execute:function(){var p;r._RF.push({},"63455Fxbc5JeJa+J9IfHeDv","pixel",void 0);var s=n.ccclass;n.property,e("pixel",s("pixel")(p=function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r.prototype.onLoad=function(){var e,t=null==(e=this.node.getComponent(o).spriteFrame)?void 0:e.texture;t&&t.setFilters(i.Filter.NONE,i.Filter.NONE)},r}(c))||p);r._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerHandCards.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts","./CardMover.ts","./GameEvents.ts","./CardComponent.ts","./BaseCardDisplay.ts","./TipText.ts"],(function(e){var t,n,r,a,s,i,c,o,d,u,l,h,p,f,C,v,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized,s=e.asyncToGenerator,i=e.regeneratorRuntime,c=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,d=e._decorator,u=e.Node,l=e.Vec3},function(e){h=e.EventManager},function(e){p=e.CardMover},function(e){f=e.PlayerHandCardEvent},function(e){C=e.CardComponent},function(e){v=e.BaseCardDisplay},function(e){m=e.TipType}],execute:function(){var g,x,y,P,b;o._RF.push({},"88570XPZuFEV5Sd/gF8v4Xx","PlayerHandCards",void 0);var k=d.ccclass,w=d.property;e("default",(g=k("PlayerHandCards"),x=w(u),g((b=t((P=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return t=e.call.apply(e,[this].concat(s))||this,r(t,"discardPile",b,a(t)),t.selectMax=2,t.selectNum=0,t}n(t,e);var o=t.prototype;return o.onLoad=function(){h.instance.on(f.DealCards,this.onDealCards,this)},o.onDestroy=function(){h.instance.off(f.DealCards,this.onDealCards,this)},o.start=function(){this.node.active=!1},o.dealCard=function(e,t){var n=this.positionContainer.children[e].position;return p.moveCard(t,this.cardContainer,n,.3,.15*(e+1))},o.dealCards=function(e,t){var n=this;this.node.active=!0,this.updatePositionLayout();var r=t.children;e.forEach(s(i().mark((function e(t,a){var s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(s=r[r.length-1]).getComponent(C).setup(t),e.next=4,n.dealCard(a,s);case 4:case"end":return e.stop()}}),e)})))),this.stopToggleSelection(),this.setToggleSelection(this.checkCardSelected.bind(this)),this.selectNum=this.selectMax},o.checkCardSelected=function(){this.selectedCardNodes.length>this.selectNum?h.instance.emit(m.Warning,"玩家回合\n您最多只能選擇"+this.selectMax+"張卡牌出牌"):h.instance.emit(m.Normal,"玩家回合")},o.sendCards=function(){var e=s(i().mark((function e(){var t,n,r,a,o,d=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=c(this.selectedCardNodes);case 2:if((r=n()).done){e.next=11;break}return a=r.value,o=a.getComponent(C).card,console.log("card",o),t.push(o),e.next=9,p.moveCard(a,this.discardPile,l.ZERO,.05,.15);case 9:e.next=2;break;case 11:return e.next=13,new Promise((function(e){return d.scheduleOnce(e,.1)}));case 13:return this.cardContainer.children.slice().forEach(s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.moveCard(t,d.discardPile,l.ZERO,.05,.15);case 2:case"end":return e.stop()}}),e)})))),e.next=17,new Promise((function(e){return d.scheduleOnce(e,.5)}));case 17:h.instance.emit("ExecuteIntent",t),this.selected.length=0,this.selectedCardNodes.length=0,this.stopToggleSelection();case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onDealCards=function(e){var t=e.cards,n=e.deckGatherings;this.initPositionNodes(t.length),this.dealCards(t,n)},o.onSendCards=function(){this.sendCards()},o.onSubmitSelectedClicked=function(){var e=s(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.selectedCardNodes.length){e.next=3;break}return h.instance.emit(m.Warning,"玩家回合\n請選擇卡牌"),e.abrupt("return");case 3:if(!(this.selectedCardNodes.length>this.selectNum)){e.next=6;break}return h.instance.emit(m.Error,"玩家回合\n能量不足，最多只能選擇"+this.selectMax+"張卡牌"),e.abrupt("return");case 6:return e.next=8,this.sendCards();case 8:console.log("提交選擇"),h.instance.emit("SubmitSelectedCards");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(v)).prototype,"discardPile",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=P))||y));o._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerHandCards2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseCardDisplay.ts","./GameEvents.ts","./EventManager.ts","./CardComponent2.ts","./CardMover.ts"],(function(n){var t,e,r,a,o,s,i,c,d,h,u;return{setters:[function(n){t=n.inheritsLoose,e=n.asyncToGenerator,r=n.regeneratorRuntime},function(n){a=n.cclegacy,o=n._decorator,s=n.instantiate},function(n){i=n.BaseCardDisplay},function(n){c=n.PlayerHandCardEvent},function(n){d=n.EventManager},function(n){h=n.CardComponent},function(n){u=n.CardMover}],execute:function(){var l;a._RF.push({},"962817kJY9H+LYU1/VczLnC","PlayerHandCards",void 0);var C=o.ccclass;o.property,n("default",C("PlayerHandCards")(l=function(n){function a(){return n.apply(this,arguments)||this}t(a,n);var o=a.prototype;return o.onLoad=function(){d.instance.on(c.DealCards,this.onDealCards,this),d.instance.on(c.ShowCards,this.onShowCards,this),d.instance.on(c.CompareCards,this.onCompareCards,this)},o.onDestroy=function(){d.instance.off(c.DealCards,this.onDealCards,this),d.instance.off(c.ShowCards,this.onShowCards,this),d.instance.off(c.CompareCards,this.onCompareCards,this)},o.start=function(){this.node.active=!1},o.showCards=function(n){var t=this;this.positionContainer.children.length===n.length?(this.selectedCardNodes.length>0&&console.error("已經有選取的卡片，請先清除之前的選取"),this.cardContainer.removeAllChildren(),n.forEach((function(n,e){var r=s(t.cardPrefab);r.name="Card_"+e,r.getComponent(h).setup(n),r.parent=t.cardContainer}))):console.error("卡牌數量與定位節點數量不符")},o.compareCards=function(n){var t=this,e=n[0];this.getCardNodes(e).forEach((function(n){t.toggleCardSelection(n)}))},o.dealCard=function(n,t){this.node.active=!0;var e=this.positionContainer.children[n].position;return u.moveCard(t,this.cardContainer,e,.3,.15*(n+1))},o.dealCards=function(n,t){var a=this;this.initPositionNodes(n.length),this.followPosition(),n.length>t.length?console.error("卡牌數量("+n.length+")超過堆疊數量("+t.length+")"):n.forEach(e(r().mark((function n(e,o){var s;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(s=t[t.length-1]).getComponent(h).setup(e),n.next=4,a.dealCard(o,s);case 4:case"end":return n.stop()}}),n)}))))},o.clearCards=function(){this.cardContainer.removeAllChildren(),this.selected=[]},o.onDealCards=function(){var n=e(r().mark((function n(t){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.node.active=!0,n.next=3,this.unselectAllCards();case 3:case 4:case"end":return n.stop()}}),n,this)})));return function(t){return n.apply(this,arguments)}}(),o.onShowCards=function(){var n=e(r().mark((function n(t){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.node.active=!0,n.next=3,this.unselectAllCards();case 3:this.showCards(t);case 4:case"end":return n.stop()}}),n,this)})));return function(t){return n.apply(this,arguments)}}(),o.onCompareCards=function(n){this.compareCards(n)},a}(i))||l);a._RF.pop()}}}));

System.register("chunks:///_virtual/PopupWindowComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,o,i,a,r,l,u,c,s,p,b,d,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){a=t.cclegacy,r=t._decorator,l=t.Node,u=t.Label,c=t.Button,s=t.instantiate,p=t.EventHandler,b=t.Vec3,d=t.tween,f=t.Component}],execute:function(){var h,g,m,v,C,w,y,P,L,k,z,N,E;a._RF.push({},"ef7f9o5MSdHJIyaJ+5Y6gKE","PopupWindowComponent",void 0);var W=r.ccclass,_=r.property;t("PopupWindowComponent",(h=W("PopupWindowComponent"),g=_(l),m=_(u),v=_(u),C=_(l),w=_(c),h((L=e((P=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,o(e,"dialogNode",L,i(e)),o(e,"titleLabel",k,i(e)),o(e,"contentLabel",z,i(e)),o(e,"buttonContainer",N,i(e)),o(e,"buttonPrefab",E,i(e)),e.callbacks=new Map,e}n(e,t);var a=e.prototype;return a.openPopup=function(t,e,n){this.setupTitle(t),this.contentLabel.string=e,this.setupButtons(n),this.animateOpen()},a.setupTitle=function(t){this.titleLabel.node.active=!!t,this.titleLabel.string=t||""},a.setupButtons=function(t){var e=this;this.buttonContainer.removeAllChildren(),t.forEach((function(t,n){var o=s(e.buttonPrefab.node),i=o.getComponent(c);o.getComponentInChildren(u).string=t.label,o.parent=e.buttonContainer,o.active=!0;var a="button_"+n;e.callbacks.set(a,t.callback);var r=new p;r.target=e.node,r.component="PopupWindowComponent",r.handler="buttonClicked",r.customEventData=a,i.clickEvents.push(r)}))},a.buttonClicked=function(t,e){var n=this.callbacks.get(e);n&&n(),this.animateClose()},a.animateOpen=function(){this.dialogNode.scale=new b(0,0,0),d(this.dialogNode).to(.3,{scale:new b(1,1,1)}).start()},a.animateClose=function(){var t=this;d(this.dialogNode).to(.3,{scale:new b(0,0,0)}).call((function(){return t.node.active=!1})).start()},a.close=function(){this.node.active=!1,this.callbacks.clear()},e}(f)).prototype,"dialogNode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(P.prototype,"titleLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(P.prototype,"contentLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(P.prototype,"buttonContainer",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(P.prototype,"buttonPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=P))||y));a._RF.pop()}}}));

System.register("chunks:///_virtual/RandomString.ts",["cc"],(function(n){var t;return{setters:[function(n){t=n.cclegacy}],execute:function(){t._RF.push({},"dcab9+inZ5O3o+MXXMDy66u","RandomString",void 0);n("RandomString",function(){function n(){}return n.generate=function(n){void 0===n&&(n=10);for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",o=0;o<n;o++){r+=t[Math.floor(Math.random()*t.length)]}return r},n}());t._RF.pop()}}}));

System.register("chunks:///_virtual/RewardCards.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts","./GameEvents.ts","./BaseCardDisplay.ts","./CardComponent.ts","./TipText.ts"],(function(n){var e,t,o,s,a,r,i,c,d;return{setters:[function(n){e=n.inheritsLoose},function(n){t=n.cclegacy,o=n._decorator,s=n.instantiate},function(n){a=n.EventManager},function(n){r=n.PlayerHandCardEvent},function(n){i=n.BaseCardDisplay},function(n){c=n.CardComponent},function(n){d=n.TipType}],execute:function(){var l;t._RF.push({},"d26baYibyJBtJbXQPaH2Y1k","RewardCards",void 0);var h=o.ccclass;o.property,n("RewardCards",h("RewardCards")(l=function(n){function t(){return n.apply(this,arguments)||this}e(t,n);var o=t.prototype;return o.onLoad=function(){a.instance.on(r.ShowCards,this.onShowCards,this),a.instance.on(r.DealCards,this.onDealCards,this)},o.onDestroy=function(){a.instance.off(r.ShowCards,this.onShowCards,this),a.instance.off(r.DealCards,this.onDealCards,this)},o.start=function(){this.node.active=!1},o.showCards=function(n){var e=this;this.positionContainer.children.length===n.length?(this.selectedCardNodes.length>0&&console.error("已經有選取的卡片，請先清除之前的選取"),this.cardContainer.removeAllChildren(),n.forEach((function(n,t){var o=s(e.cardPrefab);o.name="Card_"+t,o.getComponent(c).setup(n),o.parent=e.cardContainer}))):console.error("卡牌數量與定位節點數量不符")},o.onShowCards=function(n){this.node.active=!0;var e=n;console.log("show cards",e),this.initPositionNodes(e.length),this.showCards(e),this.followPosition(),this.setToggleSelection()},o.onDealCards=function(){},o.onChoosedCardClicked=function(){var n=this.selectedCardNodes;if(0!==n.length)if(n.length>1)a.instance.emit(d.Warning,"只能選取一張卡片");else{var e=n[0].getComponent(c);if(e){var t=e.card;console.log("選取卡片",t),a.instance.emit("SelectedRewardCard",t),this.stopToggleSelection(),this.unselectAllCards()}else console.error("卡片物件沒有CardComponent")}else a.instance.emit(d.Warning,"沒有選取任何卡片")},t}(i))||l);t._RF.pop()}}}));

System.register("chunks:///_virtual/Rogue.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Dungeon.ts","./MazeDisplay.ts","./DescriptionScrollView.ts","./NetworkGraph.ts","./EventManager.ts","./GameEvents.ts","./CharacterInfo.ts"],(function(o){var n,t,e,i,r,c,s,a,u,l,h,p,d,f,g;return{setters:[function(o){n=o.applyDecoratedDescriptor,t=o.inheritsLoose,e=o.initializerDefineProperty,i=o.assertThisInitialized},function(o){r=o.cclegacy,c=o._decorator,s=o.Component},function(o){a=o.Direction,u=o.DungeonMaze},function(o){l=o.MazeDisplay},function(o){h=o.DescriptionScrollView},function(o){p=o.NetworkGraph},function(o){d=o.EventManager},function(o){f=o.WordPuzzleGameLogicEvent},function(o){g=o.CharacterInfo}],execute:function(){var m,v,D,w,y,z,k,R,b,C,S;r._RF.push({},"a9cf4ELFqtNM7zats1RDWJ0","Rogue",void 0);var I=c.ccclass,E=c.property;o("default",(m=I("Rogue"),v=E(p),D=E(h),w=E(l),y=E(g),m((R=n((k=function(o){function n(){for(var n,t=arguments.length,r=new Array(t),c=0;c<t;c++)r[c]=arguments[c];return n=o.call.apply(o,[this].concat(r))||this,e(n,"networkGraph",R,i(n)),e(n,"descriptionScrollView",b,i(n)),e(n,"mazeDisplay",C,i(n)),e(n,"characterInfo",S,i(n)),n.dungeon=null,n.currX=0,n.currY=0,n.data=void 0,n}t(n,o);var r=n.prototype;return r.onLoad=function(){this.networkGraph.node.active=!1,this.descriptionScrollView.node.active=!1,this.mazeDisplay.node.active=!1},r.setDungeonData=function(o){this.data=o;o.roomType;var n=o.icon,t=o.name,e=o.descriptions;o.connectIn,o.locations;this.networkGraph.node.active=!0,this.networkGraph.createInitialNode(n,t,this.enterDungeon.bind(this)),this.descriptionScrollView.node.active=!0,this.descriptionScrollView.setData(e)},r.enterDungeon=function(o){console.log(o);var n=this.data.locations[0],t=(n.roomType,n.icon,n.name,n.size),e=n.position,i=n.rooms;this.descriptionScrollView.clear(),this.mazeDisplay.node.active=!0;var r=this.createDungeon(t[0],t[1],e[0],e[1]),c=this.getCurrentRoom();this.dungeon.rooms.forEach((function(o){var n=i[1];o.forEach((function(o){o.setInfo(n)}))}));var s=i[0];c.setInfo(s);var a=i[i.length-1];r.setInfo(a),this.setDungeonRoom(c)},r.setDungeonRoom=function(o){var n=this;console.log(o),o.descriptions.length>0&&(this.descriptionScrollView.node.active=!0,this.descriptionScrollView.setData(o.descriptions));this.networkGraph.removeAllNodes(),this.networkGraph.createInitialNode(o.icon,o.name,(function(){return d.instance.emit(f.WordPuzzleGameStart,o)})),o.connections.forEach((function(t){var e,i,r;switch(t){case a.North:e=0,i=200,r=function(){n.onNorthDoorClick()};break;case a.East:e=200,i=0,r=function(){n.onEastDoorClick()};break;case a.South:e=0,i=-200,r=function(){n.onSouthDoorClick()};break;case a.West:e=-200,i=0,r=function(){n.onWestDoorClick()}}n.networkGraph.addNode(o.icon,e,i,"creation1","門",r)}))},r.createDungeon=function(o,n,t,e){if(!(o<0||n<0||o<=t||n<=e||t<0||e<0)){this.dungeon=new u(o,n),this.dungeon.generateMaze(t,e);var i=this.dungeon.findExit(t,e);return console.log("exit:",i),this.mazeDisplay.showDungeon(this.dungeon,t,e,i),this.currX=t,this.currY=e,i}console.error("Invalid dungeon size or start position")},r.moveToRoom=function(o,n){if(o<0||n<0||o>=this.dungeon.width||n>=this.dungeon.height)console.error("Invalid room position");else{var t=this.dungeon.rooms[n][o];t?(this.currX=o,this.currY=n,this.mazeDisplay.movePlayer(this.dungeon,o,n),this.setDungeonRoom(t)):console.error("Invalid room")}},r.getCurrentRoom=function(){return this.dungeon.rooms[this.currY][this.currX]},r.onSouthDoorClick=function(){var o=this.getCurrentRoom();o&&o.connections.includes(a.South)&&this.moveToRoom(this.currX,this.currY-1)},r.onEastDoorClick=function(){var o=this.getCurrentRoom();o&&o.connections.includes(a.East)&&this.moveToRoom(this.currX+1,this.currY)},r.onNorthDoorClick=function(){var o=this.getCurrentRoom();o&&o.connections.includes(a.North)&&this.moveToRoom(this.currX,this.currY+1)},r.onWestDoorClick=function(){var o=this.getCurrentRoom();o&&o.connections.includes(a.West)&&this.moveToRoom(this.currX-1,this.currY)},n}(s)).prototype,"networkGraph",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=n(k.prototype,"descriptionScrollView",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=n(k.prototype,"mazeDisplay",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=n(k.prototype,"characterInfo",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=k))||z));r._RF.pop()}}}));

System.register("chunks:///_virtual/RoomHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketBridge.ts","./RandomString.ts"],(function(e){var t,o,s,i,n,a;return{setters:[function(e){t=e.createClass,o=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){i=e.cclegacy},function(e){n=e.SocketBridge},function(e){a=e.RandomString}],execute:function(){i._RF.push({},"bdac1KaEi9OoL28aGCdUil/","RoomHandler",void 0);e("RoomHandler",function(){function e(e,t){this.roomInfo=void 0,this.eventHandlers={},this._roomLocalCacheName="",this._needReconnect=!1,this.isHonster=!1,this.players={},this._readyPlayers={},this._roomList=[],this._roomID="",this._roomKey="",this._roomLockKey="",this._joinRoomInterval=void 0,this._isRoomJoining=!1,this._playerID="",this._nickname="",this.eventUpdateTableList=null,this.eventUpdateRoomList=null,this.eventGameReady=null,this.eventGameStart=null,this.eventGameReconnect=null,this._roomLocalCacheName="DE_ROOM_TEMP_"+e,this.roomInfo={id:"",key:"",lockKey:""},this._playerID=a.generate(),this._nickname=t}var i=e.prototype;return i.getEventHandlers=function(){return{join_room:this.notify_join_room.bind(this),take_seat:this.notify_take_seat.bind(this),leave_room:this.notify_leave_room.bind(this),kicked_out:this.notify_kicked_out.bind(this),game_ready:this.notify_game_ready.bind(this),game_start:this.notify_game_start.bind(this)}},i.handleRoomTimeout=function(e){var t=this;this._isRoomJoining=!0,this._joinRoomInterval&&clearTimeout(this._joinRoomInterval),this._joinRoomInterval=setTimeout((function(){var o;t._isRoomJoining&&(console.log("沒有對應的 Honster 回應"),n.Instance.clientDisconnect(t._playerID),console.log("只能把自己的 Broadcast 欄位移除"),n.Instance.delDataLabel("ROOMS/"+e),console.log("代替斷線的 Honster 把"+e+"從房間清單移除"),n.Instance.removeDispatcher(t._roomID,t),t._clearRoomInfo(),null==(o=t.eventUpdateRoomList)||o.call(t))}),1e3)},i._applicate=function(e,t){void 0===t&&(t=""),this.isHonster?this["notify_"+e](this._roomID,e,t):n.Instance.applicate(e,t)},i._broadcast=function(e,t,o){if(void 0===t&&(t=""),this.isHonster){if(console.log(e,t,"clientID?:",o),o===this._playerID)return console.log("不會發給自己");n.Instance.broadcast(e,t,o)}},i.loadRoomsAsync=function(){var e=this;return n.Instance.loadAsync("ROOMS").then((function(t){return e._roomList=t}))},i.newRoom=function(e,t){void 0===t&&(t="0");var o=a.generate();this._roomID=e,this._roomKey=o,n.Instance.addDataLabel("ROOMS/"+e,o),this._roomLockKey=t,this.isHonster=!0,this.joinRoom(this._roomID,this._roomKey,this._roomLockKey)},i.joinRoom=function(){var e=o(s().mark((function e(t,o,i){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===i&&(i="0"),e.prev=1,console.log("Joining room:",t),a={id:t,key:o,lockKey:i},e.next=6,n.Instance.addDispatcher(t,this,this.getEventHandlers());case 6:if(!this.isHonster){e.next=11;break}return e.next=9,n.Instance.addHonsterConnection(t);case 9:e.next=14;break;case 11:return e.next=13,n.Instance.addClientConnection(t,this._playerID);case 13:this.handleRoomTimeout(t);case 14:this.roomInfo=a,this._applicate("join_room",this._playerID+" "+o+" "+i),console.log("Player [",this._playerID,"] send joinRoom: id/roomkey:[",o,"] & roomLockKey:[",i,"]"),e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(1),console.error("Failed to join room:",e.t0),e.t0;case 23:case"end":return e.stop()}}),e,this,[[1,19]])})));return function(t,o,s){return e.apply(this,arguments)}}(),i.tryReconnect=function(){var e=o(s().mark((function e(){var t,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem(this._roomLocalCacheName))){e.next=14;break}return this._needReconnect=!0,o=JSON.parse(t),console.log("斷線重連:",o),this.isHonster=o.isHonster,o.playerID&&(console.log("重連後修改自己的playerID:",this._playerID,"->",o.playerID),this._playerID=o.playerID),this._roomID=o.roomID,this._roomKey=o.roomKey,this._roomLockKey=o.roomLockKey,this.players=o.players,e.next=13,this.joinRoom(this._roomID,this._roomKey);case 13:return e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.leaveRoom=function(){var e;console.log("leave room this._isHonster:",this.isHonster),this.isHonster?(console.log("發出 kicked_out!!! 然後斷線"),this._broadcast("kicked_out"),n.Instance.honsterDisconnect(),n.Instance.delBroadcastList(),n.Instance.delDataLabel("ROOMS/"+this._roomID)):(n.Instance.applicate("leave_room",this._playerID),n.Instance.clientDisconnect(this._playerID)),n.Instance.removeDispatcher(this._roomID,this),null==(e=this.eventUpdateRoomList)||e.call(this),this._clearRoomInfo()},i._clearRoomInfo=function(){localStorage.removeItem(this._roomLocalCacheName),this._roomID="",this._roomKey="",this._roomLockKey="0",this.isHonster=!1,this.players={},this._readyPlayers={}},i.notify_join_room=function(e,t,o){var s;if(this.isHonster){var i=o.split(" ");s=i[0];var a=i[1],r=i[2];if(console.log("this._roomKey:",this._roomKey,"---room key:",a),this._roomKey!=a){var l="不符合的 room key";console.log(l),o=s+" 0 "+l,this._broadcast(t,o,s)}else if(this._roomLockKey!=r){var c="輸入錯誤的密碼: "+r;console.log(c),o=s+" 0 "+c,this._broadcast(t,o,s)}else this._playerID!=s&&n.Instance.addToBroadcastList(s),o=s+" 1",this._broadcast(t,o,s)}var h=o.split(" ");if((s=h[0])==this._playerID){var _,m="1"===h[1];if(this._needReconnect)m?(null==(_=this.eventGameReconnect)||_.call(this,e,s,this._nickname,this.players),this._joinRoomInterval&&clearTimeout(this._joinRoomInterval),console.log("重連成功")):console.log("重連失敗: 已失去房間連結"),this._needReconnect=!1;else if(m)this._roomID=e,this._isRoomJoining=!1,console.log(this._nickname,"成功加入房間!!"),this._applicate("take_seat",s+" "+this._nickname);else{var y=h[2];console.log(t,"error:",y),this.leaveRoom()}}else console.log("playerID 不同",s,this._playerID)},i.notify_take_seat=function(e,t,o){var s,i,n;if(this.isHonster){var a=o.split(" ");i=a[0],n=a[1],console.log(n,i,"進行入桌"),this.players[i]=n,o=i+" "+JSON.stringify(this.players),this._broadcast(t,o)}var r=o.split(" ");i=r[0];var l=JSON.parse(r[1]);null==(s=this.eventUpdateTableList)||s.call(this,l),this._playerID===i&&this.gameReady(0)},i.notify_leave_room=function(e,t,o){var s,i,a=o;this.isHonster&&(i=this.players[a],delete this.players[a],delete this._readyPlayers[a],n.Instance.delBroadcastList(a),n.Instance.clientDisconnect(a),console.log("離開房間斷線:",a),o=JSON.stringify(this.players)+" "+i,this._broadcast(t,o));var r=o.split(" "),l=JSON.parse(r[0]),c=r[1];console.log("players:",l),null==(s=this.eventUpdateTableList)||s.call(this,l),console.log(c,"離開房間了")},i.notify_kicked_out=function(e,t,o){var s;this.isHonster?n.Instance.clientDisconnect():(n.Instance.removeDispatcher(e,this),null==(s=this.eventUpdateRoomList)||s.call(this),this._clearRoomInfo());console.log("有收到 kicked out哦!!")},i.notify_game_ready=function(e,t,o){var s,i;if(console.log("收到 notify_game_ready"),this.isHonster){var n=o.split(" ");i=n[0];var a=n[1];this._readyPlayers[i]=a,console.log("ready player:",this._readyPlayers),o=JSON.stringify(this._readyPlayers)+" "+JSON.stringify(this.players),this._broadcast(t,o)}var r=o.split(" "),l=JSON.parse(r[0]),c=JSON.parse(r[1]);null==(s=this.eventGameReady)||s.call(this,l,c)},i.notify_game_start=function(e,t,o){console.log("收到 notify_game_start",this.isHonster),this.isHonster&&(this._broadcast(t),n.Instance.delDataLabel("ROOMS/"+this._roomID)),this.eventGameStart(e,this._playerID,this._nickname);var s={roomID:this._roomID,roomKey:this._roomKey,roomLockKey:this._roomLockKey,playerID:this._playerID,isHonster:this.isHonster,players:this.players};localStorage.setItem(this._roomLocalCacheName,JSON.stringify(s)),console.log("\n\n存檔",s,"\n\n")},i.gameReady=function(e){this.isHonster&&(e="2"),this._applicate("game_ready",this._playerID+" "+e)},i.tryGameStart=function(){var e=this,t=Object.keys(this._readyPlayers),o=t.length&&t.every((function(t){return parseInt(e._readyPlayers[t],10)>0}));console.log("準備清單:",this._readyPlayers),o?this._applicate("game_start"):console.log("尚有人未準備好")},t(e,[{key:"nickname",set:function(e){this._nickname=e}}]),e}());i._RF.pop()}}}));

System.register("chunks:///_virtual/Shield.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Item.ts"],(function(e){var n,t,i;return{setters:[function(e){n=e.inheritsLoose},function(e){t=e.cclegacy},function(e){i=e.Item}],execute:function(){t._RF.push({},"b9e88pzps9K1KP4kQQJlPKP","Shield",void 0);e("Shield",function(e){function t(n,t,i,o,u){var c;return(c=e.call(this,n,i,o,1)||this).bonusAC=void 0,c.iconName=void 0,c.iconName=t,c.bonusAC=u,c}return n(t,e),t}(i));t._RF.pop()}}}));

System.register("chunks:///_virtual/ShieldDraggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Draggable.ts","./EventManager.ts","./EquipmentDropZone.ts"],(function(e){var n,t,i,a,o,r,l,s;return{setters:[function(e){n=e.inheritsLoose,t=e.createClass},function(e){i=e.cclegacy,a=e._decorator,o=e.Label},function(e){r=e.Draggable},function(e){l=e.EventManager},function(e){s=e.EquipmentDropZoneIndex}],execute:function(){var c;i._RF.push({},"8cc60sE/3xEf4NjdFJug/NW","ShieldDraggable",void 0);var u=a.ccclass;a.property,e("ShieldDraggable",u("ShieldDraggable")(c=function(e){function i(){for(var n,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(n=e.call.apply(e,[this].concat(i))||this).nameLabel=null,n._shield=null,n.equipmentIndex=s.None,n}return n(i,e),i.prototype.onTouchStart=function(n){if(e.prototype.onTouchStart.call(this,n),this.equipmentIndex!==s.None){var t=this.zone;l.instance.emit("CharacterEquipShield",{index:t.serialIndex,item:null}),this.equipmentIndex=s.None}},t(i,[{key:"shield",set:function(e){this._shield=e,console.log("Shield = ",e),this.nameLabel=this.node.getComponentInChildren(o),this.nameLabel.string=e.name,this.setPhotoImage(e.iconName)}},{key:"item",get:function(){return this._shield}}]),i}(r))||c);i._RF.pop()}}}));

System.register("chunks:///_virtual/Skill.ts",["cc"],(function(i){var e;return{setters:[function(i){e=i.cclegacy}],execute:function(){e._RF.push({},"5af80/LSJVPJo3J7v5GCx6a","Skill",void 0);i("Skill",(function(i,e,c){void 0===c&&(c=t.Novice),this.name=void 0,this.level=void 0,this.description=void 0,this.name=i,this.description=e,this.level=c}));var t=i("SkillProficiency",function(i){return i[i.Novice=0]="Novice",i[i.Proficient=1]="Proficient",i[i.Expert=2]="Expert",i}({}));e._RF.pop()}}}));

System.register("chunks:///_virtual/SocketBridge.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FirebaseBridge.ts"],(function(t){var n,i,e,o,c;return{setters:[function(t){n=t.createClass,i=t.asyncToGenerator,e=t.regeneratorRuntime},function(t){o=t.cclegacy},function(t){c=t.default}],execute:function(){o._RF.push({},"2d4a25YPn1Bho37tEGXpZjX","SocketBridge",void 0),t("SocketBridge",function(){function t(){this._bridge=new c,this._connectID="",this._broadcastList=[]}var o=t.prototype;return o.connect=function(){var t=i(e().mark((function t(n){var i;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._bridge.signInWithGoogleEmail("xxfox"+n[0]+"@gmail.com",n[1]);case 3:return i=t.sent,t.abrupt("return",i);case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(n){return t.apply(this,arguments)}}(),o.addDispatcher=function(t,n,i){this._bridge.addDispatcher(t,n,i)},o.removeDispatcher=function(t,n){this._bridge.removeDispatcher(t,n)},o.loadAsync=function(t,n){return this._bridge.loadAsync(t,n)},o.addHonsterConnection=function(t){this._connectID=t,this._bridge.addConnection(t,"Applicate")},o.addClientConnection=function(t,n){this._connectID=t,this._bridge.addConnection(t,"Broadcast",n)},o.honsterDisconnect=function(){this._bridge.delConnection(this._connectID,"Applicate"),this._bridge.uploadInfo(this._connectID,"","","Applicate"),this._connectID=""},o.clientDisconnect=function(t){var n=this;t?(this._bridge.delConnection(this._connectID,"Broadcast",t),this._bridge.uploadInfo(this._connectID,"","","Broadcast",t)):this._broadcastList.forEach((function(t){n._bridge.delConnection(n._connectID,"Broadcast",t),n._bridge.uploadInfo(n._connectID,"","","Broadcast",t)})),this.delBroadcastList(t)},o.addToBroadcastList=function(t){this._broadcastList.push(t),console.log("新增",t,this._broadcastList)},o.delBroadcastList=function(t){t?this._broadcastList.indexOf(t)>-1&&(this._broadcastList.splice(this._broadcastList.findIndex((function(n){return n===t})),1),console.log("刪除",t,this._broadcastList)):(console.log("刪除",this._broadcastList,this._broadcastList),this._broadcastList.length=0)},o.applicate=function(t,n){this._bridge.uploadInfo(this._connectID,t,n,"Applicate")},o.broadcast=function(t,n,i){var e=this;if(!this._connectID)return console.log("Honster 已斷線");i?(console.log(t,"廣播對象:",i),this._bridge.uploadInfo(this._connectID,t,n,"Broadcast",i)):(console.log(t,"廣播對象:",this._broadcastList),this._broadcastList.forEach((function(i){return e._bridge.uploadInfo(e._connectID,t,n,"Broadcast",i)})))},o.addDataLabel=function(t,n){this._bridge.addDataLabel(t,n)},o.delDataLabel=function(t){this._bridge.delDataLabel(t)},n(t,null,[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),t}())._instance=void 0,o._RF.pop()}}}));

System.register("chunks:///_virtual/StoryCard.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts","./MapConnection.ts"],(function(n){var t,e,r,o,i,a,c,u,s;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,r=n.initializerDefineProperty,o=n.assertThisInitialized},function(n){i=n.cclegacy,a=n._decorator,c=n.Component},function(n){u=n.EventManager},function(n){s=n.MapConnection}],execute:function(){var p,l,f,d,y;i._RF.push({},"ad94fOjjb5FZ6iY0SnnPczb","StoryCard",void 0);var v=a.ccclass,C=a.property;n("StoryCard",(p=v("StoryCard"),l=C(s),p((y=t((d=function(n){function t(){for(var t,e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return t=n.call.apply(n,[this].concat(i))||this,r(t,"mapConnection",y,o(t)),t}e(t,n);var i=t.prototype;return i.onLoad=function(){},i.onClicked=function(){u.instance.emit("QuestAccept","kuai_kuai_cat1"),this.node.active=!1},t}(c)).prototype,"mapConnection",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=d))||f));i._RF.pop()}}}));

System.register("chunks:///_virtual/StoryCardStack.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,r,i,n,o,a,c,s,g,l,u,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,c=t.Prefab,s=t.Node,g=t.instantiate,l=t.Vec3,u=t.UITransform,d=t.Component}],execute:function(){var h,p,f,v,C,y,b,m;o._RF.push({},"6dfabiwBrdFgJ5Dd54Bj6/C","StoryCardStack",void 0);var S=a.ccclass,k=a.property;t("StoryCardStack",(h=S("StoryCardStack"),p=k(c),f=k(s),h((y=e((C=function(t){function e(){for(var e,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,i(e,"cardPrefab",y,n(e)),i(e,"stackNode",b,n(e)),i(e,"triggerHeight",m,n(e)),e.movingCard=null,e}r(e,t);var o=e.prototype;return o.onLoad=function(){this.generateCardStack()},o.generateCardStack=function(){for(var t=0;t<10;t++){var e=g(this.cardPrefab);e.setParent(this.stackNode),e.position=new l(0,5*-t,0),e.scale=new l(.2,.2,.2),this.registerCardEvents(e)}},o.registerCardEvents=function(t){t.on(s.EventType.TOUCH_MOVE,this.onCardMove,this),t.on(s.EventType.TOUCH_END,this.onCardRelease,this)},o.onCardMove=function(t){this.movingCard||(this.movingCard=t.currentTarget);var e=t.getUILocation(),r=this.node.getComponent(u).convertToNodeSpaceAR(new l(e.x,e.y,0));this.movingCard.position=r;var i=Math.min(1,(r.y-this.stackNode.position.y)/this.triggerHeight);this.movingCard.scale=new l(.2+.8*i,.2+.8*i,1)},o.onCardRelease=function(t){t.currentTarget.position.y>=this.triggerHeight&&this.triggerAction(),this.movingCard=null},o.triggerAction=function(){console.log("Triggered Action at Height!")},e}(d)).prototype,"cardPrefab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=e(C.prototype,"stackNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(C.prototype,"triggerHeight",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),v=C))||v));o._RF.pop()}}}));

System.register("chunks:///_virtual/StoryData.ts",["cc","./ExplorationCard.ts"],(function(e){var i,t;return{setters:[function(e){i=e.cclegacy},function(e){t=e.CardSuit}],execute:function(){i._RF.push({},"47ed9Jj46dABa9sNHc8UxTB","StoryData",void 0);e("StoryData",(function(){var e,i,o,n,s,c,r,a;this.chapters=[],this.dungeons=void 0,this.monsters=void 0,this.quests=void 0,this.skills=[],this.dramas=void 0,this.options=void 0,this.ethnicityHumanIntro1=["人類在近二十歲時成年，且可活不到一世紀。","人類並不傾向特定陣營。你可以在他們之中找到最好以及最壞的個體。","人類身高體格之間的差距很大，從勉強5呎高到遠超過6呎都有。不論你在這範圍內的位置為何，你的體型為中型。","你可以說、讀、寫通用語和另一種你所選擇的語言。","人類通常會學習那些與他們打交道的其他族類的語言，包括那些晦澀難解的方言。","他們喜歡借用來自其他方言的字詞去點綴他們的言詞，像是獸人的咒罵、精靈音樂般的措辭、矮人的軍事片語、諸如此類。"],this.ethnicityElfIntro1=["儘管精靈和人類會在差不多的年齡達到生理成熟，但精靈對成年的見解並不只是生理成熟，還包括世俗的經驗。","精靈通常在100歲前後宣告成年並得到成年名稱，且其壽命可達750歲。","精靈熱愛自由、多元、和自我表現，因此他們強烈傾向於較溫和的混亂。","他們將他人的自由當作自己的來重視與保護。他們通常都是善良的。","精靈的身高範圍從不到五呎到超過六呎，且有著苗條的體格。你的體型為中型。","習慣了微光森林與夜空，你在黑暗與微光環境下仍能保持卓越視覺。","你在看距離你60呎範圍內的事物時，微光的照明程度對你而言視作明亮，黑暗則視作微光。","你無法辨別黑暗中的顏色，而只能看到灰黑的輪廓。","你熟練於感知技能。","你在對抗魅惑的豁免檢定中具有優勢，且魔法無法讓你入睡。","精靈並不需要睡眠。取而代之，他們一天會進行4小時保留潛意識的深度冥想。",'（通用語將這種冥想稱為"傳思"）在冥想時，你勉強算是會作夢；這些夢境實際上是在多年訓練下產生的反射性心靈鍛鍊。',"在以這種方式休息後，你得到與人類8小時睡眠後相同的益處。","如果你在長休期間冥想，你可以在花費4小時完成冥想後，在剩下的4小時中保持清醒，並進行輕省活動。","你仍然需要花費8小時來完成長休。","你能夠說、讀、寫通用語和精靈語。精靈語如流體般流暢，有著精妙的語調變化和複雜的語法結構。","精靈文學豐富而多元，他們的詩歌在其他種族之間也很受歡迎。","許多吟遊詩人都會學習精靈語，並將其韻律運用在他們自己的詩作中。","你具有對死靈傷害的抗性。",'"鴉后的祝福" 以一個附贈動作，你可以魔法性的傳送最多30呎距離到一處未被佔據的可見空間。',"一旦你使用此特性，直到你完成一次長休之前都無法再使用它。","從3級開始，當你使用此特性傳送時，你也獲得對所有傷害的抗性。","這個抗性持續到你的下個回合開始。在這段期間，你變得朦朧且半透明。"],this.ethnicityHalfElfIntro1=["半精靈的成熟速度和人類相同，並在20歲左右成年。","然而，他們的壽命遠長於人類，經常能活超過180歲。","半精靈分享了來自他們精靈血統的混亂天性。他們重視個人自由和創造性表達，既不展現出對領導者的喜愛、也不渴望受人追隨。","他們厭惡規則、討厭被別人命令、且有時會顯得不太可靠——或至少難以預測。","半精靈有著和人類相近的體型，身高介於5呎至6呎之間。你的體型為中型。","多虧於你的精靈血統，你在黑暗與微光環境下仍能保持卓越視覺。","你在看距離你60呎範圍內的事物時，微光的照明程度對你而言視作明亮，黑暗則視作微光。","你無法辨別黑暗中的顏色，而只能看到灰黑的輪廓。","你在對抗魅惑的豁免檢定中具有優勢，且魔法無法讓你入睡。","你熟練於二個你所選擇的技能。","你能夠說、讀、寫通用語、精靈語、和另一種你所選擇的語言。"],this.ethnicityOrcIntro1=["獸人在12歲時成年，並可以活到最多50歲。","獸人是惡毒的掠奪者，他們相信這個世界應該屬於他們。","他們崇敬力量高於一切，並相信強者必須欺凌弱者以確保軟弱不會像疾病一樣傳播。他們通常是混亂邪惡。","獸人通常超過6呎高，且體重介於230到280磅之間。你的體型為中型。","你在看距離你60呎範圍內的事物時，微光的照明程度對你而言視作明亮，黑暗則視作微光。","你無法辨別黑暗中的顏色，而只能看到灰黑的輪廓。","以一個附贈動作，你可以向一個你所能看見或聽見的敵意生物移動最多等同你移動速度的距離。","你必須在比你開始移動時距離該敵人更近的位置結束此移動。","你熟練於威嚇技能。","當決定你的負重以及你可以拖曳、推動、或提舉的重量時，你將你的體型視作比原本大一級。","你可以說、讀、寫通用語和獸人語。"],this.ethnicityHalfOrcIntro1=["半獸人的成熟速度比人類略快一些，並在14歲左右便成年。他們的衰老速度明顯更快，且很少能活超過75歲。","陣營. 半獸人從他們的獸人親代繼承了容易傾向於混亂的血統，且因此不會有善良陣營的強烈傾向。在獸人中成長並願意在其中生活的半獸人通常是邪惡的。","體型. 半獸人比人類更大而魁梧，他們的身高範圍從不到5呎到遠超過6呎都有。你的體型為中型。","黑暗視覺. 多虧於你的獸人血統，你在黑暗與微光環境下仍能保持卓越視覺。你在看距離你60呎範圍內的事物時，微光的照明程度對你而言視作明亮，黑暗則視作微光。你無法辨別黑暗中的顏色，而只能看到灰黑的輪廓。","兇惡. 你熟練於威嚇技能。","頑強耐性. 當你的生命值被歸零但沒有當場被殺死時，你可以改為使生命值減少至1。直到完成一次長休之前，你都不能再使用這個特性。","野蠻攻擊. 當你以一次近戰武器攻擊造成重擊時，你可以額外骰一次該武器的其中一顆傷害骰，並將之加入重擊的額外傷害中。","語言. 你可以說、讀、寫通用語和獸人語。獸人語是一種使用硬輔音的粗糙、刺耳的語言。它沒有自己的文字，而是使用矮人文字進行書寫。"],this.ethnicityHalfingIntro1=["半身人在20歲時成年，且通常可以活到150歲。","陣營. 大部分的半身人都是守序善良。一般來說，他們心地善良、和藹可親，厭惡看見他人受苦，且完全不能容忍壓迫。他們也很守秩序、助重傳統、無比倚重他們社群的支持以及老套生活所帶來的舒適。","體型. 半身人平均大約3呎高，且體重約莫40磅。你的體型為小型。","幸運. 當你在攻擊檢定、屬性檢定、或豁免檢定中骰出了1，你可以重骰該檢定且必須使用新的擲骰結果。","勇敢. 你在對抗恐懼的豁免檢定中具有優勢。","半身人靈巧. 你可以移動穿過任何體型大於你的生物所在的空間。","語言. 你能夠說、讀、寫通用語和半身人語。半身人的語言並不是秘密，但他們並不怎麼情願與他人分享它。他們很少書寫，因此並沒有豐富的文學作品。然而，他們的口說傳統相當強勢。幾乎所有半身人都會說通用語，以跟他所居住或旅經地區的人們交談。","強魄韌性. 你在對抗毒素的豁免檢定中具有優勢，且你對毒素傷害具有抗性。"],this.ethnicityGnomeIntro1=["地侏的成熟速度和人類相同，且大部分會被預計在40歲左右安定下來進入成年的生活。他們可以活到350歲到接近500歲。","陣營. 地侏大部分都是善良的。那些賢者、工程師、研究者、學者、調查者、或發明家傾向於守序，而那些吟游詩人、騙徒、流浪漢、或是富幻想的珠寶匠則傾向於混亂。地侏的心地善良，甚至他們之中的那些騙徒也多是玩笑性質，而不是真正帶有惡意。","體型. 地侏的身高範圍在3呎到4呎之間，且平均約40磅重。你的體型為小型。","黑暗視覺. 習慣了地底的生活，你在黑暗與微光環境下仍能保持卓越視覺。你在看距離你60呎範圍內的事物時，微光的照明程度對你而言視作明亮，黑暗則視作微光。 你無法辨別黑暗中的顏色，而只能看到灰黑的輪廓。","地侏狡黠. 你在所有對抗魔法的智力、睿知、和魅力豁免中具有優勢。","語言. 你能夠說、讀、寫通用語和地侏語。地侏語是一種使用矮人文字的語言，並以其技術論文和對自然世界的知識分類而聞名。","巧匠學識. 每當你進行與魔法物品、煉金物體、或科技裝置有關的智力（歷史）檢定時，你可以加入你兩倍的熟練加值以取代任何你原有的熟練加值。","修補匠. 你熟練於工匠工具(修補匠工具)。藉由使用這些工具，你可以花費1小時的時間以及價值10金幣的材料以創造出一個微型的發條裝置（AC 5，1點生命值）。這個裝置將在24小時之後停止運轉（除非你花費1小時修理它以維持裝置的功能），或直到你使用你的動作將它拆卸；在這個時候，你可以取回你用於創造它的材料。你同時可以有最多三個正在運作的這類裝置。","當你創造一個裝置時，選擇下列其中一個選項：","發條玩具. 這個玩具是一個發條動物、怪物、或小人，像是青蛙、老鼠、小鳥、龍、或是士兵。當被擺放在地上，這個玩具將會在你的每個回合內沿著地面向隨機方向移動5呎。它會發出與其生物外型相符的聲音。","打火機. 這個裝置會產生出微小的火焰，你可以用以點燃蠟燭、火炬、或是篝火。使用這個裝置需要一個動作。","音樂盒. 當打開時，這個音樂盒將會以適中的音量演奏一首歌曲。這個音樂箱會在歌曲結束或被關上時停止演奏。"],this.ethnicityDwarfIntro1=["矮人的成熟速度和人類相同，但他們直到50歲之前都會被視作未成年。他們平均可以活大約350年。","陣營. 大部分的矮人是守序的，堅信著井然有序的社會所帶來的好處。他們也傾向善良，有著強烈的公平競爭意識，並認為每個人都應該共享公正秩序的益處。","體型. 矮人的身高介於4到5呎高，且平均大約150磅重。你的體型為中型。","移動速度. 你的移動速度並不會因為穿著重甲而減少。","黑暗視覺. 習慣了地底的生活，你在黑暗與微光環境下仍能保持卓越視覺。你在看距離你60呎範圍內的事物時，微光的照明程度對你而言視作明亮，黑暗則視作微光。 你無法辨別黑暗中的顏色，而只能看到灰黑的輪廓。","矮人韌性. 你在對抗毒素的豁免檢定中具有優勢，且你對毒素傷害具有抗性。","矮人戰鬥訓練. 你熟練於戰斧、手斧、輕錘、和戰錘。","工具熟練. 你熟練於下列其中一個你所選擇的工匠工具：鐵匠工具、釀酒師設備、或石匠工具。","岩石熟悉. 每當你進行關聯於石製品起源的智力（歷史）檢定時，你被視為熟練於歷史技能，並將你二倍的熟練加值代替你原本的熟練加值加入該檢定中。","語言. 你能夠說、讀、寫通用語和矮人語。矮人語充斥了堅硬的輔音和喉音，而這些特徵也將顯露在任何矮人可能會說的其他語言中。","矮人耐力. 你的生命值最大值增加1點，且在每次你提升等級時再增加1點。"],this.options={ethnicity:{descriptions:["歡迎你的加入，這是一個充滿劍與魔法的[奇幻世界 | pic:fantasyworld]。","在這個世界裡有著不同的種族，彼此之間互相競爭，並且有著各自的文化特色。","在大部分世界的創世史裡，[人類 | type:ethnicity | pic:humanrace]都是最年輕的常見種族，姍姍來遲兼且比矮人、精靈、巨龍都要短壽。","也許是因為他們的有限歲月，他們會盡力燃燒僅存的有限年日。","又或者也許他們覺得需要證明自己給宗祖種族看，為此用搶掠和貿易建立強大的王國。不論是甚麼原因，人類是眾世界的革新者、登峰者、先驅者。","[精靈 | type:ethnicity | pic:elfrace]是帶超凡氣質的魔法民族，活在世上但又不完全屬世。他們居於飄逸之地，在古代森林之中或在閃耀妖火的銀色尖塔之中，柔和音樂乘風而轉，輕柔芳香隨風飄盪。","精靈喜歡自然與魔法、美術與藝術、詩詞與歌賦、及世上一切美好之事。","[半精靈 | type:ethnicity | pic:halfelfrace]行走在兩個世界的交界之處，但無論在那一邊都無法找到自己真正的歸宿。","有人說半精靈身上集中了人類和精靈兩族的優點：從精靈處繼承來的的敏銳感覺、藝術修養和熱愛自然的天性，調和了人類血統中的的好奇心、創造力和野心。","有些半精靈與人類一起生活，卻因為情感和體質上的差別而和人類產生隔閡，雖然青春依舊但卻不得不看著自己的朋友與戀人逐漸老去；","其他半精靈則是在精靈社會中生活，他們在永恆不變的精靈國度中成長著，愈發感到不安，因為他們逐漸長大成人，可是與他們同時出生的精靈孩童卻依然還是孩子。","[半獸人 | type:ethnicity | pic:orcrace]將因為戰斗而獲得的傷痕作為自豪和裝飾自身勇武的完美飾物。","而其他的疤痕，標記著獸人或者半獸人曾經身為奴隸或是羞恥的被放逐者。","生活在獸人之中的半獸人所擁有的傷痕，無論是標志著榮耀或是恥辱，都記敘著他們曾經的英勇事跡和受到的傷害。","生活在人類社會中的半獸人，則可能會自豪地將自己的傷痕展示出來，或者羞愧地隱藏起來。","[半身人 | type:ethnicity | pic:halfingrace]友善樂天。他們享受親情和友情，也享受溫暖的家，很少幻想飛黃騰達。","即使是他們當中的冒險者也主要是為了同鄉、朋友、遊歷、或好奇心而闖盪世界。他們熱愛發掘新事物，即使是簡單的小事，例如一度異國食品或者一套未曾遇見過的衣著。","半身人有強烈的同情心，受不住看見他人受苦。他們很慷慨，即使是艱難的時候也願意分甘同味。","[地侏 | type:ethnicity | pic:gnomerace]的生活熱情和精力滲透著他那細小身體的每一寸地方。地侏的平均身高略高於3英尺，重約40~45磅。","他們棕黃或褐色的臉龐通常掛著大大的笑臉（在他們巨大的鼻子下面），而他們明亮的眼睛閃爍著興奮的光芒。","他們美麗的頭發趨向於各個方向伸展，像是表達地侏那種對周圍事物永不知足的興趣似的。","地侏具有顯而易見的外表特征。相對於男性地侏自然生長的頭發來說，他們的胡子被仔細打理著，不過卻會經常變換風格，如剪成奇怪的分叉或是整齊的尖端。","地侏的服裝，盡管經常做成溫和的泥土色調，但卻精心的裝飾著刺繡、壓花或是閃亮的珠寶。","[矮人 | type:ethnicity | pic:dwarfrace]勇敢頑強，矮人以熟練的戰士、礦工、石匠鐵匠而聞名。雖然身高不過 5 尺，矮人很壯碩，致使他們可以跟比自已高 2 尺的人類一樣重。","他們的勇氣和耐力也輕易比得上任何比矮人高的人。","矮人的膚色由深啡到白裡透紅，最常見是淺啡或深古銅，跟某些泥土一樣。","他們留簡約的長髮，髮色一般為黑、灰、啡，但白膚的矮人可能有紅色的毛髮。","男性矮人極之重視自己的鬍子，會細心梳理它。","歡迎來到這個充滿戰鬥、奇幻、冒險、怪奇的世界。(你可以[選擇 | type:ethnicity | behavior:choice | response:chooseEthnicity]其中一個種族來進行冒險。)"],chance:1,behavior:{choice:{chooseEthnicity:"你作為一名[_ | type:ethnicity]來到這個世界，你會發現這個世界充滿了各種戰鬥、奇幻、冒險、怪奇的元素。"},response:{chooseEthnicity:["[人類 | type:ethnicity | response:human1]的屬性值為力量+1; 敏捷+1; 體質+1; 智力+1; 睿知+1; 魅力+1。","[精靈 | type:ethnicity | response:elf1]的屬性值為敏捷+2; 體質+1。","[半精靈 | type:ethnicity | response:halfElf1]的屬性值為魅力+2; 選擇任意其他二項+1。","[半獸人 | type:ethnicity | response:halfOrc1]的屬性值為力量+2; 體質+1。","[半身人 | type:ethnicity | response:halfing1]的屬性值為 敏捷+2; 體質+1。","[地侏 | type:ethnicity | response:gnome1]的屬性值為體質+1; 智力+2。","[矮人 | type:ethnicity | response:dwarf1]的屬性值為體質+2; 睿知+1。",""],human1:this.ethnicityHumanIntro1,elf1:this.ethnicityElfIntro1,halfElf1:this.ethnicityHalfElfIntro1,orc1:this.ethnicityOrcIntro1,halfOrc1:this.ethnicityHalfOrcIntro1,halfing1:this.ethnicityHalfingIntro1,gnome1:this.ethnicityGnomeIntro1,dwarf1:this.ethnicityDwarfIntro1}}},ability:{descriptions:["在這個世界裡，你必須要面對一個充滿挑戰的世界，並且要展現你的才能。","因此你需要為角色添加符合你需求的能力，才能夠在這個世界中盡情地冒險。","其中能力的基礎是：","[力量 | type:ability | coping:strength]，力量代表肌肉力量、運動訓練及所能發揮的肉體潛能。","[敏捷 | type:ability | coping:dexterity]，敏捷檢定可以對應進行靈巧、迅速、安靜的移動，或在不穩定的地方保持平衡。","體操、巧手、隱匿等技能分別反映了某幾類敏捷檢定可以表示的能力。","[智力 | type:ability | coping:intelligence]，智力代表思維能力、記憶能力、邏輯能力。","[睿知 | type:ability | coping:wisdom]，睿知代表你與周圍環境的協和度，反映你的觀察力和洞察力。","[魅力 | type:ability | coping:charisma]，魅力量化了你跟他人有效地交流的能力。","它代表了信心、口才，也能代表迷人或有凝聚力的個性。","[韌性 | type:ability | coping:resilience]，韌性代表身心的抗壓能力，以及對抗外在變化的能力。","建立角色的屬性表，你可以決定依序決定這些能力值的[分配 | type:ability | behavior:choice | response:setAbility]："],chance:1,behavior:{choice:{setAbility:"[_ | type:ability]分配15點、[_ | type:ability]分配14點、[_ | type:ability]分配13點、[_ | type:ability]分配12點、[_ | type:ability]分配10點、[_ | type:ability]分配8點。"}}},classFeature:{descriptions:["你選擇一個職業來進行冒險，並且展現你的才能。","你將會在這個世界中展現你的才能，並且與其他角色一起共同冒險。","你可以選擇以下職業：","[戰士 | type:classFeature | coping:warrior]，戰士擁有強大的力量，並且擅長使用武器。","[法師 | type:classFeature | coping:wizard]，法師擁有超過一般人所能想像的能力，並且擅長使用魔法。","[牧師 | type:classFeature | coping:cleric]，僧侶擁有超過一般人所能想像的智慧，並且擅長使用神祕法術。","[盜賊 | type:classFeature | coping:rogue]，盜賊擁有強大的力量，並且擅長使用手槍、槍枝、或其他武器。","[德魯依 | type:classFeature | coping:druidic]，德魯依擁有超過一般人所能想像的力量，並且擅長使用弓箭、槍枝、或其他武器。","[武僧 | type:classFeature | coping:monk]，武僧擁有強大的力量，並且擅長使用武器。","[吟遊詩人 | type:classFeature | coping:bard]，吟遊詩人擁有超過一般人所能想像的智慧，並且擅長使用歌劇。","[契術師 | type:classFeature | coping:warlock]，契術師擁有超過一般人所能想像的力量，並且擅長使用魔法。","[聖騎士 | type:classFeature | coping:paladin]，聖騎士擁有超過一般人所能想像的力量，並且擅長使用武器。","[術士 | type:classFeature | coping:sorcerer]，術士擁有強大的力量，並且擅長使用武器。","[遊俠 | type:classFeature | coping:ranger]，遊俠擁有超過一般人所能想像的力量，並且擅長使用弓箭、槍枝、或其他武器。","[野蠻人 | type:classFeature | coping:barbarian]，野蠻人擁有強大的力量，並且擅長使用手槍、槍枝、或其他武器。","(你可以[選擇 | type:classFeature | behavior:choice | response:chooseClass]其中一個職業來進行冒險。)"],chance:1,behavior:{choice:{chooseClass:"你決定成為一名[_ | type:classFeature]，在這個世界進行冒險。",chooseArmor:"你選擇了[_ | type:armor]作為初始的獲甲。",chooseWeapon:"你選擇了[_ | type:weapon]作為初始的武器。",fightingStyle:"。"},response:{chooseClass:["[戰士 | type:classFeature | response:warrior1]，戰士擁有強大的力量，並且擅長使用武器。","[法師 | type:classFeature | response:wizard]，法師擁有超過一般人所能想像的能力，並且擅長使用魔法。","[牧師 | type:classFeature | response:cleric]，牧師擁有超過一般人所能想像的智慧，並且擅長使用禪修。","[盜賊 | type:classFeature | response:rogue]，盜賊擁有強大的力量，並且擅長使用手槍、槍枝、或其他武器。","[德魯依 | type:classFeature | coping:druidic]，德魯依擁有超過一般人所能想像的力量，並且擅長使用弓箭、槍枝、或其他武器。","[武僧 | type:classFeature | coping:monk]，武僧擁有強大的力量，並且擅長使用武器。","[吟遊詩人 | type:classFeature | coping:bard]，吟遊詩人擁有超過一般人所能想像的智慧，並且擅長使用歌劇。","[契術師 | type:classFeature | coping:warlock]，契術師擁有超過一般人所能想像的力量，並且擅長使用魔法。","[聖騎士 | type:classFeature | coping:paladin]，聖騎士擁有超過一般人所能想像的力量，並且擅長使用武器。","[術士 | type:classFeature | coping:sorcerer]，術士擁有強大的力量，並且擅長使用武器。","[遊俠 | type:classFeature | coping:ranger]，遊俠擁有超過一般人所能想像的力量，並且擅長使用弓箭、槍枝、或其他武器。","[野蠻人 | type:classFeature | coping:barbarian]，野蠻人擁有強大的力量，並且擅長使用手槍、槍枝、或其他武器。"],chooseArmor:["你獲得[鎖子甲 | type:armor | action:collect | coping:chainmail | response:warrior2]，鎖子甲可以抵禦敵人的攻擊，並且可以防止傷害。","你獲得[皮甲 | type:armor | action:collect | coping:rawhide | response:warrior2]，皮甲除了抵禦攻擊，也能保持你的靈活度。"],chooseWeapon:["你獲得一把[長劍 | type:weapon | action:collect | coping:longswood | response:finish](1d8)。"],warrior1:["作為戰士你可以從基本裝備中獲得一件[鎖子甲 | type:armor](AC16)，或是一件[皮甲 | type:armor](AC14+敏捷調整值或2)。","(你的[選擇 | type:armor | behavior:choice | response:chooseArmor]是什麼呢？)"],warrior2:["可以再選擇一把[長劍 | type:weapon](1d8傷害)","(你的[選擇 | type:weapon | behavior:choice | response:chooseWeapon]是什麼呢？)"],finish:["恭喜你已完成了初步的創角，其他細節的設定可以在冒險的過程中繼續完成。"]}}}},this.quests={kuai_kuai_cat1:{descriptions:["一如往常的星期一，你經過了快快貓貨運公司的正門口。","拐個彎繞進旁邊的小巷，那才是你要進入的後門工作區。","與櫃檯的艾萊尼小姐接洽今天的工作，在集合的過程中艾萊尼小姐請你稍待一會兒。"],options:["今天的[主要任務 | link:kuai_kuai_cat1]是陪同溫德先生將木雕送到卡布拉。"],location:{name:"kuikuicompany-000:00",bg:"mytwon",connect:["carriage-000:00(180,20)"]}}},this.dramas={"kuikuicompany-000:00":{name:"快快貓貨運公司",descriptions:["「路上小心，溫德先生~」艾萊尼小姐的在[快快貓 | pic:kuikuicat]的櫃台向你們揮著手。","你們今天要陪同溫德先生將木雕送到卡布拉。"],chance:0,options:["[知道了 | behavior:end]"]},dagger:{descriptions:["一間匕首店，可以購買[匕首 | type:commodity | coping:dagger]。]"],options:["離開店舖"]},kuai_kuai_cat1:{descriptions:["你進入了[快快貓 | type:thing | pic:kuikuicat]貨運公司的後門工作區。","「各位親愛的工作夥伴，早安。我知道今天是星期一，但也請不要看起來如此的軟爛嘛~","跟大家說個好消息，最近我們的生意挺好的，所以你們今天要陪同溫德先生將旁邊那批木雕都送到隔壁的城鎮卡布拉。","你們也知道路上頂多有些[綠皮小鬼 | type:monster]，除此之外就沒什麼值得注意了。","好啦~快點幫溫德先生把貨物搬上驢車吧，不然老闆可能要找理由扣錢囉~」","溫德先生此時從門外進入室內，請你也幫忙搬運這些箱子。這些[木箱 | type:thing]的[蓋子 | type:thing]都用[釘子 | type:thing]封好了。"],chance:3,options:["「快點[搬箱子 | response:dii32]上車吧。」溫德先生催促著。"],behavior:{coping:{observation:[[1,"你仔細觀察了[_ | type:thing | behavior:coping | coping:observation]。","action to target","observation1"],[13,"你仔細觀察了[_ | type:thing | behavior:coping | coping:observation]。","action to target","observation2"]],nature:[[1,"你看著[_ | type:thing | behavior:coping | coping:nature]的材質，思考著。","action to target","nature1"],[13,"你看著[_ | type:thing | behavior:coping | coping:nature]的材質，思考著。","action to target","nature2"]],experience:[[1,"你對[_ | type:thing | behavior:coping | coping:experience]有些印象…","action to target","thing1"],[12,"你對[_ | type:thing | behavior:coping | coping:experience]有些印象…","action to target","thing12"],[1,"你記得綠皮小鬼是…","response","goblin13"]],dexterity:[[1,"你對鬆掉的釘子有些想法，便動手拆開來看看。","response","haha"],[12,"你趁沒人注意時，拆開一個木箱來看看。","response","hagws82"]],knowledge:[[1,"你想知道有關綠皮小鬼的知識。","response","goblin13"]]},response:{observation1:["[快快貓 | type:thing]的櫃台小姐是非常的可愛。","[木箱 | type:thing]跟平常送貨的木箱略有不同，這批箱子是新的。","[蓋子 | type:thing]用釘子釘死，裡面的東西被保護得很好。","[釘子 | type:thing]十分嶄新，沒有一絲鐵銹。","可惜[木雕 | type:thing]被封回箱子了，你沒辦法觀察。"],observation2:["[快快貓 | type:thing]的建立多年，內裝已有些老舊，幾名冒險者也會前來接護送貨物的工作。","[木箱 | type:thing]跟平常送貨的木箱略有不同，這批箱子是新的。","[蓋子 | type:thing]用釘子釘死，從打造到封箱的方式來看應該是品質不錯的箱子，裡面的東西被保護得很好。","有些木箱的[釘子 | type:thing]也不是那麼牢靠地釘住，有些地方還有黏著的痕跡。","可惜[木雕 | type:thing]被封回箱子了，你沒辦法觀察。"],nature1:["[木箱 | type:thing]跟平常送貨的木箱略有不同，這批箱子是新的。","[蓋子 | type:thing]用釘子釘死，從打造到封箱的方式來看應該是品質不錯的箱子，裡面的東西被保護得很好。","有些木箱的[釘子 | type:thing]也不是那麼牢靠地釘住，有些地方還有黏著的痕跡。","你看見[木雕 | type:thing]時有注意到它的材質是用紅木雕成的。"],nature2:["[木箱 | type:thing]跟平常送貨的木箱略有不同，這批箱子是新的。","[蓋子 | type:thing]用釘子釘死，從打造到封箱的方式來看應該是品質不錯的箱子，裡面的東西被保護得很好。","有些木箱的[釘子 | type:thing]也不是那麼牢靠地釘住，有些地方還有黏著的痕跡。","你看見[木雕 | type:thing]時有注意到上面留有施法過的魔法粉末。"],thing1:["[快快貓 | type:thing]的設立已有多年，且有其他同名品牌的貨運公司，像是快快狗等。","[木箱 | type:thing]的品質跟平常裝貨用的木箱略有不同。","[蓋子 | type:thing]沒什麼特別的。","平常送貨時很少用上[釘子 | type:thing]封死箱子的。","你對[木雕 | type:thing]上的造型有點印象，曾經在其他鎮子看過。"],thing12:["[快快貓 | type:thing]的設立已有許多年，除了快快貓、快快狗，在沙漠中還有快快鴨，北方寒土山丘還有快快獅。","[木箱 | type:thing]跟平常裝貨用的木箱略有不同，這批箱子是新的。而且尺寸和公司原本的大小不同，很明顯是來自其他地方的貨物。","[蓋子 | type:thing]沒什麼特別的，但木箱本身從打造到封箱的方式來看，都用上有品質的處理來保護裡面的東西。","平常送貨時很少用上[釘子 | type:thing]封死箱子，但這批箱子似乎才剛打上釘子，釘子還散發著油光，與以往的銹跡斑斑不同。","你對[木雕 | type:thing]的造型與花紋有印象，那是一種召喚魔物時使用的道具，要小心對待。"],dii32:["搬完東西後，[去找溫德 | behavior:end]先生，就能搭上他的驢車準備出發這趟護送任務了。","「這把[長劍 | type:weapon | action:collect | coping:longswood]是公用的，看你好像沒準備長劍，先借給你使用吧。」艾萊尼小姐對你說。"],haha:["「嘿！那可是重要的貨物，你動手拆開可是要被老闆扣錢的啊！」溫德先生發現你正在拆著木箱便朝你喊道。","溫德先生對你的行為鬼祟感到在意。"],hagws82:["你看到裡面裝著一個平凡的[木雕 | type:thing]。","「嘿，釘子怎麼是鬆掉的？」溫德先生指著你拆過的木箱問道，便吩咐艾萊尼小姐拿來鎚子補釘。","似乎沒注意到就是你打開箱子的。"],goblin1:["哥布林，俗稱綠皮小鬼，是典型的中立邪惡，它們只在乎它們自己的需要，在黑暗或昏暗情況下有超人的視覺。。"],goblin13:["當綠皮小鬼(哥布林)對比它大型的生物使用攻擊或魔法，並造成傷害時，可以對其造成額外傷害。","綠皮小鬼可在自己的回合，以一個附贈動作進行撤離或躲藏。"],goblin01:["綠皮小鬼…哥布林？是綠皮的小型怪物嘛…是個邪惡的威脅。"]}}},"carriage-000:00":{name:"溫德與驢車",descriptions:["裝完貨物後溫德先生感謝大家的幫忙並準備出發。","這個時間可以準備好裝備並穿戴，而驢車大約需要花費四個小時才會抵達卡布拉。","驢車裝載大量的木雕，最多只能再乘載兩位中等體型的人型生物。","「那麼，都準備好我們就出發了！快上車吧~」溫德先生朝你喊道，他已經坐上馬車等待了。"],chance:0,options:["快點[上車 | link:adf6322]吧！。"]},adf6322:{descriptions:["在前往卡布拉的小徑上，可能是因為天氣炎熱，路上沒有太多的旅人或商隊。","驢車在路上緩慢地行駛，路上沒有太多的風，斗大的汗水不斷從驢子的身上流出，溫德先生看起來也十分煩燥。","當行進到一半的路途，較為偏僻但林木較為茂密的小路，你們穿進一座蔭涼的[樹林 | type:thing | pic:forestpath]中。","而小路上有一團褐灰色的東西，像個小丘一般，並從一側垂著毫無氣息的驢頭，令你們立刻注意到前方有一頭死掉的[驢子 | type:thing]擋在道路中央。"],chance:3,options:["「這樣可過不去，必須要有人[搬開死驢子 | response:underattack]清空道路。」溫德先生對你說。"],behavior:{coping:{observation:[[1,"你看向[_ | type:thing | behavior:coping | coping:observation]。","action to target","observation1"],[12,"你看向[_ | type:thing | behavior:coping | coping:observation]。","action to target","observation2"]],awareness:[[1,"空氣中只有淡淡的腐敗氣味，在這種炎熱的天氣下，驢子的死亡時間大約在兩小時內。","describe"],[12,"當你環顧四周時，似乎感覺驢子的體內有什麼蠕動著。","describe"],[18,"你幾乎能肯定有什麼東西正躲在驢子裡，像是在埋伏準備偷襲！","describe"],[18,"你瞬間警戒起來！","response","combat2"],[12,"但也許可能只是眼花...","response","look"]],explore:[[1,"你走向驢子屍體以調查死因。","response","underattack"]]},response:{combat:["你退了兩步，準備好[迎戰 | action:combat | coping:goblinLv1 | response:edhsd319]。"],combat2:["「我注意到你們了，出來吧！」你大喊著。","兩邊的林間走出數隻哥布林，對你發起[戰鬥 | action:combat | coping:goblinLv1 | response:edhsd319]。"],underattack:["你靠近驢子並蹲下身子察看，同時驢子的肚子突然破開，從裡面跳出一隻哥布林朝你一斧劈來。","(進行DC15[敏捷檢定 | dc:15-dexterity | success:combat | failure:damage5], 失敗則受到5點傷害)"],damage5:["因為閃躲不及，你受到[5點傷害 | action:damage | value:5 | response:combat]。"],observation1:["死去的[驢子 | type:thing]看起來骨瘦嶙峋，但肚子有些腫大。","你看著茂密的樹林，心想幸好因為有這片[樹林 | type:thing]，此時你感覺到悶熱一下涼爽了不少。"],observation2:["死去的[驢子 | type:thing]看起來骨瘦嶙峋，也許活著的時候就受到不少虐待，但肚子卻有些異常的腫大。","[樹林 | type:thing]隨風晃動著，但你感覺似乎有綠皮的人影[隱藏 | response:combat2]在林木之後…"],look:["你仍然盯著驢子，小心翼翼地認為自己需要再觀察一下。"],edhsd319:["戰鬥結束後，你和溫德先生便繼續[前行 | link:oepq94722]。"]}}},oepq94722:{descriptions:["在炎熱的陽光下，你們慢慢搭乘著驢車穿過一條條馬路。","驢車終於抵達了[卡布拉 | pic:cabula]，","卡布拉是一座繁華的城市，也是快快貓貨運公司的主要貨運地點。","你來過許多次，大都是為了送貨，有時也會為了購買東西而來。","溫德先生駕駛著驢車來到倉庫區，並且請你幫忙搬貨物至倉庫內。","而收件人[蘇珊 | pic:storehouse2]正在裡面等待著。","完成簽收後，於門外聽到蘇珊正在清點著貨物，溫德先生整理好驢車的貨斗後也準備返回快快貓貨運公司。","「你要搭順風車回公司領今天的薪水，還是先留在卡布拉辦完事再回去？」溫德先生問著。"],chance:3,options:["你[上車 | response:backhome]後，與溫德先生一起向蘇珊打聲招呼道別。","你打算[逗留 | response:stay]在卡布拉一會兒，於是向溫德致謝後向他道別。"],behavior:{response:{backhome:["「祝你們一路順風，聽說最近綠皮小鬼常常在半路打劫，你們在路上要[小心 | dc:8-wisdom | success:someone | failure:homesweethome]一點呀。」","蘇珊一臉認真地對你們說。"],stay:["在你看溫德先生的驢車走遠後，『碰』地一聲倉庫的大門似乎被人惡狠狠地關上。","隨即傳來蘇珊的呼救聲，以及另一個男人的威嚇。悄悄[聽對話 | link:ifow1395]的內容似乎是有個盜賊想打劫倉庫。"],homesweethome:["你心想已經碰到過了，但也懶得跟她吐嘈。四小時的車程回到公司後，領了薪水便回家了。[(END) | behavior:end]"],someone:["正當你們和蘇珊說話時，身為冒險者的你感覺倉庫的更深處有[人影晃動 | link:bwpfj2941]。"]}}},ifow1395:{descriptions:["「誰來救救我，你別過來~」蘇珊在裡頭哭喊著。","「閉嘴！妳最好乖乖把鑰匙交出來，妳不用受傷，我也可以拿完需要的東西就走！」"],chance:0,options:["無助的蘇珊需要你的幫助，於是你決定[伸出援手 | response:helpher]。","也許蘇珊能聽他的話乖乖交出鑰匙就沒事，你還是[別多管閒事 | response:leavehere]了。"],behavior:{response:{helpher:["你思索著如何進入倉庫的[方法 | link:dibow824]。"],leavehere:["於是你決定忘了這件事，只要蘇珊交出鑰匙就是雙贏局面，根本無須你的插手。","你漫走走向卡布拉的繁華之處，準備好好享受這個城鎮的美景。[(END) | behavior:end]"]}}},dibow824:{descriptions:["倉庫[大門 | type:thing]被鎖上且十分牢固，但據你所知這不是唯一的出入口。","如果有時間的話，也許應該探索一下倉位的建築結構再決定下一步。","但蘇珊的哭喊聲也不時傳入你的耳中。"],chance:5,options:["救人心切的你決定直接[破門而入 | response:dgrdb48]。"],behavior:{coping:{explore:[[1,"你探索周遭，發現[後門 | type:thing | behavior:coping | coping:explore]也被鎖上了。","describe"],[4,"除此之外的[窗戶 | type:thing | behavior:coping | coping:explore]也被鎖上，你沒有辦法直接進入。","describe"]],dexterity:[[1,"你試著嘗試解開[_ | type:thing | behavior:coping | coping:dexterity]的鎖。","action to target","unlockfail"],[13,"你試著嘗試解開[_ | type:thing | behavior:coping | coping:dexterity]的鎖。","action to target","unlickbackdoor"]]},response:{unlockfail:["[後門 | type:thing]的鎖明明看起來不是那麼難解，但卻難倒了你。","[大門 | type:thing]的鎖複雜到讓你感到頭疼。","[窗戶 | type:thing]設有防盜的裝置，你碰觸窗戶導致觸發[陷阱 | response:trap]。"],unlickbackdoor:["你成功解開[後門 | type:thing]的鎖，並且看見一名[盜賊 | response:fistfight]正拿著匕首威脅著蘇珊。","[大門 | type:thing]的鎖過於複雜，你試了許久仍未成功。","[窗戶 | type:thing]設有防盜的裝置，即使你小心翼翼地避開但仍觸發了[陷阱 | response:trap]。"],unlickdoor:["你成功解開[後門 | type:thing]的鎖，並且看見一名[盜賊 | response:fistfight]正拿著匕首威脅著蘇珊。","你成功解開[大門 | type:thing]的鎖，並且看見一名[盜賊 | response:fistfight]正拿著匕首威脅著蘇珊。","你成功解開[窗戶 | type:thing]的鎖，並且看見一名[盜賊 | response:fistfight]正拿著匕首威脅著蘇珊。"],damage5:["因為閃躲不及，陷阱令你受到[5點傷害 | action:damage | value:5 | response:fistfight]。"],trap:["(進行DC15[敏捷檢定 | dc:15-dexterity | success:fistfight | failure:damage5], 失敗則受到5點傷害)"],fistfight:["那名盜賊看見你闖了進來，將[戰鬥 | action:combat | coping:thiefLv1 | response:secondfight]的目標轉向了你。"],dgrdb48:["你試著使用蠻力破開倉庫大門。(進行DC16[力量檢定 | dc:16-strength | success:brokendoor | failure:brokenfailure]，失敗時受到輕微的反彈傷害)"],brokendoor:["你蓄力用身子一撞，巨大的倉庫門被你轟地一聲[撞開 | link:dgrdb48]。"],brokenfailure:["作為保護重要財物的倉庫，大門十分堅固。","你奮力地想破開大門，不但沒有成功，反而還讓自己受傷了。(受到1點[傷害 | action:damage | value:1])","但大門卻還是在半秒後傾斜歪曲，你仍然可以[破門 | link:dgrdb48]而入。"],secondfight:["這個盜賊被你打倒後，伸手探入身旁因為戰鬥而波及的破木箱，並拿出木雕並[唸唸有詞 | link:bispe1335]著。"]}}},dgrdb48:{descriptions:["破門而入的你讓蘇珊與那名盜賊都大吃一驚。","「那個…大門的修理費要賠哦…」蘇珊小姐似乎忘記害怕了。","而那名盜賊瞪大雙眼並張大嘴驚慌地看著你。"],chance:3,options:["那名盜賊很快就回神，並將武器上手，[準備戰鬥 | response:fistfight]。"],behavior:{response:{fistfight:["同時，你也做好準備與他[戰鬥 | action:combat | coping:thiefLv1 | response:secondfight]。"],secondfight:["這個盜賊被你打倒後，伸手探入身旁因為戰鬥而波及的破木箱，並拿出木雕並[唸唸有詞 | link:bispe1335]著。"]}}},bwpfj2941:{descriptions:["「蘇珊小姐，今天不是妳一個人嗎？」","「今天只有我值班，你想幹嘛？」"],chance:3,options:["你[提醒 | response:someone]蘇珊，倉庫裡面似乎有其他人。"],behavior:{response:{someone:["蘇珊此時一臉緊張，立刻回頭張望，並大驚失色：","「你是誰？為什麼躲在屋樑上？你不要過來，救命呀！」蘇珊大喊並丟下手上的東西，立刻朝你求救。","「真是多管閒事的伙傢啊…」一個賊頭鼠腦的傢伙突然從暗處現身，並朝蘇珊走去，似乎要挾持她。","你讓溫德先生先走，自己留下來保護蘇珊而衝上前[迎戰 | action:combat | coping:thiefLv1 | response:secondfight]。"],secondfight:["這個盜賊被你打倒後，伸手探入身旁因為戰鬥而波及的破木箱，並拿出木雕並[唸唸有詞 | link:bispe1335]著。"]}}},bispe1335:{descriptions:["「可…可惡…我怎麼能就此落敗…明明是這麼容易的工作啊！」","你看見落敗的盜賊，拿起一旁的木雕唸起咒語。","「這個…難道是召喚火魔蝠的木雕像嗎？」","蘇珊驚訝地看著一團火柱從融化的木雕像之中升起，召喚的盜賊此時卻哀嚎著，他被火焰包圍後不一會就再無聲息…","而一隻火魔蝠從逐漸消散的火柱中間成形，散發著如融岩般的暗紅紋路。","牠注意到距離最近的你，並衝鋒過來！"],chance:3,options:["你[閃避 | dc:12-dexterity | success:dogesuccess | failure:dogefail]著如迅雷一般的攻擊。"],behavior:{response:{dogesuccess:["你及時閃避了攻擊，但火魔蝠在空中盤旋一陣子後，很快地再次鎖定你為目標，但你早已準備好[再次迎戰 | action:combat | coping:firebatLv1 | response:finalfight]。"],dogefail:["你閃避不及，對你造成了3點[傷害 | action:damage | value:3]。","逼得你不得不[再次迎戰 | action:combat | coping:firebatLv1 | response:finalfight]。"],finalfight:["你成功消滅了火蝙輻，獲得了[獎勵 | link:biuwpa73]。"]}}},biuwpa73:{descriptions:["蘇珊十分感謝你擊退了這次的襲擊，並且向公會提出追加的獎勵給你。"],chance:3,options:["對這額外的獎勵，你開心地[領取 | response:finish]1枚金幣。"],behavior:{response:{finish:["開心地結束了。[(END) | behavior:end]"]}}},hdse11589:{descriptions:["當夕陽的餘暉逐漸縮小，直至沒入地平線下，天空也從滿天的紅霞漸漸被上滿是星光的暗藍色薄幕。","一隻枯瘦墨黑的手破開黃砂緩緩伸出，隨之掩藏在砂土下的深黑色身軀爬起。","隨著砂子的滑落，如同枯枝般的[黑死屍 | type:monster]，一下就發現你的位置。","彷彿是刻意潛伏在地下等待身為獵物的你。","但你明白，那是白天時砂漠的炎熱，才讓枯乾的黑死屍動彈不得，這種時候如果能趁機解決它們就省事多了。","漸漸地，一具具從砂土中爬出的黑死屍也越來越多。","很顯然，安穩地躲在塔城裡的人們，根本不在乎外頭聚集多少黑死屍。","黑死屍們一個個轉身向你緩步走來，體力用盡就快虛脫的你只能咬牙拖著腳步離開。","「喂！這還能再用個幾發火球，之後再好好地感謝我吧！」","[貴婦 | type:npc]的聲音從上面傳來，你抬頭看著她扔下一個[袋子 | type:thing]，落在屍群的後方。","「這用來對付黑死屍，也實在是太浪費了…」","一旁的[守衛 | type:npc]抱怨著，即使在三層樓高，他的婉惜仍然傳入你的耳裡。","(你瞧了一眼掉落在附近的袋子)"],chance:3,options:["面對黑死屍的來襲，手足無措的你在本能的驅動下而[逃跑 | response:ddac112]了。"],behavior:{coping:{observation:[[1,"[逃跑]吧！不斷有更多的黑死屍緩緩地爬起，思緒混亂的你心裡這麼想著。(生存技能)","describe"],[5,"但你感覺袋子中的東西能幫助你應付眼前的情況。只要有機會能[推開]眼前那具黑死屍，便能很輕易地拾取袋子。(推撞技能)","describe"]],intimidation:[[1,"「給我滾開！」你威嚇著[_ | type:monster]。","action to target","abc123"],[20,"你做出浮誇的攻擊姿勢想嚇退[_ | type:monster]","action to target","abb223"],[5,"「快讓我進城！否則我就把戒指扔了！」你對[_ | type:npc]吼著。","action to target","bbd11"]],survival:[[1,"轉身就直接逃離屍群。","response","dii32"],[12,"在逃走前注意著屍群的動向。","response","abnopd31"]],shove:[[1,"[推撞]不顧一切地用盡全力推撞眼前的黑死屍","response","diwen1290"],[12,"[絆摔]你掌握敵人的重心後發力推倒它。","response","bnidk3623"]]},response:{combat:["你失敗了，因而被迫[戰鬥 | action:combat | coping:monster | response:edh03sd9]"],abc123:["[_ | type:monster]並沒有停下腳步, 仍然朝你走來。"],abb223:["眼前的[_ | type:monster]安靜下來並凝視著你一會兒，但還是繼續朝你走來。"],bbd11:["但是你的威脅沒有得到[_ | type:npc]的回應。等你注意到時，塔城上早已沒有任何人影。"],dii32:["你慌亂地逃跑，但讓更多的黑死屍注意到你。","有如無頭蒼蠅一般不斷地在尋找安全的地點，但屍群們卻沒有放棄跟著你。","無數個枯瘦的黑影開始追了上來，因為氣喘噓噓的你幾乎快要累倒了。","你知道如果不想成為它們的一份子，就不能停下腳步。","你試著穩定呼吸讓自己堅持下去。(進行DC13[韌性檢定 | dc:13-resilience | success:igpek532 | failure:combat]，失敗進入戰鬥)"],abnopd31:["你一邊注意著屍群的動向，一邊向後奔跑，直到找到安全的藏匿處。","直到天亮，你才[返回 | link:gkddd1234]塔城。"],igpek532:["你成功地遠離了屍群，直到有個暫時的躲藏之處才停下來休息。","直到天亮，你才[返回 | link:gkddd1234]塔城。"],diwen1290:["你用力推撞黑死屍，卻一時失去準頭跌倒在屍群之中。","你慌亂起身並打算遠離它們。(進行DC15[敏捷檢定 | dc:15-dexterity | success:igpek532 | failure:combat]，失敗進入戰鬥)"],bnidk3623:["你使勁推開擋在眼前的黑死屍，並避開它們的啃咬，快速撿起袋子並遠離原地。","如果炎熱能夠讓黑死屍動彈不得，那火炎就能有效制止它們的行動。","往袋子裡看一眼，你立刻知道袋子裡裝的是火球項鍊。","即使項鍊上只剩3顆珠子。","你可以用一個動作取下一顆珠子並投擲到至多 60 尺遠的地方。它將在移動軌跡的終點爆炸，效果等同於 3 環的火球術。","火球術的有效範圍為20 尺，以爆炸中心球體內的每一名生物都要進行一次敏捷豁免。失敗的生物受到8d6火焰傷害，成功的話受到一半傷害。","這時候只要能好好地將黑死屍聚集起來，也許這個數量真的能夠一次解決。","伴著深沉的嗚響爆出火焰，緩慢的黑死屍根本無法閃避。","「總算全解決了…」","你成功清除了所有的黑死屍，但塔城上並沒有任何歡呼，甚至連對你的作為毫無回應。","再怎麼喊也沒有回應，你只能到附近的安全點休息，就這樣等到天亮。","你直到天亮才[返回塔城 | link:gkddd1234]"],ddac112:["你覺得不值得為了一個袋子裡的東西冒險，轉身便逃離屍群。","耳邊傳來自己的腳步聲，每一步踏在鬆軟的砂土上，都會不斷消耗你的體力，但對那些追著你的屍群來說，卻幾乎沒什麼影響。","無數個枯瘦的黑影開始追了上來，而氣喘噓噓的你卻幾乎要累倒了。","你知道如果不想成為它們的一份子，就不能停下腳步。","你被絆了一下，有一具你沒發現的黑死屍，突然從你的腳下爬出撲上了你。","你必須在屍群追上你之前，[擺脫 | dc:12-dexterity | success:igpek532 | failure:combat]這名阻礙你移動的敵人(進行DC12敏捷檢定，失敗進入戰鬥)。"],edh03sd9:["砸碎這具黑死屍的頭後，你起身繼續逃跑。","你不斷地向前奔跑，但屍群卻越來越多，你越來越難以前進。","你逐漸被追上，只能試著加快速度[擺脫 | dc:8-dexterity | success:igpek532 | failure:combat]它們(進行DC8敏捷檢定，失敗進入戰鬥)。"]}}},gkddd1234:{descriptions:["天亮後，你在塔城下還沒開口，守衛便已拋下一個帶著細繩的小竹簍。","「能讓我進城了嗎？」","你問著，其實只撇了一眼你就已經明白，這樣的細繩絕對不會有歡迎你攀上去的意思。","事實上，你連怎麼進城都不知道。","無論你繞著塔城走了無數次，仍舊沒辦法找到進城的方法。","「把戒指放進竹簍，我們有好消息告訴你。」","從守衛的戲謔的語氣，你覺得會是個壞消息。","「你們還是沒打算讓我進去吧？」","「別這麼說嘛，我們是能讓你進來，但要進來塔城是必須有條件的。」","「你們…明明做了承諾，只要我去找那條狗，就讓我進城的！」","「噢不不不…你說錯了，我們是要你找到那條狗並帶回來，但你不是連根狗毛都沒找到嗎？」","「但是…」","你咬了咬牙。","事實上，你在前一天已經找到婦人她那化為黑死屍的丈夫、還有她叨唸著的家傳寶戒。","因為她不斷抱怨著丈夫拿走家傳的紅寶石戒指去找小三，連她的愛犬都追隨著丈夫與小三而去。","在她的故事裡，她留戀著戒指的價值，以及對狗的愛。你忍受到天氣的炎熱，只為了聽她不斷抱怨著無關緊要的事。","你原以為，沒有找到狗，就算把家傳寶戒帶回來也能交差。","但是並沒有。","而且，你也不能說他們反悔。","「說吧，你們還有什麼條件？」"],chance:0,options:["[確認 | behavior:end]"],behavior:{response:{}}}};this.chapters[0]=[],this.chapters[0]=["滾燙的黑色血液順著你的手臂緩緩流下來，滴落在砂土之前就已經凝結成一小片黑鐵。","你在灼熱的砂漠裡不斷前行，過往同伴的請託讓你無法停下腳步，而心中狂燥的慾望卻又讓你渴求戰鬥。","狂風肆虐的砂丘下，無數被砂土掩埋的漆黑屍骨。砂土隨意地覆蓋著它們，露出像是枯乾木乃伊的外表，卻又泛著金屬質感的黑鐵外殼。","黑死屍，你和你的同伴是這麼稱呼這些早就死了，卻又沒死透的傢伙們。","呢喃的聲音隨著黑死屍的掙扎而不斷傳來，你巴不得停下腳步殺光它們，但使命感讓你持續前行，直到遠離這場災難。","這一場災難的開頭，在一座名為馬里布的大城市裡，是一場飛空艇墜落意外之後。","從墜毀的飛空艇中湧出了無數的黑死屍，它們幾乎殺光所有馬里布的生命，在付出一切後你與你的同伴們僥倖地逃離那座城市。","強大的城防與經驗豐富的冒險者都無法抵抗它們，反抗的結果也只是增加它們的數量。","無人對付過這種像是殭屍，卻無法以神聖魔法驅散的不死生物；亦無人對付過這種外殼比魔偶更加堅硬，卻不存在魔核的殺人機器。","更無人對付過這種只需要透過傷害其他生物，就能夠不斷製造伙伴的怪物。","你們最後只能不斷地從這群怪物的威脅下逃離，不知不覺間變為沒有盡頭的旅程。","「我走不動了啦…」","你頭也不回，無視一路跟隨在你身後的小女孩的請求。","直到她開始哀求著你停下來休息。","「再堅持一下，我們就快到塔城了。」","其實你並不知道塔城究竟還有多遠，但你知道天黑之前你必須找到一個安全的地方。","因為你無法肯定在黑死屍的圍攻之下，這個女孩還能夠再撐過下一個夜晚。"],this.monsters={goblinLv1:{icon:"goblin",ac:12,dex:14,constitution:5,spirit:2,willpower:5},thiefLv1:{icon:"thief",ac:12,dex:16,constitution:8,spirit:2,willpower:5},firebatLv1:{icon:"firebat",ac:15,dex:16,constitution:10,spirit:2,willpower:5},brainLv1:{icon:"wisdom_brain",ac:14,dex:12,constitution:5,spirit:20,willpower:15},ironWarriorLv1:{icon:"iron_warrior",ac:16,dex:8,constitution:25,spirit:10,willpower:15}},this.dungeons={abcd234:{roomType:"Dungeon",icon:"creation2",name:"幽深地城",descriptions:this.chapters[0],connectIn:["def765"],locations:[{position:[2,0],size:[5,5],rooms:[{name:"入口",icon:"creation2",descriptions:["剛進入地下城，充滿了著霉味與腐朽的氣味，令人鼻子不禁癢了起來。"],question:"輸入[三碼數字]的密碼解鎖[密碼鎖]後，順利打開[盒子]後從裡面取出一把精美的<color=#ffcc00>寶石匕首</color>。",cards:[(e={},e[t.Prop]="牆角邊有一個普通的木桶。",e[t.Presage]="木桶似乎有些新的小洞口。",e[t.Clue]="木桶的裡面有一個小小的洞，透過洞望進去可以看到一張寫著[三碼數字]的小紙條。",e[t.Doubt]="木桶的洞似乎被不斷挖開過，也許有些人想從中掏出什麼？",e),(i={},i[t.Prop]="[盒子]用[密碼鎖]上鎖了。",i[t.Presage]="[盒子]有些沉重，裡面裝著什麼。",i[t.Clue]="[盒子]上的鎖，是個三位數的[密碼鎖]。",i[t.Doubt]="[盒子]有個鎖，裡面的東西似乎很重要？",i),(o={},o[t.Prop]="一扇被破壞過的窗戶。",o[t.Presage]="窗戶上的窗簾看起來很破舊。",o[t.Clue]="窗簾似乎被巨大的爪子抓過…",o[t.Doubt]="窗戶的玻璃全被敲破，因此釘上許多木板，也許曾經有人想突破進來？",o)]},{name:"某個房間",icon:"creation2",descriptions:[],question:"有<color=#ffcc00>寶石匕首</color>。",cards:[(n={},n[t.Prop]="牆角邊有一個普通的木桶。",n[t.Presage]="木桶似乎有些新的小洞口。",n[t.Clue]="木桶的裡面有一個小小的洞，透過洞望進去可以看到一張寫著[三碼數字]的小紙條。",n[t.Doubt]="木桶的洞似乎被不斷挖開過，也許有些人想從中掏出什麼？",n)]},{name:"出口",icon:"creation2",descriptions:[],question:"透過寫在[照片]背面的開啟方法，打開[密封罐]後從中掏出一卷<color=#ffcc00>紅印文件</color>。",cards:[(s={},s[t.Prop]="展示櫃內部陳列著各式各樣的收藏品。",s[t.Presage]="當靠近展示櫃時，可以聽到微弱的機械運作聲。",s[t.Clue]="展示櫃的一個[密封罐]的位置發現了被頻繁觸碰或移動的磨損痕跡。",s[t.Doubt]="展示櫃中一件展品標籤與其他似乎略有不同",s),(c={},c[t.Prop]="展示櫃的[密封罐]中裝有一卷羊皮紙。",c[t.Presage]="[密封罐]外觀與它應有的重量還來得輕。",c[t.Clue]="[密封罐]的蓋子有特殊的旋轉機制，需按照特定順序旋轉才能打開。",c[t.Doubt]="罐內的物品看起來與展示櫃中其它展示物毫無關聯。",c),(r={},r[t.Prop]="[文書匣]內部分類細緻，但其中一個隔層異常緊固。",r[t.Presage]="打開[文書匣]時，一股陳年的紙張氣味撲面而來，中間卻夾帶著一絲[新墨水]的氣味。",r[t.Clue]="文書匣中一份文件因[紅色印記]而十分顯眼，但明顯是偽造的，用來掩蓋真實文件的存在。",r[t.Doubt]="[文書匣]中某些文件顯示出被重新放置的痕跡，似乎有人試圖隱藏或更改某些信息。",r),(a={},a[t.Prop]="相框是普通的裝飾品，背板可以拆卸取出[照片]",a[t.Presage]="觀察相框時，可以發現框架的某部分略有色差。",a[t.Clue]="相框中的[照片]的背面寫上如何開啟[密封罐]的方法。",a[t.Doubt]="照片中的人物與房間內其他照片的人物不同",a)]}]}]}}}));i._RF.pop()}}}));

System.register("chunks:///_virtual/StoryDescribeStack.ts",["cc"],(function(){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"da3e1QNrIJI+ZVHoaQZA5i2","StoryDescribeStack",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/TeamMember.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CombatCharacter.ts","./CombatMonster.ts","./EventManager.ts","./Ability.ts","./HitPointsBarComponent.ts","./CombatController.ts"],(function(t){var e,i,n,a,o,r,c,s,l,u,h,m,b,f,p,g,y,d,v,E,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized,o=t.createClass},function(t){r=t.cclegacy,c=t._decorator,s=t.Node,l=t.Label,u=t.Sprite,h=t.randomRangeInt,m=t.resources,b=t.SpriteFrame,f=t.Texture2D,p=t.Component},function(t){g=t.CombatCharacter},function(t){y=t.CombatMonster},function(t){d=t.EventManager},function(t){v=t.Attribute},function(t){E=t.HitPointsBarComponent},function(t){L=t.CombatControllerEvent}],execute:function(){var C,I,k,A,P,B,w,S,H,D,M,z,F,T,q,V,R,x,N,W,j,O,_,Z,Y;r._RF.push({},"20c84cTBANNhLVZZjAVC3YR","TeamMember",void 0);var G=c.ccclass,J=c.property;t("TeamMember",(C=G("TeamMember"),I=J(E),k=J(s),A=J(l),P=J(l),B=J(l),w=J(l),S=J(l),H=J(l),D=J(s),M=J(s),z=J(u),C((q=e((T=function(t){function e(){for(var e,i,o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return i=t.call.apply(t,[this].concat(r))||this,n(i,"hitPointsBar",q,a(i)),n(i,"selectButton",V,a(i)),n(i,"nameLabel",R,a(i)),n(i,"acLabel",x,a(i)),n(i,"atLabel",N,a(i)),n(i,"initiativeLabel",W,a(i)),n(i,"intentLabel",j,a(i)),n(i,"characterInfoLabel",O,a(i)),n(i,"weaponLayout",_,a(i)),n(i,"equipmentLayout",Z,a(i)),n(i,"photo",Y,a(i)),i.combatEntity=void 0,i.movement=void 0,i.teamIndex=void 0,i.initiative=0,i.camp=0,i.weaponProficiencyAbilities=((e={})[v.Strength]=0,e[v.Dexterity]=0,e[v.Intelligence]=0,e[v.Wisdom]=0,e[v.Charisma]=0,e[v.Resilience]=0,e),i}i(e,t);var r=e.prototype;return r.onLoad=function(){},r.joinCombatTeam=function(){this.weaponLayout.active=!1,this.equipmentLayout.active=!1},r.leaveCombatTeam=function(){this.weaponLayout.active=!0,this.equipmentLayout.active=!0},r.characterInitial=function(t){this.movement=[t.movement,t.movement];var e=t.calculateProficienciesBonus(),i=t.calculateCompositeAbilities();console.log("計算所有能力的熟練加值:",e),console.log("計算各能力屬性對應的綜合屬性:",i);var n=t.name;this.combatEntity=new g(n,i,e,t.weaponProficiencies),this.setInfos(n,i),this.selectButton.off("click"),this.selectButton.on("click",this.onSelectCharacterClicked,this),this.camp=0},r.monsterInitial=function(t,e,i){this.combatEntity=new y(t,e,i,1),this.setInfos(t,e),this.selectButton.off("click"),this.selectButton.on("click",this.onSelectMonsterClicked,this),this.camp=1},r.setInfos=function(t,e){this.nameLabel.string=t,this.updateInfo(),this.setPhotoImage(t),this.hitPointsBar.defaultHp=e.constitution},r.updateInfo=function(){this.acLabel.string="AC "+this.combatEntity.ac,this.atLabel[0].string="",this.atLabel[1].string=""},r.rollInitiativeOrder=function(t){this.combatEntity.resetBonuses(),this.initiative=t+h(1,20),this.initiativeLabel.string="先攻:"+this.initiative},r.enableSelect=function(){this.selectButton.active=!0},r.disableSelect=function(){this.selectButton.active=!1},r.setPhotoImage=function(t){var e=this.photo.getComponent(u),i="maps/"+t+"/spriteFrame";m.load(i,b,(function(t,i){t?console.error("Failed to load image: "+t):(e.spriteFrame=i,e.spriteFrame.texture.setFilters(f.Filter.NONE,f.Filter.NONE))}))},r.setWeapon=function(t,e,i){var n;if(void 0===i&&(i=0),null==e)return console.log("清除武器"+t,this.combatEntity),null==(n=this.combatEntity)||n.unequipWeapon(t),void(this.atLabel[t].string="");var a=0;0===t&&this.combatEntity.weaponProficiencies.includes(e.style)&&(a=i),console.log("獲得武器"+t+"熟練加值:",a,"/",i),this.combatEntity.equipWeapon(t,e,a),this.atLabel[t].string=e.damage.dice},r.setArmor=function(t,e){e?this.combatEntity.equipArmor(e):this.combatEntity.unequipArmor(),this.acLabel.string="AC "+this.combatEntity.ac},r.setShield=function(t,e){e?this.combatEntity.equipShield(e):this.combatEntity.unequipShield(),this.acLabel.string="AC "+this.combatEntity.ac},r.startFight=function(){this.initiativeLabel.string="",console.log("開始戰鬥"),this.hitPointsBar.node.active=!1},r.endFight=function(){console.log("結束戰鬥"),this.hitPointsBar.node.active=!0},r.isAdvantage=function(){return this.combatEntity.isAdvantage},r.combatCardsToIntent=function(t){var e=this;console.log("執行卡牌轉意圖combatCards:",t);var i=this.combatEntity.combatIntent;i.clearIntents(),t.forEach((function(t){console.log("combatCard.modifiers length:",t.modifiers.length),t.modifiers.forEach((function(e){i.addIntent(e,t.target)}));var n=t.cost,a=n.type;n.fee;console.log("this.combatEntity.actionPoints:",e.combatEntity.actionPoints),"Reaction"===a&&e.combatEntity.actionPoints[a]>0&&(console.log("反應卡"),i.setReactionIntent(t.modifiers.slice())),"Bonus"===a&&e.combatEntity.actionPoints[a]}))},r.intent=function(){this.combatEntity.intent(this),this.hitPointsBar.tempHp=this.combatEntity.tempHP},r.hit=function(){return this.combatEntity.hit()},r.hits=function(t){return this.combatEntity.isAdvantage=!1,"Advantage"===t?this.combatEntity.advantageHit():"Disadvantage"===t?this.combatEntity.disadvantageHit():[this.hit()]},r.attack=function(t,e){return this.combatEntity.affixEffects.stun>0?(console.log("受到眩暈效果，無法攻擊"),this.combatEntity):(this.combatEntity.attack(t.combatEntity,e),this.combatEntity)},r.resultDamage=function(){return this.intentLabel&&(console.log("this.combatEntity.intentContents:",this.combatEntity.intentContents),this.intentLabel.string=this.combatEntity.intentContents.join("\n")),this.combatEntity.resultDamage()},r.getTempHP=function(){return this.combatEntity.tempHP},r.changeHpBar=function(t){this.hitPointsBar.node.active=!0;var e=t+this.hitPointsBar.tempHp;this.hitPointsBar.tempHp=Math.max(0,e),this.hitPointsBar.changeHp(Math.min(0,e))},r.reaction=function(t){var e=this.combatEntity.reaction();if(console.log(this.combatEntity.name,"反應成功:",e),e){var i=this.combatEntity.counterattack(t.combatEntity);console.log("反擊成功:",i)}var n=this.combatEntity,a=n.dodgeCounterattackDamageValue,o=n.counterattackDamageValue;return this.combatEntity.dodgeCounterattackDamageValue=0,this.combatEntity.counterattackDamageValue=0,{dodgeCounterattackDamageValue:a,counterattackDamageValue:o}},r.showIntent=function(){console.log("顯示意圖");var t=this.combatEntity;0!==t.intentContents.length?(this.intentLabel&&(this.intentLabel.string=t.intentContents.join("\n")),t.intentContents.length=0):this.intentLabel.string=""},r.showCharacterInfo=function(){var t=this,e=this.combatEntity;e&&this.characterInfoLabel&&(this.characterInfoLabel.string="",console.log("character.combatWeapons:",e.combatWeapons),e.combatWeapons.forEach((function(e,i){var n=[];switch(e.properties.forEach((function(t){switch(t){case"Light":n.push("輕型武器小而易用，適合被用於雙武器戰鬥。");break;case"Finesse":n.push("靈巧武器可以選擇在該次攻擊檢定和傷害骰中使用你的力量或敏捷調整值。這兩次擲骰必須使用相同的調整值。");break;case"Thrown":n.push("投擲武器。投擲武器的攻擊力與命中值都較小型生物的攻擊力低。");break;case"Two-Handed":n.push("雙手. 此武器需要雙手使用。這個屬性只關聯於你使用此武器攻擊時，而非單純持握它的時候。");break;case"Reach":n.push("觸及. 當你使用此武器攻擊時，此武器讓你的觸及距離增加5呎。這個屬性也影響你使用觸及武器進行藉機攻擊的觸及距離。");break;case"Heavy":n.push("小型生物在使用重型武器進行攻擊時會承受劣勢。重型武器的尺寸和重量使它對小型生物而言太過龐大而無法有效使用。");break;case"Ammunition":n.push("彈藥. 你只能在擁有該武器射擊所需要的彈藥時，才能使用具有彈藥屬性的武器進行一次遠程攻擊。每次你使用該武器攻擊，你消耗一發彈藥。從箭袋、盒子、或其他容器抽出彈藥被視為該攻擊的一部份。裝填單手武器需要一隻空手。在戰鬥結束後，你可以藉由花費一分鐘的時間搜索戰場，以拿回一半你所消耗掉的彈藥量。");break;case"Loading":n.push("裝填. 由於裝填此武器所需的時間，當你使用動作、附贈動作、或反應以該武器射擊時，無論你原本可以進行幾次攻擊，你都只能用其射出一發彈藥。");break;case"Special":n.push("特殊. 具有特殊屬性的武器有著獨特的規則以處理其使用，詳情請參閱該武器的描述（參見本段落中後述的「特殊武器」）。");break;case"Versatile":n.push("可雙手. 此武器可以被單手或雙手使用。這個屬性後方所顯示括號內的傷害數值，代表著以雙手使用此武器進行一次近戰攻擊時的傷害。")}})),"拳擊"!==e.name&&(t.characterInfoLabel.string+="\n"+e.name+"： "+n.join("\n")),e.damage.type){case"Bludgeoning":t.characterInfoLabel.string+="\n此武器為鈍器攻擊";break;case"Piercing":t.characterInfoLabel.string+="\n此武器為穿刺攻擊";break;case"Slashing":t.characterInfoLabel.string+="\n此武器為揮砍攻擊"}})),e.combatArmor.isCasterArmor?this.characterInfoLabel.string+="\n身著法衣，便於施法。AC 為敏捷加值。":e.combatArmor.isLightArmor?this.characterInfoLabel.string+="\n身著輕甲，可靈活動作。AC 為敏捷加值，但上限為2。":e.combatArmor.armorClass>10&&(this.characterInfoLabel.string+="\n身著重甲，防禦力強，但在需要靈活動作時會直接失敗。"),e.combatArmor.shielded&&(this.characterInfoLabel.string+="\n裝備盾牌可獲的2點AC(Armor Class)。"))},r.move=function(t){return this.movement[0]>=t&&(this.movement[0]-=t,!0)},r.roundOver=function(){this.combatEntity.temporaryArmor=0,this.combatEntity.tempHP=0,this.hitPointsBar.tempHp=0,this.acLabel.string="AC: "+this.combatEntity.ac},r.onSelectCharacterClicked=function(){console.log("選擇角色"),this.disableSelect(),d.instance.emit(L.SelectCharacter,this)},r.onSelectMonsterClicked=function(){console.log("選擇怪物"),this.disableSelect(),d.instance.emit(L.SelectMonster,this)},o(e,[{key:"isDead",get:function(){return this.combatEntity.isDead}}]),e}(p)).prototype,"hitPointsBar",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(T.prototype,"selectButton",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(T.prototype,"nameLabel",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(T.prototype,"acLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(T.prototype,"atLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W=e(T.prototype,"initiativeLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(T.prototype,"intentLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(T.prototype,"characterInfoLabel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(T.prototype,"weaponLayout",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(T.prototype,"equipmentLayout",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(T.prototype,"photo",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=T))||F));r._RF.pop()}}}));

System.register("chunks:///_virtual/TexasGameLogic.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ExplorationCard.ts","./GameEvents.ts","./HandEvaluator.ts","./EventManager.ts","./FillBlanks.ts"],(function(t){var e,n,a,i,s,r,o,c,d,h,u,l,f,m,p,v,_,C,y;return{setters:[function(t){e=t.inheritsLoose,n=t.createForOfIteratorHelperLoose,a=t.asyncToGenerator,i=t.regeneratorRuntime},function(t){s=t.cclegacy,r=t._decorator,o=t.Vec3,c=t.Component},function(t){d=t.CardSuit},function(t){h=t.GameLogicEvent,u=t.DeckPileEvent,l=t.CommunityCardEvent,f=t.PlayerHandCardEvent,m=t.GameUIEvent,p=t.WordPuzzleGameLogicEvent},function(t){v=t.CardEvaluations,_=t.HandEvaluator},function(t){C=t.EventManager},function(t){y=t.FillBlanks}],execute:function(){var g;s._RF.push({},"f06dbHBlopIvqT3D6bZcdTU","TexasGameLogic",void 0);var G=r.ccclass;r.property,t("default",G("TexasGameLogic")(g=function(t){function s(){for(var e,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))||this)._deck=[],e._community=[],e._players=[],e._discarded=[],e._gamePlayers=[],e._answerTipCards=[],e._intros=void 0,e}e(s,t);var r=s.prototype;return r.onLoad=function(){C.instance.on(h.GameStart,this.eventGameStart,this),C.instance.on(h.GameEnd,this.eventGameEnd,this),C.instance.on(h.GameResume,this.eventGameResume,this),C.instance.on(h.GameRoundStartDiscardCards,this.eventDiscardCards,this),C.instance.on(h.GameRoundStartDealCards,this.onGameRoundStartDealCards,this),C.instance.on(h.GameRoundNextPlayerTurn,this.playerNextTurn,this),C.instance.on(h.GameRoundEndShowCards,this.endShowCards,this)},r.onDestroy=function(){C.instance.off(h.GameStart,this.eventGameStart,this),C.instance.off(h.GameEnd,this.eventGameEnd,this),C.instance.off(h.GameResume,this.eventGameResume,this),C.instance.off(h.GameRoundStartDiscardCards,this.eventDiscardCards,this),C.instance.off(h.GameRoundStartDealCards,this.onGameRoundStartDealCards,this),C.instance.off(h.GameRoundNextPlayerTurn,this.playerNextTurn,this),C.instance.off(h.GameRoundEndShowCards,this.endShowCards,this)},r.start=function(){this.node.position=o.ZERO,this.node.active=!1},r.initGame=function(t,e){this.node.active=!0,this._gamePlayers=t,this._intros=e,this.initializeDeck(),C.instance.emit(u.ShowCards,this._deck)},r.initializeDeck=function(){var t=this._intros;console.log("intros:",t);var e=[d.Prop,d.Clue,d.Doubt,d.Presage],a=["2","3","4","5","6","7","8","9","10","J","Q","K","A"].slice(13-t.length),i=["stealth","power","wisdom","speed","luck"];this._deck.length=0;for(var s=0,r=e;s<r.length;s++)for(var o,c=r[s],h=n(a);!(o=h()).done;){var u=o.value,l=a.indexOf(u),f=[];if(l<t.length)f=[t[l][c]];else{var m=Math.floor(3*Math.random())+1;f=[];for(var p=0;p<m;p++)f.push(i[Math.floor(Math.random()*i.length)])}this._deck.push({suit:c,rank:u,conditions:f})}},r.shuffleDeck=function(){for(var t=0;t<this._deck.length;t++){var e=Math.floor(Math.random()*(t+1)),n=[this._deck[e],this._deck[t]];this._deck[t]=n[0],this._deck[e]=n[1]}},r.startGame=function(){var t=a(i().mark((function t(){var e=this;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.shuffleDeck(),console.log("deck:",this._deck),t.next=4,this.dealCards();case 4:return t.next=6,new Promise((function(t){return e.scheduleOnce(t,.5)}));case 6:this.compareCards();case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.dealCards=function(){var t=a(i().mark((function t(){var e,n,a=this;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._deck.length<7)){t.next=2;break}throw new Error("Not enough cards in the deck.");case 2:for(1,this._players.forEach((function(t){t.length=0})),e=0;e<1;e++)this._players[e]=[this._deck.pop(),this._deck.pop()];for(this._community.length=0,n=0;n<5;n++)this._community.push(this._deck.pop());return C.instance.emit(f.ShowCards,this._players[0]),C.instance.emit(u.DealCommunityCards,this._community),t.next=11,new Promise((function(t){return a.scheduleOnce(t,.5)}));case 11:C.instance.emit(u.DealPlayerCards,this._players);case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.compareCards=function(){var t=this._players[0].concat(this._community),e=this.findBestHand(t),n=this.findCombinationsForSpecificHandType(t,e);C.instance.emit(l.CompareCards,n),C.instance.emit(f.CompareCards,n);var a=n[0].map((function(t){return t.conditions[0]})),i=y.replaceMarkedWithKeywords(a,this._answerTipCards.map((function(t){return t.string}))).map((function(t){return t.tipCards})).flat();C.instance.emit(m.ShowCardConditions2,{conditions:a}),this._answerTipCards=this._answerTipCards.concat(i),C.instance.emit(p.ShowAnswer,{answers:this._answerTipCards})},r.determineWinner=function(){var t=this;this._players.map((function(e,n){return{score:t.evaluateHand(e.concat(t._community)),conditions:e.reduce((function(t,e){return t.concat(e.conditions)}),[]),index:n}})).forEach((function(t){console.log("Player "+(t.index+1)+" score: "+t.score+", conditions: "+t.conditions.join(", "))}))},r.evaluateHand=function(t){var e=0,n={};for(var a in t.forEach((function(t){t.conditions.forEach((function(t){n[t]=(n[t]||0)+1}))})),n)e+=n[a];return e},r.nextRound=function(){var t=a(i().mark((function t(){var e=this;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return C.instance.emit(u.DiscardCards,this._community.concat(this._players[0])),t.next=3,new Promise((function(t){return e.scheduleOnce(t,.5)}));case 3:this._deck.length<7?(C.instance.emit(u.DeckGatherings),this.initializeDeck()):this.startGame();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.updateGameState=function(t){},r.playerMakesMove=function(t,e){},r.selectOrDiscardCard=function(t,e,n){n?console.log("Player "+(t+1)+" keeps card: "+this._players[t][e].rank+" of "+this._players[t][e].suit):(this._players[t][e]=this._deck.pop(),console.log("Player "+(t+1)+" discards and draws a new card: "+this._players[t][e].rank+" of "+this._players[t][e].suit))},r.getCombinations=function(t,e){var n=[],a=[];return function i(s,r){for(var o=r;o<t.length-(e-s)+1;o++)a[s]=t[o],s<e-1?i(s+1,o+1):n.push(a.slice())}(0,0),n},r.findBestHand=function(t){var e=this;if(7!==t.length)throw new Error("Must evaluate exactly 7 cards.");var n=this.getCombinations(t,5),a=v.HighCard;return n.forEach((function(t){var n=_.evaluateHand(t);e.compareHands(n,a)>0&&(a=n)})),console.log("Best hand:",a),a},r.compareHands=function(t,e){var n=Object.values(v);return n.indexOf(t)-n.indexOf(e)},r.findCombinationsForSpecificHandType=function(t,e){if(t.length<5)throw new Error("Not enough cards to evaluate.");var n=this.getCombinations(t,5),a=[];return n.forEach((function(t){_.evaluateHand(t)===e&&a.push(t)})),a},r.handleDiscardCards=function(t){this._discarded=this._discarded.concat(t),console.log("Updated discard pile:",this._discarded),C.instance.emit(m.DeckCardDiscard,this._discarded)},r.eventDiscardCards=function(t){var e=t;this.handleDiscardCards(e)},r.playerNextTurn=function(t){this.nextRound()},r.endShowCards=function(t){console.log("End show cards:",t),this.findBestHand(t)},r.eventGameStart=function(t){console.log("Game start");var e=t.playersInfo,n=t.intros;this.initGame(e,n),C.instance.emit(m.GameStart)},r.eventGameResume=function(t){console.log("Game resume")},r.eventGameEnd=function(t){this._community.length=0,C.instance.emit(l.ShowCards,this._community),this._players.forEach((function(t){t.length=0})),C.instance.emit(f.ShowCards,this._players[0]),this._answerTipCards.length=0,C.instance.emit(m.GameEnd),C.instance.emit(p.WordPuzzleGameEnd),this.node.active=!1},r.onGameRoundStartDealCards=function(){console.log("Deal cards"),this.startGame()},s}(c))||g);s._RF.pop()}}}));

System.register("chunks:///_virtual/TexasGamePlayer.ts",["cc"],(function(e){var a,c;return{setters:[function(e){a=e.cclegacy,c=e._decorator}],execute:function(){var r;a._RF.push({},"bafc4UZqdFPnLGB1xBEv82A","TexasGamePlayer",void 0);var t=c.ccclass;c.property,e("TexasGamePlayer",t(r=function(){})||r);a._RF.pop()}}}));

System.register("chunks:///_virtual/TexasGameUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameEvents.ts","./EventManager.ts","./FillBlanks.ts","./HandCards.ts","./TipClipsAnimation.ts","./DescriptionScrollView.ts"],(function(t){var e,n,i,a,r,o,s,c,l,d,u,h,v,f,C,p,w,D,B;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,s=t.RichText,c=t.Node,l=t.Vec3,d=t.tween,u=t.Component},function(t){h=t.GameUIEvent,v=t.GameLogicEvent,f=t.WordPuzzleGameLogicEvent},function(t){C=t.EventManager},function(t){p=t.FillBlanks},function(t){w=t.HandCards},function(t){D=t.TipClipsAnimation},function(t){B=t.DescriptionScrollView}],execute:function(){var m,k,S,b,z,g,G,y,x,E,P,R,I,L,N,V,T,U,H;r._RF.push({},"9c23d2tFDNBnq8i9+EAEypr","TexasGameUI",void 0);var A=o.ccclass,F=o.property;t("default",(m=A("TexasGameUI"),k=F(w),S=F(s),b=F(B),z=F(c),g=F(c),G=F(c),y=F(c),x=F(D),m((R=e((P=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,i(e,"answerHandCards",R,a(e)),i(e,"cardIntroLabel",I,a(e)),i(e,"descriptionScrollView",L,a(e)),i(e,"BackPuzzleBtn",N,a(e)),i(e,"NextRoundBtn",V,a(e)),i(e,"DiscardCardBtn",T,a(e)),i(e,"DeckGatheringBtn",U,a(e)),i(e,"answerClipsAnimation",H,a(e)),e}n(e,t);var r=e.prototype;return r.onLoad=function(){C.instance.on(h.GameStart,this.eventGameStart,this),C.instance.on(h.GameEnd,this.eventGameEnd,this),C.instance.on(h.DeckCardSelected,this.eventDeckCardSelected,this),C.instance.on(h.DeckCardUnselected,this.eventDeckCardUnselected,this),C.instance.on(h.DeckCardDiscard,this.eventDeckCardDiscard,this),C.instance.on(h.ShowCardConditions,this.eventShowCardConditions,this),C.instance.on(h.ShowCardConditions2,this.eventShowCardConditions2,this)},r.onDestroy=function(){C.instance.off(h.GameStart,this.eventGameStart,this),C.instance.off(h.GameEnd,this.eventGameEnd,this),C.instance.off(h.DeckCardSelected,this.eventDeckCardSelected,this),C.instance.off(h.DeckCardUnselected,this.eventDeckCardUnselected,this),C.instance.off(h.DeckCardDiscard,this.eventDeckCardDiscard,this),C.instance.off(h.ShowCardConditions,this.eventShowCardConditions,this),C.instance.off(h.ShowCardConditions2,this.eventShowCardConditions2,this)},r.start=function(){this.node.position=l.ZERO,this.answerHandCards.show(!1)},r.updateCardIntroLabel=function(t){void 0===t&&(t=""),this.cardIntroLabel.string=t},r.eventGameStart=function(t){this.BackPuzzleBtn.active=!1,this.NextRoundBtn.active=!1,this.DiscardCardBtn.active=!1,this.DeckGatheringBtn.active=!0},r.eventGameEnd=function(t){this.BackPuzzleBtn.active=!1,this.NextRoundBtn.active=!1,this.DiscardCardBtn.active=!1,this.DeckGatheringBtn.active=!1,console.log("關!!"),this.answerHandCards.show(!1),this.descriptionScrollView.show(!1)},r.eventDeckCardSelected=function(t){var e=t.conditions,n=p.replaceKeywordsWidthBlanks(e).map((function(t){return t.text})).join("\n");this.updateCardIntroLabel(n)},r.eventDeckCardUnselected=function(t){this.descriptionScrollView.clear()},r.eventDeckCardDiscard=function(t){this.descriptionScrollView.clear()},r.eventShowCardConditions=function(t){var e=t.conditions;this.updateCardIntroLabel(e.join("\n"));var n=t.answers;this.answerClipsAnimation.spreadCards(n),this.BackPuzzleBtn.active=!0,this.NextRoundBtn.active=!0,this.DiscardCardBtn.active=!1,this.DeckGatheringBtn.active=!1},r.eventShowCardConditions2=function(t){console.log("event.conditions:",t.conditions),this.descriptionScrollView.show(),this.descriptionScrollView.setData(t.conditions),this.BackPuzzleBtn.active=!0,this.NextRoundBtn.active=!0,this.DiscardCardBtn.active=!1,this.DeckGatheringBtn.active=!1},r.animateCardDeal=function(t,e,n){void 0===n&&(n=.25),d(e).delay(n).to(.5,{position:t.position}).start()},r.onNextPlayerTurn=function(){this.descriptionScrollView.show(!1),this.BackPuzzleBtn.active=!1,this.NextRoundBtn.active=!1,this.DiscardCardBtn.active=!1,this.DeckGatheringBtn.active=!1,C.instance.emit(v.GameRoundNextPlayerTurn)},r.onWordPuzzleClicked=function(){C.instance.emit(f.ShowHint,{active:!0})},e}(u)).prototype,"answerHandCards",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(P.prototype,"cardIntroLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(P.prototype,"descriptionScrollView",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(P.prototype,"BackPuzzleBtn",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(P.prototype,"NextRoundBtn",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(P.prototype,"DiscardCardBtn",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(P.prototype,"DeckGatheringBtn",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(P.prototype,"answerClipsAnimation",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=P))||E));r._RF.pop()}}}));

System.register("chunks:///_virtual/TipClipsAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CardMover.ts"],(function(e){var n,t,r,i,a,o,s,c,u,l,p,d,f,h,v,C,b,m;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,c=e._decorator,u=e.Node,l=e.Prefab,p=e.Component,d=e.tween,f=e.v3,h=e.Vec3,v=e.instantiate,C=e.Label,b=e.randomRange},function(e){m=e.CardMover}],execute:function(){var y,w,g,L,N,P,T;s._RF.push({},"d0876fZtKdLFoba69Le1bNQ","TipClipsAnimation",void 0);var x=c.ccclass,A=c.property;e("TipClipsAnimation",(y=x("TipClipsAnimation"),w=A(u),g=A(l),y((P=n((N=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return n=e.call.apply(e,[this].concat(a))||this,r(n,"destinationNode",P,i(n)),r(n,"answerClipPrefab",T,i(n)),n}t(n,e);var s=n.prototype;return s.onLoad=function(){},s.spreadCards=function(){var e=a(o().mark((function e(n){var t,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n.forEach((function(e){var n=v(r.answerClipPrefab);n.getComponentInChildren(C).string=e,r.node.addChild(n),t.push(n)})),e.next=4,m.scatterCards(t,this.node,[60,100],b(.75,1.25));case 4:t.forEach(a(o().mark((function e(n,t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.moveCard(n,r.destinationNode,h.ZERO,.25,.25);case 2:d(r.destinationNode).to(.1,{scale:f(1.2,1.2,1)}).call((function(){return n.destroy()})).to(.1,{scale:f(1,1,1)}).start();case 3:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}(),n}(p)).prototype,"destinationNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(N.prototype,"answerClipPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=N))||L));s._RF.pop()}}}));

System.register("chunks:///_virtual/TipText.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts"],(function(t){var i,n,e,o,r,s,a,T,h;return{setters:[function(t){i=t.applyDecoratedDescriptor,n=t.inheritsLoose,e=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.RichText,T=t.Component},function(t){h=t.EventManager}],execute:function(){var c,p,l,f,x;r._RF.push({},"aa1f8eOUGlFa4eC3sr3+wN3","TipText",void 0);var u=s.ccclass,w=s.property,d=t("TipType",function(t){return t.Normal="ShowTipText",t.NormalDelay="ShowTipTextDelay",t.Warning="ShowWarningText",t.Error="ShowErrorText",t.Hide="HideTipText",t}({}));t("TipText",(c=u("TipText"),p=w(a),c((x=i((f=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return i=t.call.apply(t,[this].concat(r))||this,e(i,"tipText",x,o(i)),i}n(i,t);var r=i.prototype;return r.onLoad=function(){this.node.active=!1,h.instance.on(d.Normal,this.onShowTipText,this),h.instance.on(d.NormalDelay,this.onShowDelayTipText,this),h.instance.on(d.Warning,this.onShowWarrningTipText,this),h.instance.on(d.Error,this.onShowErrorTipText,this),h.instance.on(d.Hide,this.onHideTipText,this)},r.onDestroy=function(){h.instance.off(d.Normal,this.onShowTipText,this),h.instance.off(d.NormalDelay,this.onShowDelayTipText,this),h.instance.off(d.Warning,this.onShowWarrningTipText,this),h.instance.off(d.Error,this.onShowErrorTipText,this),h.instance.off(d.Hide,this.onHideTipText,this)},r.onShowTipText=function(t){var i=t;this.showTipText(i)},r.onShowDelayTipText=function(t,i){var n=this,e=t;this.showTipText(e),this.scheduleOnce((function(){return n.node.active=!1}),i)},r.onShowWarrningTipText=function(t){var i="<color=#ffff00>"+t+"</color>";this.showTipText(i)},r.onShowErrorTipText=function(t){var i="<color=#ff0000>"+t+"</color>";this.showTipText(i)},r.onHideTipText=function(){this.tipText.string="",this.node.active=!1},r.showTipText=function(t){this.node.active=!0,this.tipText.string=t},i}(T)).prototype,"tipText",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=f))||l));r._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AttributeAllocation.ts","./AttributeComponent.ts","./EventManager.ts","./CharacterInfo.ts","./Inventory.ts","./DataModal.ts","./PopupWindowComponent.ts","./MapConnection.ts","./NarratorCore.ts"],(function(n){var t,i,o,e,a,r,c,s,l,h,p,u,f,C,I,b,v,w,y;return{setters:[function(n){t=n.applyDecoratedDescriptor,i=n.inheritsLoose,o=n.initializerDefineProperty,e=n.assertThisInitialized},function(n){a=n.cclegacy,r=n._decorator,c=n.Node,s=n.Vec3,l=n.instantiate,h=n.Component},function(n){p=n.AttributeAllocation},function(n){u=n.AttributeComponent},function(n){f=n.EventManager},function(n){C=n.CharacterInfo},function(n){I=n.Inventory},function(n){b=n.DataModal},function(n){v=n.PopupWindowComponent},function(n){w=n.MapConnection},function(n){y=n.NarratorCore}],execute:function(){var S,d,m,g,U,A,_,B,M,D,P,W,k,z,E,V,L,N,Q,q,O;a._RF.push({},"39d66FlqqhOgIS0LTNa2cx0","UIManager",void 0);var j=r.ccclass,F=r.property,R=n("UIEvent",function(n){return n.BaseAbilitiesShowUI="ui_event_base_abilities_show_ui",n.BaseAbilityAllocation="ui_event_base_ability_allocation",n.InventoryShowUI="ui_event_inventory_show_ui",n.DescriptionScrollViewShowUI="ui_event_description_scroll_view_show_ui",n.PopupWindow="ui_event_popup_window",n.UpdateCharacterInfo="ui_event_update_character_info",n.MapConnectionShowUI="ui_event_map_connection_show_ui",n}({}));n("UIManager",(S=j("UIManager"),d=F(c),m=F(c),g=F(c),U=F(c),A=F(c),_=F(c),B=F(c),M=F(c),D=F(c),S((k=t((W=function(n){function t(){for(var t,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return t=n.call.apply(n,[this].concat(a))||this,o(t,"abilitiesInfoContainer",k,e(t)),o(t,"abilitiesContainer",z,e(t)),o(t,"characterInfoContainer",E,e(t)),o(t,"inventoryContainer",V,e(t)),o(t,"descriptionScrollContainer",L,e(t)),o(t,"mapConnectionContainer",N,e(t)),o(t,"copingSkillContainer",Q,e(t)),o(t,"popupWindowContainer",q,e(t)),o(t,"story",O,e(t)),t}i(t,n);var a=t.prototype;return a.onLoad=function(){f.instance.on(R.BaseAbilitiesShowUI,this.onBaseAbilitiesShowUI,this),f.instance.on(R.BaseAbilityAllocation,this.onBaseAbilityAllocation,this),f.instance.on(R.InventoryShowUI,this.onInventoryShowUI,this),f.instance.on(R.DescriptionScrollViewShowUI,this.onDescriptionScrollViewShowUI,this),f.instance.on(R.PopupWindow,this.onPopupWindow,this),f.instance.on(R.UpdateCharacterInfo,this.onUpdateCharacterInfo,this),f.instance.on(R.MapConnectionShowUI,this.onMapConnectionShowUI,this),f.instance.on("QuestAccept",this.onQuestAccept,this),f.instance.on("DramaEvent",this.onDramaEvent,this),f.instance.on("StartStory",this.onStartStory,this)},a.onDestroy=function(){f.instance.off(R.BaseAbilitiesShowUI,this.onBaseAbilitiesShowUI,this),f.instance.off(R.BaseAbilityAllocation,this.onBaseAbilityAllocation,this),f.instance.off(R.InventoryShowUI,this.onInventoryShowUI,this),f.instance.off(R.DescriptionScrollViewShowUI,this.onDescriptionScrollViewShowUI,this),f.instance.off(R.PopupWindow,this.onPopupWindow,this),f.instance.off(R.UpdateCharacterInfo,this.onUpdateCharacterInfo,this),f.instance.off(R.MapConnectionShowUI,this.onMapConnectionShowUI,this),f.instance.off("QuestAccept",this.onQuestAccept,this),f.instance.off("DramaEvent",this.onDramaEvent,this),f.instance.off("StartStory",this.onStartStory,this)},a.onBaseAbilitiesShowUI=function(n){this.abilitiesContainer.active=n,this.abilitiesInfoContainer.active=n,n||this.updateBaseAbilityByComponents()},a.onBaseAbilityAllocation=function(n){var t=n.allocatePoints,i=n.baseAbilities;console.log("onBaseAbilityAllocation",t,i),this.allocateBaseAbility(t,i)},a.onInventoryShowUI=function(n){var t=this.inventoryContainer.getComponent(I);t&&t.show(n);var i=this.characterInfoContainer.getComponent(C);i&&(i.member.characterInfoLabel.node.active=n)},a.onDescriptionScrollViewShowUI=function(n){this.descriptionScrollContainer.active=n},a.onUpdateCharacterInfo=function(){this.characterInfoContainer.active=!0;var n=this.characterInfoContainer.getComponent(C);n&&(n.character=b.getInstance().playerCharacter,n.refreshCharacterInfo(),n.refreshItemInfo())},a.onQuestAccept=function(n){var t=this.characterInfoContainer.getComponent(C);if(t){t.acceptMission(n);var i=b.getInstance().storyData.quests[n];if(i.location){this.onMapConnectionShowUI(!0);var o=this.mapConnectionContainer.getComponent(w);null==o||o.createCenterLocation(i.location),this.copingSkillContainer.active=!0;var e=this.copingSkillContainer.getComponent(y);e&&(e.quest=n)}}},a.onDramaEvent=function(n){this.copingSkillContainer.active=!0;var t=this.copingSkillContainer.getComponent(y);t&&(t.drama=n)},a.onMapConnectionShowUI=function(n){this.mapConnectionContainer.active=n},a.onStartStory=function(){this.story.active=!0},a.onPopupWindow=function(n,t,i){this.popupWindowContainer.active=!0;var o=this.popupWindowContainer.getComponent(v);o&&o.openPopup(n,t,i)},a.start=function(){this.node.position=s.ZERO,this.abilitiesInfoContainer.active=!1,this.inventoryContainer.active=!1,this.popupWindowContainer.active=!1},a.updateBaseAbilityByComponents=function(){var n=this.abilitiesContainer.getComponentsInChildren(u),t={};n.forEach((function(n){t[n.Name]=n.Value}));var i=t;b.getInstance().playerCharacter.abilities=i,this.characterInfoUpdate()},a.characterInfoUpdate=function(){var n=this.characterInfoContainer.getComponent(C);n&&(n.refreshCharacterInfo(),n.refreshItemInfo())},a.allocateBaseAbility=function(n,t){var i=this,o=this.abilitiesContainer.getComponent(p),e=this.abilitiesContainer.getComponentsInChildren(u);if(o&&e){this.abilitiesContainer.active=!0;var a=0;Object.values(t).forEach((function(n,o){var r=e[o];if(!r){var c=l(e[0].node);c.parent=i.abilitiesContainer,c.active=!0,r=c.getComponent(u)}r.Name=Object.keys(t)[o],r.Value=n,a+=n})),o.pointsUsed=a,o.totalPoints=n+a}},a.onAbilitiesCloseClicked=function(){this.onBaseAbilitiesShowUI(!1)},a.onAbilityInfoClicked=function(){this.onBaseAbilitiesShowUI(!this.abilitiesContainer.active)},a.onInventoryButtonClicked=function(){this.onInventoryShowUI(!this.inventoryContainer.active)},t}(h)).prototype,"abilitiesInfoContainer",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(W.prototype,"abilitiesContainer",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(W.prototype,"characterInfoContainer",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(W.prototype,"inventoryContainer",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(W.prototype,"descriptionScrollContainer",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(W.prototype,"mapConnectionContainer",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(W.prototype,"copingSkillContainer",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(W.prototype,"popupWindowContainer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(W.prototype,"story",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=W))||P));a._RF.pop()}}}));

System.register("chunks:///_virtual/Weapon.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Item.ts"],(function(e){var a,r,o;return{setters:[function(e){a=e.inheritsLoose},function(e){r=e.cclegacy},function(e){o=e.Item}],execute:function(){r._RF.push({},"ed784fy1SFNlou/nwbz53fp","Weapon",void 0);e("WeaponStyle",function(e){return e.Unarmed="Unarmed",e.AllSimpleWeapons="AllSimpleWeapons",e.Club="Club",e.Dagger="Dagger",e.Greatclub="Greatclub",e.Handaxe="Handaxe",e.Javelin="Javelin",e.LightHammer="Light Hammer",e.Mace="Mace",e.Quarterstaff="Quarterstaff",e.Sickle="Sickle",e.Spear="Spear",e.LightCrossbow="Light Crossbow",e.Dart="Dart",e.Shortbow="Shortbow",e.Sling="Sling",e.AllMartialWeapons="AllMartialWeapons",e.Battleaxe="Battleaxe",e.Flail="Flail",e.Glaive="Glaive",e.Greataxe="Greataxe",e.Greatsword="Greatsword",e.Halberd="Halberd",e.Lance="Lance",e.Longsword="Longsword",e.Maul="Maul",e.Morningstar="Morningstar",e.Pike="Pike",e.Rapier="Rapier",e.Scimitar="Scimitar",e.ShortSword="Shortsword",e.Trident="Trident",e.WarPick="War Pick",e.Warhammer="Warhammer",e.Whip="Whip",e.Blowgun="Blowgun",e.HandCrossbow="Hand Crossbow",e.HeavyCrossbow="Heavy Crossbow",e.Longbow="Longbow",e.Net="Net",e}({})),e("Weapon",function(e){function r(a,r,o,t,n,i,l,s){var c;return(c=e.call(this,a,r,o,1)||this).style=void 0,c.icon=void 0,c.damage=void 0,c.properties=void 0,c.range=void 0,c.style=t,c.icon=n,c.damage=i,c.properties=l,c.range=s,c}return a(r,e),r}(o));r._RF.pop()}}}));

System.register("chunks:///_virtual/WeaponDraggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Draggable.ts","./EventManager.ts","./EquipmentDropZone.ts"],(function(e){var n,t,o,a,r,i,l,s;return{setters:[function(e){n=e.inheritsLoose,t=e.createClass},function(e){o=e.cclegacy,a=e._decorator,r=e.Label},function(e){i=e.Draggable},function(e){l=e.EventManager},function(e){s=e.EquipmentDropZoneIndex}],execute:function(){var c;o._RF.push({},"15f7a4o9/hARp+gzHtYMOx6","WeaponDraggable",void 0);var p=a.ccclass;a.property,e("WeaponDraggable",p("WeaponDraggable")(c=function(e){function o(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return(n=e.call.apply(e,[this].concat(o))||this).nameLabel=null,n._weapon=null,n.equipmentIndex=s.None,n}return n(o,e),o.prototype.onTouchStart=function(n){if(e.prototype.onTouchStart.call(this,n),console.log("WeaponDraggable.onTouchStart"),this.equipmentIndex!==s.None){var t=this.zone;l.instance.emit("CharacterUnequip",{index:t.serialIndex}),this.equipmentIndex=s.None}},t(o,[{key:"weapon",set:function(e){this._weapon=e,console.log("WeaponDraggable.weapon = ",e),this.nameLabel=this.node.getComponentInChildren(r),this.nameLabel.string=e.name,this.setPhotoImage(e.icon)}},{key:"item",get:function(){return this._weapon}}]),o}(i))||c);o._RF.pop()}}}));

System.register("chunks:///_virtual/WordPuzzleData.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"081e8hHWYtO0oke+7yDlL6q","WordPuzzleData",void 0);t("WordPuzzleData",(function(){}));e._RF.pop()}}}));

System.register("chunks:///_virtual/WordPuzzleGameLogic.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts","./GameEvents.ts","./FillBlanks.ts","./WordPuzzleGameUI.ts"],(function(e){var t,n,o,s,i,a,r,c,u,h,l,m,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,s=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,r=e.Vec3,c=e.Component},function(e){u=e.EventManager},function(e){h=e.WordPuzzleGameLogicEvent,l=e.GameLogicEvent},function(e){m=e.FillBlanks},function(e){d=e.default}],execute:function(){var f,w,z,G,p;i._RF.push({},"f79c6JenbpK/pT47NpbhBEI","WordPuzzleGameLogic",void 0);var v=a.ccclass,g=a.property;e("default",(f=v("WordPuzzleGameLogic"),w=g(d),f((p=t((G=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,o(t,"gameUI",p,s(t)),t._data=void 0,t}n(t,e);var i=t.prototype;return i.onLoad=function(){this.node.setPosition(r.ZERO),u.instance.on(h.WordPuzzleGameStart,this.startWordPuzzleGame,this),u.instance.on(h.WordPuzzleGameEnd,this.endWordPuzzleGame,this),u.instance.on(h.ShowAnswer,this.onShowAnswer,this),u.instance.on(h.ShowHint,this.onShowHint,this),u.instance.on(h.TexasGameStart,this.onTexasGameStart,this),u.instance.on(h.TexasGameResume,this.onTexasGameResume,this)},i.onDestroy=function(){u.instance.off(h.WordPuzzleGameStart,this.startWordPuzzleGame,this),u.instance.off(h.WordPuzzleGameEnd,this.endWordPuzzleGame,this),u.instance.off(h.ShowAnswer,this.onShowAnswer,this),u.instance.off(h.ShowHint,this.onShowHint,this),u.instance.off(h.TexasGameStart,this.onTexasGameStart,this),u.instance.off(h.TexasGameResume,this.onTexasGameResume,this)},i.start=function(){this.node.position=r.ZERO,this.node.active=!1,this.gameUI.onrReasoningTest()},i.startWordPuzzleGame=function(e){this.node.active=!0,this._data=e,e.cards.sort((function(){return Math.random()-.5}));var t=[e.question];this.onShowQuestion(t)},i.endWordPuzzleGame=function(){this.node.active=!1},i.showQuestion=function(e,t){console.log("Question: "+e+", Answer: "+t),this.gameUI.showQuestion(e,t)},i.showAnswer=function(e){this.gameUI.showAnswer(e)},i.onShowQuestion=function(e){var t=m.replaceKeywordsWidthBlanks(e),n=t[0].text,o=t[0].keywords;this.showQuestion(n,o)},i.onShowAnswer=function(e){var t=e.answers;console.log("Answer: "+t.map((function(e){return e.string}))),this.showAnswer(t)},i.onShowHint=function(e){this.node.active=e.active},i.onTexasGameStart=function(e){u.instance.emit(l.GameStart,{plyaerInfo:null,intros:this._data.cards}),this.node.active=!1},i.onTexasGameResume=function(e){u.instance.emit(l.GameResume),this.node.active=!1},t}(c)).prototype,"gameUI",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=G))||z));i._RF.pop()}}}));

System.register("chunks:///_virtual/WordPuzzleGameUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts","./GameEvents.ts","./HandCards.ts","./FillBlanks.ts","./TipText.ts","./ExplorationCard.ts"],(function(t){var e,n,i,s,r,a,o,u,c,l,d,h,m,f,p,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,o=t.RichText,u=t.Node,c=t.Component},function(t){l=t.EventManager},function(t){d=t.WordPuzzleGameLogicEvent,h=t.GameLogicEvent},function(t){m=t.HandCards},function(t){f=t.FillBlanks},function(t){p=t.TipType},function(t){v=t.ExplorationCard}],execute:function(){var w,b,g,B,C,z,y,R,H,G,T,x,k;r._RF.push({},"1ed87ddISpPK7ueRW4/h8TV","WordPuzzleGameUI",void 0);var F=a.ccclass,L=a.property;t("default",(w=F("WordPuzzleGameUI"),b=L(o),g=L(m),B=L(u),C=L(u),z=L(u),w((H=e((R=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"questionLabel",H,s(e)),i(e,"answerHandCards",G,s(e)),i(e,"restartBtn",T,s(e)),i(e,"startBtn",x,s(e)),i(e,"resumeBtn",k,s(e)),e.question="",e.solutions=[],e.isFirstRound=!0,e.index=-1,e}n(e,t);var r=e.prototype;return r.showQuestion=function(t,e){this.questionLabel.string=this.question=t,this.solutions=e,this.answerHandCards.setSendData(this.solutions.length,this.sendAnswer.bind(this)),this.answerHandCards.show(!1),this.answerHandCards.lock(!0),this.restartBtn.active=!1,this.startBtn.active=this.isFirstRound,this.resumeBtn.active=!this.isFirstRound,this.isFirstRound=!1},r.showAnswer=function(t){var e=this;this.answerHandCards.show(!0),this.answerHandCards.list(t,(function(t,n){e.questionLabel.string=f.answerQuestion(e.question,n)})),this.answerHandCards.lock(!1)},r.sendAnswer=function(t){this.checkQuestionAnswer(t)?(l.instance.emit(p.Normal,"回答正確！"),this.questionLabel.string="",this.answerHandCards.show(!1),this.answerHandCards.clear(),this.restartBtn.active=!0,this.startBtn.active=!1,this.resumeBtn.active=!1):l.instance.emit(p.Error,"回答錯誤！")},r.checkQuestionAnswer=function(t){return this.solutions.every((function(e,n){return e===t[n]}))},r.onTexasGameStartClicked=function(){this.restartBtn.active=!1,this.startBtn.active=!1,this.resumeBtn.active=!0,this.isFirstRound=!1,l.instance.emit(d.TexasGameStart)},r.onTexasGameResumeClicked=function(){l.instance.emit(d.TexasGameResume)},r.onTexasGameRestartClicked=function(){this.questionLabel.string="",this.restartBtn.active=!1,this.startBtn.active=!1,this.resumeBtn.active=!1,this.isFirstRound=!0,this.node.parent.active=!0,l.instance.emit(p.Hide),l.instance.emit(h.GameEnd)},r.onrReasoningTest=function(){var t=(new v).getReasoning(++this.index);l.instance.emit(d.WordPuzzleGameStart,t)},e}(c)).prototype,"questionLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(R.prototype,"answerHandCards",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(R.prototype,"restartBtn",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(R.prototype,"startBtn",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(R.prototype,"resumeBtn",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=R))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/YellowCardHandler.ts",["cc","./SocketBridge.ts","./YellowCardRecord.ts"],(function(t){var e,s,n,o,a;return{setters:[function(t){e=t.cclegacy},function(t){s=t.SocketBridge},function(t){n=t.YellowCardRecord,o=t.GameStatus,a=t.Role}],execute:function(){e._RF.push({},"de129SoJGFNgrAtVVueT/S0","YellowCardHandler",void 0);t("YellowCardHandler",function(){function t(t,e){this._isHonster=!1,this._roomID="",this._honstCardMax={q:2,a:13},this._honstRoundPlayers=[],this._honstRoundIndex=0,this._honstQuestionAnswers={},this._honstWorstList=[],this._masterID="",this._playerID="",this._myNickname="",this._loseNum=5,this._honstGameRecord=null,this.eventUpdateQuestionCards=null,this.eventUpdateAnswerCards=null,this.eventShowQuestion=null,this.eventLockQuestionSelection=null,this.eventLockAnswerSelection=null,this.eventShowQuestionAnswer=null,this.eventShowAllQuestionAnswer=null,this.eventChooseQuestionAnswer=null,this.eventVoted=null,this.eventAnswerCardFold=null,this.eventShowBestAnswer=null,this.eventShowTip=null,this.eventClearPrevRound=null,this.eventRecordLose=null,this.eventGameEnd=null,this._playerID=t,this._myNickname=e}var e=t.prototype;return e.applicate=function(t,e){void 0===e&&(e=""),console.log("===== applicate:",t,e),this._isHonster?(console.log(t,"Applicate 事件不透過連線發給自己:",e),this["notify_"+t](this._roomID,t,e)):s.Instance.applicate(t,e)},e._broadcast=function(t,e,n){if(void 0===e&&(e=""),console.log("===== broadcast:",t,e),this._isHonster){if(n===this._playerID)return console.log(t,"Broadcast 事件不透過連線發給自己:",e);s.Instance.broadcast(t,e,n)}},e.startGame=function(t,e,a){var i=this;if(this._roomID=t,a){this._isHonster=!0,this._honstGameRecord=new n,this._honstRoundPlayers=Object.keys(a);var r=this._honstRoundPlayers.length;this._loseNum=r<6?6:r<8?5:4,e?this._honstGameRecord.readData():this._honstRoundPlayers.forEach((function(t){i._honstGameRecord.add(t,a[t],o.GAMING)}))}s.Instance.addDispatcher(t,this,{update_game_step:this.notify_update_game_step,game_round:this.notify_game_round,draw_question_cards:this.notify_draw_question_cards,draw_answer_cards:this.notify_draw_answer_cards,licensing:this.notify_licensing,fold_answer_card:this.notify_fold_answer_card,question:this.notify_question,answer:this.notify_answer,question_answers_result:this.notify_question_answers_result,choose_best_answer:this.notify_choose_best_answer,vote:this.notify_vote,vote_result:this.notify_vote_result,alert:this.notify_alert,next_round:this.notify_next_round,game_over:this.notify_game_over,reconnect:this.notify_reconnect}),this._isHonster?(console.log("HONSTER 連線!!"),e?this.applicate("reconnect",this._playerID):this.updateQuestionAsync().then((function(){return console.log("已下載問題卡牌庫")})).then((function(){return i.updateAnswerAsync()})).then((function(){return console.log("已下載答案卡牌庫")})).then((function(){return i.applicate("game_round")}))):(console.log("CLIENT 連線!!"),e&&this.applicate("reconnect",this._playerID))},e.endGame=function(t){s.Instance.removeDispatcher(t,this),this._isHonster&&(this._honstGameRecord.clear(),this._honstGameRecord=null,this._honstRoundPlayers.length=0,this._honstRoundIndex=0),this._masterID="",this._playerID="",this._myNickname=""},e.updateQuestionAsync=function(){var t=this,e=Math.round(3*Math.random());return s.Instance.loadAsync("Question",e.toString()).then((function(e){return t._honstGameRecord.questions=e.sort((function(){return Math.random()-.5}))}))},e.updateAnswerAsync=function(){var t=this,e=Math.round(1e3*Math.random()%2);return s.Instance.loadAsync("Answer",e.toString()).then((function(e){return t._honstGameRecord.answers=e.sort((function(){return Math.random()-.5}))}))},e.tryAllAnswered=function(){var t=this,e=this._honstRoundPlayers.every((function(e){return t._masterID===e||t._honstGameRecord.get(e).gameStatus===o.ANSWERED}));return e&&(console.log("全部都答題了，開始投票"),this._honstRoundPlayers.forEach((function(e){t._masterID!==e&&(t._honstGameRecord.get(e).gameStatus=o.VOTING)}))),this._honstGameRecord.writeData(),e},e.notify_update_game_step=function(t,e,s){var n,a;if(this._isHonster){switch(n=s.split(" ")[0],a=this._honstGameRecord.get(n),this._masterID=this._honstGameRecord.masterID,this._honstGameRecord.get(this._masterID).gameStatus){case o.REVIEW:if(this.tryAllAnswered())return void this.applicate("question_answers_result")}if(s=this._masterID+" "+n+" "+JSON.stringify(a),this._broadcast(e,s,n),this._playerID!=n)return}var i=s.split(" ");this._masterID=i[0],n=i[1],a=JSON.parse(i[2]),console.log(e,"GAME STATUS:",a.gameStatus);var r=a,h=r.gameStatus,c=r.nickname;switch(h){case o.ASKING:console.log("我是"+c+", 正在擔任裁判並發問",a),this.eventUpdateQuestionCards(a.questionHandCards),this.eventLockQuestionSelection(!1),this.eventShowTip("選擇題目並送出");break;case o.ASKED:console.log("UI 禁止選擇問題卡"),this.eventLockQuestionSelection(!0),this.eventShowTip("等待答案中...");break;case o.ANSWER:console.log("我是"+c+", 是一般玩家",a),this.eventUpdateAnswerCards(a.answerHandCards),this.eventShowTip("等待裁判出題");break;case o.ANSWERING:console.log("UI 進行選擇答案卡"),this.eventLockAnswerSelection(!1),this.eventShowTip("填空並送出");break;case o.FOLD:var l=a.answerCards.length-1,_=a.answerHandCards;this.eventAnswerCardFold(_,l),this.eventShowTip("請棄掉牌"+l+"張牌");break;case o.ANSWERED:this.eventShowTip("等待其他人…")}},e.notify_game_round=function(t,e,s){var n=this;if(this._isHonster){var i=this._honstRoundPlayers[this._honstRoundIndex];this._honstGameRecord.masterID=i;var r=this._honstGameRecord.get(i);r.role=a.MASTER,r.gameStatus=o.ASKING,console.log("裁判人選:",i,"master:",r),this.applicate("draw_question_cards",i),this._honstRoundPlayers.forEach((function(t){if(i!==t){var e=n._honstGameRecord.get(t);e.role=a.PLAYER,e.gameStatus=o.ANSWER,n.applicate("draw_answer_cards",t)}})),this._honstGameRecord.writeData(),s=""+i,this._broadcast(e,s)}var h=s.split(" ");this._masterID=h[0]},e.notify_draw_question_cards=function(t,e,s){var n=this;if(this._isHonster){var o=s.split(" ")[0],a=this._honstGameRecord.questions,i=this._honstGameRecord.get(o).questionHandCards,r=this._honstCardMax.q-i.length;console.log("抽",r,"張"),console.log("問題卡牌庫張數(應有"+this._honstCardMax.q+"), Honster 目前張數::",a.length);var h=function(){n._honstGameRecord.questions.splice(0,r).forEach((function(t){return i.push(t)})),console.log("獲得手牌:",i),n._honstGameRecord.writeData(),n.applicate("licensing",o)};r>a.length?this.updateQuestionAsync().then((function(){return h()})):h()}},e.notify_draw_answer_cards=function(t,e,s){var n=this;if(this._isHonster){var o=s.split(" ")[0],a=this._honstGameRecord.answers,i=this._honstGameRecord.get(o).answerHandCards,r=this._honstCardMax.a-i.length;console.log("抽",r,"張"),console.log("答案卡牌庫張數(應有"+this._honstCardMax.a+"), Honster 目前張數:",a.length);var h=function(){n._honstGameRecord.answers.splice(0,r).forEach((function(t){return i.push(t)})),console.log("獲得手牌:",i),n._honstGameRecord.writeData(),n.applicate("licensing",o)};r>a.length?this.updateAnswerAsync().then((function(){return h()})):h()}},e.notify_licensing=function(t,e,s){var n,o;if(this._isHonster&&(n=s.split(" ")[0],o=this._honstGameRecord.get(n),s=n+" "+JSON.stringify(o),this._broadcast(e,s,n),this._playerID!=n))return;var a=s.split(" ");if(n=a[0],this._playerID!=n)return console.error("playerID 不符合",n,"應該在honster 階段return");console.log("clientData[1]::::::",a[1]),o=JSON.parse(a[1]),this.applicate("update_game_step",n+" "+Math.random())},e.notify_question=function(t,e,s){var n,i=this;if(this._isHonster){n=s,this._honstGameRecord.askingQuestion=s,console.log("裁判送出的問題卡:",n);var r=this._honstGameRecord.get(this._masterID);if(r.role!==a.MASTER)return this._broadcast("alert","自己不是裁判，不應該問問題",this._masterID),console.log(this._masterID,"不是裁判，不應該問問題");if(r.gameStatus!==o.ASKING)return this._broadcast("alert","自己還不是問問題的狀態",this._masterID),console.log(this._masterID,"還不是問問題的狀態:",r.gameStatus);r.gameStatus=o.ASKED,this._honstGameRecord.get(this._masterID).questionHandCards.length=0,this._honstRoundPlayers.forEach((function(t){if(t!==i._masterID){var e=i._honstGameRecord.get(t);e.gameStatus===o.ANSWER?(e.gameStatus=o.ANSWERING,console.log("玩家"+t+"改為"+o.ANSWERING+"狀態")):console.error("玩家應該是"+o.ANSWER+"狀態，但現在卻是"+e.gameStatus)}})),this._honstGameRecord.writeData(),s=""+n,this._broadcast(e,s)}n=s.split(" ")[0],this.eventShowQuestion(n),console.log("題目顯示後，請 Honster 指引下一步該做的事",this._playerID),this.applicate("update_game_step",this._playerID+" "+Math.random())},e.notify_answer=function(t,e,s){var n,i;if(this._isHonster){var r=s.split(" ");n=r[0],i=JSON.parse(r[1]),console.log("玩家送出的答案卡:",i);var h=this._honstGameRecord.get(n);if(h.role!==a.PLAYER)return this._broadcast("alert","自己不是玩家，不應該回答問題",n),console.log(n,"不是玩家，不應該回答問題");if(h.gameStatus!==o.ANSWERING)return this._broadcast("alert","自己還不是回答問題的狀態",n),console.log(n,"還不是回答問題的狀態:",h.gameStatus);h.gameStatus=i.length>1?o.FOLD:o.ANSWERED,this._honstQuestionAnswers[n]=i,h.answerCards=i,console.log("this._honstQuestionAnswers:",this._honstQuestionAnswers);var c=h.answerHandCards;console.log("手牌整理前:",c),i.forEach((function(t){var e=c.findIndex((function(e){return e===t}));e>-1?c.splice(e,1):console.log("玩家手牌無此張卡片:",t)})),console.log("手牌整理後:",c);var l=this._honstGameRecord.get(this._masterID);if(l.gameStatus===o.ASKED&&(l.gameStatus=o.REVIEW),this._honstGameRecord.writeData(),s=n+" "+JSON.stringify(i),this._broadcast(e,s,n),this._broadcast(e,s,this._masterID),console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! this._playerID != answerPlayerID",this._playerID!=n,"&& this._masterID != this._playerID",this._masterID!=this._playerID),this._playerID!=n&&this._masterID!=this._playerID)return}var _=s.split(" ");n=_[0],i=JSON.parse(_[1]),this._playerID===this._masterID?(this.eventShowQuestionAnswer(n,i),this.eventShowTip("收到玩家的答案")):this.eventShowTip("已送出你的答案"),this.applicate("update_game_step",this._playerID)},e.notify_fold_answer_card=function(t,e,s){var n,a;if(this._isHonster){var i=s.split(" ");n=i[0],a=JSON.parse(i[1]),console.log("玩家",n,"進行棄牌:",a);var r=this._honstGameRecord.get(n),h=r.answerHandCards;a.forEach((function(t){h.splice(h.findIndex((function(e){return e===t})),1)})),console.log("棄完牌後:",h),r.gameStatus===o.FOLD?r.gameStatus=o.ANSWERED:console.error(r.gameStatus,"狀態不是",o.FOLD,"，但正在進行棄牌"),this._honstGameRecord.writeData(),this.applicate("update_game_step",n),this.applicate("update_game_step",this._masterID)}},e.notify_question_answers_result=function(t,e,s){this._isHonster&&(s=""+JSON.stringify(this._honstQuestionAnswers),this._broadcast(e,s));var n=s.split(" "),o=JSON.parse(n[0]),a=this._playerID===this._masterID;a||(console.log("全員的答題清單:",o),this.eventShowAllQuestionAnswer(o)),this.eventChooseQuestionAnswer(a)},e.notify_vote=function(t,e,s){var n;if(this._isHonster){var a=s.split(" ");n=a[0];var i=a[1];this._honstWorstList.push(i),this._honstGameRecord.get(i).voted++;var r=this._honstGameRecord.get(n);r.gameStatus===o.VOTING?(console.log("玩家"+r.nickname+"已完成投票，並修改標記"),r.gameStatus=o.VOTED):console.error("玩家"+r.nickname+"再次完成投票，標記為"+o.VOTED.toString()),console.log("糟糕清單:",this._honstWorstList);var h=1;if(this._honstWorstList.length===this._honstRoundPlayers.length-1&&(h=0,this.applicate("vote_result")),this._honstGameRecord.writeData(),s=n+" "+h,this._broadcast(e,s,n),this._playerID!=n)return}var c="1"===s.split(" ")[1];this.eventVoted(!c),c&&this.eventShowTip("完成投票，請等候其他人投完票")},e.notify_vote_result=function(t,e,s){var n=this,o=[],a={};if(this._isHonster){var i={};this._honstWorstList.forEach((function(t){i[t]=i[t]||0,console.log(t,":",i[t]),i[t]++}));var r=Math.max.apply(Math,Object.keys(i).map((function(t){return i[t]})));console.log("voteResult:",i,r),Object.keys(i).forEach((function(t){i[t]===r&&(o.push(t),n._honstGameRecord.get(t).lose++)})),console.log("最糟的幾個人:",o),this._honstWorstList.length=0,this._honstRoundPlayers.forEach((function(t){var e=n._honstGameRecord.get(t);a[t]=e.lose})),this._honstGameRecord.writeData(),s=JSON.stringify(o)+" "+JSON.stringify(a),this._broadcast(e,s)}var h=s.split(" ");o=JSON.parse(h[0]),a=JSON.parse(h[1]),o.some((function(t){return n._playerID===t}))?(this.eventShowTip("恭喜，大家覺得你的問答組合是最爛的！"),this.eventRecordLose(a[this._playerID])):this._playerID!=this._masterID&&this.eventShowTip("很遺憾你的答案未獲選為最爛的問答組合…")},e.notify_choose_best_answer=function(t,e,s){var n,a,i=this,r=!0;if(this._isHonster){n=s.split(" ")[0],console.log("bestPlayerID:",n);var h=[];this._honstRoundPlayers.forEach((function(t){if(i._masterID!==t){var e=i._honstGameRecord.get(t);e.gameStatus===o.VOTING&&(h.push(t),r=!1),e.gameStatus===o.VOTED&&(e.gameStatus=o.GAMING)}})),r?(console.log("全員完成投票"),this._honstGameRecord.get(n).win++,a=this._honstQuestionAnswers[n],s="1 "+JSON.stringify(a)):(console.log("提醒未投票玩家進行投票"),s="0 "+JSON.stringify(h)),this._honstGameRecord.writeData(),this._broadcast(e,s)}var c=s.split(" ");(r="1"===c[0])?(a=JSON.parse(c[1]),this.eventShowBestAnswer(a,this._playerID===this._masterID),this.eventShowTip("裁判選出的最佳組合：")):JSON.parse(c[1]).some((function(t){return i._playerID===t}))?this.eventShowTip("快投票哦!!!大家都在等你!!!"):this._masterID===this._playerID&&this.eventShowTip("等待玩家完成最差組合投票")},e.notify_next_round=function(t,e,s){var n=this,o=!1;if(this._isHonster){if(this._honstRoundIndex=(this._honstRoundIndex+1)%this._honstRoundPlayers.length,this._honstQuestionAnswers={},this._honstGameRecord.clearAnswerCards(),this._honstGameRecord.clearWorstVote(),this._honstRoundPlayers.forEach((function(t){var e=n._honstGameRecord.get(t),s=-e.lose;s<=-n._loseNum&&(o=!0),console.log(e.nickname,"score:",s)})),console.log("檢查，還沒結束就下一輪"),o)return void this.applicate("game_over");this._broadcast(e,s)}var a=this._playerID===this._masterID;this.eventClearPrevRound(),a&&this.applicate("game_round")},e.notify_game_over=function(t,e,s){var n=this,o=[];if(this._isHonster){var a=Math.max.apply(Math,this._honstRoundPlayers.map((function(t){return n._honstGameRecord.get(t).win})));this._honstRoundPlayers.forEach((function(t){a===n._honstGameRecord.get(t).win&&o.push(n._honstGameRecord.get(t).nickname)})),s=""+JSON.stringify(o),this._broadcast(e,s)}var i=s.split(" ");o=JSON.parse(i[0]),this.eventShowTip("遊戲結束，最終大贏家是"+o.join("、")),this.eventGameEnd(),this.eventRecordLose(0)},e.notify_alert=function(t,e,s){this.eventShowTip(s)},e.notify_reconnect=function(t,e,s){var n,a,i,r,h,c=this;if(this._isHonster){n=s.split(" ")[0],this._masterID=this._honstGameRecord.masterID,this._honstRoundPlayers.forEach((function(t){var e=c._honstGameRecord.get(t).answerCards;e.length&&(c._honstQuestionAnswers[t]=e);for(var s=0;s<c._honstGameRecord.get(t).voted;s++)c._honstWorstList.push(t)})),console.log("notify_reconnect 答題:",this._honstQuestionAnswers),console.log("notify_reconnect 最糟投票:",this._honstWorstList),i=this._honstQuestionAnswers;var l=this._honstGameRecord.get(n),_=l.gameStatus;switch(_){case o.GAMING:return void this.applicate("licensing",n);case o.ASKING:return void this.applicate("update_game_step",n);case o.ASKED:a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+a,this._broadcast(e,s,n);break;case o.REVIEW:this._masterID===n&&(a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+a+" "+JSON.stringify(i),this._broadcast(e,s,n));break;case o.ANSWER:return void this.applicate("update_game_step",n);case o.ANSWERING:r=l.answerHandCards,a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+JSON.stringify(r)+" "+a,this._broadcast(e,s,n);break;case o.FOLD:r=l.answerHandCards,h=l.answerCards,a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+JSON.stringify(r)+" "+JSON.stringify(h)+" "+a,this._broadcast(e,s,n);break;case o.ANSWERED:return void this.applicate("update_game_step",n);case o.VOTING:a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+a+" "+JSON.stringify(i),this._broadcast(e,s,n);break;case o.VOTED:s=_+" "+this._masterID+" "+JSON.stringify(i),this._broadcast(e,s,n)}if(console.log("gameStatusgameStatusgameStatusgameStatus:",_),this._playerID!=n)return}var u=s.split(" "),d=parseInt(u[0]);switch(this._masterID=u[1],d){case o.ASKED:console.log("GameStatus.ASKED"),a=u[2],console.log("UI 禁止選擇問題卡"),this.eventLockQuestionSelection(!0),this.eventShowQuestion(a),this.eventShowTip("等待答案中...");break;case o.ANSWERING:console.log("GameStatus.ANSWERING"),r=JSON.parse(u[2]),a=u[3],this.eventUpdateAnswerCards(r),this.eventShowQuestion(a),console.log("UI 進行選擇答案卡"),this.eventLockAnswerSelection(!1),this.eventShowTip("填空並送出");break;case o.FOLD:r=JSON.parse(u[2]),h=JSON.parse(u[3]),a=u[4],this.eventShowQuestion(a);var m=h.length-1;this.eventAnswerCardFold(r,m),this.eventShowTip("請棄掉牌"+m+"張牌");break;case o.ANSWERED:this.eventShowTip("等待其他人…");break;case o.REVIEW:console.log("GameStatus.REVIEW"),a=u[2],this.eventShowQuestion(a),i=JSON.parse(u[3]),this.eventShowAllQuestionAnswer(i);break;case o.VOTING:console.log("GameStatus.VOTING"),a=u[2],this.eventShowQuestion(a),i=JSON.parse(u[3]),this.eventShowAllQuestionAnswer(i);var p=this._playerID===this._masterID;this.eventChooseQuestionAnswer(p);break;case o.VOTED:console.log("GameStatus.VOTED"),i=JSON.parse(u[2]),this.eventShowAllQuestionAnswer(i);var g=this._playerID===this._masterID;this.eventChooseQuestionAnswer(g);break;default:console.log("未設定 reconnet 該做的事")}},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/YellowCardPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./YellowCardHandler.ts","./HandCards.ts","./FoldCards.ts"],(function(e){var n,t,i,s,o,a,r,l,d,h,u,c,w,f,C,_;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,s=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,r=e.Node,l=e.Button,d=e.Label,h=e.Vec3,u=e.RichText,c=e.instantiate,w=e.Component},function(e){f=e.YellowCardHandler},function(e){C=e.HandCards},function(e){_=e.FoldCards}],execute:function(){var g,p,v,b,m,H,Q,A,S,y,q,L,B,k,F,x,V,R,I,D,M,z,E;o._RF.push({},"7a536XvrlROxY0P5Wdjctoi","YellowCardPanel",void 0);var P=a.ccclass,T=a.property;e("YellowCardPanel",(g=P("YellowCardPanel"),p=T(C),v=T(C),b=T(r),m=T(_),H=T(r),Q=T(r),A=T(l),S=T(d),y=T(d),q=T(r),g((k=n((B=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,i(n,"questionHandCards",k,s(n)),i(n,"answerHandCards",F,s(n)),i(n,"questionBoard",x,s(n)),i(n,"foldCards",V,s(n)),i(n,"answerQuestionListView",R,s(n)),i(n,"answerQuestionViewContent",I,s(n)),i(n,"nextRoundButton",D,s(n)),i(n,"infoLabel",M,s(n)),i(n,"tipLabel",z,s(n)),i(n,"yellowCardLayout",E,s(n)),n.eventMainSceneGameEnd=null,n._playerID="",n._roomID="",n._gameHandler=null,n._questionCardButtons=[],n._answerCardButtons=[],n._answerMax=0,n._selectedQuestion="",n._selectedAnswers=[],n._questionAnswers={},n._isFolding=!1,n._selectFoldMax=0,n._selectFoldNum=0,n._selectedFloadCards=[],n}t(n,e);var o=n.prototype;return o.start=function(){this.node.setPosition(h.ZERO),this.foldCards.node.setPosition(h.ZERO),this.close()},o.close=function(){this.node.active=!1,this.questionHandCards.show(!1),this.answerHandCards.show(!1),this.questionBoard.active=!1,this.answerQuestionListView.active=!1,this.nextRoundButton.node.active=!1,this._roomID&&(this._gameHandler.endGame(this._roomID),this._gameHandler=null),this.tipLabel.string="",this._roomID="",this._playerID="",this._questionAnswers={},this._questionCardButtons.length=0,this._answerCardButtons.length=0,this._selectedAnswers.length=0,this._selectedQuestion="",this._answerMax=0,this._isFolding=!1,this._selectFoldMax=0,this._selectFoldNum=0,this._selectedFloadCards.length=0},o.init=function(e,n,t,i,s){this.node.active=!0,this._gameHandler=new f(n,t),this._gameHandler.eventUpdateQuestionCards=this.onUpdateQuestionCards.bind(this),this._gameHandler.eventLockQuestionSelection=this.onLockQuestionSelection.bind(this),this._gameHandler.eventUpdateAnswerCards=this.onUpdateAnswerCards.bind(this),this._gameHandler.eventLockAnswerSelection=this.onLockAnswerSelection.bind(this),this._gameHandler.eventShowQuestion=this.onShowQuestion.bind(this),this._gameHandler.eventShowAllQuestionAnswer=this.onShowAllQuestionAnswer.bind(this),this._gameHandler.eventShowQuestionAnswer=this.onShowQuestionAnswer.bind(this),this._gameHandler.eventChooseQuestionAnswer=this.onChooseQuestionAnswer.bind(this),this._gameHandler.eventAnswerCardFold=this.onAnswerCardFold.bind(this),this._gameHandler.eventShowBestAnswer=this.onShowBestAnswer.bind(this),this._gameHandler.eventVoted=this.onVoted.bind(this),this._gameHandler.eventShowTip=this.onShowTip.bind(this),this._gameHandler.eventClearPrevRound=this.onClearPrevRound.bind(this),this._gameHandler.eventRecordLose=this.onRecordLose.bind(this),this._gameHandler.eventGameEnd=this.onGameEnd.bind(this),this._gameHandler.startGame(e,i,s),this._roomID=e,this.infoLabel.string=e+"\n"+t+"\n("+n+")",this._playerID=n},o.fillBlanks=function(e,n){var t=n.slice();return console.log("fill question:",e,n),e.replace(/_/g,(function(e){return"<color=#FFFF00><u>"+(t.shift()||"_")+"</u></c>"}))},o.onUpdateQuestionCards=function(e){var n=this;this.questionHandCards.setSendData(e.length,this.onSendQuestionClicked.bind(this)),this.questionHandCards.show(!0),this.questionHandCards.list(e,(function(e,t){n._selectedQuestion=e}))},o.onLockQuestionSelection=function(e){this.questionHandCards.lock(e),this.answerHandCards.show(!1)},o.onSendQuestionClicked=function(e){this.questionHandCards.show(!1),this.questionHandCards.lock(!0),this._gameHandler.applicate("question",e[0])},o.onUpdateAnswerCards=function(e){var n=this;this.answerHandCards.show(!0),this.answerHandCards.list(e,(function(e,t){n.questionBoard.active=!0;var i=n.fillBlanks(n._selectedQuestion,t);n.questionBoard.getComponentInChildren(u).string=i}))},o.onLockAnswerSelection=function(e){this.answerHandCards.lock(e),this.questionHandCards.show(!1)},o.onSendAnswerClicked=function(e){this.answerHandCards.show(!1),this._gameHandler.applicate("answer",this._playerID+" "+JSON.stringify(e))},o.onShowQuestion=function(e){console.log("UI 顯示問題:",e);var n=e.split("_");this._answerMax=Math.max(1,n.length-1),this.answerHandCards.setSendData(this._answerMax,this.onSendAnswerClicked.bind(this)),this._selectedQuestion=e,this.questionBoard.active=!0,this.questionBoard.getComponentInChildren(u).string=e},o.onShowQuestionAnswer=function(e,n){console.log("玩家"+e+"送入答案:",n,typeof n),this._questionAnswers[e]=n,this.onShowAllQuestionAnswer(this._questionAnswers)},o.onShowAllQuestionAnswer=function(e){var n=this;this._questionAnswers=e,console.log("顯示所有的答案卡片:",this._questionAnswers),this.answerQuestionListView.active=!0;var t=this.answerQuestionViewContent.children;t.forEach((function(e){return e.active=!1})),Object.keys(e).forEach((function(i,s){var o=t[s];o||((o=c(t[0])).parent=n.answerQuestionViewContent),o.active=!0;var a=n.fillBlanks(n._selectedQuestion,e[i]);console.log("content:",a),o.getComponentInChildren(u).string=a,console.log("\t",o.getComponentInChildren(u).string),o.getComponent(l).node.off("click")})),console.log("顯示答案送出內容，移除 answerQuestionViewContent 的按鈕事件")},o.onChooseQuestionAnswer=function(e){var n=this,t=this.answerQuestionViewContent.children,i=e?this.sendBestQuestionAnswer.bind(this):this.sendWorstQuestionAnswer.bind(this);Object.keys(this._questionAnswers).forEach((function(e,s){t[s].getComponent(l).node.on("click",(function(){return i(e)}),n)})),console.log("設定選擇問答組合，設定觸發 answerQuestionViewContent 的按鈕事件"),this.answerQuestionListView.active=!this._isFolding,this._isFolding?e?this.onShowTip("選擇最符合你提出條件的組合"):(this.onShowTip("選擇不符裁判要求的組合(請先棄完牌)"),this.foldCards.show(!0)):this.onShowTip(e?"選擇最符合你提出條件的組合":"選擇不符裁判要求的組合")},o.onVoted=function(e){this.answerQuestionViewContent.children.forEach((function(e){return e.off("click")})),console.log("已投票，移除 answerQuestionViewContent 的按鈕事件"),this.answerQuestionListView.active=!1},o.onShowBestAnswer=function(e,n){this.questionBoard.active=!0;var t=this.fillBlanks(this._selectedQuestion,e);this.questionBoard.getComponentInChildren(u).string=t,this.answerQuestionListView.active=!1,this._questionAnswers={},this._answerMax=0,this._selectedQuestion="",this.nextRoundButton.node.active=n},o.sendBestQuestionAnswer=function(e){console.log("最佳組合的玩家:",e),this._gameHandler.applicate("choose_best_answer",e+" "+Math.round(1e6*Math.random()))},o.sendWorstQuestionAnswer=function(e){console.log("最差組合的玩家:",e),this._gameHandler.applicate("vote",this._playerID+" "+e)},o.onAnswerCardFold=function(e,n){this._isFolding=!0,console.log("進入棄牌流程"),this.foldCards.show(!0),this.foldCards.selectMax=n,this.foldCards.list(e),this.foldCards.eventSendCallback=this.onSendFoldAnswerClicked.bind(this)},o.onSendFoldAnswerClicked=function(e){this.answerHandCards.show(!1),this.foldCards.show(!1),this._isFolding=!1,this._gameHandler.applicate("fold_answer_card",this._playerID+" "+JSON.stringify(e))},o.onShowTip=function(e){this.tipLabel.string=e},o.onRecordLose=function(e){var n=this.yellowCardLayout.children;n.forEach((function(e){return e.active=!1}));for(var t=0;t<e;t++){var i=n[t];i||((i=c(n[0])).parent=this.yellowCardLayout),i.active=!0}},o.onClearPrevRound=function(){this.questionHandCards.show(!1),this.answerHandCards.show(!1),this.questionBoard.active=!1,this.answerQuestionListView.active=!1,this.nextRoundButton.node.active=!1,this._questionAnswers={},this._answerMax=0,this._selectedQuestion=""},o.onGameEnd=function(){var e;null==(e=this.eventMainSceneGameEnd)||e.call(this),this.nextRoundButton.node.active=!1,this.infoLabel.string=""},o.onNextRoundClicked=function(){this._gameHandler.applicate("next_round")},n}(w)).prototype,"questionHandCards",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(B.prototype,"answerHandCards",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(B.prototype,"questionBoard",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(B.prototype,"foldCards",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=n(B.prototype,"answerQuestionListView",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(B.prototype,"answerQuestionViewContent",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=n(B.prototype,"nextRoundButton",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(B.prototype,"infoLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(B.prototype,"tipLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(B.prototype,"yellowCardLayout",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=B))||L));o._RF.pop()}}}));

System.register("chunks:///_virtual/YellowCardRecord.ts",["cc"],(function(s){var e;return{setters:[function(s){e=s.cclegacy}],execute:function(){e._RF.push({},"962bfAm9SxBtKUI3CbrHESq","YellowCardRecord",void 0);var r=s("Role",function(s){return s[s.PLAYER=0]="PLAYER",s[s.MASTER=1]="MASTER",s}({})),t="YC_GAME_RECORD_INFO";s("GameStatus",function(s){return s[s.GAMING=0]="GAMING",s[s.ASKING=1]="ASKING",s[s.ASKED=2]="ASKED",s[s.REVIEW=3]="REVIEW",s[s.ANSWER=4]="ANSWER",s[s.ANSWERING=5]="ANSWERING",s[s.FOLD=6]="FOLD",s[s.ANSWERED=7]="ANSWERED",s[s.VOTING=8]="VOTING",s[s.VOTED=9]="VOTED",s[s.PICK=10]="PICK",s}({})),s("YellowCardRecord",function(){function s(){this.masterID="",this._players={},this._roundPlayers=[],this.questions=[],this.answers=[],this.askingQuestion=""}var e=s.prototype;return e.add=function(s,e,t){this._players[s]={nickname:e,gameStatus:t,win:0,lose:0,answerCards:[],answerHandCards:[],questionHandCards:[],voted:0,role:r.PLAYER},this._roundPlayers=Object.keys(this._players)},e.del=function(s){delete this._players[s]},e.get=function(s){return this._players[s]},e.clear=function(){this._players={},this._roundPlayers=[],this.questions=[],this.answers=[],this.askingQuestion="",localStorage.removeItem(t)},e.clearAnswerCards=function(){var s=this;this._roundPlayers.forEach((function(e){return s._players[e].answerCards.length=0}))},e.clearWorstVote=function(){var s=this;this._roundPlayers.forEach((function(e){return s._players[e].voted=0}))},e.readData=function(){var s=JSON.parse(localStorage.getItem(t));console.log("YellowCardRecord read localData:",s),this.masterID=s.masterID,this._players=s.players,this._roundPlayers=s.roundPlayers,this.questions=s.questions,this.answers=s.answers,this.askingQuestion=s.askingQuestion},e.writeData=function(){var s={masterID:this.masterID,players:this._players,roundPlayers:this._roundPlayers,questions:this.questions,answers:this.answers,askingQuestion:this.askingQuestion};localStorage.setItem(t,JSON.stringify(s))},e.dropAnswerHandCards=function(s,e){this.dropHandCard(this._players[s].answerHandCards,e)},e.dropHandCard=function(s,e){return e.every((function(e){return s.find((function(s,r,t){if(s===e)return t.splice(r,1),!0}))}))},s}());e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});