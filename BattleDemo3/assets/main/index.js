System.register("chunks:///_virtual/AiIntentData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,i;return{setters:[function(t){n=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"44b8cpbU6hA/53MuLEUTRN4","AiIntentData",void 0);t("AiIntentData",function(){function t(t,n){this._id=void 0,this._intents=void 0,this._id=t,this._intents=n}return t.fromCSV=function(n){var i=n.intents.map((function(t){return t.split(" ")}));return new t(n.id,i)},n(t,[{key:"id",get:function(){return this._id}},{key:"intents",get:function(){return this._intents}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/AudioHelper.ts",["cc","./AudioManager.ts"],(function(n){var u,i,o;return{setters:[function(n){u=n.cclegacy,i=n._decorator},function(n){o=n.AudioManager}],execute:function(){var a,c;u._RF.push({},"b4896iudoVCNYcBglAhYLkq","AudioHelper",void 0);var t=i.ccclass;n("AudioHelper",t("AudioHelper")(((c=function(){function n(){}return n.playMusic=function(n){var u=this.getPath(n);o.instance.playBackgroundMusic(u)},n.playSound=function(n){var u=this.getPath(n);o.instance.playSoundEffect(u)},n.getPath=function(n){return this.audioMap[n]||""},n}()).audioMap={backgroundMusic:"audio/dancing_on_table",clickSound:"audio/click",winSound:"audio/win",loseSound:"audio/lose"},a=c))||a);u._RF.pop()}}}));

System.register("chunks:///_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,i,o,u,a,s,c,r,l,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,u=e.createClass},function(e){a=e.cclegacy,s=e._decorator,c=e.AudioSource,r=e.resources,l=e.AudioClip,d=e.Component}],execute:function(){var f,p,h,b,S,y,g,m;a._RF.push({},"c714bqcI0FN4Y+9uQVoTRJe","AudioManager",void 0);var M=s.ccclass,E=s.property;e("AudioManager",(f=M("AudioManager"),p=E(c),h=E(c),f(((m=function(e){function t(){for(var t,n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return t=e.call.apply(e,[this].concat(u))||this,i(t,"bgmSource",y,o(t)),i(t,"sfxSource",g,o(t)),t.isMusicEnabled=!0,t.isSoundEffectsEnabled=!0,t}n(t,e);var a=t.prototype;return a.onLoad=function(){t._instance?this.destroy():t._instance=this},a.playBackgroundMusic=function(e){this.isMusicEnabled&&this.loadAndPlay(this.bgmSource,e,!0)},a.playSoundEffect=function(e){this.isSoundEffectsEnabled&&this.loadAndPlay(this.sfxSource,e,!1)},a.loadAndPlay=function(e,t,n){r.load(t,l,(function(t,i){t?console.error("Failed to load audio: "+t):(e.clip=i,e.loop=n,e.play())}))},a.setMusicEnabled=function(e){this.isMusicEnabled=e,this.updateAudioState(this.bgmSource,e)},a.setSoundEffectsEnabled=function(e){this.isSoundEffectsEnabled=e,this.updateAudioState(this.sfxSource,e)},a.updateAudioState=function(e,t){t?e.playing||e.play():e.stop()},a.setMusicVolume=function(e){this.bgmSource.volume=Math.max(0,Math.min(1,e))},a.setSoundEffectVolume=function(e){this.sfxSource.volume=Math.max(0,Math.min(1,e))},u(t,null,[{key:"instance",get:function(){return this._instance}}]),t}(d))._instance=null,y=t((S=m).prototype,"bgmSource",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=t(S.prototype,"sfxSource",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=S))||b));a._RF.pop()}}}));

System.register("chunks:///_virtual/BattleManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HandCards.ts","./CombatCardComponent.ts","./CombatCardManager.ts","./GameManager.ts","./CombatEffectManager.ts","./CombatEffectComponent.ts","./CombatCard.ts","./PopupWindowComponent.ts","./HitTag.ts","./CardMover.ts","./CameraCenterMover.ts","./RewardPanel.ts","./CardPreview.ts","./CardComponent.ts","./CharacterInfo.ts","./EmpowerCombatCardList.ts"],(function(t){var e,n,a,r,i,o,s,c,u,d,l,f,h,m,p,C,b,y,g,v,_,w,I,E,T,D,P,x,B,k,U,L,M,O;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,a=t.initializerDefineProperty,r=t.assertThisInitialized,i=t.createClass,o=t.asyncToGenerator,s=t.regeneratorRuntime},function(t){c=t.cclegacy,u=t._decorator,d=t.Node,l=t.Layout,f=t.Label,h=t.ProgressBar,m=t.UITransform,p=t.randomRangeInt,C=t.instantiate,b=t.Component,y=t.v3},function(t){g=t.HandCards},function(t){v=t.CombatCardComponent},function(t){_=t.CombatCardManager},function(t){w=t.GameManager},function(t){I=t.CombatEffectManager},function(t){E=t.CombatEffectComponent},function(t){T=t.CombatCard},function(t){D=t.PopupWindowComponent},function(t){P=t.HitTag},function(t){x=t.CardMover},function(t){B=t.CameraCenterMover},function(t){k=t.RewardPanel},function(t){U=t.CardPreview},function(t){L=t.CardComponent},function(t){M=t.CharacterInfo},function(t){O=t.EmpowerCombatCardList}],execute:function(){var N,z,A,H,S,F,R,q,W,j,V,G,J,Z,K,Q,X,Y,$,tt,et,nt,at,rt,it,ot,st,ct,ut,dt,lt,ft,ht,mt,pt,Ct,bt,yt,gt,vt;c._RF.push({},"75f1fvy7CZE6IJPWLrjCF5k","BattleManager",void 0);var _t=u.ccclass,wt=u.property;t("BattleManager",(N=_t("BattleManager"),z=wt(d),A=wt(d),H=wt(g),S=wt(E),F=wt(E),R=wt(l),q=wt(d),W=wt(D),j=wt(B),V=wt(f),G=wt(f),J=wt(d),Z=wt(k),K=wt(d),Q=wt(U),X=wt(L),Y=wt(h),$=wt(M),N(((vt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,a(e,"combatNode",nt,r(e)),a(e,"cardPrefab",at,r(e)),a(e,"handCards",rt,r(e)),a(e,"myCombatEffectStatus",it,r(e)),a(e,"enemyCombatEffectStatus",ot,r(e)),a(e,"enemyFrontLayout",st,r(e)),a(e,"endTurnButton",ct,r(e)),a(e,"popupWindow",ut,r(e)),a(e,"cameraCenterMover",dt,r(e)),a(e,"energyLabel",lt,r(e)),a(e,"countdownLabel",ft,r(e)),a(e,"pathContainer",ht,r(e)),a(e,"rewardPanel",mt,r(e)),a(e,"useItemBoard",pt,r(e)),a(e,"cardPreview",Ct,r(e)),a(e,"rewardIcon",bt,r(e)),a(e,"expProgressBar",yt,r(e)),a(e,"characterInfo",gt,r(e)),e._currentTurnIndex=0,e._playerUnitId="",e._enemyUnitIds=[],e._unitEnemyIds=[],e._combatCardDataList=void 0,e._recordEffects=[],e._turnOrder=[],e._enemyTeamData=[],e._hittingEnemyId="",e._roundCount=0,e._isBattleEnd=!0,e._itemCard=null,e._curEnemyTeamData=null,e._itemCombatCard=null,e._usingItem="",e}n(e,t);var c=e.prototype;return c.onLoad=function(){e._instance?this.destroy():e._instance=this,this.combatNode.active=!1,this.showEndTurnButton(!1),this.expProgressBar.totalLength=this.expProgressBar.getComponent(m).width,this.expProgressBar.progress=w.instance.characterCombatData.curExp/w.instance.characterCombatData.maxExp},c.getRandomInitiative=function(){return Math.floor(100*Math.random())},c.startBattle=function(){var t=this;this._roundCount=0,this._isBattleEnd&&(this._isBattleEnd=!1,this.combatNode.active=!0,this.scheduleOnce((function(){t.characterInfo.updateTourniquet(),t.setCombatCards(),t.setCombatEffectStatus(),I.instance.onBeginBattle(),t._currentTurnIndex=0,t.startNextUnitTurn()})))},c.skipBattle=function(){this._enemyTeamData.shift()},c.startNextUnitTurn=function(){var t=o(s().mark((function t(){var e,n,a=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this._turnOrder[this._currentTurnIndex],!I.instance.isStun(e)){t.next=5;break}return console.log("狀態影響，回合提前結束"),this.processEndTurn(),t.abrupt("return");case 5:return t.next=7,I.instance.hitRoll(e);case 7:if(e!==this._playerUnitId){t.next=13;break}I.instance.onTurnBegin(this._playerUnitId,this._enemyUnitIds),this.cameraCenterMover.moveToCenter(this.enemyFrontLayout.node),this.startPlayerTurn(),t.next=20;break;case 13:return I.instance.onTurnBegin(e,[this._playerUnitId]),console.log("開始AI行動，等骰命中後護甲動畫跑完"),n=I.instance.units[e],this.cameraCenterMover.moveToCenter(n.status.node),t.next=19,new Promise((function(t){return a.scheduleOnce(t,1)}));case 19:this.startAiTurn(e);case 20:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.startPlayerTurn=function(){var t=o(s().mark((function t(){var e,n,a,r=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.showEndTurnButton(),this.onPlayerTurn(),e=I.instance.takeDiscardCount(this._playerUnitId),console.log("開始玩家行動，手牌數量:",this.handCards.cards.length,"要丟棄:",e),!(e>0)){t.next=9;break}return n=this.handCards.cards.slice(0,e),_.instance.discardCards(n),t.next=9,new Promise((function(t){return r.scheduleOnce(t,2)}));case 9:(a=I.instance.getCountdown(this._playerUnitId))>0?this.startTurnTimer(a):(console.log("正常走這邊，不限時間"),this.countdownLabel.string="");case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.startTurnTimer=function(t){var e=this,n=t;this.schedule((function t(){n--,e.updateTurnTimerUI(n),n<=0&&(e.unschedule(t),e.endPlayerTurn())}),1,t)},c.endPlayerTurn=function(){this.handCards.disableCards(),this.showEndTurnButton(!1),this.processEndTurn()},c.showEndTurnButton=function(t){void 0===t&&(t=!0),this.endTurnButton.active=t},c.updateTurnTimerUI=function(t){this.countdownLabel.string=t.toString()},c.processEndTurn=function(){if(this.isBattleOver())this.endBattle();else{var t=this._turnOrder[this._currentTurnIndex];I.instance.onTurnEnd(t),this._currentTurnIndex++,this._currentTurnIndex>=this._turnOrder.length&&(this._currentTurnIndex=0,I.instance.onRoundEnd(),this._roundCount++,this.handCards.cards.forEach((function(t){var e=t.getComponent(v);e.CombatCard.reset(),e.nameLabel.string=e.CombatCard.Name,e.updateEffects()})),console.log("回合結束後處理debuff，檢查死亡"),this.isBattleOver())?this.endBattle():this.startNextUnitTurn()}},c.startAiTurn=function(){var t=o(s().mark((function t(e){var n,a=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getAiIntention(e),t.next=3,this.executeAiIntention(e,n);case 3:if(console.log("AI行動結束",n),!this.isBattleOver()){t.next=7;break}return this.endBattle(),t.abrupt("return");case 7:return t.next=9,new Promise((function(t){return a.scheduleOnce(t,1)}));case 9:this.processEndTurn();case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),c.getAiIntention=function(t){var e=this._unitEnemyIds[t],n=w.instance.database.aiIntentDatabase.find((function(t){return t.id===e}));return n?n.intents:(console.error("找不到AI的意圖資料",e),[["defense_1","defense_1","attack_1"],["attack_1","attack_1"],["hit_1","hit_1","puncture_1"]])},c.executeAiIntention=function(){var t=o(s().mark((function t(e,n){var a,r,i,o,c,u,d,l,f,h,m,p=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=w.instance.database.combatCardDatabase,r=this._roundCount%n.length,i=n[r].map((function(t){return a.find((function(e){return e.cardId===t}))})),I.instance.intentionHandsTip(e,i.length),t.next=6,new Promise((function(t){return p.scheduleOnce(t,1)}));case 6:for(o=I.instance.takeDiscardCount(e),c=0;c<o;c++)i.shift();I.instance.intentionHandsTip(e,i.length),console.log("提示敵人棄牌"),i.forEach((function(t,e){t||(console.error("combatCardDataList 中有undefined:",i),i.splice(e,1))})),u=!1,d=1.5;case 13:if(!(i.length>0)){t.next=36;break}if(l=i.shift()){t.next=19;break}return console.error("combatCardData 沒有資料:",l),i.length=0,t.abrupt("break",36);case 19:return console.log("AI行動:",null==l?void 0:l.cardName),f=this.parseCombatCard(l),h=new T(l,f,u),t.next=24,I.instance.intentionHandsTip(e,i.length);case 24:return(m=C(this.cardPrefab)).parent=this.node,m.active=!0,m.getComponent(v).setup(h),t.next=30,x.moveCard(m,this.node,y(-200,150,0),d,1);case 30:return I.instance.onCardPlayed(h.Effects,e,[this._playerUnitId]),t.next=33,new Promise((function(t){return p.scheduleOnce(t,1)}));case 33:m.destroy(),t.next=13;break;case 36:return t.next=39,new Promise((function(t){return p.scheduleOnce(t,1)}));case 39:return t.abrupt("return",t.sent);case 40:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.checkForDeaths=function(){this._turnOrder=this._turnOrder.filter((function(t){return I.instance.isAlive(t)}))},c.isBattleOver=function(){var t=this;this.checkForDeaths();var e=I.instance.isAlive(this._playerUnitId),n=!1;return[].concat(this._enemyUnitIds).forEach((function(e){I.instance.isAlive(e)?n=!0:(console.log("敵人死亡",t._unitEnemyIds[e]),t.handCards.removeTag(e),t._enemyUnitIds.splice(t._enemyUnitIds.indexOf(e),1),delete t._unitEnemyIds[e],I.instance.quit(e))})),this._isBattleEnd=!e||!n,this._isBattleEnd},c.endBattle=function(){var t=o(s().mark((function t(){var e=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handCards.clear(),this.showEndTurnButton(!1),t.next=4,new Promise((function(t){return e.scheduleOnce(t,1)}));case 4:this.enemyFrontLayout.node.removeAllChildren(),this._enemyUnitIds.length=0,this._hittingEnemyId="",I.instance.isAlive(this._playerUnitId)?(this.showVictoryMessage(),this.playVictoryAnimation(),console.log("this._playerUnitId:",this._playerUnitId),w.instance.characterCombatData.curHP=I.instance.units[this._playerUnitId].HP):this.showDefeatMessage(),I.instance.onEnBattle(),this.combatNode.active=!1;case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.showDefeatMessage=function(){var t=this;this.popupWindow.openPopup("戰鬥結果","敵方勝利",[{label:"返回主畫面",callback:function(){t.combatNode.active=!1,console.warn("玩家輸了，再次挑戰"),t.restartBattle()}},{label:"重置角色",callback:function(){console.warn("刪角色了"),w.instance.characterCombatData.reset(),t.popupWindow.openPopup("角色已重置","角色資料已刪除",[{label:"返回主畫面",callback:function(){return t.restartBattle()}}])}}])},c.restartBattle=function(){this._enemyTeamData=[].concat(w.instance.database.enemyTeamDatabase),w.instance.characterCombatData.combatLose(),w.instance.characterCombatData.write(),this.expProgressBar.progress=0,this.pathContainer.active=!0},c.showVictoryMessage=function(){var t=this;this.popupWindow.openPopup("戰鬥結果","恭喜您獲得勝利",[{label:"確認",callback:function(){var e={id:"dialog_002",name:"戰鬥勝利獎勵",img:"npc_maze_merchant",dialogue:"獎勵由勝利者全拿！",rewards:[{id:"exp_1",name:"經驗值",img:"experience_point",amount:t._curEnemyTeamData.cr},{id:"money_1",name:"金幣",img:"money",amount:p(5,12)}]},n=C(t.rewardIcon.node);n.active=!0;var a=n.getComponent(L);a._cardId=e.id,a._cardName=e.name,a._cardIcon=e.img,a.description=e.dialogue,t.cardPreview.refresh(n),t.cardPreview.listReward(e.rewards,{money_1:w.instance.characterCombatData.money})}}])},c.playVictoryAnimation=function(){},c.parseCombatCard=function(t){var e=w.instance.database.combatEffectDatabase,n=[];return t.combatEffects.forEach((function(t){var a=e.find((function(e){return e.effectId===t.id}));a?n.push(I.instance.getCombatEffect(a)):console.log("卡片抽光了")})),n},c.setEnemyData=function(){this._enemyTeamData=w.instance.database.enemyTeamDatabase.flat(),console.log("this._enemyTeamData:",this._enemyTeamData.length)},c.setCombatCards=function(){var t=this,e=O.instance.empowerCombatCards;this._combatCardDataList=Object.values(e).map((function(t){return t.cards})).flat(),console.log("可用牌庫",this._combatCardDataList.map((function(t){return t.cardName})));var n=[];this._combatCardDataList.forEach((function(e){var a=C(t.cardPrefab);a.parent=t.cardPrefab.parent,a.active=!0;var r=t.parseCombatCard(e),i=new T(e,r,!1);a.getComponent(v).setup(i),n.push(a)})),_.instance.clear(),_.instance.addCardsToDeck(n),_.instance.shuffleDeck()},c.setCombatEffectStatus=function(){var t=w.instance.characterCombatData.maxHP,e=w.instance.characterCombatData.ac;this._playerUnitId=I.instance.join(this.myCombatEffectStatus,"玩家",t,e,3,0,0,0,0),I.instance.fixHp(this._playerUnitId,w.instance.characterCombatData.curHP),this.loadEnemyData(),this._turnOrder=[this._playerUnitId].concat(this._enemyUnitIds)},c.loadEnemyData=function(){var t=this,e=this._enemyTeamData.shift();if(e){var n=w.instance.database.enemyDatabase;e.enemies.forEach((function(e){var a=n.find((function(t){return t.id===e}));console.log("載入敵人:",a.name);var r=C(t.enemyCombatEffectStatus.node);r.parent=t.enemyFrontLayout.node,r.active=!0;var i=r.getComponent(E);i.Image=a.img;var o=I.instance.join(i,a.name,a.hp,a.ac,3,0,a.dexterity,a.wisdom,a.resilience);t._enemyUnitIds.push(o),t._unitEnemyIds[o]=e,r.getComponentInChildren(P).tagID=o})),this._curEnemyTeamData=e,this.handCards.catchTag()}else this.popupWindow.openPopup("恭喜您","已打倒全部敵人，挑戰成功！",[{label:"返回主畫面",callback:function(){t.combatNode.active=!1,console.warn("玩家勝利，再次挑戰"),t.pathContainer.active=!0,t._enemyTeamData=[].concat(w.instance.database.enemyTeamDatabase)}}])},c.onPlayerTurn=function(){var t=this._playerUnitId;this._recordEffects.length=0,this.energyLabel.string=I.instance.getEnergy(t);var e=I.instance.getDrawCount(t);I.instance.getCountdown(t);_.instance.drawCards(e)},c.onRoundEndClicked=function(){},c.onTurnEndClicked=function(){this.endPlayerTurn()},c.onTouchedCardEvent=function(t){var e=t.getComponent(v).CombatCard;this.handCards.setNeedTarget(e.NeedTarget)},c.onPlayCardCheckEvent=function(t,e){var n=t.getComponent(v).CombatCard,a=this._playerUnitId;if(n){if(!I.instance.tryCostFee(a,n))return console.log("沒有足夠的能量"),void this.handCards.cancelSelect();n.NeedTarget&&(this._hittingEnemyId=e.getComponent(P).tagID,this._hittingEnemyId||console.error("!!!!!!!!!!!!!!!!!!!!!沒有選擇目標!!!!!!!!!!!!!!!!!!!!")),_.instance.playCard(t)}else console.error("沒有選擇卡牌")},c.onPlayCardEvent=function(t){var e,n=this,a=t.Effects,r=this._playerUnitId,i=this._hittingEnemyId;this._hittingEnemyId="";var o=[].concat(a);if(t.EvolutionEffects.forEach((function(t){return o.push(n.parseCombatEffect(t.effectId))})),console.log("combatEffects:",o.map((function(t){return t.effectName}))),i||!t.NeedTarget){if(i)o.some((function(t){return"cleave"===t.effectType}))?(console.log("順劈"),I.instance.onCardPlayed(o,r,this._enemyUnitIds)):I.instance.onCardPlayed(o,r,[i]);else I.instance.onCardPlayed(o,r,this._enemyUnitIds);this.energyLabel.string=I.instance.getEnergy(r),(e=this._recordEffects).push.apply(e,a),console.log("本回合已使用效果:",this._recordEffects.map((function(t){return t.effectType})));var s=this._recordEffects.map((function(t){return t.effectType}));this.handCards.cards.forEach((function(t,e){var n=t.getComponent(v),a=n.CombatCard;s.length>0&&a.tryEvolutions(s)&&(a.EvolutionEffects.forEach((function(t){n.nameLabel.string=t.name})),n.updateEffects())}));var c=I.instance.takeDiscardCount(this._playerUnitId);if(console.log("出牌時受棄牌效果影響，手牌數量:",this.handCards.cards.length,"要丟棄:",c),c>0){var u=this.handCards.cards.slice(0,c);_.instance.discardCards(u)}}else console.error("沒有選擇目標",i)},c.onPlayedCardEvent=function(t){var e=this;if(!this._isBattleEnd){var n=this._playerUnitId;if(t.CombatCard.reset(),t.nameLabel.string=t.CombatCard.Name,t.updateEffects(),this.isBattleOver())this.endBattle();else{var a=O.instance.empowerCombatCards,r=I.instance.getExtraDraw(n);Object.keys(r).forEach((function(t){var i=r[t],o=[],s=!1;switch(t){case"atk":I.instance.tryExtraDraw(n,t)&&(o=Object.values(a).map((function(t){return t.cards})).flat().filter((function(t){return t.cardId.indexOf("attack")>-1})),s=!0);break;case"def":I.instance.tryExtraDraw(n,t)&&(o=Object.values(a).map((function(t){return t.cards})).flat().filter((function(t){return t.cardId.indexOf("defense")>-1})),s=!0);break;case"ran":if(I.instance.tryExtraDraw(n,t))return void _.instance.drawCards(i);break;case"steal":if(console.log("extra steal:",r[t]),I.instance.tryExtraDraw(n,t))return _.instance.drawCards(i),void console.warn("steal 效果尚未實作")}o=o.sort((function(){return Math.random()-.5})).slice(0,i);var c=e.parseCombatCards(o,s);_.instance.unshiftCardsToDraw(c),_.instance.drawCards(i)}))}}},c.parseCombatCards=function(t,e){var n=this;void 0===e&&(e=!1);var a=[];return t.forEach((function(t){var r=C(n.cardPrefab);r.parent=n.cardPrefab.parent,r.active=!0;var i=n.parseCombatCard(t),o=new T(t,i,e);r.getComponent(v).setup(o),a.push(r)})),a},c.onEnermyAttackClicked=function(){var t=o(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.showVictoryMessage();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.parseCombatEffect=function(t){var e=w.instance.database.combatEffectDatabase.find((function(e){return e.effectId===t}));return console.log("combatEffectData:",e),I.instance.getCombatEffect(e)},c.item=function(t){var e=w.instance.database.combatCardDatabase.find((function(e){return e.cardId===t})),n=this.parseCombatCards([e],true);this._itemCard=n[0],this._itemCombatCard=new T(e,this.parseCombatCard(e),true);var a=this.node.getComponent(m).convertToNodeSpaceAR(this.useItemBoard.worldPosition);_.instance.previewCard(this._itemCard,1.5,0,1,this.useItemBoard,a.add3f(0,20,0)),this.useItemBoard.active=!0,console.log("this._recordEffects:",this._recordEffects)},c.onTourniquetItemClicked=function(){w.instance.characterCombatData.tourniquetCount<=0?console.log("沒有可用的 tourniquet"):(this._usingItem="tourniquet",this.item("tourniquet_1"))},c.onHPItemClicked=function(){w.instance.characterCombatData.hpPotionCount<=0?console.log("沒有可用的 hp potion"):(this._usingItem="hp_potion",this.item("hp_potion_1"))},c.onUseItemButtonClicked=function(){this.useItemBoard.active=!1,I.instance.tryCostFee(this._playerUnitId,this._itemCombatCard)?("tourniquet"===this._usingItem?(w.instance.characterCombatData.tourniquetCount--,this.characterInfo.updateTourniquet()):"hp_potion"===this._usingItem&&(w.instance.characterCombatData.hpPotionCount--,this.characterInfo.updateHpPotion()),this._usingItem="",_.instance.consumeCard(this._itemCard)):this.onCancelItemButtonClicked()},c.onCancelItemButtonClicked=function(){this.useItemBoard.active=!1,this._usingItem="",this._itemCard.destroy(),this._itemCard=null,this._itemCombatCard=null},i(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(b))._instance=null,nt=e((et=vt).prototype,"combatNode",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=e(et.prototype,"cardPrefab",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=e(et.prototype,"handCards",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e(et.prototype,"myCombatEffectStatus",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=e(et.prototype,"enemyCombatEffectStatus",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e(et.prototype,"enemyFrontLayout",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=e(et.prototype,"endTurnButton",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=e(et.prototype,"popupWindow",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=e(et.prototype,"cameraCenterMover",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt=e(et.prototype,"energyLabel",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=e(et.prototype,"countdownLabel",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ht=e(et.prototype,"pathContainer",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mt=e(et.prototype,"rewardPanel",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(et.prototype,"useItemBoard",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ct=e(et.prototype,"cardPreview",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bt=e(et.prototype,"rewardIcon",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yt=e(et.prototype,"expProgressBar",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gt=e(et.prototype,"characterInfo",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=et))||tt));c._RF.pop()}}}));

System.register("chunks:///_virtual/CameraCenterMover.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var e,r,n,t,i,a,u,c,d,l,s,f,p;return{setters:[function(o){e=o.applyDecoratedDescriptor,r=o.inheritsLoose,n=o.initializerDefineProperty,t=o.assertThisInitialized},function(o){i=o.cclegacy,a=o._decorator,u=o.Node,c=o.v3,d=o.Vec3,l=o.view,s=o.UITransform,f=o.tween,p=o.Component}],execute:function(){var g,m,b,h,v,y,N,w,z,F,C,k,E,M,T,x;i._RF.push({},"26e98L2djNEAIefDtGVZOdA","CameraCenterMover",void 0);var O=a.ccclass,D=a.property;o("CameraCenterMover",(g=O("CameraCenterMover"),m=D(u),b=D([u]),h=D([u]),v=D([u]),g((w=e((N=function(o){function e(){for(var e,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i))||this,n(e,"touchPanel",w,t(e)),n(e,"moveX",z,t(e)),n(e,"moveY",F,t(e)),n(e,"foregroundNodes",C,t(e)),n(e,"midgroundNodes",k,t(e)),n(e,"backgroundNodes",E,t(e)),n(e,"foregroundFactor",M,t(e)),n(e,"midgroundFactor",T,t(e)),n(e,"backgroundFactor",x,t(e)),e}r(e,o);var i=e.prototype;return i.onLoad=function(){this.touchPanel.on(u.EventType.TOUCH_MOVE,this.onTouchMove,this)},i.onTouchMove=function(o){var e=o.getDelta();this.moveByOffset(c(e.x,e.y,0))},i.moveByOffset=function(o){var e=this;o=new d(this.moveX?o.x:0,this.moveY?o.y:0,0),this.foregroundNodes.forEach((function(r){e.positionNode(r,o,e.foregroundFactor)})),this.midgroundNodes.forEach((function(r){e.positionNode(r,o,e.midgroundFactor)})),this.backgroundNodes.forEach((function(r){e.positionNode(r,o,e.backgroundFactor)}))},i.positionNode=function(o,e,r){var n=new d(e.x*r,e.y*r,e.z);o.position=o.position.clone().add(n)},i.moveToCenter=function(o){var e=this,r=l.getVisibleSize(),n=new d(r.width/2,r.height/2,0),t=o.getComponent(s).convertToWorldSpaceAR(new d(0,0,0)),i=new d(this.moveX?n.x-t.x:0,this.moveY?n.y-t.y:0,0);this.foregroundNodes.forEach((function(o){e.moveNode(o,i,e.foregroundFactor)})),this.midgroundNodes.forEach((function(o){e.moveNode(o,i,e.midgroundFactor)})),this.backgroundNodes.forEach((function(o){e.moveNode(o,i,e.backgroundFactor)}))},i.moveNode=function(o,e,r){var n=new d(e.x*r,e.y*r,e.z),t=o.position.clone().add(n);f(o).to(1,{position:t},{easing:"quadInOut"}).start()},e}(p)).prototype,"touchPanel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(N.prototype,"moveX",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),F=e(N.prototype,"moveY",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),C=e(N.prototype,"foregroundNodes",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),k=e(N.prototype,"midgroundNodes",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),E=e(N.prototype,"backgroundNodes",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M=e(N.prototype,"foregroundFactor",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),T=e(N.prototype,"midgroundFactor",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),x=e(N.prototype,"backgroundFactor",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),y=N))||y));i._RF.pop()}}}));

System.register("chunks:///_virtual/CardComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PixelImage.ts"],(function(e){var t,n,o,r,c,i,a,s;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){o=e.cclegacy,r=e._decorator,c=e.Sprite,i=e.v3,a=e.Component},function(e){s=e.PixelImage}],execute:function(){var d;o._RF.push({},"fb275fVietK178DsZ4xC8/t","CardComponent",void 0);var p=r.ccclass;r.property,e("CardComponent",p("CardComponent")(d=function(e){function o(){for(var t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))||this)._cardId="",t._cardName="",t._cardIcon="",t.isFliped=!1,t.description="",t}return t(o,e),o.prototype.setIcon=function(e){var t;this._cardIcon=e,null==(t=this.getComponent(s))||t.setSpriteFrame(e),this.node.getComponent(c).sizeMode=c.SizeMode.RAW,this.node.scale=i(2,2,2),this.node.active=!0},n(o,[{key:"cardId",get:function(){return this._cardId}},{key:"cardName",get:function(){return this._cardName}}]),o}(a))||d);o._RF.pop()}}}));

System.register("chunks:///_virtual/CardMover.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,o,r,a,i,s,c;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,o=n._decorator,r=n.UITransform,a=n.tween,i=n.v3,s=n.Vec3,c=n.Component}],execute:function(){var u;e._RF.push({},"84f9242HqlIxoYCUsq4N1ow","CardMover",void 0);var d=o.ccclass;n("CardMover",d("CardMover")(u=function(n){function e(){return n.apply(this,arguments)||this}return t(e,n),e.moveCard=function(n,t,e,o,a,i){void 0===o&&(o=1),void 0===a&&(a=.02),void 0===i&&(i=.25);var s=n.parent.getComponent(r),c=t.getComponent(r);if(!s||!c)return Promise.reject(new Error("UITransform component is missing"));var u=s.convertToWorldSpaceAR(n.position);n.removeFromParent(),n.parent=t;var d=c.convertToNodeSpaceAR(u);return n.setPosition(d),this.animateCardMovement(n,e,o,a,i)},e.animateCardMovement=function(n,t,e,o,r){return new Promise((function(s){var c=a().delay(o).call((function(){return s()})),u=a(n).delay(r/2).to(r/4,{scale:i(e,e,1)},{easing:"quadInOut"}),d=a(n).to(r,{position:t},{easing:"quadInOut"});a(n).parallel(d,u,c).start()}))},e.scatterCards=function(n,t,e,o){return new Promise((function(r){n.forEach((function(n){var i=e[0],c=e[1],u=2*Math.random()*Math.PI,d=i+Math.random()*(c-i),v=new s(Math.cos(u),Math.sin(u),0),l=s.scaleAndAdd(new s,t.position,v,d);a(n).to(o,{position:l},{easing:"cubicOut"}).call((function(){return r()})).start()}))}))},e}(c))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/CardPreview.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CardComponent.ts","./QuestInteraction.ts","./RewardInteraction.ts","./GameManager.ts"],(function(e){var t,n,i,r,a,o,l,s,c,u,p,C,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Node,s=e.Label,c=e.Component},function(e){u=e.CardComponent},function(e){p=e.QuestInteraction},function(e){C=e.RewardInteraction},function(e){d=e.GameManager}],execute:function(){var h,f,m,v,w,g,b,y,P,_,L;a._RF.push({},"6d5ealQPgFJwL+MefBf+Ms3","CardPreview",void 0);var q=o.ccclass,k=o.property;e("CardPreview",(h=q("CardPreview"),f=k(l),m=k(l),v=k(l),w=k(s),h((y=t((b=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"mainContainer",y,r(t)),i(t,"questContainer",P,r(t)),i(t,"rewardContainer",_,r(t)),i(t,"descriptionLabel",L,r(t)),t._card=null,t._oriParent=null,t.nextPathCallback=null,t}n(t,e);var a=t.prototype;return a.refresh=function(e){var t,n;this.node.active=!0,this._card=e,this._oriParent=e.parent,e.parent=this.mainContainer;var i=e.getComponent(u);this.descriptionLabel.string=i.description,null==(t=this.questContainer.getComponent(p))||t.reset(),null==(n=this.rewardContainer.getComponent(C))||n.setDescription(i.description)},a.close=function(){var e,t,n;this.node.active=!1,this._card.parent=this._oriParent,this.descriptionLabel.string="",this._card.getComponent(u).isFliped=!1,null==(e=this.questContainer.getComponent(p))||e.close(),null==(t=this.rewardContainer.getComponent(C))||t.close(),this.questContainer.active=!1,this.rewardContainer.active=!1,d.instance.characterCombatData.write(),null==(n=this.nextPathCallback)||n.call(this)},a.listQuest=function(e){var t;this.questContainer.active=!0,null==(t=this.questContainer.getComponent(p))||t.listQuest(e)},a.listReward=function(e,t){var n;this.rewardContainer.active=!0,null==(n=this.rewardContainer.getComponent(C))||n.listReward(e,t)},a.onCloseClicked=function(){var e;null!=(e=this.rewardContainer.getComponent(C))&&e.isBlocked()||this.close()},a.onCloseButtonClicked=function(){this.close()},t}(c)).prototype,"mainContainer",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(b.prototype,"questContainer",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(b.prototype,"rewardContainer",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(b.prototype,"descriptionLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=b))||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterCombatData.ts",["cc"],(function(t){var e,i;return{setters:[function(t){e=t.cclegacy,i=t.randomRangeInt}],execute:function(){e._RF.push({},"b0052CXTd5Og7XDST/d9g4h","CharacterCombatData",void 0);t("CharacterCombatData",function(){function t(){this._level=1,this._combatPoints=0,this._abilitiyModifers={},this._empowerCardRanks={},this.empowerCardDatabase=[],this.maxHP=6,this.curHP=6,this.ac=8,this.maxExp=2,this.curExp=0,this.money=0,this.tourniquetCount=2,this.hpPotionCount=1,this._lottery=[15,9,4,2,1]}var e=t.prototype;return e.reset=function(){var t;t="character_abilitiy_modifiers",localStorage.removeItem(t),t="character_empower_card_ranks",localStorage.removeItem(t),t="character_data",localStorage.removeItem(t),this.curHP=this.maxHP=6,this.ac=8,this.maxExp=2,this.curExp=0,this.money=0,this.tourniquetCount=2,this.hpPotionCount=1},e.read=function(){var t,e,i=this;t="character_abilitiy_modifiers",e=JSON.parse(localStorage.getItem(t)||"{}"),Object.keys(e).forEach((function(t){i._abilitiyModifers[t]&&(i._abilitiyModifers[t]=e[t])})),console.log("savedData:",e),t="character_empower_card_ranks",e=JSON.parse(localStorage.getItem(t)||"{}"),Object.keys(e).forEach((function(t){i._empowerCardRanks[t]=e[t]})),console.log("savedData:",e),t="character_data",(e=JSON.parse(localStorage.getItem(t)||"{}")).maxExp&&(this.maxExp=e.maxExp),e.curExp&&(this.curExp=e.curExp),e.level&&(this._level=e.level),e.maxHP&&(this.maxHP=e.maxHP),e.curHP&&(this.curHP=e.curHP),e.money&&(this.money=e.money),e.tourniquetCount?this.tourniquetCount=e.tourniquetCount:this.tourniquetCount+=5,e.hpPotionCount?this.hpPotionCount=e.hpPotionCount:this.hpPotionCount+=2,console.log("savedData:",e),this.maxExp=Math.pow(2,this._level)},e.write=function(){localStorage.setItem("character_abilitiy_modifiers",JSON.stringify(this._abilitiyModifers)),localStorage.setItem("character_empower_card_ranks",JSON.stringify(this._empowerCardRanks));var t={maxExp:this.maxExp,curExp:this.curExp,level:this._level,maxHP:this.maxHP,curHP:this.curHP,money:this.money,tourniquetCount:this.tourniquetCount,hpPotionCount:this.hpPotionCount};localStorage.setItem("character_data",JSON.stringify(t)),console.log("寫入 character_data:",t)},e.getCombatAbilities=function(t){return this._abilitiyModifers[t]||0},e.getEmpowerCardRank=function(t){return this._empowerCardRanks[t]||0},e.getEmpowerCardRanks=function(){return this._empowerCardRanks},e.combatWin=function(){},e.combatLose=function(){this.curHP=this.maxHP,this.curExp=0,this.money=0,this.tourniquetCount=2,this.hpPotionCount=1},e.tryLevelUp=function(){this.curExp<this.maxExp?console.warn("Not enough experience to level up",this.curExp,"/",this.maxExp):(this._level++,this.maxExp=Math.pow(2,this._level),this.curExp=Math.max(0,this.curExp-this.maxExp),this.maxHP+=2*this._level,this.curHP=this.maxHP)},e.increaseCombatAbility=function(t,e){return void 0===e&&(e=1),!!this._abilitiyModifers[t]&&(this._abilitiyModifers[t]=this.getCombatAbilities(t)+e,!0)},e.resetCombatAbilities=function(){this._combatPoints+=Object.values(this._abilitiyModifers).reduce((function(t,e){return t+e}),0),this._abilitiyModifers={}},e.tryIncreaseEmpowerCardRank=function(t,e){var i=this;void 0===e&&(e=1);var a=this.getEmpowerCardRank(t)+e;return this.empowerCardDatabase.some((function(e){return e.regimentation===t&&e.regimentationRank===a&&(i._empowerCardRanks[t]=a,!0)}))},e.resetEmpowerCardRanks=function(){this._combatPoints+=Object.values(this._empowerCardRanks).reduce((function(t,e){return t+e}),0),this._empowerCardRanks={}},e.getRewardOption=function(){var t=this,e="",a=this._lottery.length-1,r=this.empowerCardDatabase.slice().sort((function(){return Math.random()-.5})).find((function(r){var o=r.regimentation,n=t.getEmpowerCardRank(o)+1;return!(n!=r.regimentationRank||n>a)&&(t._lottery[n]>i(0,20)?(console.log("rank up to:",n,r.empowerName),!0):void(e=o))}));return r||this.empowerCardDatabase.find((function(i){var r=i.regimentation;return t.getEmpowerCardRank(r)<=a&&r===e}))},e.getRewardOptionList=function(){for(var t=50,e=[];e.length<3;){var i=this.getRewardOption();if(e.includes(i)||e.push(i),--t<=0)break}return e},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterInfo.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./FloatingTextComponent.ts"],(function(t){var e,n,o,a,r,i,u,l,c,s,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,i=t._decorator,u=t.Label,l=t.Vec3,c=t.Component},function(t){s=t.GameManager},function(t){p=t.FloatingTextComponent}],execute:function(){var b,f,h,m,y,g,C,L,x,F,d;r._RF.push({},"b2fb48DkpxFKquBibeqN5SV","CharacterInfo",void 0);var v=i.ccclass,D=i.property;t("CharacterInfo",(b=v("CharacterInfo"),f=D(u),h=D(p),m=D(u),y=D(u),b((L=e((C=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r))||this,o(e,"moneyLabel",L,a(e)),o(e,"moneyFloatingText",x,a(e)),o(e,"tourniquetLabel",F,a(e)),o(e,"hpPotionLabel",d,a(e)),e}n(e,t);var r=e.prototype;return r.updateMoney=function(t){var e=this;t?(this.moneyFloatingText.startPoint=new l(0,t<=0?20:-20,0),this.moneyFloatingText.showNumber(t,(function(){e.moneyLabel.string=s.instance.characterCombatData.money.toString()}))):this.moneyLabel.string=s.instance.characterCombatData.money.toString()},r.updateTourniquet=function(){this.tourniquetLabel.string="止血帶 x"+s.instance.characterCombatData.tourniquetCount},r.updateHpPotion=function(){this.hpPotionLabel.string="生命藥水 x"+s.instance.characterCombatData.hpPotionCount},e}(c)).prototype,"moneyLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(C.prototype,"moneyFloatingText",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(C.prototype,"tourniquetLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=e(C.prototype,"hpPotionLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=C))||g));r._RF.pop()}}}));

System.register("chunks:///_virtual/CheckBoxComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,c,n,o,r,s,a,h;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,c=e.initializerDefineProperty,n=e.assertThisInitialized,o=e.createClass},function(e){r=e.cclegacy,s=e._decorator,a=e.Node,h=e.Component}],execute:function(){var u,k,l,p,d,C;r._RF.push({},"9182cS2L5BPUIFExtxBBEUL","CheckBoxComponent",void 0);var f=s.ccclass,m=s.property;e("CheckBoxComponent",(u=f("CheckBoxComponent"),k=m(a),u((d=i((p=function(e){function i(){for(var i,t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return i=e.call.apply(e,[this].concat(o))||this,c(i,"checkmark",d,n(i)),c(i,"isRadio",C,n(i)),i._isChecked=!1,i}t(i,e);var r=i.prototype;return r.onLoad=function(){this.checkmark.active=this._isChecked},r.check=function(){this._isChecked=!0,this.checkmark.active=!0},r.cancel=function(){this._isChecked=!1,this.checkmark.active=!1},r.onClicked=function(){this.isRadio&&!this._isChecked&&this.node.parent.getComponentsInChildren(i).forEach((function(e){return e.cancel()})),this._isChecked=!this._isChecked,this.checkmark.active=this._isChecked},o(i,[{key:"isChecked",get:function(){return this._isChecked}}]),i}(h)).prototype,"checkmark",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(p.prototype,"isRadio",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l=p))||l));r._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCard.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"7ca924FaMxPpJUAkJlPtpzg","CombatCard",void 0);e("CombatCard",function(){var e=n.prototype;function n(e,t,n){this._data=null,this._effects=[],this._evolutionEffects=[],this._feeType=void 0,this._fee=void 0,this._consumable=void 0,this._range=void 0,e?(this._data=e,this._feeType=e.feeType,this._fee=e.fee,this._range=e.range,this._effects=t,this._consumable=n):console.error("CombatCardData is null")}return e.tryEvolutions=function(e){var t=this;this._evolutionEffects.length=0;var n=!1;return this._data.evolutions.forEach((function(i){var s=i.conditions.split(" ").every((function(t){return e.includes(t)}));return s&&(t._evolutionEffects.push({name:i.name,effectId:i.effectId,effectName:i.effectName,feeType:i.feeType,fee:i.fee,range:i.range}),n=!0),s})),n},e.changeFee=function(e,t){this._feeType=e,this._fee=t},e.changeRange=function(e){this._range=e},e.reset=function(){this._evolutionEffects.length=0,this._feeType=this._data.feeType,this._fee=this._data.fee,this._range=this._data.range},t(n,[{key:"Id",get:function(){return this._data.cardId}},{key:"Name",get:function(){return this._data.cardName}},{key:"Effects",get:function(){return this._effects}},{key:"EvolutionEffects",get:function(){return this._evolutionEffects}},{key:"Description",get:function(){return this._data.getDescription("\n")}},{key:"FeeType",get:function(){return this._feeType}},{key:"Fee",get:function(){return this._fee}},{key:"Consumable",get:function(){return this._consumable}},{key:"Range",get:function(){return this._range}},{key:"NeedTarget",get:function(){return"None"!=this.Range}}]),n}());n._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCardComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,a,n,i,r,o,l,s,u,c,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,r=e.createClass},function(e){o=e.cclegacy,l=e._decorator,s=e.Label,u=e.Sprite,c=e.Color,f=e.Component}],execute:function(){var b,m,p,h,d,C,g,y,L,v,E,F,V;o._RF.push({},"7a72cWn7flKx465/nIaH80W","CombatCardComponent",void 0);var w=l.ccclass,S=l.property;e("CombatCardComponent",(b=w("CombatCardComponent"),m=S(s),p=S(s),h=S(s),d=S(s),C=S(s),b((L=t((y=function(e){function t(){for(var t,a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,n(t,"nameLabel",L,i(t)),n(t,"feeLabel",v,i(t)),n(t,"mainValueLabel",E,i(t)),n(t,"secondaryValueLabel",F,i(t)),n(t,"effectsLabel",V,i(t)),t._combatCard=null,t}a(t,e);var o=t.prototype;return o.setup=function(e){this._combatCard=e,this.nameLabel.string=e.Name,this.updateFee(e);var t=0,a=[];this.CombatCard.Effects.forEach((function(e){"damage"===e.effectType&&(t+=e.value),a.push(e.effectName)})),this.mainValueLabel.string=t?t.toString():"",this.effectsLabel.string=a.join("\n"),this.updateEffects()},o.updateEffects=function(){var e=this,t=0,a=0,n=0,i=[],r=[];this.CombatCard.Effects.forEach((function(e){"damage"===e.effectType?t+=e.value:"defense"===e.effectType?n+=e.value:e.diceInfo.indexOf("d")>-1&&(i.push(e.diceInfo),a=e.value),r.push(e.effectName)})),this.CombatCard.EvolutionEffects.forEach((function(t){r.includes(t.effectName)||r.push(t.effectName),e.CombatCard.changeFee(t.feeType,parseInt(t.fee,10)),e.CombatCard.changeRange(t.range)})),this.effectsLabel.string=r.join("\n"),this.mainValueLabel.string="",this.secondaryValueLabel.string="",t>0?this.mainValueLabel.string=t.toString():a>0?(this.mainValueLabel.string=a.toString(),this.secondaryValueLabel.string=i.join("\n")):n>0&&(this.mainValueLabel.string=n.toString()),this.updateFee(this.CombatCard)},o.updateFee=function(e){var t="";"action"===e.FeeType?t="動作":"reaction"===e.FeeType?t="反應":"bonus"===e.FeeType&&(t="備戰"),this.feeLabel.string=t?e.Fee+"\n"+t:e.Fee.toString()},o.isConsumable=function(){var e;return(null==(e=this.CombatCard)?void 0:e.Consumable)||!1},o.onNormalStatus=function(){this.isConsumable()?this.getComponent(u).color=new c(255,255,0):this.getComponent(u).color=new c(0,255,0)},o.onPlayedCardStatus=function(){this.isConsumable()||(this.getComponent(u).color=new c(0,255,255))},r(t,[{key:"Name",get:function(){var e;return null==(e=this._combatCard)?void 0:e.Name}},{key:"CombatCard",get:function(){return this._combatCard}},{key:"Effects",get:function(){var e;return null==(e=this._combatCard)?void 0:e.Effects}}]),t}(f)).prototype,"nameLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(y.prototype,"feeLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(y.prototype,"mainValueLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(y.prototype,"secondaryValueLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(y.prototype,"effectsLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=y))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCardData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"6281cLfjNxAfZ27Gtcn5Q+M","CombatCardData",void 0);t("CombatCardData",function(){function t(t,e,i,n,r,o,s,c){this._cardId=void 0,this._cardName=void 0,this._combatEffects=[],this._range=void 0,this._evolutions=[],this._description=[],this._feeType=void 0,this._fee=void 0,this._cardId=t,this._cardName=e,this._range=i,this._feeType=n,this._fee=r,this._combatEffects=o,this._evolutions=s,this._description=c}return t.prototype.getDescription=function(t){return this._description.join(t)},t.fromCSV=function(e){var i=parseInt(e.fee,10);return new t(e.id,e.name,e.range,e.feeType,i,e.effects,e.evolutions,e.description)},e(t,[{key:"cardId",get:function(){return this._cardId}},{key:"cardName",get:function(){return this._cardName}},{key:"combatEffects",get:function(){return this._combatEffects}},{key:"range",get:function(){return this._range}},{key:"evolutions",get:function(){return this._evolutions}},{key:"feeType",get:function(){return this._feeType}},{key:"fee",get:function(){return this._fee}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCardManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CombatCardComponent.ts","./CardMover.ts","./HandCards.ts"],(function(e){var n,t,i,r,o,a,s,c,l,d,h,u,p,f,C,v,w,m,g,y,P,b;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime,s=e.createClass},function(e){c=e.cclegacy,l=e._decorator,d=e.Node,h=e.ScrollView,u=e.EventHandler,p=e.instantiate,f=e.Label,C=e.Vec3,v=e.Component,w=e.v3,m=e.Sprite,g=e.Color},function(e){y=e.CombatCardComponent},function(e){P=e.CardMover},function(e){b=e.HandCards}],execute:function(){var I,k,E,S,_,V,x,L,D,O,z,M,R,T,Z,H,B,N,F,j,A,G;c._RF.push({},"e3c4eMhBghL4LVTn4lhrJcB","CombatCardManager",void 0);var J=l.ccclass,q=l.property;e("CombatCardManager",(I=J("CombatCardManager"),k=q(d),E=q(d),S=q(d),_=q(d),V=q(d),x=q(b),L=q(h),D=q(u),O=q(u),I(((G=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,i(n,"cardPrefab",R,r(n)),i(n,"deckIcon",T,r(n)),i(n,"drawIcon",Z,r(n)),i(n,"playedIcon",H,r(n)),i(n,"consumedIcon",B,r(n)),i(n,"handCards",N,r(n)),i(n,"cardsScrollView",F,r(n)),i(n,"playCardEvent",j,r(n)),i(n,"playedCardEvent",A,r(n)),n.deck=[],n.hand=[],n.playedPile=[],n.consumedPile=[],n.drawPile=[],n._prviewIcon=null,n._prviewPile=[],n}t(n,e);var c=n.prototype;return c.onLoad=function(){n._instance?this.destroy():n._instance=this},c.sample=function(){for(var e=[],n=0;n<15;n++){var t=p(this.cardPrefab);t.parent=this.cardPrefab.parent,t.active=!0,e.push(t),t.getComponent(y).nameLabel.string="card"+(n+1)}this.addCardsToDeck(e),this.shuffleDeck()},c.clear=function(){console.log("this.deck:",this.deck),this.deck.forEach((function(e){return e.isValid&&e.destroy()})),console.log("this.drawPile:",this.drawPile),this.drawPile.forEach((function(e){return e.isValid&&e.destroy()})),console.log("this.playedPile:",this.playedPile.length,this.playedPile),this.playedPile.forEach((function(e){return e.isValid&&e.destroy()})),console.log("this.consumedPile:",this.consumedPile.length,this.consumedPile),this.consumedPile.forEach((function(e){return e.isValid&&e.destroy()})),this.deck.length=0,this.hand.length=0,this.drawPile.length=0,this.playedPile.length=0,this.consumedPile.length=0,this.deckIcon.getComponentInChildren(f).string="0",this.drawIcon.getComponentInChildren(f).string="0",this.playedIcon.getComponentInChildren(f).string="0",this.consumedIcon.getComponentInChildren(f).string="0"},c.hide=function(e){this.scheduleOnce((function(){e.forEach((function(e){e.active=!1}))}),.6)},c.remove=function(e){e.forEach((function(e){e.destroy()}))},c.addCardsToDeck=function(e){var n,t=this;(n=this.deck).push.apply(n,e),e.forEach((function(e){P.moveCard(e,t.deckIcon,C.ZERO,.2);var n=e.getComponent(y),i=p(e);i.parent=t.drawIcon,i.active=!1,i.getComponent(y).setup(n.CombatCard),t.drawPile.push(i)})),this.hide(e)},c.unshiftCardsToDraw=function(e){var n,t=this;(n=this.drawPile).unshift.apply(n,e),e.forEach((function(e){P.moveCard(e,t.drawIcon,C.ZERO,.2)}))},c.shuffleDeck=function(){for(var e=this.drawPile.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),t=[this.drawPile[n],this.drawPile[e]];this.drawPile[e]=t[0],this.drawPile[n]=t[1]}console.log("this.drawPile;",this.drawPile)},c.drawCards=function(){var e=o(a().mark((function e(n){var t,i,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[];n>0&&this.drawPile.length>0;)(r=this.drawPile.shift()).getComponent(y).onNormalStatus(),i.push(r),n--;if((t=this.hand).push.apply(t,i),!(n>0)){e.next=9;break}return e.next=6,this.recyclePlayedCards();case 6:return this.shuffleDeck(),0===this.drawPile.length&&(n=0,console.log("牌堆與抽牌堆的牌都抽完了，只能結束")),e.abrupt("return",this.drawCards(n));case 9:return this.handCards.drawCard(this.hand),this.drawIcon.getComponentInChildren(f).string=this.drawPile.length.toString(),e.abrupt("return",this.hand);case 12:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}(),c.previewCard=function(e,n,t,i,r,s){var c=this;void 0===n&&(n=1),void 0===t&&(t=0),void 0===i&&(i=1),void 0===r&&(r=null),void 0===s&&(s=null),console.log("展示",e),this.scheduleOnce(o(a().mark((function o(){return a().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e.isValid){o.next=3;break}return console.log("卡牌已被移除"),o.abrupt("return");case 3:if(e.scale=w(n,n,1),e.getComponent(y).onPlayedCardStatus(),!r||!s){o.next=10;break}return o.next=8,P.moveCard(e,c.node,s,n,i-t);case 8:o.next=12;break;case 10:return o.next=12,P.moveCard(e,c.node,w(0,150,0),n,i-t);case 12:case"end":return o.stop()}}),o)}))),t)},c.discardCards=function(e){var n=this;e.forEach((function(e){var t=n.hand.indexOf(e);if(t<0&&t>=n.hand.length)console.log("卡牌不存在或超出手牌範圍",t);else{console.log("棄牌",t),n.handCards.discardCard(e),n.handCards.tipLabel.string="棄牌";n.previewCard(e,1.5,0,.8),n.hand.splice(t,1),n.isConsumable(e)?(n.consumedPile.push(e),n.displayCard(e,n.consumedIcon,n.consumedPile.length,.8)):(n.playedPile.push(e),n.displayCard(e,n.playedIcon,n.playedPile.length,.8))}}))},c.playCard=function(e){var n=this.hand.indexOf(e);if(n<0||n>=this.hand.length)console.log("卡牌不存在或超出手牌範圍",n);else{console.log("出牌",n),this.handCards.playCard();this.previewCard(e,1.5,0,.8),this.hand.splice(n,1),this.isConsumable(e)?(this.consumedPile.push(e),this.displayCard(e,this.consumedIcon,this.consumedPile.length,.8)):(this.playedPile.push(e),this.displayCard(e,this.playedIcon,this.playedPile.length,.8))}},c.consumeCard=function(e){this.previewCard(e,1.5,0,.8),this.consumedPile.push(e),this.displayCard(e,this.consumedIcon,this.consumedPile.length,.8)},c.isConsumable=function(e){var n;return(null==(n=e.getComponent(y))?void 0:n.isConsumable())||!1},c.recyclePlayedCards=function(){var e=o(a().mark((function e(){var n,t=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=this.drawPile).push.apply(n,this.playedPile),this.drawIcon.getComponentInChildren(f).string=this.drawPile.length.toString(),this.playedPile.forEach((function(e){e.getComponent(m).color=new g(255,255,255,255),P.moveCard(e,t.drawIcon,C.ZERO,.2)})),e.next=5,this.delaySeconds(1.5);case 5:this.playedPile.length=0,this.playedIcon.getComponentInChildren(f).string="0";case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.showDeckList=function(e){void 0===e&&(e=!0),this._prviewIcon=this.deckIcon,this._prviewPile=this.deck,this.showScrollview(e)},c.showDrawList=function(e){void 0===e&&(e=!0),this._prviewIcon=this.drawIcon,this._prviewPile=this.drawPile,this.showScrollview(e)},c.showPlayedList=function(e){void 0===e&&(e=!0),this._prviewIcon=this.playedIcon,this._prviewPile=this.playedPile,this.showScrollview(e)},c.showConsumedList=function(e){void 0===e&&(e=!0),this._prviewIcon=this.consumedIcon,this._prviewPile=this.consumedPile,this.showScrollview(e)},c.showScrollview=function(e){void 0===e&&(e=!0);for(var n=this._prviewIcon,t=this._prviewPile,i=this.cardsScrollView.content.children,r=i.length;r<t.length;r++){var o=p(i[0]);o.parent=this.cardsScrollView.content,o.active=!0}this.cardsScrollView.node.active=e,e?i.forEach((function(e,n){var i=t[n];i?(i.active=e.active=!0,P.moveCard(i,e,C.ZERO,1)):e.active=!1})):(i.forEach((function(e,i){var r=t[i];r?(r.active=e.active=!0,P.moveCard(r,n,C.ZERO,.2)):e.active=!1})),this.hide(t))},c.displayCard=function(e,n,t,i){var r=this;void 0===i&&(i=0),this.scheduleOnce(o(a().mark((function i(){var o;return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e.isValid){i.next=3;break}return console.log("卡牌已被移除"),i.abrupt("return");case 3:return o=e.getComponent(y),r.playCardEvent.forEach((function(e){return e.emit([o.CombatCard])})),i.next=7,P.moveCard(e,n,C.ZERO,.2,.25);case 7:e.active=!1,e.scale=C.ONE,r.handCards.tipLabel.string="",r.playedCardEvent.forEach((function(e){return e.emit([o])})),n.getComponentInChildren(f).string=t.toString();case 12:case"end":return i.stop()}}),i)}))),i)},c.delaySeconds=function(e){var n=this;return new Promise((function(t){return n.scheduleOnce((function(){return t()}),e)}))},c.onDeckIconClick=function(){this.showDeckList(!this.cardsScrollView.node.active)},c.onDrawIconClick=function(){this.showDrawList(!this.cardsScrollView.node.active)},c.onPlayedIconClick=function(){this.showPlayedList(!this.cardsScrollView.node.active)},c.onConsumedIconClick=function(){this.showConsumedList(!this.cardsScrollView.node.active)},c.onClosePrivewClick=function(){this.showScrollview(!1)},s(n,null,[{key:"instance",get:function(){return this._instance}}]),n}(v))._instance=null,R=n((M=G).prototype,"cardPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(M.prototype,"deckIcon",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=n(M.prototype,"drawIcon",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=n(M.prototype,"playedIcon",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(M.prototype,"consumedIcon",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(M.prototype,"handCards",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(M.prototype,"cardsScrollView",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=n(M.prototype,"playCardEvent",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A=n(M.prototype,"playedCardEvent",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),z=M))||z));c._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEffect.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"afe14JRpy1EaoVaSRoNni5X","CombatEffect",void 0);t("CombatEffect",function(){function t(t,e,i,n,c,o){this._effectName=void 0,this._effectType=void 0,this._value=void 0,this._diceInfo="",this._dc=void 0,this._description=void 0,this.adjustmentValue=0,this._effectName=t,this._effectType=e,this._value=i,this._diceInfo=n,this._dc=c,this._description=o}return t.prototype.tooltop=function(){return this._description},e(t,[{key:"effectName",get:function(){return this._effectName}},{key:"effectType",get:function(){return this._effectType}},{key:"value",get:function(){return this._value}},{key:"diceInfo",get:function(){return this._diceInfo}},{key:"dc",get:function(){return this._dc}},{key:"description",get:function(){return this._description}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEffectComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HitPointsBarComponent.ts","./ShakeAnimation.ts","./DodgeAnimation.ts","./DiceAnimation.ts","./DefenseAnimation.ts","./HideAnimation.ts","./StunAnimation.ts","./HitCheckAnimation.ts","./FloatingTextComponent.ts","./PixelImage.ts"],(function(t){var n,e,i,o,a,r,s,c,u,f,l,p,h,m,d,g,y,v,b,C,w,A,k,D,T,x,B;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.asyncToGenerator,r=t.regeneratorRuntime,s=t.createClass},function(t){c=t.cclegacy,u=t._decorator,f=t.Node,l=t.Label,p=t.randomRangeInt,h=t.tween,m=t.UIOpacity,d=t.Vec3,g=t.Component,y=t.instantiate},function(t){v=t.HitPointsBarComponent},function(t){b=t.default},function(t){C=t.DodgeAnimation},function(t){w=t.default},function(t){A=t.DefenseAnimation},function(t){k=t.HideAnimation},function(t){D=t.StunAnimation},function(t){T=t.HitCheckAnimation},function(t){x=t.FloatingTextComponent},function(t){B=t.PixelImage}],execute:function(){var E,P,H,S,_,z,N,O,I,L,F,M,R,V,U,j,q,G,X;c._RF.push({},"48a24wcO/NEgaUXiL0qFeIA","CombatEffectComponent",void 0);var J=u.ccclass,K=u.property;t("CombatEffectComponent",(E=J("CombatEffectComponent"),P=K(f),H=K(f),S=K(f),_=K(v),z=K(l),N=K(f),O=K(f),I=K(x),E((M=n((F=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return n=t.call.apply(t,[this].concat(a))||this,i(n,"iconContainer",M,o(n)),i(n,"displayContainer",R,o(n)),i(n,"entity",V,o(n)),i(n,"hitPointsBar",U,o(n)),i(n,"NameLabel",j,o(n)),i(n,"dice",q,o(n)),i(n,"handCardTip",G,o(n)),i(n,"tip",X,o(n)),n._combatEffects=new Map,n._isDefenseBroken=!1,n}e(n,t);var c=n.prototype;return c.onLoad=function(){this.iconContainer.children.forEach((function(t){return t.active=!1}))},c.fixHP=function(t,n){this.hitPointsBar.setHP(t,n)},c.showTip=function(t){this.tip.showText(t)},c.rollHitDice=function(t){var n=this;return void 0===t&&(t="normal"),new Promise(a(r().mark((function e(i){var o,a,s,c,u,f,l,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null==(o=n.dice)?void 0:o.getComponent(w)){e.next=4;break}return i("advantage"===t?Math.max(p(1,20),p(1,20)):"disadvantage"===t?Math.min(p(1,20),p(1,20)):p(1,20)),e.abrupt("return");case 4:for(s="",c=[],u=1;u<=20;u++)c.push(u);if("advantage"===t)for(s="優勢",f=11;f<=20;f++)c.push(f);else if("disadvantage"===t)for(s="劣勢",l=1;l<=10;l++)c.push(l);return a.setTipText(s),c.sort((function(){return Math.random()-.5})),e.next=12,a.starAnimation(1,c);case 12:h=e.sent,i(h);case 14:case"end":return e.stop()}}),e)}))))},c.rollHitCheck=function(){var t=a(r().mark((function t(n){var e;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.entity.getComponent(T),t.abrupt("return",new Promise(a(r().mark((function t(i){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=5;break}return e.stopAnimation(),t.next=4,e.startAnimation();case 4:20===n?e.setValue(n,2,"\n爆擊"):e.setValue(n,1.5);case 5:i();case 6:case"end":return t.stop()}}),t)})))));case 2:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),c.hitBonus=function(t,n,e){var i=this.entity.getComponent(T);i&&i.addBonus(t,n,e)},c.changeArmor=function(t,n){var e=this.entity.getComponent(A);e&&(t>0?e.increaseDefense(t,n):e.decreaseDefense(-t,n))},c.breakDefense=function(t){if(!this._isDefenseBroken){var n=this.entity.getComponent(A);n&&(n.defenseBroken(t),this.tip.showText("破防"),this._isDefenseBroken=!0)}},c.dodge=function(t){if(t){var n=this.entity.getComponent(C);n&&(n.stopAnimation(),n.startAnimation(),this.tip.showText("閃避"))}else this.tip.showText("閃避失敗")},c.hiding=function(t){void 0===t&&(t=!0);var n=this.entity.getComponent(k);n&&(n.stopAnimation(),t?(n.startAnimation(),this.tip.showText("隱匿中")):this.tip.showText("解除隱匿"))},c.stun=function(){var t=this.entity.getComponent(D);t&&(t.stopAnimation(),t.startAnimation(),this.tip.showText("暈眩"))},c.death=function(){var t=this;h(this.entity.getComponent(m)).to(.5,{opacity:0},{easing:"cubicOut"}).call((function(){t.entity.getComponent(B).clearSpriteFrame(),t.node.destroy()})).start(),this.tip.showText("死亡")},c.onTurnEnd=function(){var t=this.entity.getComponent(T);t&&t.hide()},c.handCount=function(t){var n=this;return new Promise((function(e){var i=n.handCardTip.children,o=i.filter((function(t){return t.active})).length,a=t-o,r=[];if(a>0)for(var s=function(t){if((u=i[t])||((u=y(i[0])).parent=n.handCardTip),u.active=!0,t>=o-a){var s=32*t;u.position=new d(s,-30,0),r.push(h(u).delay(.1*t).to(.2,{position:new d(s,0,0)},{easing:"cubicOut"}).call((function(){t===o-1&&e()}))),u.getComponent(m).opacity=0,r.push(h(u.getComponent(m)).delay(.1*t).to(.2,{opacity:255},{easing:"cubicOut"}))}},c=0;c<t;c++){var u;s(c)}else a<0?n.handCardTip.children.forEach((function(t,n){if(n>=o+a){var i=32*n;t.position=new d(i,0,0),r.push(h(t).delay(.1*n).to(.2,{position:new d(i,30,0)},{easing:"cubicOut"}).call((function(){t.active=!1,n===o-1&&e()})))}})):r.push(h(n.node).call((function(){return e()})));n.scheduleOnce((function(){r.forEach((function(t){return t.start()}))}),.1)}))},c.setEffectStatus=function(t){var n=this._combatEffects.get(t.effectType);n||(n={name:t.effectName,stack:0},this._combatEffects.set(t.effectType,n)),this.updateStatusDisplay(t.effectType,t.value)},c.updateStatusDisplay=function(t,n){var e=this,i=this._combatEffects.get(t);if(console.log(t,i),i){var o=this.iconContainer.getChildByName(t);if(o){o.active=!0;var a=o.parent,r=o.getComponentInChildren(l);r.string=i.stack.toString(),h(o).delay(0).call((function(){return o.parent=e.displayContainer})).to(.1,{scale:new d(1.5,1.5)},{easing:"cubicOut"}).call((function(){i.stack+=n,r.string=i.name+"\n"+i.stack,console.log(i.name,"數值變化",n)})).to(.25,{scale:d.ONE},{easing:"cubicIn"}).call((function(){o.parent=a,i.stack<=0&&e.removeStatusDisplay(t)})).start()}}},c.removeStatusDisplay=function(t){var n=this.iconContainer.getChildByName(t);n&&(n.active=!1),this._combatEffects.delete(t)},c.removeAllStatusDisplay=function(){var t=this;this._combatEffects.forEach((function(n,e){t.removeStatusDisplay(e)}))},s(n,[{key:"Name",set:function(t){this.NameLabel.string=t}},{key:"Image",set:function(t){var n=this.entity.getComponent(B);n&&n.setSpriteFrame(t)}},{key:"HP",set:function(t){this.hitPointsBar.defaultHp=t}},{key:"Damage",set:function(t){this.hitPointsBar.changeHp(-t);var n=this.entity.getComponent(b);n&&(n.stopAnimation(),n.startAnimation(),this.scheduleOnce((function(){return n.stopAnimation()}),.5))}},{key:"Heal",set:function(t){this.hitPointsBar.changeHp(t)}},{key:"Defense",set:function(t){this._isDefenseBroken=!1;var n=this.entity.getComponent(A);n&&n.buildDefense(t)}}]),n}(g)).prototype,"iconContainer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=n(F.prototype,"displayContainer",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(F.prototype,"entity",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=n(F.prototype,"hitPointsBar",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=n(F.prototype,"NameLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=n(F.prototype,"dice",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=n(F.prototype,"handCardTip",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=n(F.prototype,"tip",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=F))||L));c._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEffectData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,f;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy,f=t.randomRangeInt}],execute:function(){i._RF.push({},"c34e5IgS79CdJxWRMmgBF7i","CombatEffectData",void 0);t("CombatEffectData",function(){function t(t,e,i,f,u,s){this._effectId=void 0,this._effectName=void 0,this._effectType=void 0,this._value=void 0,this._difficultyAttribute=void 0,this._difficultClass=void 0,this._description=void 0,this._effectId=t,this._effectName=e,this._effectType=i,this._value=f;var c=u.split("_");c.length<2?(this._difficultyAttribute="",this._difficultClass=0):(this._difficultyAttribute=c[0],this._difficultClass=Number(c[1])),this._description=s}return t.prototype.getEffectValue=function(){var t=0;if(this._value.indexOf("d")>-1){var e=this._value.split("d"),i=Number(e[0]),u=Number(e[1]);t=i*f(1,u)}else t=this._value?Number(this._value):0;return t},t.fromCSV=function(e){return new t(e.id,e.name,e.type,e.value,e.dc,e.description)},e(t,[{key:"effectId",get:function(){return this._effectId}},{key:"effectName",get:function(){return this._effectName}},{key:"effectType",get:function(){return this._effectType}},{key:"value",get:function(){return this._value}},{key:"dc",get:function(){return""===this._difficultyAttribute||0===this._difficultClass?null:{attribute:this._difficultyAttribute,class:this._difficultClass}}},{key:"description",get:function(){return this._description}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEffectManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RandomString.ts","./CombatEffect.ts","./CombatUnit.ts"],(function(t){var n,e,i,r,s,a,o,u,c,f;return{setters:[function(t){n=t.inheritsLoose,e=t.createClass,i=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){s=t.cclegacy,a=t._decorator,o=t.Component},function(t){u=t.RandomString},function(t){c=t.CombatEffect},function(t){f=t.CombatUnit}],execute:function(){var h,l;s._RF.push({},"0999bVerhlP2bt4/tuii+28","CombatEffectManager",void 0);var v=a.ccclass;t("CombatEffectManager",v("CombatEffectManager")(((l=function(t){function s(){for(var n,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return(n=t.call.apply(t,[this].concat(i))||this).units={},n}n(s,t);var a=s.prototype;return a.onLoad=function(){s._instance||(s._instance=this)},a.join=function(t,n,e,i,r,s,a,o,c){var h=u.generate();return this.units[h]=new f(t,n,e,i,r,s,a,o,c),h},a.quit=function(t){return this.units[t]?(this.units[t].status.death(),this.units[t].remove(),delete this.units[t],console.log("CombatUnit quit",t,this.units),!0):(console.warn("CombatUnit not found",t),!1)},a.getCombatEffect=function(t){return new c(t.effectName,t.effectType,t.getEffectValue(),t.value,t.dc,t.description)},a.hitRoll=function(){var t=i(r().mark((function t(n){var e;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.units[n],t.next=3,e.hitRoll();case 3:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),a.onCardPlayed=function(t,n,e){var i=this;void 0===e&&(e=[]);var r=this.units[n];if(r){var s=r.healthTest();t.forEach((function(t){s&&r.positive(t)}));var a=r.HitCheck,o=r.isDouble;s&&e.forEach((function(n){var e=i.units[n];e?(t.forEach((function(t){e.negative(t,a,o),e.Defense<=a&&e.status.breakDefense(e.Defense),"damage"!==t.effectType&&"cleave"!==t.effectType||(e.onSquelch(),e.onMind()),e.onRepel()})),e.squelch>0&&(r.damage+=e.squelch,e.squelch=0)):console.warn("CombatUnit not found",n)})),console.log("----caster----",this.units[n]),console.log("----receivers----",e.map((function(t){return i.units[t]}))),r.onBurning(),r.onPanic();var u=r.cleave;r.cleave=0,e.forEach((function(t){var n=i.units[t];n?(n.damage+=u,n.executeDamage()?r.onCombatReflex():r.isCombatReflex=!1):console.warn("CombatUnit not found",t)})),r.executeDamage()}},a.onBeginBattle=function(){var t=this;Object.keys(this.units).forEach((function(n){t.units[n].reset()}))},a.onEnBattle=function(){var t=this;Object.keys(this.units).forEach((function(n){var e=t.units[n];e.status.onTurnEnd(),e.remove()})),this.units={}},a.onTurnBegin=function(t,n){var e=this;void 0===n&&(n=[]);var i=this.units[t];i.reset(),i.onInaccurate();var r=i.HitCheck;n.forEach((function(n){if(n!=t){var i=e.units[n];i.Defense<=r?i.status.breakDefense(i.Defense):i.status.Defense=i.Defense}})),i.onFear()},a.onTurnEnd=function(t){this.units[t].status.onTurnEnd()},a.onRoundEnd=function(){for(var t in this.units){var n=this.units[t];n.onBleed(),n.executeDamage(),n.resetDraw()}},a.intentionHandsTip=function(t,n){return this.units[t].status.handCount(n)},a.takeDiscardCount=function(t){var n=this.units[t],e=n.discardCount;return n.discardCount=0,e},a.getDrawCount=function(t){return this.units[t].draw},a.getCountdown=function(t){return this.units[t].cuntdown},a.getEnergy=function(t){return Object.values(this.units[t].energy).map((function(t,n){return["行動","反應","備戰"][n]+": "+t})).join("\n")},a.getExtraDraw=function(t){var n=this,e={};return Object.keys(this.units[t].extraDraw).forEach((function(i){var r=n.units[t].extraDraw[i];r&&(e[i]=r)})),e},a.tryExtraDraw=function(t,n){if(null==this.units[t].extraDraw[n])return!1;var e=this.units[t].extraDraw[n]>0;return this.units[t].extraDraw[n]=0,e},a.tryCostFee=function(t,n){var e=this.units[t],i=n.FeeType,r=n.Fee;if(0===r)return!0;if(void 0===e.energy[i])return console.error("無此類別能量:",i),!1;if(e.energy[i]<r){var s="";switch(i){case"action":s="行動";break;case"reaction":s="反應";break;case"bonus":s="備戰";break;default:return console.error("無此類別能量:",i),!1}return this.units[t].status.showTip(s+"\n點數不足"),!1}return e.energy[i]-=r,!0},a.isStun=function(t){var n=this.units[t];return n?(n.isStuned&&n.onStun(),this.units[t].isStuned):(console.warn("CombatUnit not found",t),!0)},a.isAlive=function(t){return this.units[t].HP>0},a.fixHp=function(t,n){this.units[t].fixHp(n)},e(s,null,[{key:"instance",get:function(){return this._instance}}]),s}(o))._instance=null,h=l))||h);s._RF.pop()}}}));

System.register("chunks:///_virtual/CombatUnit.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var s,e,i,a,c;return{setters:[function(t){s=t.createClass,e=t.asyncToGenerator,i=t.regeneratorRuntime},function(t){a=t.cclegacy,c=t.randomRangeInt}],execute:function(){a._RF.push({},"e24c4KJ1EJM8rW8CxG0wdKj","CombatUnit",void 0);t("CombatUnit",function(){function t(t,s,e,i,a,c,h,n,u){this.status=null,this._hitPoint=0,this._armorClass=0,this._defense=0,this.damage=0,this.squelch=0,this.draw=0,this.extraDraw={},this._handCount=0,this.discardCount=0,this.energy={},this._hitBonus=0,this.strength=0,this.dexterity=0,this.wisdom=0,this.resilience=0,this.cuntdown=0,this.isStuned=!1,this.isDouble=!1,this.isHiding=!1,this.isCombatReflex=!1,this.isMindDodge=!1,this.hitStatus="normal",this._effectDC=[],this._effectAcc=[],this._castedCount=0,this._hitRoll=0,this._maxHP=0,this.cleave=0,this.status=t,this.status.Name=s,this.status.HP=e,this._maxHP=e,this._hitPoint=e,this._armorClass=i,this.draw=this._handCount=a,this.strength=c,this.dexterity=h,this.wisdom=n,this.resilience=u}var a=t.prototype;return a.hitRoll=function(){var t=e(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._hitBonus=0,this.isDouble=!1,t.next=4,this.status.rollHitDice(this.hitStatus);case 4:return this._hitRoll=t.sent,20!==this._hitRoll&&30!==this._hitRoll||(this.isDouble=!0),t.next=8,this.status.rollHitCheck(this.HitCheck);case 8:this.hitStatus="normal";case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),a.fixHp=function(t){this.status.fixHP(this._hitPoint,t),this._hitPoint=t,console.log("修正血量",t)},a.executeDamage=function(){var t;return this.damage>0&&(this._hitPoint-=this.damage,this.status.Damage=this.damage,this.damage=0,(null==(t=this._effectDC.hide)?void 0:t.stack)>0&&(this._effectDC.hide.stack=0,this.status.removeStatusDisplay("hide"),this.status.hiding(!1)),!0)},a.reset=function(){var t;this._defense=this._armorClass,this.status.Defense=this.Defense,this._castedCount=0,this.energy={action:1,reaction:1,bonus:1},this.extraDraw={atk:0,def:0,ran:0,steal:0},(null==(t=this._effectDC.mind)?void 0:t.stack)>0&&(this._effectDC.mind.stack=0,this.status.removeStatusDisplay("mind"),this.isMindDodge=!1,this.status.showTip("解除\n心眼狀態"))},a.remove=function(){var t;(null==(t=this._effectDC.hide)?void 0:t.stack)>0&&this.status.hiding(!1),this.status.removeAllStatusDisplay(),this.status=null},a.resetDraw=function(){this.draw=this._handCount},a.onBleed=function(){var t="bleed";if(this._effectAcc.bleed){var s=this._effectAcc.bleed;console.log(t,s),s>0&&(this._effectAcc.bleed--,this._hitPoint-=s,this.status.Damage=s,this.status.updateStatusDisplay(t,-1),console.log("受到流血傷害:",s))}},a.onBurning=function(){var t="burning";if(this._effectAcc.burning){var s=this._effectAcc.burning;console.log(t,s),s>0&&(this._effectAcc.burning--,this._hitPoint-=s,this.status.Damage=s,this.status.updateStatusDisplay(t,-1),console.log("受到灼燒傷害:",s))}},a.onVigilant=function(){var t="vigilant";this._effectAcc.vigilant&&this._effectAcc.vigilant>0&&(this._effectAcc.vigilant--,this.status.updateStatusDisplay(t,-1),console.log("抽一張牌"))},a.onInaccurate=function(){var t="inaccurate";this._effectAcc.inaccurate&&this._effectAcc.inaccurate>0&&(this._hitBonus-=this._effectAcc.inaccurate,this.status.hitBonus(-this._effectAcc.inaccurate,this.HitCheck),this._effectAcc.inaccurate=0,this.status.removeStatusDisplay(t))},a.onStun=function(){var t,s="stun";(null==(t=this._effectDC.stun)?void 0:t.stack)>0?this._checkDifficultClass(s,0)?(console.log("韌性檢定成功，解除眩暈"),this._effectDC.stun.stack--,this.status.updateStatusDisplay(s,-1),this.isStuned=this._effectDC.stun.stack>0):(console.log("眩暈效果持續"),this.isStuned=!0,this.status.stun()):this.isStuned=!1},a.onFear=function(){var t,s="fear";(null==(t=this._effectDC.fear)?void 0:t.stack)>0&&(this._checkDifficultClass(s)?(this.status.showTip("解除恐懼"),this._effectDC.fear.stack=0,this.status.removeStatusDisplay(s),this.cuntdown=0):(console.log("恐懼效果持續"),this.status.showTip("恐懼"),this.cuntdown=6))},a.onPanic=function(){var t,s="panic";(null==(t=this._effectDC.panic)?void 0:t.stack)>0&&(this._checkDifficultClass(s)?(console.log("韌性檢定成功，解除慌亂"),this._effectDC.panic.stack=0,this.status.removeStatusDisplay(s)):(console.log("慌亂效果持續"),this.discardCount++,this.status.showTip("慌亂棄牌")))},a.onSquelch=function(){var t="squelch";this._effectAcc.squelch>0&&(this.squelch+=this._effectAcc.squelch,this._effectAcc.squelch=0,this.status.removeStatusDisplay(t))},a.onCombatReflex=function(){this.isCombatReflex&&(this.status.showTip("行動恢復"),this.energy.action=1)},a.onStolen=function(){var t="steal";this._effectAcc.steal>0&&(this.draw-=this._effectAcc.steal,this._effectAcc.steal=0,this.status.removeStatusDisplay(t))},a.onMind=function(){var t,s="mind";(null==(t=this._effectDC.mind)?void 0:t.stack)>0&&(this._checkDifficultClass(s,0)?this.isMindDodge=!1:(this.squelch+=this._effectDC.mind.stack,this.status.showTip("心眼反擊"),this.isMindDodge=!0))},a.onRepel=function(){var t,s="repel";(null==(t=this._effectDC.repel)?void 0:t.stack)>0&&(this._checkDifficultClass(s)?this.status.showTip("擊退抵抗"):(this.discardCount+=this._effectDC.repel.stack,this.status.showTip("擊退棄牌")),this._effectDC.repel.stack=0,this.status.removeStatusDisplay(s))},a.healthTest=function(){var t;if((null==(t=this._effectDC.paralysis)?void 0:t.stack)>0){if(!this._checkDifficultClass("paralysis"))return console.log("麻痺效果持續，攻擊失敗"),this.status.showTip("麻痺"),!1;console.log("韌性檢定成功，麻痺不影響出招"),this.status.showTip("延緩麻痺")}return!0},a.positive=function(t){var s,e=t.effectType,i=t.value;switch(console.log("positive effect:",e,i),this._castedCount++,e){case"cleave":this.cleave=t.value;break;case"damage":this._effectAcc.internalInjury>0&&(this._effectAcc.internalInjury--,this.status.updateStatusDisplay("internalInjury",-1),console.log("內傷造成傷害減半"),t.adjustmentValue=-Math.floor(t.value/2)),(null==(s=this._effectDC.hide)?void 0:s.stack)>0&&(this._effectDC.hide.stack=0,this.status.removeStatusDisplay("hide"),this.status.hiding(!1));break;case"defense":var a=i;if(this._effectAcc.frigid>0){var c=Math.min(this._effectAcc.frigid,a);this._effectAcc.frigid-=c,this.status.updateStatusDisplay("frigid",-c),a=Math.round(a/2)}this.Defense+=a,this.status.changeArmor(a,this.Defense);break;case"attackQuickly":1===this._castedCount?t.adjustmentValue=t.value:t.adjustmentValue=1;break;case"heal":this._hitPoint=Math.min(this._maxHP,this._hitPoint+i),console.log("補血:",this._hitPoint,"+",i),this.status.Heal=i;break;case"squelch":this._addEffectAcc(e,i),this.status.setEffectStatus(t);break;case"hit":this._hitBonus+=i,this.status.hitBonus(i,this.HitCheck),this.status.showTip("命中上升");break;case"tourniquet":this._addEffectAcc("bleed",-i),this.status.updateStatusDisplay("bleed",-i),this.status.showTip("止血");break;case"vigilant":this._addEffectAcc(e,i),this.status.setEffectStatus(t);break;case"drawAtkCard":this.extraDraw.atk+=i;break;case"drawDefCard":this.extraDraw.def+=i;break;case"drawRanCard":this.extraDraw.ran+=i;break;case"steal":this.extraDraw.steal+=i;break;case"restoreAct":this.energy.action+=i;break;case"combatReflex":this.isCombatReflex=!0,this.status.showTip("戰鬥反射");break;case"dodge":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t);break;case"prejudgment":this._stackDifficultClass(t,!1),this.status.setEffectStatus(t);break;case"hide":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t),this.status.hiding();break;case"mind":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t),this.status.showTip("開啟心眼")}},a.negative=function(t,s,e){var i,a,c,h,n,u,o;void 0===e&&(e=!1);var f=t.effectType,l=t.value+t.adjustmentValue;if((null==(i=this._effectDC.prejudgment)?void 0:i.stack)>0){if(this._checkDifficultClass("prejudgment"))return void this.status.showTip("預判攻擊");this.status.showTip("誤判攻擊")}if((null==(a=this._effectDC.hide)?void 0:a.stack)>0&&("damage"===f||"bleed"===f||"cleave"===f)){if(this._checkDifficultClass("hide",0))return console.log("隱匿免疫攻擊成功"),void this.status.hiding();console.log("受到攻擊，隱匿失敗"),this._effectDC.hide.stack=0,this.status.removeStatusDisplay("hide"),this.status.hiding(!1)}var r=this.isMindDodge;switch((null==(c=this._effectDC.dodge)?void 0:c.stack)>0&&(this._checkDifficultClass("dodge",0)?(console.log("閃避攻擊"),r=!0):console.log("閃避失敗")),console.log("negative effect:",f,l),f){case"cleave":case"damage":if(this.onVigilant(),(null==(h=this._effectDC.dodge)?void 0:h.stack)>0&&(this._effectDC.dodge.stack--,this.status.updateStatusDisplay("dodge",-1),this.status.dodge(r)),r)return;e&&(console.log("this.爆擊:",this.isDouble),this.damage+=l,this.status.showTip("爆擊")),console.log("this.defense:",this.Defense,s),this.Defense<=s?this.damage+=l:(this.Defense-=l,this.status.changeArmor(-l,this.Defense));break;case"attackQuickly":var d=t.adjustmentValue;this.Defense<=s?this.damage+=d:(this.Defense-=d,this.status.changeArmor(-l,this.Defense));break;case"detection":this._effectAcc.hide>0&&(this._effectAcc.hide=0,console.log("偵察效果解除隱匿"),this.status.removeStatusDisplay("hide"),this.status.hiding(!1),this.status.showTip("偵察"));break;case"bleed":if(r)return void console.log("閃避出血攻擊");this._addEffectAcc(f,l),this.status.setEffectStatus(t);break;case"internalInjury":if((null==(n=this._effectDC.dodge)?void 0:n.stack)>0&&(this._effectDC.dodge.stack--,this.status.updateStatusDisplay("dodge",-1),this.status.dodge(r)),r)return;this._addEffectAcc(f,l),this.status.setEffectStatus(t);break;case"burning":case"frigid":case"inaccurate":this._addEffectAcc(f,l),this.status.setEffectStatus(t);break;case"disarm":this.discardCount+=l;break;case"panic":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t);break;case"laziness":this.draw=Math.max(this.draw-l,0),this.status.showTip("怠惰");break;case"stun":if((null==(u=this._effectDC.dodge)?void 0:u.stack)>0&&(this._effectDC.dodge.stack--,this.status.updateStatusDisplay("dodge",-1),this.status.dodge(r)),r)return void console.log("閃避暈眩攻擊");this._stackDifficultClass(t,!0),this.status.setEffectStatus(t),this.isStuned||this.onStun(),this.isStuned&&(null==(o=this._effectDC.dodge)?void 0:o.stack)>0&&(this._effectDC.dodge.stack=0,this.status.removeStatusDisplay("dodge"),console.log("暈眩中，解除掉閃避效果"),this.status.showTip("暈眩中"));break;case"fear":case"paralysis":case"repel":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t)}},a._addEffectAcc=function(t,s){this._effectAcc[t]||(this._effectAcc[t]=0),this._effectAcc[t]+=s},a._stackDifficultClass=function(t,s){var e=t.effectType,i=t.dc,a=t.value,c=this._effectDC[e];c||(this._effectDC[e]=c={attriube:i.attribute,class:0,stack:0}),0===c.stack?c.class=i.class:c.class=s?Math.max(c.class,i.class):Math.min(c.class,i.class),c.stack+=a,console.log("檢定attribute:",i.attribute,this[i.attribute])},a._checkDifficultClass=function(t,s){void 0===s&&(s=1);var e=this._effectDC[t];if(console.log("檢定effectDc:",e),!e)return!1;console.log("檢定消費:",s),e.stack-=s,s>0&&this.status.updateStatusDisplay(t,-1);var i={class:c(1,20)},a=this[e.attriube];return console.log("檢定dc:",i.class,e.class),i.class+a>=e.class},s(t,[{key:"HP",get:function(){return console.log("this._hitPoint:",this._hitPoint),this._hitPoint}},{key:"HitCheck",get:function(){return console.log("命中值",this._hitRoll,"+",this._hitBonus),this._hitRoll+this._hitBonus}},{key:"Defense",get:function(){return this._defense},set:function(t){this._defense=Math.max(t,0)}}]),t}());a._RF.pop()}}}));

System.register("chunks:///_virtual/CounterComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,o,r,i,u,a,c,s,l,p,f,d;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized,i=t.createClass},function(t){u=t.cclegacy,a=t._decorator,c=t.Label,s=t.Node,l=t.Vec3,p=t.tween,f=t.UIOpacity,d=t.Component}],execute:function(){var C,h,b,v,m;u._RF.push({},"a4592V7k85I6Y4OVwBiWMQr","CounterComponent",void 0);var y=a.ccclass,g=a.property;t("CounterComponent",(C=y("CounterComponent"),h=g(c),C((m=n((v=function(t){function n(){for(var n,e=arguments.length,i=new Array(e),u=0;u<e;u++)i[u]=arguments[u];return n=t.call.apply(t,[this].concat(i))||this,o(n,"counterLabel",m,r(n)),n.minCount=1,n.currentCount=0,n.deprecatedCount=0,n}e(n,t);var u=n.prototype;return u.start=function(){this.count=this.currentCount},u.updateLabel=function(){this.counterLabel.string=this.currentCount.toString()},u.addCount=function(t,n,e){var o=this;void 0===n&&(n=""),void 0===e&&(e=30),this.currentCount=Math.max(this.currentCount+t,this.minCount);var r=new s;r.parent=this.node;var i=r.addComponent(c);t>0?(r.position=new l(0,-80,0),i.string="+"+t+"\n"+n,i.fontSize=e,p(r).to(.5,{position:new l(0,0,0)},{easing:"cubicOut"}).call((function(){o.updateLabel(),o.counterEffect()})).removeSelf().start()):(r.position=new l(0,0,0),i.string=t+"\n"+n,i.fontSize=e,this.counterEffect(),p(r).to(.5,{position:new l(0,-80,0)},{easing:"cubicOut"}).call((function(){o.updateLabel()})).removeSelf().start());var u=r.addComponent(f);p(u).to(.7,{opacity:120},{easing:"cubicOut"}).to(.1,{opacity:0}).start()},u.counterEffect=function(){p(this.counterLabel.node).to(.01,{scale:new l(1.5,1.5,1)}).to(.2,{scale:new l(1,1,1)}).start()},i(n,[{key:"count",set:function(t){this.currentCount=t,this.updateLabel()}}]),n}(d)).prototype,"counterLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=v))||b));u._RF.pop()}}}));

System.register("chunks:///_virtual/CSVLoader.ts",["cc"],(function(r){var t,e,n;return{setters:[function(r){t=r.cclegacy,e=r._decorator,n=r.resources}],execute:function(){var o;t._RF.push({},"c4720GIVLlAOLtbrOZf7kjr","CSVLoader",void 0);var c=e.ccclass;r("CSVLoader",c("CSVLoader")(o=function(){function r(){}return r.loadCSV=function(r,t){var e=this;n.load(r,(function(r,n){if(r)console.error("Failed to load CSV:",r);else{var o=n.text,c=e.parseCSV(o);t(c)}}))},r.parseCSV=function(r){var t=r.split("\n"),e=t[0].split(",");return t.slice(1).map((function(r){var t=r.split(","),n={};return e.forEach((function(r,e){n[r.trim()]=t[e].trim()})),n}))},r}())||o);t._RF.pop()}}}));

System.register("chunks:///_virtual/debug-view-runtime-control.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,n,s,l,r,a,g,h,p,c,C,d,m,u,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,a=t.Color,g=t.Canvas,h=t.UITransform,p=t.instantiate,c=t.Label,C=t.RichText,d=t.Toggle,m=t.Button,u=t.director,L=t.Component}],execute:function(){var f,M,b,v,T,S,x,E,I;s._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var A=l.ccclass,y=l.property;t("DebugViewRuntimeControl",(f=A("internal.DebugViewRuntimeControl"),M=y(r),b=y(r),v=y(r),f((x=e((S=function(t){function e(){for(var e,o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"compositeModeToggle",x,n(e)),i(e,"singleModeToggle",E,n(e)),i(e,"EnableAllCompositeModeButton",I,n(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e.hideButtonLabel=void 0,e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[a.WHITE,a.BLACK,a.RED,a.GREEN,a.BLUE],e}o(e,t);var s=e.prototype;return s.start=function(){if(this.node.parent.getComponent(g)){var t=this.node.parent.getComponent(h),e=.5*t.width,o=.5*t.height,i=.1*e-e,n=o-.1*o,s=this.node.getChildByName("MiscMode"),l=p(s);l.parent=this.node,l.name="Buttons";var r=p(s);r.parent=this.node,r.name="Titles";for(var u=0;u<2;u++){var L=p(this.EnableAllCompositeModeButton.getChildByName("Label"));L.setPosition(i+(u>0?450:150),n,0),L.setScale(.75,.75,.75),L.parent=r;var f=L.getComponent(c);f.string=u?"----------Composite Mode----------":"----------Single Mode----------",f.color=a.WHITE,f.overflow=0,this.labelComponentList[this.labelComponentList.length]=f}n-=20;for(var M=0,b=0;b<this.strSingle.length;b++,M++){b===this.strSingle.length>>1&&(i+=200,M=0);var v=b?p(this.singleModeToggle):this.singleModeToggle;v.setPosition(i,n-20*M,0),v.setScale(.5,.5,.5),v.parent=this.singleModeToggle.parent;var T=v.getComponentInChildren(C);T.string=this.strSingle[b],this.textComponentList[this.textComponentList.length]=T,this.textContentList[this.textContentList.length]=T.string,v.on(d.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[b]=v}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,n,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(m.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=l;var S=this.EnableAllCompositeModeButton.getComponentInChildren(c);this.labelComponentList[this.labelComponentList.length]=S;var x=p(this.EnableAllCompositeModeButton);x.setPosition(i+90,n,0),x.setScale(.5,.5,.5),x.on(m.EventType.CLICK,this.changeTextColor,this),x.parent=l,(S=x.getComponentInChildren(c)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=S;var E=p(this.EnableAllCompositeModeButton);E.setPosition(i+200,n,0),E.setScale(.5,.5,.5),E.on(m.EventType.CLICK,this.hideUI,this),E.parent=this.node.parent,(S=E.getComponentInChildren(c)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=S,this.hideButtonLabel=S,n-=40;for(var I=0;I<this.strMisc.length;I++){var A=p(this.compositeModeToggle);A.setPosition(i,n-20*I,0),A.setScale(.5,.5,.5),A.parent=s;var y=A.getComponentInChildren(C);y.string=this.strMisc[I],this.textComponentList[this.textComponentList.length]=y,this.textContentList[this.textContentList.length]=y.string,A.getComponent(d).isChecked=!!I,A.on(d.EventType.TOGGLE,I?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[I]=A}n-=150;for(var D=0;D<this.strComposite.length;D++){var B=D?p(this.compositeModeToggle):this.compositeModeToggle;B.setPosition(i,n-20*D,0),B.setScale(.5,.5,.5),B.parent=this.compositeModeToggle.parent;var w=B.getComponentInChildren(C);w.string=this.strComposite[D],this.textComponentList[this.textComponentList.length]=w,this.textContentList[this.textContentList.length]=w.string,B.on(d.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[D]=B}}else console.error("debug-view-runtime-control should be child of Canvas")},s.isTextMatched=function(t,e){var o=new String(t),i=o.search(">");return-1===i?t===e:(o=(o=o.substr(i+1)).substr(0,o.search("<")))===e},s.toggleSingleMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strSingle.length;i++)this.isTextMatched(o.string,this.strSingle[i])&&(e.singleMode=i)},s.toggleCompositeMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strComposite.length;i++)this.isTextMatched(o.string,this.strComposite[i])&&e.enableCompositeMode(i,t.isChecked)},s.toggleLightingWithAlbedo=function(t){u.root.debugView.lightingWithAlbedo=t.isChecked},s.toggleCSMColoration=function(t){u.root.debugView.csmLayerColoration=t.isChecked},s.enableAllCompositeMode=function(t){var e=u.root.debugView;e.enableAllCompositeMode(!0);for(var o=0;o<this.compositeModeToggleList.length;o++){this.compositeModeToggleList[o].getComponent(d).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(d);i.isChecked=!1,e.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(d)).isChecked=!0,e.lightingWithAlbedo=!0},s.hideUI=function(t){var e=this.node.getChildByName("Titles"),o=!e.active;this.singleModeToggleList[0].parent.active=o,this.miscModeToggleList[0].parent.active=o,this.compositeModeToggleList[0].parent.active=o,this.EnableAllCompositeModeButton.parent.active=o,e.active=o,this.hideButtonLabel.string=o?"Hide UI":"Show UI"},s.changeTextColor=function(t){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(var o=0;o<this.labelComponentList.length;o++)this.labelComponentList[o].color=this.color[this._currentColorIndex]},s.onLoad=function(){},s.update=function(t){},e}(L)).prototype,"compositeModeToggle",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(S.prototype,"singleModeToggle",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(S.prototype,"EnableAllCompositeModeButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=S))||T));s._RF.pop()}}}));

System.register("chunks:///_virtual/DefenseAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,o,n,r,a,s,c,d,l,u,p,f,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized,r=e.createClass},function(e){a=e.cclegacy,s=e._decorator,c=e.Node,d=e.Label,l=e.Vec3,u=e.UIOpacity,p=e.tween,f=e.v3,h=e.Component}],execute:function(){var b,y,m,g,N,v,L,O,_,w,D,C,P,z;a._RF.push({},"bf79d8GvnFMRL0TfWPWT1dq","DefenseAnimation",void 0);var A=s.ccclass,k=s.property;e("DefenseAnimation",(b=A("DefenseAnimation"),y=k(c),m=k(d),g=k(d),N=k(c),v=k(c),b((_=t((O=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"defenseNode",_,n(t)),o(t,"defenseLabel",w,n(t)),o(t,"armoredLabel",D,n(t)),o(t,"armoredNode",C,n(t)),o(t,"eyeNode",P,n(t)),o(t,"distance",z,n(t)),t._defenseOpacity=null,t._oriPosition=new l,t}i(t,e);var a=t.prototype;return a.onLoad=function(){this.defenseNode.active=!1,this._oriPosition=this.armoredLabel.node.position,this._defenseOpacity=this.defenseNode.getComponent(u),this._defenseOpacity||console.error("DefenseAnimation: _defenseOpacity is null")},a.buildDefense=function(e){var t=this.armoredLabel.getComponent(u);t&&(t.opacity=255),this.armor=e;var i=.5,o=this.armoredLabel.node.position.clone();this.armoredNode.forEach((function(e){return e.active=!0})),this.armoredNode[0].position=o.clone().subtract(new l(40,0,0)),this.armoredNode[1].position=o.clone().add(new l(40,0,0)),p(this.armoredNode[0]).to(i,{position:o},{easing:"cubicOut"}).start(),p(this.armoredNode[1]).to(i,{position:o},{easing:"cubicOut"}).start(),this.armoredNode[0].getComponent(u).opacity=0,this.armoredNode[1].getComponent(u).opacity=0,p(this.armoredNode[0].getComponent(u)).to(.25,{opacity:160},{easing:"cubicOut"}).delay(.25).start(),p(this.armoredNode[1].getComponent(u)).to(.125,{opacity:160},{easing:"cubicOut"}).delay(.25).start()},a.increaseDefense=function(e,t){var i=this;this.defenseNode.active=!0,this._defenseOpacity.opacity=0,this.defenseNode.position=this._oriPosition.clone().subtract(new l(0,this.distance,0)),this.defenseLabel.string="+"+e;p(this.defenseNode).to(1,{position:this._oriPosition},{easing:"cubicOut"}).call((function(){return i.armor=t})).start(),p(this._defenseOpacity).to(1/4,{opacity:255}).delay(.5).to(1/4,{opacity:0}).start()},a.decreaseDefense=function(e,t){var i=this;this.defenseNode.active=!0,this._defenseOpacity.opacity=0,this.defenseNode.position=this._oriPosition.clone().add(new l(0,this.distance,0)),this.defenseLabel.string="-"+e;p(this.defenseNode).to(.5,{position:this._oriPosition},{easing:"cubicOut"}).call((function(){return i.armor=t})).start(),p(this._defenseOpacity).to(.125,{opacity:255}).delay(.25).to(.125,{opacity:0}).start()},a.defenseBroken=function(e){var t=this,i=.5,o=this.armoredLabel.node.position.clone(),n=p(this.armoredNode[1]).to(i,{position:o.subtract3f(0,40,0)},{easing:"cubicOut"}).call((function(){t.armoredLabel.string=e+"\n(破碇)",t.armoredLabel.getComponent(u).opacity=180})),r=p(this.armoredNode[1].getComponent(u)).delay(.25).to(.125,{opacity:0},{easing:"cubicOut"});this.eyeNode.active=!0,this.eyeNode.position=o,p(this.eyeNode).to(.25,{scale:f(1.5,1.5,1)},{easing:"cubicOut"}).to(.25,{scale:f(1,1,1)},{easing:"cubicIn"}).call((function(){n.start(),r.start(),t.eyeNode.active=!1})).start()},r(t,[{key:"armor",set:function(e){this.armoredLabel.string=e.toString()}}]),t}(h)).prototype,"defenseNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(O.prototype,"defenseLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(O.prototype,"armoredLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(O.prototype,"armoredNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),P=t(O.prototype,"eyeNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(O.prototype,"distance",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),L=O))||L));a._RF.pop()}}}));

System.register("chunks:///_virtual/DiceAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,n,o,r,a,l,c,s,u,p,h,d,f;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,o=i.assertThisInitialized},function(i){r=i.cclegacy,a=i._decorator,l=i.CCInteger,c=i.CCFloat,s=i.Node,u=i.Label,p=i.Vec3,h=i.UIOpacity,d=i.tween,f=i.Component}],execute:function(){var g,b,y,_,m,V,v,w,D,z,L,O,T,x,C,M,P,I,Z,A,N;r._RF.push({},"df852/bswtF3blmL0rIX8iv","DiceAnimation",void 0);var E=a.ccclass,F=a.property;i("default",(g=E("DiceAnimation"),b=F({tooltip:"起點位置"}),y=F({type:l,tooltip:"移動方向的X軸力度"}),_=F({type:l,tooltip:"移動X軸的左極限"}),m=F({type:l,tooltip:"移動X軸的右極限"}),V=F({type:c,tooltip:"衰減值"}),v=F({type:c,tooltip:"力度極限值"}),w=F({type:s,tooltip:"骰子"}),D=F({type:u,tooltip:"骰子的值"}),z=F({type:u,tooltip:"骰子的文字提示"}),g((T=t((O=function(i){function t(){for(var t,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return t=i.call.apply(i,[this].concat(r))||this,n(t,"startPosition",T,o(t)),n(t,"force",x,o(t)),t._force=0,n(t,"leftLimit",C,o(t)),n(t,"rightLimit",M,o(t)),n(t,"decay",P,o(t)),n(t,"forceThreshold",I,o(t)),n(t,"diceNode",Z,o(t)),n(t,"diceValue",A,o(t)),n(t,"diceText",N,o(t)),t._isMoving=!1,t._diceValues=[],t._dropDiceValues=[],t._diceEndCallback=null,t._originalZOrder=p.ZERO,t}e(t,i);var r=t.prototype;return r.onLoad=function(){this._originalZOrder=this.node.position.clone(),this.startPosition=this.node.position.clone().add(this._originalZOrder)},r.update=function(i){var t;this._isMoving&&(this.node.position=this.node.position.add3f(this._force*i,0,0),(this.node.position.x<=this.leftLimit||this.node.position.x>=this.rightLimit)&&(this._force=-this._force,this.changeDiceValue()),this._force*=1-this.decay,Math.abs(this._force)<this.forceThreshold&&(this._isMoving=!1,null==(t=this._diceEndCallback)||t.call(this,parseInt(this.diceValue.string))))},r.starAnimation=function(i,t){var e=this;this._force=this.force,this.node.position=new p(this.startPosition.x,this._originalZOrder.y,0),this._isMoving=!0,this._diceValues=t,this.changeDiceValue();var n=this.diceNode.getComponent(h);return n.opacity=255,new Promise((function(t){d(e.diceNode).to(i/4,{position:new p(0,e.startPosition.y,0)},{easing:"cubicOut"}).parallel(d().to(i,{position:p.ZERO},{easing:"bounceOut"}),d().delay(i/3).call((function(){e.changeDiceValue()})).delay(i/3).call((function(){e.changeDiceValue()})).delay(i/4).call((function(){e.changeDiceValue()}))).call((function(){e._isMoving=!1,t(parseInt(e.diceValue.string))})).delay(1).call((function(){n&&d(n).to(.25,{opacity:0},{easing:"cubicOut"}).start()})).start()}))},r.changeDiceValue=function(){0===this._diceValues.length&&(this._diceValues=this._dropDiceValues.sort((function(){return Math.random()-.5})).slice(),this._dropDiceValues.length=0);var i=this._diceValues.shift();this.diceValue.string=i.toString(),this._dropDiceValues.push(i)},r.setTipText=function(i){this.diceText.string=i},t}(f)).prototype,"startPosition",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p(0,0,0)}}),x=t(O.prototype,"force",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),C=t(O.prototype,"leftLimit",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-100}}),M=t(O.prototype,"rightLimit",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),P=t(O.prototype,"decay",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),I=t(O.prototype,"forceThreshold",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Z=t(O.prototype,"diceNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(O.prototype,"diceValue",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(O.prototype,"diceText",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=O))||L));r._RF.pop()}}}));

System.register("chunks:///_virtual/DodgeAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,o,e,n,r,a,s,c,u,l,p;return{setters:[function(t){i=t.applyDecoratedDescriptor,o=t.inheritsLoose,e=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,s=t.Node,c=t.Vec3,u=t.tween,l=t.Tween,p=t.Component}],execute:function(){var g,d,m,h,f,v,b;r._RF.push({},"bbbad5Z7GlHLY/sdj0z7DaP","DodgeAnimation",void 0);var D=a.ccclass,y=a.property;t("DodgeAnimation",(g=D("DodgeAnimation"),d=y(s),g((f=i((h=function(t){function i(){for(var i,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return i=t.call.apply(t,[this].concat(r))||this,e(i,"targetNode",f,n(i)),e(i,"moveDistance",v,n(i)),e(i,"moveDuration",b,n(i)),i._originalPosition=void 0,i}o(i,t);var r=i.prototype;return r.start=function(){},r.startAnimation=function(){var t=this._originalPosition=this.node.position.clone(),i=Math.random()>.5?1:-1,o=new c(t.x+i*this.moveDistance,t.y,t.z);u(this.targetNode).to(this.moveDuration/2,{position:o},{easing:"cubicInOut"}).to(this.moveDuration,{position:t},{easing:"bounceOut"}).start()},r.stopAnimation=function(){l.stopAllByTarget(this.targetNode),this._originalPosition&&this.targetNode.setPosition(this._originalPosition)},i}(p)).prototype,"targetNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(h.prototype,"moveDistance",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),b=i(h.prototype,"moveDuration",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),m=h))||m));r._RF.pop()}}}));

System.register("chunks:///_virtual/DynamicWidthScrollView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,e,o,r,l,c,s,a,h,d,u,p,f,g;return{setters:[function(t){i=t.inheritsLoose,n=t.applyDecoratedDescriptor,e=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose,l=t.createClass},function(t){c=t.cclegacy,s=t._decorator,a=t.ScrollView,h=t.Event,d=t.Vec3,u=t.UITransform,p=t.Layout,f=t.v3,g=t.Component}],execute:function(){var m,w,v,y,S,V,b,E,W,L;c._RF.push({},"97f47FpcPJIjKbS1g4ndve0","DynamicWidthScrollView",void 0);var C=s.ccclass,_=s.property,T=t("DynamicWidthScrollEvent",function(t){function n(i,n,e){var o;return(o=t.call(this,i,n)||this).detail=null,o.detail=e,o}return i(n,t),n}(h));T.DYNAMIC_WIDTH_SCROLL_EVENT="dynamic-width-scroll-event";t("DynamicWidthScrollView",(m=C("DynamicWidthScrollView"),w=_(a),m((S=n((y=function(t){function n(){for(var i,n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return i=t.call.apply(t,[this].concat(r))||this,e(i,"scrollView",S,o(i)),e(i,"maxWidth",V,o(i)),e(i,"minWidth",b,o(i)),e(i,"spacingX",E,o(i)),e(i,"paddingLeft",W,o(i)),e(i,"paddingRight",L,o(i)),i._centerPosition=d.ZERO,i._scrollContentTrans=null,i}i(n,t);var c=n.prototype;return c.onLoad=function(){if(this.scrollView){this._centerPosition=this.scrollView.getComponent(u).convertToWorldSpaceAR(d.ZERO),this._scrollContentTrans=this.scrollView.content.getComponent(u);var t=this.scrollView.content.getComponent(p);t.spacingX=this.spacingX,t.paddingLeft=this.paddingLeft,t.paddingRight=this.paddingRight,this.scrollView.cancelInnerEvents=!1,this.scrollView.enabled=!1}else console.error("ScrollView component is not assigned.")},c.onEnable=function(){this.scrollView.node.on(a.EventType.SCROLLING,this.onScrolling,this),this.scrollView.node.on(a.EventType.SCROLL_ENDED,this.onScrollEnded,this)},c.onDisable=function(){this.scrollView.node.off(a.EventType.SCROLLING,this.onScrolling,this),this.scrollView.node.off(a.EventType.SCROLL_ENDED,this.onScrollEnded,this)},c.onScrolling=function(){for(var t,i=this._scrollContentTrans.node.children,n=r(i);!(t=n()).done;){var e=t.value,o=this._scrollContentTrans.convertToWorldSpaceAR(e.position),l=d.distance(o,this._centerPosition),c=this.calculateWidth(l);e.getComponent(u).width=c;var s=1+c/this.maxWidth;e.scale=f(s,s,1)}},c.onScrollEnded=function(){var t=this,i=[];this.scrollView.content.children.forEach((function(n){i.push(t._scrollContentTrans.convertToWorldSpaceAR(n.position))})),this.node.dispatchEvent(new T(T.DYNAMIC_WIDTH_SCROLL_EVENT,!0,{positions:i}))},c.calculateWidth=function(t){var i=this.scrollView.node.getComponent(u).width/2,n=this.minWidth+(this.maxWidth-this.minWidth)*(1-t/i);return n=Math.max(this.minWidth,Math.min(this.maxWidth,n))},l(n,[{key:"content",get:function(){return this.scrollView.content}}]),n}(g)).prototype,"scrollView",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(y.prototype,"maxWidth",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),b=n(y.prototype,"minWidth",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),E=n(y.prototype,"spacingX",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),W=n(y.prototype,"paddingLeft",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),L=n(y.prototype,"paddingRight",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v=y))||v));c._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerCardData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"ccd0ezjodZFI5/H0FYjbduc","EmpowerCardData",void 0);e("EmpowerCardData",function(){function e(e,t,n,i,r){this._regimentation=void 0,this._regimentationRank=void 0,this._empowerId=void 0,this._empowerName=void 0,this._combatCards=[],this._regimentation=e,this._regimentationRank=i,this._empowerId=t,this._empowerName=n,this._combatCards=r}return e.fromCSV=function(t){return new e(t.regimentation,t.id,t.name,t.rank,t.cards)},t(e,[{key:"regimentation",get:function(){return this._regimentation}},{key:"regimentationRank",get:function(){return this._regimentationRank}},{key:"empowerId",get:function(){return this._empowerId}},{key:"empowerName",get:function(){return this._empowerName}},{key:"combatCards",get:function(){return this._combatCards}}]),e}());n._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerCardsListItem.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,t,i,n,a,o,l,c,s,u;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Node,c=e.Label,s=e.instantiate,u=e.Component}],execute:function(){var p,m,f,d,b,h,y,g,v;a._RF.push({},"15e66JpM99KFaMCBD5ZXhE3","EmpowerCardsListItem",void 0);var w=o.ccclass,C=o.property;e("EmpowerCardsListItem",(p=w("EmpowerCardsListItem"),m=C(l),f=C(c),d=C(l),p((y=r((h=function(e){function r(){for(var r,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return r=e.call.apply(e,[this].concat(a))||this,i(r,"layout",y,n(r)),i(r,"label",g,n(r)),i(r,"cardPrefab",v,n(r)),r.regimentation="",r.empowerId="",r}t(r,e);var a=r.prototype;return a.onLoad=function(){this.cardPrefab.active=!1},a.list=function(e){var r=this;this.layout.removeAllChildren(),this.regimentation=e.regimentation,this.empowerId=e.empowerId,this.label.string=e.empowerName,e.combatCards.forEach((function(e){for(var t=e.num,i=0;i<t;i++){var n=s(r.cardPrefab);n.active=!0,n.parent=r.layout,n.getComponentInChildren(c).string=e.name}}))},r}(u)).prototype,"layout",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=r(h.prototype,"label",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=r(h.prototype,"cardPrefab",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=h))||b));a._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerCombatCardList.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EmpowerCardsListItem.ts","./CheckBoxComponent.ts","./PopupWindowComponent.ts","./GameManager.ts"],(function(e){var t,o,n,r,a,i,s,c,m,d,p,u,l,C,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.createClass},function(e){i=e.cclegacy,s=e._decorator,c=e.Node,m=e.Layout,d=e.instantiate,p=e.Component},function(e){u=e.EmpowerCardsListItem},function(e){l=e.CheckBoxComponent},function(e){C=e.PopupWindowComponent},function(e){w=e.GameManager}],execute:function(){var f,b,h,g,L,v,I,y,E,k,D,_;i._RF.push({},"f7b72lDm39O2b0VSTgjN98U","EmpowerCombatCardList",void 0);var N=s.ccclass,R=s.property;e("EmpowerCombatCardList",(f=N("EmpowerCombatCardList"),b=R(c),h=R(m),g=R(u),L=R(C),f(((_=function(e){function t(){for(var t,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return t=e.call.apply(e,[this].concat(a))||this,n(t,"empowerCardsListView",y,r(t)),n(t,"empowerCardsListLayout",E,r(t)),n(t,"empowerCardsListItem",k,r(t)),n(t,"popupWindow",D,r(t)),t._empowerCombatCards={},t}o(t,e);var i=t.prototype;return i.onLoad=function(){t._instance?this.destroy():t._instance=this,this.empowerCardsListItem.node.active=!1},i.list=function(e){var t=this;void 0===e&&(e=.1),this.scheduleOnce((function(){var o=t.getEmpowerCardDataList();if(console.log("empowerCardDataList:",o),0!==Object.keys(o).length){var n=t.empowerCardsListLayout.node.children;n.forEach((function(e){return e.active=!1})),o.forEach((function(e,o){var r=n[o];r||((r=d(t.empowerCardsListItem.node)).parent=t.empowerCardsListLayout.node),r.active=!0;var a,i=r.getComponent(u);(i.list(e),i.empowerId===e.empowerId)&&(console.log("觸發賦能:",e.empowerId),null==(a=i.getComponentInChildren(l))||a.check())})),t.empowerCardsListView.active=!0,t.popupWindow.openPopup("提示","請勾選戰鬥使用的賦能牌組，最多可選五組。",[{label:"知道了",callback:function(){}}])}else t.list(e+.1)}),e)},i.enableEmpowerCards=function(e,t){this.empowerCardsListLayout.node.children.forEach((function(o){var n,r,a=o.getComponent(u);a.regimentation===e&&(a.empowerId===t?(console.log("觸發賦能:",t),null==(n=a.getComponentInChildren(l))||n.check()):(console.log("取消觸發賦能:",a.empowerId),null==(r=a.getComponentInChildren(l))||r.cancel()))})),this.setEmpowerCombatCards()},i.getEmpowerCardDataList=function(){return w.instance.database.empowerCardDatabase.filter((function(e){var t=e.regimentation;return w.instance.characterCombatData.getEmpowerCardRank(t)===e.regimentationRank}))},i.setEmpowerCombatCards=function(){var e=[];this.empowerCardsListLayout.node.children.forEach((function(t){var o,n=t.getComponent(u);null!=(o=n.getComponentInChildren(l))&&o.isChecked&&e.push(n.empowerId)}));var t=w.instance.database.empowerCardDatabase,o=w.instance.database.combatCardDatabase,n={};t.forEach((function(t){var r=t.empowerId;e.includes(r)&&t.combatCards.forEach((function(e){var a=e.num,i=o.find((function(t){return t.cardId===e.id}));if(i){n[r]||(n[r]={name:t.empowerName,cards:[]}),console.log(t.empowerName+" 抽 "+a+" 張 "+i.cardName);for(var s=0;s<a;s++)n[r].cards.push(i)}}))})),console.log("empowerCombatCards:",n),this._empowerCombatCards=n},i.setEmpowerCombatCardsFromRank=function(){var e=w.instance.characterCombatData.getEmpowerCardRanks(),t=w.instance.database.empowerCardDatabase,o=w.instance.database.combatCardDatabase,n={},r=t.find((function(e){return 0===e.regimentationRank}));n[r.empowerId]={name:r.empowerName,cards:[]},r.combatCards.forEach((function(e){console.log(r.empowerName+" 抽 "+e.num+" 張 "+e.name);for(var t=0;t<e.num;t++){var a=o.find((function(t){return t.cardId===e.id}));n[r.empowerId].cards.push(a)}})),Object.keys(e).forEach((function(r){var a=e[r],i=t.find((function(e){return e.regimentation===r&&e.regimentationRank===a}));console.log("card.empowerId:",i.empowerId,a),n[i.empowerId]={name:i.empowerName,cards:[]},i.combatCards.forEach((function(e){console.log(i.empowerName+" 抽 "+e.num+" 張 "+e.name);for(var t=0;t<e.num;t++){var r=o.find((function(t){return t.cardId===e.id}));n[i.empowerId].cards.push(r)}}))})),console.log("empowerCombatCards:",n),this._empowerCombatCards=n},a(t,[{key:"empowerCombatCards",get:function(){return this._empowerCombatCards}}],[{key:"instance",get:function(){return this._instance}}]),t}(p))._instance=null,y=t((I=_).prototype,"empowerCardsListView",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(I.prototype,"empowerCardsListLayout",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(I.prototype,"empowerCardsListItem",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(I.prototype,"popupWindow",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=I))||v));i._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"29c0cmZm51PGI1hR+HUjJiK","EmpowerData",void 0);t("EmpowerData",function(){function t(t,e,i){this._id=void 0,this._name=void 0,this._triggers=[],this._id=t,this._name=e,this._triggers=i}return t.fromCSV=function(e){return new t(e.id,e.name,e.triggers)},e(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"triggers",get:function(){return this._triggers}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(e){var r,a,t,n;return{setters:[function(e){r=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,t=e._decorator},function(e){n=e.GameManager}],execute:function(){var o,s;a._RF.push({},"a7abbEaJMtIgb6pw2B6UKeL","EmpowerManager",void 0);var u=t.ccclass;e("EmpowerManager",u("EmpowerManager")(((s=function(){function e(){}return e.loadEmpowerData=function(){this.empowers=n.instance.database.empowerDatabase},e.triggerEmpower=function(e){for(var a,t=r(this.empowers);!(a=t()).done;){var n=a.value;n.triggers.every((function(r){return e.some((function(e){if(r.type===e.type){var a=r.key===e.key;switch(r.type){case"equip":return a&&r.value.indexOf(e.value)>=0;case"ability_score":return a&&Number(r.value)<=Number(e.value);case"skill":return a&&r.value===e.value;default:return!1}}}))}))&&(this.empowerIds.has(n.id)||this.empowerIds.add(n.id))}},e.getEmpoweredIds=function(){return Array.from(this.empowerIds)},e.getEmpoweredCardDataList=function(){var e=this;return n.instance.database.empowerCardDatabase.filter((function(r){return Array.from(e.empowerIds).includes(r.empowerId)}))},e}()).empowers=[],s.empowerIds=new Set,o=s))||o);a._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e;return{setters:[function(t){i=t.createClass},function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"28b50fCDddFEoSFzDbmRP9j","EnemyData",void 0);t("EnemyData",function(){function t(t,i,e,n,s,r,o,c){this._id=void 0,this._name=void 0,this._hp=void 0,this._ac=void 0,this._wisdom=void 0,this._resilience=void 0,this._dexterity=void 0,this._img=void 0,this._id=t,this._name=i,this._hp=e,this._ac=n,this._wisdom=s,this._resilience=r,this._dexterity=o,this._img=c}return t.fromCSV=function(i){var e=parseInt(i.hp,10),n=parseInt(i.ac,10),s=parseInt(i.wisdom,10),r=parseInt(i.resilience,10),o=parseInt(i.dexterity,10);return new t(i.id,i.name,e,n,s,r,o,i.img)},i(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"hp",get:function(){return this._hp}},{key:"ac",get:function(){return this._ac}},{key:"wisdom",get:function(){return this._wisdom}},{key:"resilience",get:function(){return this._resilience}},{key:"dexterity",get:function(){return this._dexterity}},{key:"img",get:function(){return this._img}}]),t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyTeamData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t;return{setters:[function(e){n=e.createClass},function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"2779ecWOjNL5IJSqyNH68qJ","EnemyTeamData",void 0);e("EnemyTeamData",function(){function e(e,n,t){this._id=void 0,this._challengeRank=void 0,this._enemies=void 0,this._id=e,this._challengeRank=n,this._enemies=t}return e.fromCSV=function(n){var t=parseInt(n.challengeRank);return new e(n.id,t,n.enemies)},n(e,[{key:"id",get:function(){return this._id}},{key:"cr",get:function(){return this._challengeRank}},{key:"enemies",get:function(){return this._enemies}}]),e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/FloatingTextComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,o,r,a,l,s,u,c,p,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.Color,s=t.Vec3,u=t.Label,c=t.instantiate,p=t.tween,f=t.Component}],execute:function(){var h,g,b,m,v,d,y,C,P,w,_,x,B;r._RF.push({},"6e930lNmNxI/bj5j7OKSnzK","FloatingTextComponent",void 0);var L=a.ccclass,z=a.property;t("FloatingTextComponent",(h=L("FloatingTextComponent"),g=z(l),b=z(l),m=z(s),v=z(s),d=z(u),h((P=e((C=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"positiveColor",P,o(e)),i(e,"negativeColor",w,o(e)),i(e,"startPoint",_,o(e)),i(e,"endPoint",x,o(e)),i(e,"templateLabel",B,o(e)),e._numBuffer=[],e._textBuffer=[],e}n(e,t);var r=e.prototype;return r.onLoad=function(){this.templateLabel.node.active=!1},r.showNumber=function(t,e,n,i){var o=this;void 0===n&&(n=.5),void 0===i&&(i="");var r=c(this.templateLabel.node);r.setParent(this.node),this._numBuffer.push(t),p(r).delay(n*(this._numBuffer.length-1)).call((function(){r.active=!0;var e=r.getComponent(u);e.string=(t>0?"+":"")+t.toString()+(i?" "+i:""),e.color=t>0?o.positiveColor:o.negativeColor,r.setPosition(o.startPoint)})).to(1.5,{position:this.endPoint},{easing:"elasticOut"}).call((function(){o._numBuffer.shift(),r.destroy(),null==e||e()})).start()},r.showText=function(t,e,n){var i=this;void 0===n&&(n=.5);var o=c(this.templateLabel.node);o.setParent(this.node),this._textBuffer.push(t),p(o).delay(n*(this._textBuffer.length-1)).call((function(){o.active=!0,o.getComponent(u).string=t,o.setPosition(i.startPoint)})).to(1.5,{position:this.endPoint},{easing:"elasticOut"}).call((function(){i._textBuffer.shift(),o.destroy(),null==e||e()})).start()},e}(f)).prototype,"positiveColor",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(0,255,0)}}),w=e(C.prototype,"negativeColor",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(255,0,0)}}),_=e(C.prototype,"startPoint",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new s(0,0,0)}}),x=e(C.prototype,"endPoint",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new s(0,100,0)}}),B=e(C.prototype,"templateLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=C))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/GameDatabase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CSVLoader.ts","./EmpowerCardData.ts","./CombatCardData.ts","./CombatEffectData.ts","./EnemyData.ts","./EnemyTeamData.ts","./AiIntentData.ts"],(function(a){var t,e,n,o,i,r,s,c,f;return{setters:[function(a){t=a.createClass},function(a){e=a.cclegacy},function(a){n=a.CSVLoader},function(a){o=a.EmpowerCardData},function(a){i=a.CombatCardData},function(a){r=a.CombatEffectData},function(a){s=a.EnemyData},function(a){c=a.EnemyTeamData},function(a){f=a.AiIntentData}],execute:function(){e._RF.push({},"814245g0y1A567rYQuvik/O","GameDatabase",void 0);a("GameDatabase",function(){function a(){this._weaponDatabase=void 0,this._armorDatabase=void 0,this._empowerDatabase=[],this._empowerCardDatabase=[],this._combatCardDatabase=[],this._combatEffectDatabase=[],this._enemyTeamDatabase=[],this._enemyDatabase=[],this._aiIntentDatabase=[],this.loadEmpowerCardData(),this.loadCombatCardData(),this.loadCombatEffectData(),this.loadEnemyTeamData(),this.loadEnemyData(),this.loadeAiIntentData()}var e=a.prototype;return e.loadWeaponData=function(){var a=this;n.loadCSV("data/weapons",(function(t){a._weaponDatabase=t}))},e.loadArmorData=function(){var a=this;n.loadCSV("data/armors",(function(t){a._armorDatabase=t}))},e.loadEmpowerData=function(){var a=this;n.loadCSV("data/empower",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,name:a.name,trigger:[]}),n[t].trigger.push({type:a.trigger_type,key:a.trigger_key,value:a.trigger_value,description:a.description})})),(e=a._empowerDatabase).push.apply(e,Object.values(n))}))},e.loadEmpowerCardData=function(){var a=this;n.loadCSV("data/empower_card",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={regimentation:a.regimentation,rank:parseInt(a.rank,10),id:a.id,name:a.name,cards:[]}),n[t].cards.push({id:a.card_id,name:a.card_name,num:parseInt(a.card_num,10)})})),(e=a._empowerCardDatabase).push.apply(e,Object.values(n).map((function(a){return o.fromCSV(a)})))}))},e.loadCombatCardData=function(){var a=this;n.loadCSV("data/combat_card",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,name:a.name,range:a.range,feeType:a.fee_type,fee:a.fee,effects:[],description:[],evolutions:[]}),a.evolution_conditions?n[t].evolutions.push({conditions:a.evolution_conditions,name:a.name,range:a.range,feeType:a.fee_type,fee:a.fee,effectId:a.effect_id,effectName:a.effect_name}):(n[t].effects.push({id:a.effect_id,name:a.effect_name}),n[t].description.push(a.description))})),(e=a._combatCardDatabase).push.apply(e,Object.values(n).map((function(a){return i.fromCSV(a)})))}))},e.loadCombatEffectData=function(){var a=this;n.loadCSV("data/combat_effect",(function(t){a._combatEffectDatabase=t.map((function(a){return r.fromCSV(a)}))}))},e.loadEnemyTeamData=function(){var a=this;n.loadCSV("data/enemy_team",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,challengeRank:a.challenge_rank,enemies:[]}),n[t].enemies.push(a.enemy_id)})),(e=a._enemyTeamDatabase).push.apply(e,Object.values(n).map((function(a){return c.fromCSV(a)})))}))},e.loadEnemyData=function(){var a=this;n.loadCSV("data/enemy",(function(t){a._enemyDatabase=t.map((function(a){return s.fromCSV(a)}))}))},e.loadeAiIntentData=function(){var a=this;n.loadCSV("data/ai_intent",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,intents:[]}),n[t].intents.push(a.intent)})),(e=a._aiIntentDatabase).push.apply(e,Object.values(n).map((function(a){return f.fromCSV(a)})))}))},t(a,[{key:"weaponDatabase",get:function(){return this._weaponDatabase}},{key:"armorDatabase",get:function(){return this._armorDatabase}},{key:"empowerDatabase",get:function(){return this._empowerDatabase}},{key:"empowerCardDatabase",get:function(){return this._empowerCardDatabase}},{key:"combatCardDatabase",get:function(){return this._combatCardDatabase}},{key:"combatEffectDatabase",get:function(){return this._combatEffectDatabase}},{key:"enemyTeamDatabase",get:function(){return this._enemyTeamDatabase}},{key:"enemyDatabase",get:function(){return this._enemyDatabase}},{key:"aiIntentDatabase",get:function(){return this._aiIntentDatabase}}]),a}());e._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameDatabase.ts","./CharacterCombatData.ts"],(function(a){var t,e,n,r,c,o,s;return{setters:[function(a){t=a.inheritsLoose,e=a.createClass},function(a){n=a.cclegacy,r=a._decorator,c=a.Component},function(a){o=a.GameDatabase},function(a){s=a.CharacterCombatData}],execute:function(){var i,u;n._RF.push({},"6dcbd1szwBNRLtMHywedW9x","GameManager",void 0);var h=r.ccclass;r.property,a("GameManager",h("GameManager")(((u=function(a){function n(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this)._characterCombatData=null,t.database=void 0,t}t(n,a);var r=n.prototype;return r.onLoad=function(){n._instance||(n._instance=this),this.database=new o},r.onSelectPath=function(a){},r.onBattle=function(){},e(n,[{key:"characterCombatData",get:function(){return this._characterCombatData||(this._characterCombatData=new s,this.characterCombatData.empowerCardDatabase=this.database.empowerCardDatabase),this._characterCombatData}}],[{key:"instance",get:function(){return this._instance}}]),n}(c))._instance=null,i=u))||i);n._RF.pop()}}}));

System.register("chunks:///_virtual/GameSetup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EmpowerManager.ts","./GameManager.ts","./EmpowerCardsListItem.ts","./CheckBoxComponent.ts","./PopupWindowComponent.ts","./AudioManager.ts","./BattleManager.ts","./CardPreview.ts","./RewardInteraction.ts","./CardComponent.ts","./CharacterInfo.ts","./EmpowerCombatCardList.ts"],(function(e){var t,n,a,i,r,o,c,s,u,l,p,d,m,h,f,C,w,b,g,v,y,I,E;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,o=e._decorator,c=e.Node,s=e.Layout,u=e.randomRangeInt,l=e.instantiate,p=e.Component},function(e){d=e.EmpowerManager},function(e){m=e.GameManager},function(e){h=e.EmpowerCardsListItem},function(e){f=e.CheckBoxComponent},function(e){C=e.PopupWindowComponent},function(e){w=e.AudioManager},function(e){b=e.BattleManager},function(e){g=e.CardPreview},function(e){v=e.RewardInteraction},function(e){y=e.CardComponent},function(e){I=e.CharacterInfo},function(e){E=e.EmpowerCombatCardList}],execute:function(){var _,P,L,k,M,z,D,B,R,S,x,W,G,V,T,A,F,H,N;r._RF.push({},"bb2ffInL51HnKcJWJ6pe0DS","GameSetup",void 0);var J=o.ccclass,j=o.property;e("GameSetup",(_=J("GameSetup"),P=j(c),L=j(s),k=j(g),M=j(I),z=j(C),D=j(c),B=j(v),R=j(y),_((W=t((x=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,a(t,"empowerCardsListView",W,i(t)),a(t,"empowerCardsListLayout",G,i(t)),a(t,"cardPreview",V,i(t)),a(t,"characterInfo",T,i(t)),a(t,"popupWindow",A,i(t)),a(t,"pathContainer",F,i(t)),a(t,"rewardInteraction",H,i(t)),a(t,"cardComponent",N,i(t)),t._empowerCombatCards={},t._musicEnabled=!0,t._soundEnabled=!0,t}n(t,e);var r=t.prototype;return r.start=function(){d.loadEmpowerData(),m.instance.characterCombatData.read(),this.characterInfo.updateMoney(),this.characterInfo.updateTourniquet(),this.characterInfo.updateHpPotion(),this.scheduleOnce((function(){b.instance.setEnemyData(),E.instance.setEmpowerCombatCardsFromRank(),E.instance.list()}),.5);var e=this.pathContainer.children;e.forEach((function(e){return e.active=!1})),e[0].active=!0,this.cardPreview.nextPathCallback=this.nextPath.bind(this)},r.nextPath=function(){var e=this.pathContainer.children;e.forEach((function(e){return e.active=!1}));var t=u(1,3),n=0;e.some((function(e){var a=Math.random()<.5;return e.active=a,console.log(a),a&&n++,n>t})),this.pathContainer.active=!0,0===e.length&&(console.warn("沒找出路線，重新整理路線"),this.nextPath())},r.onBattleClick=function(){E.instance.setEmpowerCombatCards(),b.instance.startBattle(),this.pathContainer.active=!1},r.onInteractionClick=function(){var e=this.rewardInteraction.data,t=e[u(0,e.length)],n=l(this.cardComponent.node),a=n.getComponent(y);a._cardId=t.id,a._cardName=t.name,a._cardIcon=t.img,a.description=t.dialogue,this.cardPreview.refresh(n),this.cardPreview.listReward(t.rewards,{money_1:m.instance.characterCombatData.money}),b.instance.skipBattle()},r.onInteractionClick2=function(){var e=l(this.cardComponent.node),t=e.getComponent(y);t._cardId="chest_1",t._cardName="寶箱",t.setIcon("chest"),t.description="寶箱裡總會有好東西";this.cardPreview.refresh(e),this.cardPreview.listReward([{id:"money_1",name:"金幣",img:"money",amount:20}],{money_1:m.instance.characterCombatData.money}),b.instance.skipBattle()},r.onDeckIconClick=function(){if(this.empowerCardsListView.active=!this.empowerCardsListView.active,this.empowerCardsListView.active){E.instance.list();var e=0;if(this.empowerCardsListLayout.node.children.forEach((function(t){var n;null!=(n=t.getComponent(h).getComponentInChildren(f))&&n.isChecked&&e++})),e>5)return void this.popupWindow.openPopup("提醒您","選用賦能過多，請不要超過5項賦能",[{label:"確定",callback:null}]);if(0===e)return void this.popupWindow.openPopup("提醒您","請至少選一項賦能",[{label:"確定",callback:null}])}},r.onMusicToggleClick=function(){this._musicEnabled=!this._musicEnabled,w.instance.setMusicEnabled(this._musicEnabled)},r.onSoundToggleClick=function(){this._soundEnabled=!this._soundEnabled,w.instance.setSoundEffectsEnabled(this._soundEnabled)},t}(p)).prototype,"empowerCardsListView",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(x.prototype,"empowerCardsListLayout",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(x.prototype,"cardPreview",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(x.prototype,"characterInfo",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(x.prototype,"popupWindow",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(x.prototype,"pathContainer",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(x.prototype,"rewardInteraction",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(x.prototype,"cardComponent",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=x))||S));r._RF.pop()}}}));

System.register("chunks:///_virtual/GraphicsLineDrawer.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,r,n,t,a,o,l,c,s,h,p;return{setters:[function(e){i=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Node,c=e.Graphics,s=e.Vec3,h=e.randomRangeInt,p=e.Component}],execute:function(){var u,f,g,d,w,y,_,v;a._RF.push({},"e0e0fhzL69JuKnuWTCWLWHY","GraphicsLineDrawer",void 0);var L=o.ccclass,b=o.property;e("GraphicsLineDrawer",(u=L("GraphicsLineDrawer"),f=b(l),u((w=i((d=function(e){function i(){for(var i,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return i=e.call.apply(e,[this].concat(a))||this,n(i,"arror",w,t(i)),n(i,"lineLength",y,t(i)),n(i,"lineSpacing",_,t(i)),n(i,"lineWidth",v,t(i)),i._fromNode=null,i._graphics=null,i}r(i,e);var a=i.prototype;return a.onLoad=function(){this._graphics=this.getComponent(c)},a.drawDashedLine=function(e){this._fromNode=e,this._graphics.clear();var i=this.arror.worldPosition,r=this._fromNode.worldPosition,n=s.distance(i,r),t=0;this._graphics.lineWidth=this.lineWidth,this._graphics.moveTo(i.x,i.y);for(var a=new s(h(-3,3),h(-3,3),0);t<n;){var o=t+this.lineLength;o>n&&(o=n);var l=t/n,c=o/n,p=s.lerp(new s,i,r,l);s.lerp(new s,i,r,c);if(this._graphics.lineTo(p.x+a.x,p.y+a.y),this._graphics.stroke(),(t=o+this.lineSpacing)<n){var u=s.lerp(new s,i,r,t/n);this._graphics.moveTo(u.x,u.y)}}},a.clearDashedLine=function(){this._graphics.clear()},i}(p)).prototype,"arror",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=i(d.prototype,"lineLength",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),_=i(d.prototype,"lineSpacing",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),v=i(d.prototype,"lineWidth",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),g=d))||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/HandCards.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DynamicWidthScrollView.ts","./CardMover.ts","./HitBox.ts","./GraphicsLineDrawer.ts"],(function(t){var e,i,n,o,r,a,c,s,l,h,u,d,p,f,v,w,T,_,C,b,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){a=t.cclegacy,c=t._decorator,s=t.Node,l=t.Color,h=t.EventHandler,u=t.Label,d=t.Vec3,p=t.UIOpacity,f=t.UITransform,v=t.Button,w=t.instantiate,T=t.Component},function(t){_=t.DynamicWidthScrollView},function(t){C=t.CardMover},function(t){b=t.HitBox},function(t){g=t.GraphicsLineDrawer}],execute:function(){var y,m,E,S,V,P,L,D,H,x,O,U,z,B,M,k,I,R,A,N,W;a._RF.push({},"880f34hHldLa4t21nW2dLUl","HandCards",void 0);var F=c.ccclass,G=c.property;t("HandCards",(y=F("HandCards"),m=G(s),E=G(_),S=G(l),V=G(s),P=G(b),L=G(h),D=G(h),H=G(g),x=G(u),y((z=e((U=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"cardPrefab",z,o(e)),n(e,"dwScrollView",B,o(e)),n(e,"selectedColor",M,o(e)),n(e,"arrowTip",k,o(e)),n(e,"hitBox",I,o(e)),n(e,"touchedCardEvent",R,o(e)),n(e,"playCardCheckEvent",A,o(e)),n(e,"graphicsLineDrawer",N,o(e)),n(e,"tipLabel",W,o(e)),e._buttonTemps=[],e._oriColor=void 0,e._oriPositionY=void 0,e._selected=null,e._touchStartPos=null,e._oriCardPos=null,e._touchParent=null,e._selectCancel=!1,e._opacity=255,e._needTarget=!0,e}i(e,t);var a=e.prototype;return a.onEnable=function(){this.catchTag()},a.onDisable=function(){},a.onTouchStart=function(t){var e=t.target,i=t.getUILocation(),n=i.x,o=i.y;this._touchStartPos=new d(n,o+50,0),this._oriCardPos=e.position.clone(),this.arrowTip.setWorldPosition(this._touchStartPos),this._selectCancel=!1,this.touchedCardEvent.forEach((function(t){return t.emit([e])}))},a.onTouchMove=function(t){if(!this._selectCancel){var e=t.target,i=t.getUIDelta();if(!this._needTarget)return e.worldPosition.y-this._touchStartPos.y>100&&(this.dwScrollView.scrollView.enabled=!1),void e.setPosition(e.position.x,e.position.y+i.y);e.getComponent(p).opacity=120;var n=this.arrowTip;n.setPosition(n.position.x+i.x,n.position.y+i.y);var o=n.parent.getComponent(f).convertToWorldSpaceAR(n.position);n.active?this.graphicsLineDrawer.drawDashedLine(e):this.graphicsLineDrawer.clearDashedLine(),Math.abs(o.x-this._touchStartPos.x)>50?this._selectCancel=!n.active:o.y-this._touchStartPos.y>50&&(n.active=!0,this.dwScrollView.scrollView.enabled=!1,e.getComponent(p).opacity=180)}},a.onTouchEnd=function(t){var e=t.target;this.dwScrollView.scrollView.enabled=!0,this.arrowTip.active=!1,e.getComponent(p).opacity=255,!this._needTarget&&e.worldPosition.y-this._touchStartPos.y>120?(this._selected=e,this.playCardCheckEvent.forEach((function(t){return t.emit([e])}))):e.position=this._oriCardPos,this.graphicsLineDrawer.clearDashedLine()},a.onTouchCancel=function(t){var e=t.target;if(this.dwScrollView.scrollView.enabled=!0,this.arrowTip.active=!1,e.getComponent(p).opacity=255,!this._needTarget&&e.worldPosition.y-this._touchStartPos.y>120)this._selected=e,this.playCardCheckEvent.forEach((function(t){return t.emit([e])}));else if(this._needTarget&&this.hitBox.tryHit()){var i=this.hitBox.target;this._selected=e,this.playCardCheckEvent.forEach((function(t){return t.emit([e,i])}))}else e.position=this._oriCardPos;this.graphicsLineDrawer.clearDashedLine()},a.show=function(t){void 0===t&&(t=!0),this.node.active=t},a.lock=function(t){void 0===t&&(t=!0),this._buttonTemps.forEach((function(e){return e.interactable=!t}))},a.disableCards=function(){var t=this;this._buttonTemps.forEach((function(e){return t._removeEventTouch(e.node)}))},a.catchTag=function(){this.arrowTip.active=!1,this.hitBox.catchTag()},a.removeTag=function(t){this.hitBox.removeTag(t)},a.cancelSelect=function(){this._selected.position=this._oriCardPos},a.playCard=function(){if(this._selected){this._removeEventTouch(this._selected),this._buttonTemps.splice(this._buttonTemps.indexOf(this._selected.getComponent(v)),1),this._selected.parent.setSiblingIndex(999),this._selected.parent.active=!1,this.dwScrollView.scrollView.enabled=!0;var t=this.dwScrollView.content.getComponent(f).convertToWorldSpaceAR(this._selected.parent.position);this.dwScrollView.scrollView.scrollToPercentVertical(t.x/this.dwScrollView.scrollView.content.getComponent(f).width,.5)}else console.warn("HandCards: no selected card")},a.discardCard=function(t){var e=this._buttonTemps.indexOf(t.getComponent(v));-1!==e?(this._removeEventTouch(t),this._buttonTemps.splice(e,1),t.parent.setSiblingIndex(999),t.parent.active=!1):console.warn("HandCards: card not found")},a.setCount=function(t){var e=this.dwScrollView.content,i=e.children;i.forEach((function(t){return t.active=!1}));for(var n=0;n<t;n++){var o=i[n];o||((o=w(this.cardPrefab)).parent=e),o.active=!0,o.getComponentInChildren(u).string=n.toString()}this.dwScrollView.scrollView.scrollToRight(1)},a.attach=function(t){var e=this,i=this.dwScrollView.content.children;t.forEach((function(t,e){C.moveCard(t,i[e],d.ZERO),t.active=!0})),this._buttonTemps.forEach((function(t){return e._removeEventTouch(t.node)})),this._buttonTemps.length=0,t.forEach((function(t){var i=t.getComponent(v);i?(e._setEventTouch(i.node),e._buttonTemps.push(i)):console.error(i.name,"HandCards: cardButton not found")})),this.dwScrollView.scrollView.enabled=!0},a.setNeedTarget=function(t){this._needTarget=t},a.clear=function(){var t;this.dwScrollView.content.children.forEach((function(t){return t.active=!1})),this.cards.forEach((function(t){return t.destroy()})),this._buttonTemps.length=0,null==(t=this._selected)||t.destroy(),this._selected=null,this.arrowTip.active=!1,this._needTarget=!1},a._setEventTouch=function(t){t.on(s.EventType.TOUCH_START,this.onTouchStart,this),t.on(s.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(s.EventType.TOUCH_END,this.onTouchEnd,this),t.on(s.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},a._removeEventTouch=function(t){t.off(s.EventType.TOUCH_START,this.onTouchStart,this),t.off(s.EventType.TOUCH_MOVE,this.onTouchMove,this),t.off(s.EventType.TOUCH_END,this.onTouchEnd,this),t.off(s.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},a.drawCard=function(t){this.setCount(t.length),this.attach(t)},r(e,[{key:"cards",get:function(){return this._buttonTemps.map((function(t){return t.node}))}}]),e}(T)).prototype,"cardPrefab",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(U.prototype,"dwScrollView",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(U.prototype,"selectedColor",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(255,255,255,255)}}),k=e(U.prototype,"arrowTip",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(U.prototype,"hitBox",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(U.prototype,"touchedCardEvent",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A=e(U.prototype,"playCardCheckEvent",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),N=e(U.prototype,"graphicsLineDrawer",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(U.prototype,"tipLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=U))||O));a._RF.pop()}}}));

System.register("chunks:///_virtual/HideAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,a,c,s,u,l,p,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,c=t.Node,s=t.tween,u=t.v3,l=t.UIOpacity,p=t.Tween,d=t.Component}],execute:function(){var g,h,f,y,m,b;r._RF.push({},"d7439ZMnRZLfp1t6juGuJcD","HideAnimation",void 0);var v=a.ccclass,N=a.property;t("HideAnimation",(g=v("HideAnimation"),h=N(c),g((m=e((y=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"targetNode",m,o(e)),n(e,"duration",b,o(e)),e}i(e,t);var r=e.prototype;return r.startAnimation=function(){this.targetNode.position=this.node.position.clone(),this.targetNode.active=!0,s(this.targetNode).to(this.duration/2,{scale:u(1.5,1.5,1)},{easing:"cubicInOut"}).to(this.duration/2,{scale:u(1,1,1)},{easing:"cubicInOut"}).start(),this.targetNode.getComponent(l).opacity=0,s(this.targetNode.getComponent(l)).to(this.duration/2,{opacity:255},{easing:"cubicInOut"}).start()},r.stopAnimation=function(){p.stopAllByTarget(this.targetNode),this.targetNode.active=!1},e}(d)).prototype,"targetNode",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=e(y.prototype,"duration",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),f=y))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/HitBox.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HitTag.ts"],(function(t){var e,n,r,i,o,a,s,c,u,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.createClass},function(t){a=t.cclegacy,s=t._decorator,c=t.Node,u=t.Component},function(t){l=t.HitTag}],execute:function(){var p,g,h,f,_;a._RF.push({},"96ff9jpamdA2bWRunCbqZnm","HitBox",void 0);var v=s.ccclass,y=s.property;t("HitBox",(p=v("HitBox"),g=y({type:c,tooltip:'包含有"HitTag"子節點组件的父節點'}),p((_=e((f=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,r(e,"catchPools",_,i(e)),e._tags=[],e._target=null,e}n(e,t);var a=e.prototype;return a.catchTag=function(){var t=this;this._tags.length=0,this.catchPools.forEach((function(e){var n,r=e.getComponentsInChildren(l);(n=t._tags).push.apply(n,r)}))},a.removeTag=function(t){var e=this;[].concat(this._tags).some((function(n){return n.tagID===t&&(e._tags.splice(e._tags.indexOf(n),1),!0)}))},a.tryHit=function(){var t=this;return this._tags.some((function(e){var n=e.onHitTest(t.node);return n&&(t._target=e.node),n}))},o(e,[{key:"target",get:function(){return this._target}}]),e}(u)).prototype,"catchPools",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h=f))||h));a._RF.pop()}}}));

System.register("chunks:///_virtual/HitCheckAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FloatingTextComponent.ts"],(function(t){var e,i,n,o,a,r,u,s,c,l,p,d,g,h,b,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){u=t.cclegacy,s=t._decorator,c=t.Node,l=t.Label,p=t.v3,d=t.Tween,g=t.tween,h=t.Component,b=t.UIOpacity},function(t){f=t.FloatingTextComponent}],execute:function(){var v,m,y,L,N,w,C,I,O,T;u._RF.push({},"b9eb2nvQ95OKbr7JRCkzMir","HitCheckAnimation",void 0);var _=s.ccclass,A=s.property;t("HitCheckAnimation",(v=_("HitCheckAnimation"),m=A(c),y=A(f),L=A(l),v((C=e((w=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,n(e,"targetNode",C,o(e)),n(e,"floatingText",I,o(e)),n(e,"valueLabel",O,o(e)),n(e,"duration",T,o(e)),e._oriPosition=p(),e}i(e,t);var u=e.prototype;return u.onLoad=function(){this.hide()},u.startAnimation=function(){var t=a(r().mark((function t(){var e=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._oriPosition=this.valueLabel.node.position.clone(),this.targetNode.active=!0,this.targetNode.position=this._oriPosition.clone().add3f(-120,0,0),this.targetNode.angle=-45,t.abrupt("return",new Promise((function(t){g(e.targetNode).parallel(g().to(e.duration,{position:e._oriPosition},{easing:"cubicInOut"}),g().to(e.duration,{angle:45},{easing:"cubicInOut"})).call((function(){t()})).start(),e.targetNode.getComponent(b).opacity=0,g(e.targetNode.getComponent(b)).to(e.duration/2,{opacity:255},{easing:"cubicInOut"}).start()})));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),u.stopAnimation=function(){d.stopAllByTarget(this.targetNode),this.targetNode.position=this._oriPosition},u.hide=function(){this.valueLabel.node.active=!1,this.targetNode.active=!1},u.setValue=function(t,e,i){void 0===e&&(e=1),this.valueLabel.string=i?""+t+i:t.toString(),this.valueLabel.node.active=!0,g(this.valueLabel.node).to(this.duration/2,{scale:p(e,e,1)},{easing:"cubicInOut"}).to(this.duration/2,{scale:p(1,1,1)},{easing:"cubicInOut"}).start()},u.addBonus=function(t,e,i){var n=this;void 0===i&&(i=""),this.floatingText.showNumber(t,(function(){n.valueLabel.string=e.toString(),g(n.valueLabel.node).to(n.duration/2,{scale:p(1.5,1.5,1)},{easing:"cubicInOut"}).to(n.duration/2,{scale:p(1,1,1)},{easing:"cubicInOut"}).start()}),0,i)},e}(h)).prototype,"targetNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(w.prototype,"floatingText",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(w.prototype,"valueLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(w.prototype,"duration",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),N=w))||N));u._RF.pop()}}}));

System.register("chunks:///_virtual/HitPointsBarComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FloatingTextComponent.ts"],(function(t){var e,n,i,o,r,a,p,s,u,l,h,c,m,H,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){a=t.cclegacy,p=t._decorator,s=t.ProgressBar,u=t.Node,l=t.Label,h=t.Vec3,c=t.tween,m=t.UITransform,H=t.Component},function(t){f=t.FloatingTextComponent}],execute:function(){var b,g,d,x,B,P,y,C,w,L,_;a._RF.push({},"975d2k7B9dAQ7imcn3+VIGb","HitPointsBarComponent",void 0);var v=p.ccclass,T=p.property;t("HitPointsBarComponent",(b=v("HitPointsBarComponent"),g=T(s),d=T(f),x=T(u),B=T(l),b((C=e((y=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"hpBar",C,o(e)),i(e,"floatingTextComponent",w,o(e)),i(e,"textSpawnPoint",L,o(e)),i(e,"hpLabel",_,o(e)),e.curHp=100,e.maxHp=100,e._tempHp=0,e}n(e,t);var a=e.prototype;return a.setHP=function(t,e){this.maxHp=t,this.curHp=e,this.updateBar(),this.updateHpLabel()},a.changeHp=function(t){var e=this,n=Math.min(Math.max(this.curHp+t,0),this.maxHp),i=this.textSpawnPoint.position.clone(),o=new h(0,40,0),r=t<=0?i.add(o):i.subtract(o);this.floatingTextComponent.startPoint=r,this.floatingTextComponent.endPoint=this.textSpawnPoint.position,this.curHp=n,this.floatingTextComponent.showNumber(t,(function(){e.updateBar(),e.updateHpLabel()}))},a.updateBar=function(){this.hpBar.progress;var t=(this.curHp+this._tempHp)/this.maxHp;c(this.hpBar).to(.25,{progress:t}).start()},a.updateHpLabel=function(){this._tempHp?this.hpLabel.string="HP: "+(this.curHp+this._tempHp)+" (+"+this._tempHp+") / "+this.maxHp:this.hpLabel.string="HP: "+this.curHp+" / "+this.maxHp},r(e,[{key:"defaultHp",set:function(t){this.hpBar.totalLength=this.getComponent(m).width,this.maxHp=t,this.curHp=t,this.updateBar(),this.updateHpLabel()}},{key:"tempHp",get:function(){return this._tempHp},set:function(t){this._tempHp=t,this.updateHpLabel()}}]),e}(H)).prototype,"hpBar",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(y.prototype,"floatingTextComponent",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(y.prototype,"textSpawnPoint",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(y.prototype,"hpLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=y))||P));a._RF.pop()}}}));

System.register("chunks:///_virtual/HitTag.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,o,r,i,c;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t._decorator,r=t.UITransform,i=t.Rect,c=t.Component}],execute:function(){var s;n._RF.push({},"c6070yqE7ZNV4279lc1aNrY","HitTag",void 0);var a=o.ccclass;o.property,t("HitTag",a("HitTag")(s=function(t){function n(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))||this).tagID="",e}e(n,t);var o=n.prototype;return o.onHitTest=function(t){var e,n=null==(e=this.node)?void 0:e.getComponent(r),o=null==t?void 0:t.getComponent(r);if(!n||!o)return console.error("UITransform component is missing on one of the nodes."),!1;var i=this.getWorldRect(this.node,n),c=this.getWorldRect(t,o);return i.intersects(c)},o.getWorldRect=function(t,e){var n=t.getWorldPosition(),o=e.width,r=e.height;return new i(n.x-o/2,n.y-r/2,o,r)},n}(c))||s);n._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./debug-view-runtime-control.ts","./DefenseAnimation.ts","./DiceAnimation.ts","./DodgeAnimation.ts","./HideAnimation.ts","./HitCheckAnimation.ts","./ShakeAnimation.ts","./StunAnimation.ts","./CharacterCombatData.ts","./CombatCard.ts","./CombatEffect.ts","./CombatEffectComponent.ts","./CombatUnit.ts","./EmpowerCombatCardList.ts","./AiIntentData.ts","./CSVLoader.ts","./CombatCardData.ts","./CombatEffectData.ts","./EmpowerCardData.ts","./EmpowerData.ts","./EnemyData.ts","./EnemyTeamData.ts","./GameDatabase.ts","./AudioHelper.ts","./AudioManager.ts","./BattleManager.ts","./CombatCardManager.ts","./CombatEffectManager.ts","./EmpowerManager.ts","./GameManager.ts","./GameSetup.ts","./CameraCenterMover.ts","./CardMover.ts","./CheckBoxComponent.ts","./CounterComponent.ts","./DynamicWidthScrollView.ts","./FloatingTextComponent.ts","./GraphicsLineDrawer.ts","./HitBox.ts","./HitPointsBarComponent.ts","./HitTag.ts","./PixelImage.ts","./RandomString.ts","./CharacterInfo.ts","./EmpowerCardsListItem.ts","./CardComponent.ts","./CardPreview.ts","./CombatCardComponent.ts","./HandCards.ts","./NPCInteraction.ts","./QuestInteraction.ts","./RewardInteraction.ts","./PopupWindowComponent.ts","./RewardPanel.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NPCInteraction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PixelImage.ts"],(function(e){var t,n,i,r,a,o,u,l,c,s,d,p,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,u=e.Label,l=e.Layout,c=e.Button,s=e.instantiate,d=e.UIOpacity,p=e.Component},function(e){f=e.PixelImage}],execute:function(){var m,h,b,g,w,y,v,L,C,I,B,P,z;a._RF.push({},"a485brwkVVL0rG7SNw3352Q","NPCInteraction",void 0);var R=o.ccclass,S=o.property;e("NPCInteraction",(m=R("NPCInteraction"),h=S(u),b=S(f),g=S(u),w=S(l),y=S(c),m((C=t((L=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"nameLabel",C,r(t)),i(t,"imageSprite",I,r(t)),i(t,"dialogueLabel",B,r(t)),i(t,"rewardLayout",P,r(t)),i(t,"closeButton",z,r(t)),t.rewards=[],t.data=[{id:"",name:"",img:"",dialogue:"",rewards:[{name:"",conditions:[{id:"",amount:0}]}]}],t}n(t,e);var a=t.prototype;return a.init=function(e,t){var n=this.data.find((function(t){return t.id===e})),i=n.name,r=n.img,a=n.dialogue,o=n.rewards.forEach((function(e){return{name:e.name,claimed:!1,button:null,condition:function(){return!0}}}));this.nameLabel.string=i,this.imageSprite.setSpriteFrame(r),this.dialogueLabel.string=a,this.rewards=o,this.setupRewards(),this.updateCloseButton()},a.setupRewards=function(){var e=this,t=this.rewardLayout.node.children;t.forEach((function(e){return e.active=!1}));var n=s(t[0]);this.rewards.forEach((function(i,r){var a=t[r];a||((a=s(n)).parent=e.rewardLayout.node,a.addComponent(d)),a.active=!0;var o=a.addComponent(c),l=a.getComponent(d);a.getComponentInChildren(u).string=i.name,i.condition()?(o.interactable=!0,l.opacity=1,o.node.on("click",(function(){return e.claimReward(i)}),e)):(o.interactable=!1,l.opacity=.5)}))},a.claimReward=function(e){e.claimed=!0,e.button.node.active=!1,this.updateCloseButton()},a.updateCloseButton=function(){this.closeButton.interactable=this.rewards.every((function(e){return e.claimed}))},a.close=function(){this.rewardLayout.node.children.forEach((function(e){return e.active=!1})),this.rewards.length=0},t}(p)).prototype,"nameLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(L.prototype,"imageSprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(L.prototype,"dialogueLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(L.prototype,"rewardLayout",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(L.prototype,"closeButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=L))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/PixelImage.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,o,n,a,s,l;return{setters:[function(e){t=e.inheritsLoose},function(e){r=e.cclegacy,i=e._decorator,o=e.Sprite,n=e.Texture2D,a=e.resources,s=e.SpriteFrame,l=e.Component}],execute:function(){var c;r._RF.push({},"1e6a61M7DpGTZ8ctRa3V2rU","PixelImage",void 0);var p=i.ccclass;i.property,e("PixelImage",p("PixelImage")(c=function(e){function r(){return e.apply(this,arguments)||this}t(r,e);var i=r.prototype;return i.onLoad=function(){var e,t=null==(e=this.node.getComponent(o).spriteFrame)?void 0:e.texture;t&&t.setFilters(n.Filter.NONE,n.Filter.NONE)},i.setSpriteFrame=function(e){var t=this.node.getComponent(o),r="picture/"+e+"/spriteFrame";a.load(r,s,(function(e,r){e?console.error("Failed to load image: "+e):(t.spriteFrame=r,t.spriteFrame.texture.setFilters(n.Filter.NONE,n.Filter.NONE))}))},i.clearSpriteFrame=function(){this.node.getComponent(o).spriteFrame=null},r}(l))||c);r._RF.pop()}}}));

System.register("chunks:///_virtual/PopupWindowComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,r,i,o,a,u,c,l,s,p,f,b,h,d,v;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){u=t.cclegacy,c=t._decorator,l=t.Node,s=t.Label,p=t.Button,f=t.instantiate,b=t.EventHandler,h=t.Component,d=t.Vec3,v=t.tween}],execute:function(){var m,w,g,C,y,P,k,L,x,z,N,E,I;u._RF.push({},"ef7f9o5MSdHJIyaJ+5Y6gKE","PopupWindowComponent",void 0);var T=c.ccclass,W=c.property;t("PopupWindowComponent",(m=T("PopupWindowComponent"),w=W(l),g=W(s),C=W(s),y=W(l),P=W(p),m((x=n((L=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o))||this,r(n,"dialogNode",x,i(n)),r(n,"titleLabel",z,i(n)),r(n,"contentLabel",N,i(n)),r(n,"buttonContainer",E,i(n)),r(n,"buttonPrefab",I,i(n)),n.callbacks={},n}e(n,t);var u=n.prototype;return u.openPopup=function(){var t=o(a().mark((function t(n,e,r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.node.active=!0,t.next=3,this.animateOpen();case 3:this.setupTitle(n),this.contentLabel.string=e,this.setupButtons(r);case 6:case"end":return t.stop()}}),t,this)})));return function(n,e,r){return t.apply(this,arguments)}}(),u.setupTitle=function(t){this.titleLabel.node.active=!!t,this.titleLabel.string=t||""},u.setupButtons=function(t){var n=this;this.buttonContainer.removeAllChildren(),t.forEach((function(t,e){var r=f(n.buttonPrefab.node),i=r.getComponent(p);r.getComponentInChildren(s).string=t.label,r.parent=n.buttonContainer,r.active=!0;var o="button_"+e;n.callbacks[o]=t.callback;var a=new b;a.target=n.node,a.component="PopupWindowComponent",a.handler="buttonClicked",a.customEventData=o,i.clickEvents.push(a)}))},u.buttonClicked=function(){var t=o(a().mark((function t(n,e){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.animateClose();case 2:null==(r=this.callbacks[e])||r();case 4:case"end":return t.stop()}}),t,this)})));return function(n,e){return t.apply(this,arguments)}}(),u.animateOpen=function(){var t=o(a().mark((function t(){var n=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.dialogNode.scale=new d(0,0,0),v(n.dialogNode).to(.3,{scale:new d(1,1,1)},{easing:"cubicInOut"}).call((function(){return t()})).start()})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),u.animateClose=function(){var t=o(a().mark((function t(){var n=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.reset(),t.abrupt("return",new Promise((function(t){v(n.dialogNode).to(.3,{scale:new d(0,0,0)},{easing:"cubicInOut"}).call((function(){t(),n.node.active=!1})).start()})));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),u.reset=function(){this.setupTitle(""),this.contentLabel.string="",this.buttonContainer.removeAllChildren()},n}(h)).prototype,"dialogNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(L.prototype,"titleLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(L.prototype,"contentLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(L.prototype,"buttonContainer",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(L.prototype,"buttonPrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=L))||k));u._RF.pop()}}}));

System.register("chunks:///_virtual/QuestInteraction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CheckBoxComponent.ts"],(function(t){var e,n,o,i,r,c,s,u,a,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,c=t._decorator,s=t.Layout,u=t.Label,a=t.Component},function(t){l=t.CheckBoxComponent}],execute:function(){var p,f,h,y,d,b,g;r._RF.push({},"74f14pO4FZPVYbNSd8SqtFe","QuestInteraction",void 0);var I=c.ccclass,L=c.property;t("QuestInteraction",(p=I("QuestInteraction"),f=L(s),h=L(u),p((b=e((d=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r))||this,o(e,"questLayout",b,i(e)),o(e,"descriptionLabel",g,i(e)),e._taskIds=[],e}n(e,t);var r=e.prototype;return r.reset=function(){var t;null==(t=this.questLayout.getComponentsInChildren(l))||t.forEach((function(t){return t.cancel()}))},r.close=function(){this._taskIds.length=0},r.listQuest=function(t){console.log("listQuest",t)},r.onSelectQuestClicked=function(){console.log(this._taskIds)},e}(a)).prototype,"questLayout",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=e(d.prototype,"descriptionLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=d))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/RandomString.ts",["cc"],(function(n){var t;return{setters:[function(n){t=n.cclegacy}],execute:function(){t._RF.push({},"6d68btvCrRImoQ92N8EOOsm","RandomString",void 0);n("RandomString",function(){function n(){}return n.generate=function(n){void 0===n&&(n=10);for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",o=0;o<n;o++){r+=t[Math.floor(Math.random()*t.length)]}return r},n}());t._RF.pop()}}}));

System.register("chunks:///_virtual/RewardInteraction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./RewardPanel.ts","./PopupWindowComponent.ts","./PixelImage.ts","./CardMover.ts","./CharacterInfo.ts"],(function(n){var t,e,o,r,i,a,u,c,s,l,p,d,m,f,h,g,b,_,y,v,w,P,C,x,q,I;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,o=n.initializerDefineProperty,r=n.assertThisInitialized,i=n.asyncToGenerator,a=n.regeneratorRuntime},function(n){u=n.cclegacy,c=n._decorator,s=n.Layout,l=n.ProgressBar,p=n.Node,d=n.Label,m=n.instantiate,f=n.Button,h=n.UIOpacity,g=n.UITransform,b=n.tween,_=n.Component,y=n.v3,v=n.Vec3},function(n){w=n.GameManager},function(n){P=n.RewardPanel},function(n){C=n.PopupWindowComponent},function(n){x=n.PixelImage},function(n){q=n.CardMover},function(n){I=n.CharacterInfo}],execute:function(){var k,z,L,B,E,M,R,D,S,W,T,O,j,H,U,F,G,Z,J,A,N,V,K,Q,X,Y,$;u._RF.push({},"d30d7j/bfdC8aLMnJJmkaWi","RewardInteraction",void 0);var nn=c.ccclass,tn=c.property;n("RewardInteraction",(k=nn("RewardInteraction"),z=tn(s),L=tn(l),B=tn(p),E=tn(p),M=tn(p),R=tn(C),D=tn(d),S=tn(p),W=tn(p),T=tn(p),O=tn(I),j=tn(p),k((F=t((U=function(n){function t(){for(var t,e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return t=n.call.apply(n,[this].concat(i))||this,o(t,"rewardLayout",F,r(t)),o(t,"expProgressBars",G,r(t)),o(t,"tourniquet",Z,r(t)),o(t,"hpPotion",J,r(t)),o(t,"itemContainer",A,r(t)),o(t,"popupWindow",N,r(t)),o(t,"descriptionLabel",V,r(t)),o(t,"rewardPanelContainer",K,r(t)),o(t,"coinPrefab",Q,r(t)),o(t,"characterInfoMoneyPos",X,r(t)),o(t,"characterInfo",Y,r(t)),o(t,"closeButton",$,r(t)),t.description="",t._tempStr=[],t._rewards=[],t.data=[{id:"npc_001",name:"迷途旅人",img:"npc_lost_traveler",dialogue:"我在這個迷宮裡待了很久了，也許剛加入迷宮的你會需要這個…",rewards:[{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1}]},{id:"npc_002",name:"迷宮商人",img:"npc_maze_merchant",dialogue:"迷宮裡存活不易，你身上有財寶的話可以跟我換點東西。",rewards:[{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:10}]},{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:10}]},{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:10}]},{id:"health_potion_1",name:"生命藥水",img:"health_potion",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]},{id:"health_potion_1",name:"生命藥水",img:"health_potion",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]}]},{id:"npc_003",name:"迷宮守護者",img:"npc_maze_guardian",dialogue:"你能夠走到這裡，顯示了你的實力。這是我最後能給你的幫助。",rewards:[{id:"health_potion_1",name:"生命藥水",img:"health_potion",amount:1}]},{id:"npc_005",name:"哪裡來的小狗",img:"npc_gatekeeper",dialogue:"(牠從嘴裡吐出一支鑰匙，一溜煙地跑掉了。)\n\n蛤？",rewards:[{id:"universal_key_1",name:"萬能鑰匙",img:"key",amount:1}]},{id:"npc_009",name:"拾荒者",img:"npc_battlefield_medic",dialogue:"戰鬥總是充滿危險，帶上這些繃帶，或許能救你一命。",rewards:[{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]},{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]},{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]}]}],t}e(t,n);var u=t.prototype;return u.setDescription=function(n){this.description=n},u.listReward=function(n,t){var e=this,o=this.rewardLayout.node.children;o.forEach((function(n){return n.active=!1})),this._tempStr.length=0,console.log(n),this.closeButton.active=!1;var r=m(o[0]);n.forEach((function(n,i){var a,u;n.available=!0,n.condition=function(){return n.available&&(!n.conditions||n.conditions.every((function(n){return t[n.id]>=n.amount})))},n.conditions&&(e.closeButton.active=!0);var c=o[i];c||((c=m(r)).parent=e.rewardLayout.node),c.active=!0,null==(a=c.getComponentInChildren(x))||a.setSpriteFrame(n.img);c.addComponent(f),c.getComponent(h)||c.addComponent(h);var s=c.getComponentInChildren(d);s.string=n.name+"x"+n.amount,null==(u=n.conditions)||u.forEach((function(n){s.string+="\n需花費\n"+n.amount+n.name})),c.off("click"),c.once("click",(function(){if(n.condition()){var o;if("exp_1"===n.id){var r=n.amount;e.setExpProgress(r,c)}else"money_1"===n.id?e.setMoney(n.amount,c):"tourniquet_1"===n.id?e.addTourniquet(n.amount,c):"health_potion_1"===n.id?e.addHPpotion(n.amount,c):"universal_key_1"===n.id&&(e.node.active=!1);null==(o=n.conditions)||o.forEach((function(n){"money_1"===n.id&&(w.instance.characterCombatData.money-=n.amount,e.characterInfo.updateMoney(-n.amount),e._tempStr.push("花費"+n.amount+" "+n.name),t[n.id]-=n.amount)})),e._tempStr.push(n.amount+" "+n.name),e.descriptionLabel.string=e.description+"\n\n獲得\n"+e._tempStr.join("\n"),n.available=!1}else{var i=n.conditions.map((function(n){return n.name})).join("、");e.popupWindow.openPopup("無法兌換","你得付出一點東西…\n\n("+i+"不足)",[{label:"確認",callback:function(){}}])}}),e)})),this._rewards=n.flat()},u.close=function(){this.rewardLayout.node.children.forEach((function(n){n.off("click"),n.active=!1})),this.expProgressBars[0].node.active=!1,this._rewards.length=0,this.closeButton.active=!1},u.isBlocked=function(){return this._rewards.some((function(n){return n.condition()}))},u.setExpProgress=function(n,t){var e=this,o=w.instance.characterCombatData.curExp,r=w.instance.characterCombatData.maxExp,i=o+n;w.instance.characterCombatData.curExp=i;var a=this.expProgressBars[0],u=this.expProgressBars[1];a.totalLength=a.getComponent(g).width,a.node.active=!0,a.progress=o/r,u.progress=i/r;var c=a.getComponentInChildren(d);c.string=o+"/"+r,b(a).to(.5,{progress:i/r},{easing:"linear",onUpdate:function(t,e){c.string=Math.floor(o+n*e)+"/"+r}}).delay(.5).call((function(){i>=r&&(w.instance.characterCombatData.tryLevelUp(),u.progress=i/r,e.popupWindow.openPopup("恭喜升級","升級提升您的賦能，可使用更多的卡牌",[{label:"選擇賦能或升級",callback:function(){e.rewardPanelContainer.getComponent(P).show()}}])),t.active=!1})).start()},u.setMoney=function(){var n=i(a().mark((function n(t,e){var o,r,i,u,c,s=this;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(o=[],r=0;r<t;r++)(i=m(this.coinPrefab)).parent=e,i.active=!0,o.push(i);return n.next=4,q.scatterCards(o,e,[30,120],.25);case 4:u=1/o.length;case 5:if(!(o.length>0)){n.next=13;break}return c=o.pop(),n.next=9,q.moveCard(c,this.characterInfoMoneyPos,v.ZERO,.5,u,.3);case 9:w.instance.characterCombatData.money++,this.characterInfo.updateMoney(),n.next=5;break;case 13:return n.next=15,new Promise((function(n){return s.scheduleOnce(n,.7-u)}));case 15:o.forEach((function(n){return n.destroy()})),e.active=!1;case 17:case"end":return n.stop()}}),n,this)})));return function(t,e){return n.apply(this,arguments)}}(),u.addTourniquet=function(){var n=i(a().mark((function n(t,e){var o;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(o=m(this.tourniquet)).parent=e,o.active=!0,o.worldPosition=e.worldPosition,n.next=6,q.moveCard(o,this.tourniquet,v.ZERO,1,.5,.3);case 6:b(this.tourniquet).to(.25,{scale:y(1.2,1.2,1.2)}).start(),o.destroy(),e.active=!1,w.instance.characterCombatData.tourniquetCount+=t,this.characterInfo.updateTourniquet();case 11:case"end":return n.stop()}}),n,this)})));return function(t,e){return n.apply(this,arguments)}}(),u.addHPpotion=function(){var n=i(a().mark((function n(t,e){var o;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(o=m(this.hpPotion)).parent=e,o.active=!0,o.worldPosition=e.worldPosition,n.next=6,q.moveCard(o,this.hpPotion,v.ZERO,1,.5,.3);case 6:b(this.hpPotion).to(.25,{scale:y(1.2,1.2,1.2)}).start(),o.destroy(),e.active=!1,w.instance.characterCombatData.hpPotionCount+=t,this.characterInfo.updateHpPotion();case 11:case"end":return n.stop()}}),n,this)})));return function(t,e){return n.apply(this,arguments)}}(),t}(_)).prototype,"rewardLayout",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(U.prototype,"expProgressBars",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Z=t(U.prototype,"tourniquet",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(U.prototype,"hpPotion",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(U.prototype,"itemContainer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(U.prototype,"popupWindow",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(U.prototype,"descriptionLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(U.prototype,"rewardPanelContainer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(U.prototype,"coinPrefab",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(U.prototype,"characterInfoMoneyPos",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(U.prototype,"characterInfo",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(U.prototype,"closeButton",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=U))||H));u._RF.pop()}}}));

System.register("chunks:///_virtual/RewardPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CheckBoxComponent.ts","./GameManager.ts","./EmpowerCombatCardList.ts"],(function(e){var t,n,o,r,a,i,s,c,u,p,d,l;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,i=e._decorator,s=e.Node,c=e.Label,u=e.Component},function(e){p=e.CheckBoxComponent},function(e){d=e.GameManager},function(e){l=e.EmpowerCombatCardList}],execute:function(){var h,m,f,w,C;a._RF.push({},"010e05GqoZK7rWtWkZ5SoLn","RewardPanel",void 0);var L=i.ccclass,g=i.property;e("RewardPanel",(h=L("RewardPanel"),m=g(s),h((C=t((w=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return t=e.call.apply(e,[this].concat(a))||this,o(t,"rewardLayout",C,r(t)),t._optionList=[],t}n(t,e);var a=t.prototype;return a.show=function(e){var t=this;void 0===e&&(e=!0),this.node.active=e,this._optionList=d.instance.characterCombatData.getRewardOptionList(),this.rewardLayout.getComponentsInChildren(c).forEach((function(e,n){if(!t._optionList[n])return e.string="",void(e.node.active=!1);e.node.active=!0,e.string=t._optionList[n].empowerName}))},a.onRewardClicked=function(){var e=this,t="",n="";this.rewardLayout.getComponentsInChildren(p).some((function(o,r){return!!o.isChecked&&(d.instance.characterCombatData.tryIncreaseEmpowerCardRank(e._optionList[r].regimentation,1),d.instance.database.empowerCardDatabase.find((function(o){return o.empowerId===e._optionList[r].empowerId&&(t=o.empowerId,n=o.regimentation,!0)})),!0)}))&&(l.instance.list(),this.show(!1),this.rewardLayout.getComponentsInChildren(p).forEach((function(e){return e.cancel()})),this.scheduleOnce((function(){l.instance.enableEmpowerCards(n,t)}),.5))},t}(u)).prototype,"rewardLayout",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=w))||f));a._RF.pop()}}}));

System.register("chunks:///_virtual/ShakeAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,e,o,r,a,s,u,l,c,h,p;return{setters:[function(t){i=t.applyDecoratedDescriptor,n=t.inheritsLoose,e=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,s=t.Node,u=t.tween,l=t.Tween,c=t.randomRange,h=t.v3,p=t.Component}],execute:function(){var g,d,f,y,k,m;r._RF.push({},"c60d2C3PxNPN4bC4RKZtYQc","ShakeAnimation",void 0);var b=a.ccclass,v=a.property;t("default",(g=v(s),b((y=i((f=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return i=t.call.apply(t,[this].concat(r))||this,e(i,"targetNode",y,o(i)),e(i,"shakeDuration",k,o(i)),e(i,"shakeIntensity",m,o(i)),i._originalPosition=void 0,i}n(i,t);var r=i.prototype;return r.start=function(){},r.startAnimation=function(){var t=this,i=this._originalPosition=this.targetNode.position.clone();u(this.targetNode).to(this.shakeDuration/2,{position:this.getRandomShakePosition()},{easing:"bounceInOut"}).to(this.shakeDuration/2,{position:i}).call((function(){t.startAnimation()})).start()},r.stopAnimation=function(){l.stopAllByTarget(this.targetNode),this._originalPosition&&this.targetNode.setPosition(this._originalPosition)},r.getRandomShakePosition=function(){var t=c(-1,1)*this.shakeIntensity,i=c(-1,1)*this.shakeIntensity;return h(this.targetNode.position.x+t,this.targetNode.position.y+i,0)},i}(p)).prototype,"targetNode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=i(f.prototype,"shakeDuration",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),m=i(f.prototype,"shakeIntensity",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),d=f))||d));r._RF.pop()}}}));

System.register("chunks:///_virtual/StunAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,i,r,o,a,l,u,c,s;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,l=t.Node,u=t.tween,c=t.Tween,s=t.Component}],execute:function(){var g,p,h,d,f,A,m;o._RF.push({},"20cceTBQ0dKcKTLx+gHgTvb","StunAnimation",void 0);var y=a.ccclass,b=a.property;t("StunAnimation",(g=y("StunAnimation"),p=b(l),g((f=n((d=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o))||this,i(n,"targetNode",f,r(n)),i(n,"duration",A,r(n)),i(n,"rotationAngle",m,r(n)),n._oriAngle=0,n}e(n,t);var o=n.prototype;return o.startAnimation=function(){var t=this;this._oriAngle=this.targetNode.angle,u(this.targetNode).to(this.duration,{angle:this.rotationAngle}).to(this.duration,{angle:-this.rotationAngle}).union().repeat(3).call((function(){t.stopAnimation()})).start()},o.stopAnimation=function(){c.stopAllByTarget(this.targetNode),this.targetNode.angle=this._oriAngle},n}(s)).prototype,"targetNode",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(d.prototype,"duration",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),m=n(d.prototype,"rotationAngle",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),h=d))||h));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});