System.register("chunks:///_virtual/bridge.ts",["cc","./index.esm.js","./index-77658911.js","./index.esm20172.js","./index.esm20174.js","./tslib.es6.mjs","./index.esm2017.js"],(function(e){var n,o,t,i,c,a,r,s,l,u,f,d;return{setters:[function(e){n=e.cclegacy},null,function(e){o=e.ab,t=e.o},function(e){i=e.initializeApp},null,null,function(e){c=e.getDatabase,a=e.onValue,r=e.ref,s=e.off,l=e.set,u=e.get,f=e.child,d=e.push}],execute:function(){n._RF.push({},"38cd6l6cFxNNLIWxKEB712S","bridge",void 0);var v,p="YellowCard",g={};e("default",function(){function e(){}var n=e.prototype;return n.signInWithGoogleEmail=function(e,n){var a=i({apiKey:"AIzaSyAc5PRwmE14gBH5az8TSoqs9aBrQ8YWa4o",authDomain:"fir-test-756e1.firebaseapp.com",databaseURL:"https://fir-test-756e1.firebaseio.com",projectId:"fir-test-756e1",storageBucket:"fir-test-756e1.appspot.com",messagingSenderId:"182531440628"});return o(t(),e,n).then((function(e){return v=c(a),e.user.uid})).catch((function(e){e.code;return e.message}))},n._onReceive=function(e,n){var o=n,t="",i=n.indexOf(" ");i>0&&(o=n.slice(0,i),t=n.slice(i+1)),console.log(e,":",g),g[e].forEach((function(n){return n.onReceive(e,o,t)}))},n.addDispatcher=function(e,n,o){if(""!==e){var t=!1,i=g[e]||[];i.length&&i.find((function(e){return(t=e.scope===n)&&Object.keys(o).forEach((function(n){return e.callbackMap[n]=o[n]})),t})),t||i.push(new h(n,o)),g[e]=i,console.log("add "+e+" - notifyKeymaps:",g)}else console.error("connectID 為空白字串:[",e,"]")},n.removeDispatcher=function(e,n){var o;null==(o=g[e])||o.find((function(o,t){if(o.scope===n)return g[e].splice(t,1),!0})),delete g[e],console.log("remove notifyKeymaps["+e+"]:",g)},n.addConnection=function(e,n,o){var t=this;void 0===o&&(o="");var i=p+"/C/"+e+"/"+n+"/"+o;a(r(v,i),(function(i){var c=i.val();console.log("[NOTIFY]",n,o,":",c),c&&function(n){t._onReceive(e,n)}(c)})),console.log("加入監聽:",i)},n.delConnection=function(e,n,o){void 0===o&&(o="");var t=p+"/C/"+e+"/"+n+"/"+o;s(r(v,t)),console.log("移除監聽:",t)},n.uploadInfo=function(e,n,o,t,i){void 0===i&&(i="");var c=o?n+" "+o:n;l(r(v,p+"/C/"+e+"/"+t+"/"+i),c)},n.loadAsync=function(e,n){var o=p+"/D/"+e+"/";return new Promise((function(t){u(n?f(r(v,o),n):r(v,o)).then((function(o){var i=o.val();t(i),console.log(e,n,"::::",i)}))}))},n.addDataLabel=function(e,n){void 0===n&&(n=-1);var o=p+"/D";return e?console.log(e+"刷新資料:"+JSON.stringify(n)):e=d(r(v,o)).key,l(r(v,o+"/"+e+"/"),n),e},n.delDataLabel=function(e){l(r(v,"YellowCard/D/"+e+"/"),null)},e}());function h(e,n){this.scope=e,this.callbackMap=n,this.onReceive=function(o,t,i){var c=n[t];c&&c.call(e,o,t,i)}}n._RF.pop()}}}));

System.register("chunks:///_virtual/debug-view-runtime-control.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,n,s,l,r,a,g,h,p,c,C,d,m,u,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,a=t.Canvas,g=t.UITransform,h=t.instantiate,p=t.Label,c=t.Color,C=t.RichText,d=t.Toggle,m=t.Button,u=t.director,L=t.Component}],execute:function(){var f,M,b,v,T,S,x,E,I;s._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var A=l.ccclass,y=l.property;t("DebugViewRuntimeControl",(f=A("internal.DebugViewRuntimeControl"),M=y(r),b=y(r),v=y(r),f((x=e((S=function(t){function e(){for(var e,o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"compositeModeToggle",x,n(e)),i(e,"singleModeToggle",E,n(e)),i(e,"EnableAllCompositeModeButton",I,n(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e.hideButtonLabel=void 0,e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[c.WHITE,c.BLACK,c.RED,c.GREEN,c.BLUE],e}o(e,t);var s=e.prototype;return s.start=function(){if(this.node.parent.getComponent(a)){var t=this.node.parent.getComponent(g),e=.5*t.width,o=.5*t.height,i=.1*e-e,n=o-.1*o,s=this.node.getChildByName("MiscMode"),l=h(s);l.parent=this.node,l.name="Buttons";var r=h(s);r.parent=this.node,r.name="Titles";for(var u=0;u<2;u++){var L=h(this.EnableAllCompositeModeButton.getChildByName("Label"));L.setPosition(i+(u>0?450:150),n,0),L.setScale(.75,.75,.75),L.parent=r;var f=L.getComponent(p);f.string=u?"----------Composite Mode----------":"----------Single Mode----------",f.color=c.WHITE,f.overflow=0,this.labelComponentList[this.labelComponentList.length]=f}n-=20;for(var M=0,b=0;b<this.strSingle.length;b++,M++){b===this.strSingle.length>>1&&(i+=200,M=0);var v=b?h(this.singleModeToggle):this.singleModeToggle;v.setPosition(i,n-20*M,0),v.setScale(.5,.5,.5),v.parent=this.singleModeToggle.parent;var T=v.getComponentInChildren(C);T.string=this.strSingle[b],this.textComponentList[this.textComponentList.length]=T,this.textContentList[this.textContentList.length]=T.string,v.on(d.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[b]=v}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,n,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(m.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=l;var S=this.EnableAllCompositeModeButton.getComponentInChildren(p);this.labelComponentList[this.labelComponentList.length]=S;var x=h(this.EnableAllCompositeModeButton);x.setPosition(i+90,n,0),x.setScale(.5,.5,.5),x.on(m.EventType.CLICK,this.changeTextColor,this),x.parent=l,(S=x.getComponentInChildren(p)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=S;var E=h(this.EnableAllCompositeModeButton);E.setPosition(i+200,n,0),E.setScale(.5,.5,.5),E.on(m.EventType.CLICK,this.hideUI,this),E.parent=this.node.parent,(S=E.getComponentInChildren(p)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=S,this.hideButtonLabel=S,n-=40;for(var I=0;I<this.strMisc.length;I++){var A=h(this.compositeModeToggle);A.setPosition(i,n-20*I,0),A.setScale(.5,.5,.5),A.parent=s;var y=A.getComponentInChildren(C);y.string=this.strMisc[I],this.textComponentList[this.textComponentList.length]=y,this.textContentList[this.textContentList.length]=y.string,A.getComponent(d).isChecked=!!I,A.on(d.EventType.TOGGLE,I?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[I]=A}n-=150;for(var D=0;D<this.strComposite.length;D++){var B=D?h(this.compositeModeToggle):this.compositeModeToggle;B.setPosition(i,n-20*D,0),B.setScale(.5,.5,.5),B.parent=this.compositeModeToggle.parent;var w=B.getComponentInChildren(C);w.string=this.strComposite[D],this.textComponentList[this.textComponentList.length]=w,this.textContentList[this.textContentList.length]=w.string,B.on(d.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[D]=B}}else console.error("debug-view-runtime-control should be child of Canvas")},s.isTextMatched=function(t,e){var o=new String(t),i=o.search(">");return-1===i?t===e:(o=(o=o.substr(i+1)).substr(0,o.search("<")))===e},s.toggleSingleMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strSingle.length;i++)this.isTextMatched(o.string,this.strSingle[i])&&(e.singleMode=i)},s.toggleCompositeMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strComposite.length;i++)this.isTextMatched(o.string,this.strComposite[i])&&e.enableCompositeMode(i,t.isChecked)},s.toggleLightingWithAlbedo=function(t){u.root.debugView.lightingWithAlbedo=t.isChecked},s.toggleCSMColoration=function(t){u.root.debugView.csmLayerColoration=t.isChecked},s.enableAllCompositeMode=function(t){var e=u.root.debugView;e.enableAllCompositeMode(!0);for(var o=0;o<this.compositeModeToggleList.length;o++){this.compositeModeToggleList[o].getComponent(d).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(d);i.isChecked=!1,e.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(d)).isChecked=!0,e.lightingWithAlbedo=!0},s.hideUI=function(t){var e=this.node.getChildByName("Titles"),o=!e.active;this.singleModeToggleList[0].parent.active=o,this.miscModeToggleList[0].parent.active=o,this.compositeModeToggleList[0].parent.active=o,this.EnableAllCompositeModeButton.parent.active=o,e.active=o,this.hideButtonLabel.string=o?"Hide UI":"Show UI"},s.changeTextColor=function(t){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(var o=0;o<this.labelComponentList.length;o++)this.labelComponentList[o].color=this.color[this._currentColorIndex]},s.onLoad=function(){},s.update=function(t){},e}(L)).prototype,"compositeModeToggle",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(S.prototype,"singleModeToggle",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(S.prototype,"EnableAllCompositeModeButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=S))||T));s._RF.pop()}}}));

System.register("chunks:///_virtual/DynamicWidthScrollView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,n,o,r,l,c,a,s,h,u,p;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.createForOfIteratorHelperLoose,o=i.initializerDefineProperty,r=i.assertThisInitialized},function(i){l=i.cclegacy,c=i._decorator,a=i.ScrollView,s=i.UITransform,h=i.Vec3,u=i.v3,p=i.Component}],execute:function(){var d,m,f,w,g,W,y,V;l._RF.push({},"97f47FpcPJIjKbS1g4ndve0","DynamicWidthScrollView",void 0);var v=c.ccclass,b=c.property;i("DynamicWidthScrollView",(d=v("DynamicWidthScrollView"),m=b(a),d((g=t((w=function(i){function t(){for(var t,e=arguments.length,n=new Array(e),l=0;l<e;l++)n[l]=arguments[l];return t=i.call.apply(i,[this].concat(n))||this,o(t,"scrollView",g,r(t)),o(t,"maxWidth",W,r(t)),o(t,"minWidth",y,r(t)),o(t,"spacingX",V,r(t)),t}e(t,i);var l=t.prototype;return l.start=function(){this.scrollView?this.scrollView.node.on("scrolling",this.onScrolling,this):console.warn("ScrollView component is not assigned.")},l.onScrolling=function(){for(var i,t=this.scrollView.content.children,e=this.scrollView.getComponent(s).convertToWorldSpaceAR(new h(0,0,0)),o=this.scrollView.content.getComponent(s),r=n(t);!(i=r()).done;){var l=i.value,c=o.convertToWorldSpaceAR(l.position),a=h.distance(c,e),p=this.calculateWidth(a);l.getComponent(s).width=p;var d=Math.min(1+p/this.maxWidth,1.3);l.scale=u(d,d,1)}},l.calculateWidth=function(i){var t=this.scrollView.node.getComponent(s).width/2,e=this.minWidth+(this.maxWidth-this.minWidth)*(1-i/t);return e=Math.max(this.minWidth,Math.min(this.maxWidth,e))},l.onDestroy=function(){this.scrollView&&this.scrollView.node.off("scrolling",this.onScrolling,this)},t}(p)).prototype,"scrollView",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(w.prototype,"maxWidth",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),y=t(w.prototype,"minWidth",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),V=t(w.prototype,"spacingX",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),f=w))||f));l._RF.pop()}}}));

System.register("chunks:///_virtual/FoldCards.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,o,n,r,i,l,c,s,a,d,u,h,C;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,l=e._decorator,c=e.Node,s=e.Button,a=e.Sprite,d=e.Color,u=e.instantiate,h=e.Label,C=e.Component}],execute:function(){var p,f,_,g,v,b,y;i._RF.push({},"a78ae3xgKlLYqn9+yGYTQTS","FoldCards",void 0);var m=l.ccclass,R=l.property;e("FoldCards",(p=m("FoldCards"),f=R(c),_=R(s),p((b=t((v=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return t=e.call.apply(e,[this].concat(i))||this,n(t,"cardRoot",b,r(t)),n(t,"sendButton",y,r(t)),t.eventSendCallback=null,t._secletedCards=[],t.selectMax=0,t._oriColor=void 0,t}o(t,e);var i=t.prototype;return i.show=function(e){this.node.active=e,this.sendButton.node.active=!1,this._secletedCards.length=0},i.list=function(e,t){var o=this,n=this.cardRoot.children;n.forEach((function(e){return e.active=!1}));var r=n[0].getComponent(a).color;this._oriColor=new d(r.r,r.g,r.b,r.a),e.forEach((function(e,r){var i=n[r];i||((i=u(n[0])).parent=o.cardRoot),i.active=!0,i.getComponentInChildren(h).string=e,i.off("click"),i.on("click",(function(){null==t||t(e),-1===o._secletedCards.indexOf(e)?(o._secletedCards.push(e),i.getComponent(a).color=d.RED):(o._secletedCards.splice(o._secletedCards.findIndex((function(t){return t===e})),1),i.getComponent(a).color=o._oriColor),console.log("this._secletedCards:",o._secletedCards),o.sendButton.node.active=o._secletedCards.length===o.selectMax}),o)}))},i.onSendButtonClicked=function(){var e,t=this;console.log("this._secletedCards:",this._secletedCards),this.cardRoot.children.forEach((function(e){return e.getComponent(a).color=t._oriColor})),null==(e=this.eventSendCallback)||e.call(this,this._secletedCards.slice()),this._secletedCards.length=0},t}(C)).prototype,"cardRoot",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(v.prototype,"sendButton",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=v))||g));i._RF.pop()}}}));

System.register("chunks:///_virtual/HandCards.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DynamicWidthScrollView.ts"],(function(e){var t,o,n,i,r,l,s,c,a,d,u,h,p,C;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,l=e._decorator,s=e.Node,c=e.Button,a=e.Color,d=e.Sprite,u=e.instantiate,h=e.Label,p=e.Component},function(e){C=e.DynamicWidthScrollView}],execute:function(){var f,_,b,g,v,m,w,y,P,x,S;r._RF.push({},"880f34hHldLa4t21nW2dLUl","HandCards",void 0);var I=l.ccclass,k=l.property;e("HandCards",(f=I("HandCards"),_=k(s),b=k(c),g=k(C),v=k(a),f((y=t((w=function(e){function t(){for(var t,o=arguments.length,r=new Array(o),l=0;l<o;l++)r[l]=arguments[l];return t=e.call.apply(e,[this].concat(r))||this,n(t,"cardRoot",y,i(t)),n(t,"sendButton",P,i(t)),n(t,"dwScrollView",x,i(t)),n(t,"selectedColor",S,i(t)),t.eventSendCallback=null,t.selectMax=0,t._secletedCards=[],t._buttonTemps=[],t._oriColor=void 0,t._oriPositionY=void 0,t}o(t,e);var r=t.prototype;return r.show=function(e){console.log(e?"顯示":"隱藏",this.node.name),this.node.active=e,this.sendButton.node.active=!1,this._secletedCards.length=0},r.list=function(e,t){var o,n=this,i=this.cardRoot.children,r=i[0].getComponentInChildren(d).color;this._oriColor=new a(r.r,r.g,r.b,r.a),this._oriPositionY=i[0].position.y,i.forEach((function(e){e.setPosition(e.position.x,n._oriPositionY),e.active=!1})),this._buttonTemps.length=0,e.forEach((function(e,o){var r=i[o];r||((r=u(i[0])).parent=n.cardRoot),r.active=!0;var l=r.getComponentInChildren(c);l&&(l.enabled=!1,r.getComponentInChildren(h).string=e,l.node.off("click"),l.node.on("click",(function(){-1===n._secletedCards.indexOf(e)?(n._secletedCards.push(e),r.setPosition(r.position.x,r.position.y+50),r.getComponentInChildren(d).color=n.selectedColor):(n._secletedCards.splice(n._secletedCards.findIndex((function(t){return t===e})),1),r.setPosition(r.position.x,n._oriPositionY),r.getComponentInChildren(d).color=n._oriColor),null==t||t(e,n._secletedCards),n.sendButton.node.active=n._secletedCards.length===n.selectMax}),n),n._buttonTemps.push(l))})),null==(o=this.dwScrollView)||o.scrollView.scrollToPercentHorizontal(.5,.1,!0)},r.lock=function(e){this._buttonTemps.forEach((function(t){return t.enabled=!e}))},r.onSendButtonClicked=function(){var e,t=this;this.selectMax===this._secletedCards.length&&(this.cardRoot.children.forEach((function(e){e.getComponentInChildren(d).color=t._oriColor,e.setPosition(e.position.x,t._oriPositionY)})),null==(e=this.eventSendCallback)||e.call(this,this._secletedCards.slice()),this._secletedCards.length=0)},t}(p)).prototype,"cardRoot",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(w.prototype,"sendButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(w.prototype,"dwScrollView",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(w.prototype,"selectedColor",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=w))||m));r._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./debug-view-runtime-control.ts","./MainScene.ts","./FoldCards.ts","./HandCards.ts","./YellowCardHandler.ts","./YellowCardHandler2.ts","./YellowCardPanel.ts","./YellowCardRecord.ts","./test.ts","./SocketBridge.ts","./bridge.ts","./RoomHandler.ts","./DynamicWidthScrollView.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RoomHandler.ts","./YellowCardPanel.ts","./SocketBridge.ts"],(function(e){var t,o,n,a,i,r,c,l,s,m,u,d,h,v,R;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){i=e.cclegacy,r=e._decorator,c=e.Node,l=e.Button,s=e.EditBox,m=e.instantiate,u=e.Label,d=e.Component},function(e){h=e.RoomHandler},function(e){v=e.YellowCardPanel},function(e){R=e.SocketBridge}],execute:function(){var f,p,B,b,y,g,G,_,H,w,C,E,S,L,k,x,P,M,z,U,N;i._RF.push({},"dc7a4oGyFRBH7m1+WQMgD4/","MainScene",void 0);var j=r.ccclass,I=r.property;e("MainScene",(f=j("MainScene"),p=I(c),B=I(c),b=I(l),y=I(l),g=I(l),G=I(l),_=I(l),H=I(s),w=I(v),f((S=t((E=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return t=e.call.apply(e,[this].concat(i))||this,n(t,"roomRoot",S,a(t)),n(t,"tableRoot",L,a(t)),n(t,"refreshRoomButton",k,a(t)),n(t,"newRoomButton",x,a(t)),n(t,"leaveRoomButton",P,a(t)),n(t,"readyGameButton",M,a(t)),n(t,"startGameButton",z,a(t)),n(t,"nameEditBox",U,a(t)),n(t,"gamePanel",N,a(t)),t._roomHandler=null,t._indexGameReady=0,t._playerLocalCacheName="",t}o(t,e);var i=t.prototype;return i.start=function(){var e=this,t=new URLSearchParams(location.search),o=t.get("user")||"0";this._playerLocalCacheName="YC_PLAYER_TEMP_"+o;var n,a=t.get("room").split("-"),i=localStorage.getItem(this._playerLocalCacheName);if(i){var r=JSON.parse(i);n=r.nickname}else{var c="黃色使者-"+Math.round(1e3*Math.random());n=c}this.tableRoot.active=!1,this.readyGameButton.node.active=!1,this.startGameButton.node.active=!1,this.leaveRoomButton.node.active=!1,R.Instance.connect(a).then((function(){e.nameEditBox.string=n,e._roomHandler=new h(o,n),e._roomHandler.eventUpdateTableList=e.onUpdateTableList.bind(e),e._roomHandler.eventUpdateRoomList=e.onUpdateRoomList.bind(e),e._roomHandler.eventGameReady=e.onGameReady.bind(e),e._roomHandler.eventGameStart=e.onGameStart.bind(e),e._roomHandler.eventGameReconnect=e.onGameReconnect.bind(e),e._roomHandler.tryReconnect()||e.onUpdateRoomList()}))},i.onRenameEndEdit=function(){var e=this.nameEditBox.string;this._roomHandler.nickname=e,localStorage.setItem(this._playerLocalCacheName,JSON.stringify({nickname:e}))},i.onNewRoomClicked=function(){this._roomHandler.newRoom("YC-"+Math.round(1e5*Math.random())),this.roomRoot.active=!1,this.refreshRoomButton.node.active=!1,this.newRoomButton.node.active=!1,this.tableRoot.active=!0,this.readyGameButton.node.active=!1,this.startGameButton.node.active=!0,this.leaveRoomButton.node.active=!0},i.onJoinRoom=function(e,t,o){this.roomRoot.active=!1,this.refreshRoomButton.node.active=!1,this.newRoomButton.node.active=!1,this.nameEditBox.node.active=!1,this.tableRoot.active=!0,this.readyGameButton.node.active=!0,this.startGameButton.node.active=!1,this.leaveRoomButton.node.active=!0,console.log("join!!!!",e,t,o),this._roomHandler.joinRoom(e,t,o)},i.onUpdateTableList=function(e){var t=this;console.log("更新桌子:",e),this.nameEditBox.node.active=!1;var o=this.tableRoot.children;o.forEach((function(e){return e.active=!1})),Object.keys(e).forEach((function(n,a){var i=e[n],r=o[a];r||((r=m(o[0])).parent=t.tableRoot),r.active=!0,r.getComponentInChildren(u).string=i}))},i.onExitRoomClicked=function(){this._roomHandler.leaveRoom(),this.onUpdateRoomList()},i.onUpdateRoomList=function(){var e=this,t=this.roomRoot.children;t.forEach((function(e){return e.active=!1})),this.roomRoot.active=!0,this.refreshRoomButton.node.active=!0,this.newRoomButton.node.active=!0,this.tableRoot.active=!1,this.readyGameButton.node.active=!1,this.startGameButton.node.active=!1,this.leaveRoomButton.node.active=!1,this.nameEditBox.node.active=!0,this._indexGameReady=0,this.gamePanel.close(),this._roomHandler.loadRoomsAsync().then((function(o){o&&Object.keys(o).forEach((function(n,a){var i=o[n],r=t[a];r||((r=m(t[0])).parent=e.roomRoot),r.active=!0,r.getComponentInChildren(u).string=n,r.getComponent(l).node.off("click"),r.getComponent(l).node.once("click",(function(){return e.onJoinRoom(n,i)}),e)}))}))},i.onGameReady=function(e,t){console.log("onGameReady:",e,t);var o=this.tableRoot.children;Object.keys(t).forEach((function(n,a){var i=t[n],r=e[n];o[a].getComponentInChildren(u).string=i+" "+["","[READY]","[HONST]"][r]}))},i.onGameStart=function(e,t,o){var n=this;console.log("開始遊戲",this._roomHandler.isHonster),this.roomRoot.active=!1,this.refreshRoomButton.node.active=!1,this.newRoomButton.node.active=!1,this.tableRoot.active=!1,this.readyGameButton.node.active=!1,this.startGameButton.node.active=!1;this._roomHandler.isHonster?this.gamePanel.init(e,t,o,false,this._roomHandler.players):(this.gamePanel.init(e,t,o,false),this.leaveRoomButton.node.active=!1),this.gamePanel.eventMainSceneGameEnd=function(){n.leaveRoomButton.node.active=!0}},i.onGameReconnect=function(e,t,o,n){var a=this;console.log("遊戲重連!!");var i=n&&Object.keys(n).length>0;i?this.gamePanel.init(e,t,o,true,this._roomHandler.players):this.gamePanel.init(e,t,o,true),this.roomRoot.active=!1,this.refreshRoomButton.node.active=!1,this.newRoomButton.node.active=!1,this.nameEditBox.node.active=!1,this.leaveRoomButton.node.active=i,this.gamePanel.eventMainSceneGameEnd=function(){a.leaveRoomButton.node.active=!0}},i.onRefreshRoomClicked=function(){this.onUpdateRoomList()},i.onGameReadyClicked=function(){this._indexGameReady=(this._indexGameReady+1)%2,this._roomHandler.gameReady(this._indexGameReady)},i.onGameStartClicked=function(){this._roomHandler.tryGameStart()},t}(d)).prototype,"roomRoot",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(E.prototype,"tableRoot",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(E.prototype,"refreshRoomButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(E.prototype,"newRoomButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(E.prototype,"leaveRoomButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(E.prototype,"readyGameButton",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(E.prototype,"startGameButton",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(E.prototype,"nameEditBox",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(E.prototype,"gamePanel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=E))||C));i._RF.pop()}}}));

System.register("chunks:///_virtual/RoomHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketBridge.ts"],(function(o){var e,t,s;return{setters:[function(o){e=o.createClass},function(o){t=o.cclegacy},function(o){s=o.SocketBridge}],execute:function(){t._RF.push({},"bdac1KaEi9OoL28aGCdUil/","RoomHandler",void 0);o("RoomHandler",function(){function o(o,e){this.bridge=void 0,this._roomLocalCacheName="",this._needReconnect=!1,this.isHonster=!1,this.players={},this._readyPlayers={},this._roomList=[],this._roomID="",this._roomKey="",this._roomLockKey="",this._joinRoomInterval=void 0,this._isRoomJoining=!1,this._playerID="",this._nickname="",this.eventUpdateTableList=null,this.eventUpdateRoomList=null,this.eventGameReady=null,this.eventGameStart=null,this.eventGameReconnect=null,this._roomLocalCacheName="YC_ROOM_TEMP_"+o,this._playerID=this.generateRandomString(),console.log("自己的playerID:",this._playerID),this._nickname=e}var t=o.prototype;return t._applicate=function(o,e){void 0===e&&(e=""),this.isHonster?this["notify_"+o](this._roomID,o,e):s.Instance.applicate(o,e)},t._broadcast=function(o,e,t){if(void 0===e&&(e=""),this.isHonster){if(console.log(o,e,"clientID?:",t),t===this._playerID)return console.log("不會發給自己");s.Instance.broadcast(o,e,t)}},t.load=function(){s.Instance.loadAsync("Answer").then((function(o){return console.log(o),localStorage.setItem("Answers",o),s.Instance.loadAsync("Question")})).then((function(o){console.log(o),localStorage.setItem("Questions",o)}))},t.generateRandomString=function(o){void 0===o&&(o=10);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",s=0;s<o;s++){t+=e[Math.floor(Math.random()*e.length)]}return t},t.loadRoomsAsync=function(){var o=this;return s.Instance.loadAsync("ROOMS").then((function(e){return o._roomList=e}))},t.newRoom=function(o,e){void 0===e&&(e="0");var t=this.generateRandomString();this._roomID=o,this._roomKey=t,s.Instance.addDataLabel("ROOMS/"+o,t),this._roomLockKey=e,this.isHonster=!0,this.joinRoom(this._roomID,this._roomKey,this._roomLockKey)},t.joinRoom=function(o,e,t){var i=this;void 0===t&&(t="0"),console.log("joinRoom roomID:",o),s.Instance.addDispatcher(o,this,{join_room:this.notify_join_room,take_seat:this.notify_take_seat,leave_room:this.notify_leave_room,kicked_out:this.notify_kicked_out,game_ready:this.notify_game_ready,game_start:this.notify_game_start}),this.isHonster?s.Instance.addHonsterConnection(o):(s.Instance.addClientConnection(o,this._playerID),this._isRoomJoining=!0,this._joinRoomInterval&&clearTimeout(this._joinRoomInterval),this._joinRoomInterval=setTimeout((function(){var e;i._isRoomJoining&&(console.log("沒有對應的 Honster 回應"),s.Instance.clientDisconnect(i._playerID),console.log("只能把自己的 Broadcast 欄位移除"),s.Instance.delDataLabel("ROOMS/"+o),console.log("代替斷線的 Honster 把"+o+"從房間清單移除"),s.Instance.removeDispatcher(i._roomID,i),i._clearRoomInfo(),null==(e=i.eventUpdateRoomList)||e.call(i))}),1e3)),this._roomKey=e,this._roomLockKey=t,this._applicate("join_room",this._playerID+" "+e+" "+t),console.log("Player [",this._playerID,"] send joinRoom: id/roomkey:[",e,"] & roomLockKey:[",t,"]")},t.tryReconnect=function(){console.log("this._roomLocalCacheName:",this._roomLocalCacheName);var o=localStorage.getItem(this._roomLocalCacheName);if(console.log("reconnect roomTemp:",o),o){this._needReconnect=!0;var e=JSON.parse(o);return console.log("斷線重連:",e),this.isHonster=e.isHonster,e.playerID&&(console.log("重連後修改自己的playerID:",this._playerID,"->",e.playerID),this._playerID=e.playerID),this._roomID=e.roomID,this._roomKey=e.roomKey,this._roomLockKey=e.roomLockKey,this.players=e.players,this.joinRoom(this._roomID,this._roomKey),!0}return!1},t.leaveRoom=function(){var o;console.log("leave room this._isHonster:",this.isHonster),this.isHonster?(console.log("發出 kicked_out!!! 然後斷線"),this._broadcast("kicked_out"),s.Instance.honsterDisconnect(),s.Instance.delBroadcastList(),s.Instance.delDataLabel("ROOMS/"+this._roomID)):(s.Instance.applicate("leave_room",this._playerID),s.Instance.clientDisconnect(this._playerID)),s.Instance.removeDispatcher(this._roomID,this),null==(o=this.eventUpdateRoomList)||o.call(this),this._clearRoomInfo()},t._clearRoomInfo=function(){localStorage.removeItem(this._roomLocalCacheName),this._roomID="",this._roomKey="",this._roomLockKey="0",this.isHonster=!1,this.players={},this._readyPlayers={}},t.notify_join_room=function(o,e,t){var i;if(this.isHonster){var n=t.split(" ");i=n[0];var a=n[1],r=n[2];if(console.log("this._roomKey:",this._roomKey,"---room key:",a),this._roomKey!=a){var l="不符合的 room key";console.log(l),t=i+" 0 "+l,this._broadcast(e,t,i)}else if(this._roomLockKey!=r){var c="輸入錯誤的密碼: "+r;console.log(c),t=i+" 0 "+c,this._broadcast(e,t,i)}else this._playerID!=i&&s.Instance.addToBroadcastList(i),t=i+" 1",this._broadcast(e,t,i)}var h=t.split(" ");if((i=h[0])==this._playerID){var _,m="1"===h[1];if(this._needReconnect)m?(this.isHonster?s.Instance.honsterDisconnect():s.Instance.clientDisconnect(i),null==(_=this.eventGameReconnect)||_.call(this,o,i,this._nickname,this.players),this._joinRoomInterval&&clearTimeout(this._joinRoomInterval),console.log("重連成功")):console.log("重連失敗: 已失去房間連結"),this._needReconnect=!1;else if(m)this._roomID=o,this._isRoomJoining=!1,console.log(this._nickname,"成功加入房間!!"),this._applicate("take_seat",i+" "+this._nickname);else{var y=h[2];console.log(e,"error:",y),this.leaveRoom()}}else console.log("playerID 不同",i,this._playerID)},t.notify_take_seat=function(o,e,t){var s,i,n;if(this.isHonster){var a=t.split(" ");i=a[0],n=a[1],console.log(n,i,"進行入桌"),this.players[i]=n,t=i+" "+JSON.stringify(this.players),this._broadcast(e,t)}var r=t.split(" ");i=r[0];var l=JSON.parse(r[1]);null==(s=this.eventUpdateTableList)||s.call(this,l),this._playerID===i&&this.gameReady(0)},t.notify_leave_room=function(o,e,t){var i,n,a=t;this.isHonster&&(n=this.players[a],delete this.players[a],delete this._readyPlayers[a],s.Instance.delBroadcastList(a),s.Instance.clientDisconnect(a),console.log("離開房間斷線:",a),t=JSON.stringify(this.players)+" "+n,this._broadcast(e,t));var r=t.split(" "),l=JSON.parse(r[0]),c=r[1];console.log("players:",l),null==(i=this.eventUpdateTableList)||i.call(this,l),console.log(c,"離開房間了")},t.notify_kicked_out=function(o,e,t){var i;this.isHonster||(s.Instance.clientDisconnect(this._playerID),console.log("移掉自己的client 連線:",this._playerID),s.Instance.removeDispatcher(o,this),null==(i=this.eventUpdateRoomList)||i.call(this),this._clearRoomInfo());console.log("有收到 kicked out哦!!")},t.notify_game_ready=function(o,e,t){var s,i;if(console.log("收到 notify_game_ready"),this.isHonster){var n=t.split(" ");i=n[0];var a=n[1];this._readyPlayers[i]=a,console.log("ready player:",this._readyPlayers),t=JSON.stringify(this._readyPlayers)+" "+JSON.stringify(this.players),this._broadcast(e,t)}var r=t.split(" "),l=JSON.parse(r[0]),c=JSON.parse(r[1]);null==(s=this.eventGameReady)||s.call(this,l,c)},t.notify_game_start=function(o,e,t){console.log("收到 notify_game_start",this.isHonster),this.isHonster?(this._broadcast(e),s.Instance.honsterDisconnect(),s.Instance.delDataLabel("ROOMS/"+this._roomID)):s.Instance.clientDisconnect(this._playerID),this.eventGameStart(o,this._playerID,this._nickname);var i={roomID:this._roomID,roomKey:this._roomKey,roomLockKey:this._roomLockKey,playerID:this._playerID,isHonster:this.isHonster,players:this.players};localStorage.setItem(this._roomLocalCacheName,JSON.stringify(i)),console.log("\n\n存檔",i,"\n\n")},t.gameReady=function(o){this.isHonster&&(o="2"),this._applicate("game_ready",this._playerID+" "+o)},t.tryGameStart=function(){var o=this,e=Object.keys(this._readyPlayers),t=e.length&&e.every((function(e){return parseInt(o._readyPlayers[e],10)>0}));console.log("準備清單:",this._readyPlayers),t?this._applicate("game_start"):console.log("尚有人未準備好")},e(o,[{key:"nickname",set:function(o){this._nickname=o}}]),o}());t._RF.pop()}}}));

System.register("chunks:///_virtual/SocketBridge.ts",["./rollupPluginModLoBabelHelpers.js","cc","./bridge.ts"],(function(t){var n,i,o;return{setters:[function(t){n=t.createClass},function(t){i=t.cclegacy},function(t){o=t.default}],execute:function(){i._RF.push({},"2d4a25YPn1Bho37tEGXpZjX","SocketBridge",void 0),t("SocketBridge",function(){function t(){this._bridge=new o,this._connectID="",this._broadcastList=[]}var i=t.prototype;return i.connect=function(t){return this._bridge.signInWithGoogleEmail("xxfox"+t[0]+"@gmail.com",t[1])},i.addDispatcher=function(t,n,i){this._bridge.addDispatcher(t,n,i)},i.removeDispatcher=function(t,n){this._bridge.removeDispatcher(t,n)},i.loadAsync=function(t,n){return this._bridge.loadAsync(t,n)},i.addHonsterConnection=function(t){this._connectID=t,this._bridge.addConnection(t,"Applicate")},i.addClientConnection=function(t,n){this._connectID=t,this._bridge.addConnection(t,"Broadcast",n)},i.honsterDisconnect=function(){this._bridge.delConnection(this._connectID,"Applicate"),this._bridge.uploadInfo(this._connectID,null,null,"Applicate"),this._connectID=""},i.clientDisconnect=function(t){var n=this;t?(this._bridge.delConnection(this._connectID,"Broadcast",t),this._bridge.uploadInfo(this._connectID,null,null,"Broadcast",t)):this._broadcastList.forEach((function(t){n._bridge.delConnection(n._connectID,"Broadcast",t),n._bridge.uploadInfo(n._connectID,null,null,"Broadcast",t)})),this.delBroadcastList(t)},i.addToBroadcastList=function(t){this._broadcastList.push(t),console.log("新增",t,this._broadcastList)},i.delBroadcastList=function(t){t?this._broadcastList.indexOf(this._broadcastList)>-1&&(this._broadcastList.splice(this._broadcastList.findIndex((function(n){return n===t})),1),console.log("刪除",t,this._broadcastList)):(console.log("刪除",this._broadcastList,this._broadcastList),this._broadcastList.length=0)},i.applicate=function(t,n){this._bridge.uploadInfo(this._connectID,t,n,"Applicate")},i.broadcast=function(t,n,i){var o=this;if(!this._connectID)return console.log("Honster 已斷線");i?(console.log(t,"廣播對象:",i),this._bridge.uploadInfo(this._connectID,t,n,"Broadcast",i)):(console.log(t,"廣播對象:",this._broadcastList),this._broadcastList.forEach((function(i){return o._bridge.uploadInfo(o._connectID,t,n,"Broadcast",i)})))},i.addDataLabel=function(t,n){this._bridge.addDataLabel(t,n)},i.delDataLabel=function(t){this._bridge.delDataLabel(t)},n(t,null,[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),t}())._instance=void 0,i._RF.pop()}}}));

System.register("chunks:///_virtual/test.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"1132caDfNVPAIjfLTH87NX7","test",void 0);t("test",function(){function t(){}var e=t.prototype;return e.requestHandle=function(){},e.responseHandle=function(){},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/YellowCardHandler.ts",["cc","./SocketBridge.ts","./YellowCardRecord.ts"],(function(t){var e,s,n,o,a;return{setters:[function(t){e=t.cclegacy},function(t){s=t.SocketBridge},function(t){n=t.YellowCardRecord,o=t.GameStatus,a=t.Role}],execute:function(){e._RF.push({},"de129SoJGFNgrAtVVueT/S0","YellowCardHandler",void 0);t("YellowCardHandler",function(){function t(t,e){this._isHonster=!1,this._roomID="",this._honstCardMax={q:2,a:13},this._honstRoundPlayers=[],this._honstRoundIndex=0,this._honstQuestionAnswers={},this._honstWorstList=[],this._masterID="",this._playerID="",this._myNickname="",this._honstGameRecord=null,this.eventUpdateQuestionCards=null,this.eventUpdateAnswerCards=null,this.eventShowQuestion=null,this.eventLockQuestionSelection=null,this.eventLockAnswerSelection=null,this.eventShowQuestionAnswer=null,this.eventShowAllQuestionAnswer=null,this.eventChooseQuestionAnswer=null,this.eventVoted=null,this.eventAnswerCardFold=null,this.eventShowBestAnswer=null,this.eventShowTip=null,this.eventClearPrevRound=null,this.eventRecordLose=null,this.eventGameEnd=null,this._playerID=t,this._myNickname=e}var e=t.prototype;return e.applicate=function(t,e){void 0===e&&(e=""),console.log("===== applicate:",t,e),this._isHonster?(console.log(t,"Applicate 事件不透過連線發給自己:",e),this["notify_"+t](this._roomID,t,e)):s.Instance.applicate(t,e)},e._broadcast=function(t,e,n){if(void 0===e&&(e=""),console.log("===== broadcast:",t,e),this._isHonster){if(n===this._playerID)return console.log(t,"Broadcast 事件不透過連線發給自己:",e);s.Instance.broadcast(t,e,n)}},e.startGame=function(t,e,a){var i=this;this._roomID=t,a&&(this._isHonster=!0,this._honstGameRecord=new n,this._honstRoundPlayers=Object.keys(a),e?this._honstGameRecord.readData():this._honstRoundPlayers.forEach((function(t){i._honstGameRecord.add(t,a[t],o.GAMING)}))),s.Instance.addDispatcher(t,this,{update_game_step:this.notify_update_game_step,game_round:this.notify_game_round,draw_question_cards:this.notify_draw_question_cards,draw_answer_cards:this.notify_draw_answer_cards,licensing:this.notify_licensing,fold_answer_card:this.notify_fold_answer_card,question:this.notify_question,answer:this.notify_answer,question_answers_result:this.notify_question_answers_result,choose_best_answer:this.notify_choose_best_answer,vote:this.notify_vote,vote_result:this.notify_vote_result,alert:this.notify_alert,next_round:this.notify_next_round,game_over:this.notify_game_over,reconnect:this.notify_reconnect}),this._isHonster?(s.Instance.addHonsterConnection(t),console.log("HONSTER 連線!!"),e?this.applicate("reconnect",this._playerID):this.updateQuestionAsync().then((function(){return console.log("已下載問題卡牌庫")})).then((function(){return i.updateAnswerAsync()})).then((function(){return console.log("已下載答案卡牌庫")})).then((function(){return i.applicate("game_round")}))):(console.log("CLIENT 連線!!"),s.Instance.addClientConnection(t,this._playerID),e&&this.applicate("reconnect",this._playerID))},e.endGame=function(t){s.Instance.removeDispatcher(t,this),this._isHonster&&(this._honstGameRecord.clear(),this._honstGameRecord=null,this._honstRoundPlayers.length=0,this._honstRoundIndex=0),this._masterID="",this._playerID="",this._myNickname=""},e.updateQuestionAsync=function(){var t=this,e=Math.round(3*Math.random());return s.Instance.loadAsync("Question",e.toString()).then((function(e){return t._honstGameRecord.questions=e.sort((function(){return Math.random()-.5}))}))},e.updateAnswerAsync=function(){var t=this,e=Math.round(1e3*Math.random()%2);return s.Instance.loadAsync("Answer",e.toString()).then((function(e){return t._honstGameRecord.answers=e.sort((function(){return Math.random()-.5}))}))},e.tryAllAnswered=function(){var t=this,e=this._honstRoundPlayers.every((function(e){return t._masterID===e||t._honstGameRecord.get(e).gameStatus===o.ANSWERED}));return e&&(console.log("全部都答題了，開始投票"),this._honstRoundPlayers.forEach((function(e){t._masterID!==e&&(t._honstGameRecord.get(e).gameStatus=o.VOTING)}))),this._honstGameRecord.writeData(),e},e.notify_update_game_step=function(t,e,s){var n,a;if(this._isHonster){switch(n=s.split(" ")[0],a=this._honstGameRecord.get(n),this._masterID=this._honstGameRecord.masterID,a.gameStatus){case o.REVIEW:if(this.tryAllAnswered())return void this.applicate("question_answers_result")}if(s=this._masterID+" "+n+" "+JSON.stringify(a),this._broadcast(e,s,n),this._playerID!=n)return}var i=s.split(" ");this._masterID=i[0],n=i[1],a=JSON.parse(i[2]),console.log(e,"GAME STATUS:",a.gameStatus);var r=a,h=r.gameStatus,c=r.nickname;switch(h){case o.ASKING:console.log("我是"+c+", 正在擔任裁判並發問",a),this.eventUpdateQuestionCards(a.questionHandCards),this.eventLockQuestionSelection(!1),this.eventShowTip("選擇題目並送出");break;case o.ASKED:console.log("UI 禁止選擇問題卡"),this.eventLockQuestionSelection(!0),this.eventShowTip("等待答案中...");break;case o.ANSWER:console.log("我是"+c+", 是一般玩家",a),this.eventUpdateAnswerCards(a.answerHandCards),this.eventShowTip("等待裁判出題");break;case o.ANSWERING:console.log("UI 進行選擇答案卡"),this.eventLockAnswerSelection(!1),this.eventShowTip("填空並送出");break;case o.FOLD:var l=a.answerCards.length-1,_=a.answerHandCards;this.eventAnswerCardFold(_,l),this.eventShowTip("請棄掉牌"+l+"張牌[FOLD]");break;case o.ANSWERED:this.eventShowTip("等待其他人…")}},e.notify_game_round=function(t,e,s){var n=this;if(this._isHonster){var i=this._honstRoundPlayers[this._honstRoundIndex];this._honstGameRecord.masterID=i;var r=this._honstGameRecord.get(i);r.role=a.MASTER,r.gameStatus=o.ASKING,console.log("裁判人選:",i,"master:",r),this.applicate("draw_question_cards",i),this._honstRoundPlayers.forEach((function(t){if(i!==t){var e=n._honstGameRecord.get(t);e.role=a.PLAYER,e.gameStatus=o.ANSWER,n.applicate("draw_answer_cards",t)}})),this._honstGameRecord.writeData(),s=""+i,this._broadcast(e,s)}var h=s.split(" ");this._masterID=h[0]},e.notify_draw_question_cards=function(t,e,s){var n=this;if(this._isHonster){var o=s.split(" ")[0],a=this._honstGameRecord.questions;console.log("問題卡目前張數:",a.length);var i=this._honstGameRecord.get(o).questionHandCards,r=this._honstCardMax.q-i.length,h=function(){console.log("抽",r,"張"),console.log("問題卡牌庫張數(應有"+n._honstCardMax.q+"):",a.length),console.log("獲得手牌:",i),a.splice(0,r).forEach((function(t){return i.push(t)})),n._honstGameRecord.writeData(),n.applicate("licensing",o)};r<this._honstCardMax.q?this.updateQuestionAsync().then((function(){return h()})):h()}},e.notify_draw_answer_cards=function(t,e,s){var n=this;if(this._isHonster){var o=s.split(" ")[0],a=this._honstGameRecord.answers;console.log("答案卡目前張數:",a.length);var i=this._honstGameRecord.get(o).answerHandCards,r=this._honstCardMax.a-i.length,h=function(){console.log("抽",r,"張"),console.log("答案卡牌庫張數(應有"+n._honstCardMax.a+"):",a.length),console.log("獲得手牌:",i),a.splice(0,r).forEach((function(t){return i.push(t)})),n._honstGameRecord.writeData(),n.applicate("licensing",o)};r<this._honstCardMax.a?this.updateAnswerAsync().then((function(){return h()})):h()}},e.notify_licensing=function(t,e,s){var n,o;if(this._isHonster&&(n=s.split(" ")[0],o=this._honstGameRecord.get(n),s=n+" "+JSON.stringify(o),this._broadcast(e,s,n),this._playerID!=n))return;var a=s.split(" ");if(n=a[0],this._playerID!=n)return console.error("playerID 不符合",n,"應該在honster 階段return");o=JSON.parse(a[1]),this.applicate("update_game_step",n+" "+Math.random())},e.notify_question=function(t,e,s){var n,i=this;if(this._isHonster){n=s,this._honstGameRecord.askingQuestion=s,console.log("裁判送出的問題卡:",n);var r=this._honstGameRecord.get(this._masterID);if(r.role!==a.MASTER)return this._broadcast("alert","自己不是裁判，不應該問問題",this._masterID),console.log(this._masterID,"不是裁判，不應該問問題");if(r.gameStatus!==o.ASKING)return this._broadcast("alert","自己還不是問問題的狀態",this._masterID),console.log(this._masterID,"還不是問問題的狀態:",r.gameStatus);r.gameStatus=o.ASKED,this._honstGameRecord.get(this._masterID).questionHandCards.length=0,this._honstRoundPlayers.forEach((function(t){if(t!==i._masterID){var e=i._honstGameRecord.get(t);e.gameStatus===o.ANSWER?(e.gameStatus=o.ANSWERING,console.log("玩家"+t+"改為"+o.ANSWERING+"狀態")):console.error("玩家應該是"+o.ANSWER+"狀態，但現在卻是"+e.gameStatus)}})),this._honstGameRecord.writeData(),s=""+n,this._broadcast(e,s)}n=s.split(" ")[0],this.eventShowQuestion(n),console.log("題目顯示後，請 Honster 指引下一步該做的事",this._playerID),this.applicate("update_game_step",this._playerID+" "+Math.random())},e.notify_answer=function(t,e,s){var n,i;if(this._isHonster){var r=s.split(" ");n=r[0],i=JSON.parse(r[1]),console.log("玩家送出的答案卡:",i);var h=this._honstGameRecord.get(n);if(h.role!==a.PLAYER)return this._broadcast("alert","自己不是玩家，不應該回答問題",n),console.log(n,"不是玩家，不應該回答問題");if(h.gameStatus!==o.ANSWERING)return this._broadcast("alert","自己還不是回答問題的狀態",n),console.log(n,"還不是回答問題的狀態:",h.gameStatus);h.gameStatus=i.length>1?o.FOLD:o.ANSWERED,this._honstQuestionAnswers[n]=i,h.answerCards=i,console.log("this._honstQuestionAnswers:",this._honstQuestionAnswers);var c=h.answerHandCards;console.log("手牌整理前:",c),i.forEach((function(t){var e=c.findIndex((function(e){return e===t}));e>-1?c.splice(e,1):console.log("玩家手牌無此張卡片:",t)})),console.log("手牌整理後:",c);var l=this._honstGameRecord.get(this._masterID);if(l.gameStatus===o.ASKED&&(l.gameStatus=o.REVIEW),this._honstGameRecord.writeData(),s=n+" "+JSON.stringify(i),this._broadcast(e,s,n),this._broadcast(e,s,this._masterID),this._playerID!=n&&this._masterID!=this._playerID)return}var _=s.split(" ");n=_[0],i=JSON.parse(_[1]),this._playerID===this._masterID&&this.eventShowQuestionAnswer(n,i),this.eventShowTip("已送出你的答案"),this.applicate("update_game_step",this._playerID)},e.notify_fold_answer_card=function(t,e,s){var n,a;if(this._isHonster){var i=s.split(" ");n=i[0],a=JSON.parse(i[1]),console.log("玩家",n,"進行棄牌:",a);var r=this._honstGameRecord.get(n),h=r.answerHandCards;a.forEach((function(t){h.splice(h.findIndex((function(e){return e===t})),1)})),console.log("棄完牌後:",h),r.gameStatus===o.FOLD?r.gameStatus=o.ANSWERED:console.error(r.gameStatus,"狀態不是",o.FOLD,"，但正在進行棄牌"),this._honstGameRecord.writeData(),this.applicate("update_game_step",n),this.applicate("update_game_step",this._masterID)}},e.notify_question_answers_result=function(t,e,s){this._isHonster&&(s=""+JSON.stringify(this._honstQuestionAnswers),this._broadcast(e,s));var n=s.split(" "),o=JSON.parse(n[0]),a=this._playerID===this._masterID;a||(console.log("全員的答題清單:",o),this.eventShowAllQuestionAnswer(o)),this.eventChooseQuestionAnswer(a)},e.notify_vote=function(t,e,s){var n;if(this._isHonster){var a=s.split(" ");n=a[0];var i=a[1];this._honstWorstList.push(i),this._honstGameRecord.get(i).voted++;var r=this._honstGameRecord.get(n);r.gameStatus===o.VOTING?(console.log("玩家"+r.nickname+"已完成投票，並修改標記"),r.gameStatus=o.VOTED):console.error("玩家"+r.nickname+"再次完成投票，標記為"+o.VOTED.toString()),console.log("糟糕清單:",this._honstWorstList);var h=1;if(this._honstWorstList.length===this._honstRoundPlayers.length-1&&(h=0,this.applicate("vote_result")),this._honstGameRecord.writeData(),s=n+" "+h,this._broadcast(e,s,n),this._playerID!=n)return}var c="1"===s.split(" ")[1];this.eventVoted(!c),c||this.eventShowTip("完成投票，請等候其他人投完票")},e.notify_vote_result=function(t,e,s){var n=this,o=[],a={};if(this._isHonster){var i={};this._honstWorstList.forEach((function(t){i[t]=i[t]||0,console.log(t,":",i[t]),i[t]++}));var r=Math.max.apply(Math,Object.keys(i).map((function(t){return i[t]})));console.log("voteResult:",i,r),Object.keys(i).forEach((function(t){i[t]===r&&(o.push(t),n._honstGameRecord.get(t).lose++)})),console.log("最糟的幾個人:",o),this._honstWorstList.length=0,this._honstRoundPlayers.forEach((function(t){var e=n._honstGameRecord.get(t);a[t]=e.lose})),this._honstGameRecord.writeData(),s=JSON.stringify(o)+" "+JSON.stringify(a),this._broadcast(e,s)}var h=s.split(" ");o=JSON.parse(h[0]),a=JSON.parse(h[1]),o.some((function(t){return n._playerID===t}))?(this.eventShowTip("恭喜，大家覺得你的問答組合是最爛的！"),this.eventRecordLose(a[this._playerID])):this._playerID!=this._masterID&&this.eventShowTip("很遺憾你的答案未獲選為最爛的問答組合…")},e.notify_choose_best_answer=function(t,e,s){var n,a,i=this,r=!0;if(this._isHonster){n=s.split(" ")[0],console.log("bestPlayerID:",n);var h=[];this._honstRoundPlayers.forEach((function(t){if(i._masterID!==t){var e=i._honstGameRecord.get(t);e.gameStatus===o.VOTING&&(h.push(t),r=!1),e.gameStatus===o.VOTED&&(e.gameStatus=o.GAMING)}})),r?(console.log("全員完成投票"),this._honstGameRecord.get(n).win++,a=this._honstQuestionAnswers[n],s="1 "+JSON.stringify(a)):(console.log("提醒未投票玩家進行投票"),s="0 "+JSON.stringify(h)),this._honstGameRecord.writeData(),this._broadcast(e,s)}var c=s.split(" ");(r="1"===c[0])?(a=JSON.parse(c[1]),this.eventShowBestAnswer(a,this._playerID===this._masterID),this.eventShowTip("裁判選出的最佳組合：")):JSON.parse(c[1]).some((function(t){return i._playerID===t}))?this.eventShowTip("快投票哦!!!大家都在等你!!!"):this._masterID===this._playerID&&this.eventShowTip("等待玩家完成最差組合投票")},e.notify_next_round=function(t,e,s){var n=this,o=!1;if(this._isHonster){if(this._honstRoundIndex=(this._honstRoundIndex+1)%this._honstRoundPlayers.length,this._honstQuestionAnswers={},this._honstGameRecord.clearAnswerCards(),this._honstGameRecord.clearWorstVote(),this._honstRoundPlayers.forEach((function(t){var e=n._honstGameRecord.get(t),s=-e.lose;s<=-5&&(o=!0),console.log(e.nickname,"score:",s)})),console.log("檢查，還沒結束就下一輪"),o)return void this.applicate("game_over");this._broadcast(e,s)}var a=this._playerID===this._masterID;this.eventClearPrevRound(),a&&this.applicate("game_round")},e.notify_game_over=function(t,e,s){var n=this,o=[];if(this._isHonster){console.log("遊戲結束,看一下誰最贏");var a=Math.max.apply(Math,this._honstRoundPlayers.map((function(t){return n._honstGameRecord.get(t).win})));this._honstRoundPlayers.forEach((function(t){a===n._honstGameRecord.get(t).win&&o.push(n._honstGameRecord.get(t).nickname)})),s=""+JSON.stringify(o),this._broadcast(e,s)}var i=s.split(" ");o=JSON.parse(i[0]),this.eventShowTip("遊戲結束，最終大贏家是"+o.join("、")),this.eventGameEnd(),this.eventRecordLose(0)},e.notify_alert=function(t,e,s){this.eventShowTip(s)},e.notify_reconnect=function(t,e,s){var n,a,i,r,h,c=this;if(this._isHonster){n=s.split(" ")[0],this._masterID=this._honstGameRecord.masterID,this._honstRoundPlayers.forEach((function(t){var e=c._honstGameRecord.get(t).answerCards;e.length&&(c._honstQuestionAnswers[t]=e);for(var s=0;s<c._honstGameRecord.get(t).voted;s++)c._honstWorstList.push(t)})),console.log("notify_reconnect 答題:",this._honstQuestionAnswers),console.log("notify_reconnect 最糟投票:",this._honstWorstList),i=this._honstQuestionAnswers;var l=this._honstGameRecord.get(n),_=l.gameStatus;switch(_){case o.GAMING:return void this.applicate("licensing",n);case o.ASKING:return void this.applicate("update_game_step",n);case o.ASKED:a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+a,this._broadcast(e,s,n);break;case o.REVIEW:this._masterID===n&&(a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+a+" "+JSON.stringify(i),this._broadcast(e,s,n));break;case o.ANSWER:return void this.applicate("update_game_step",n);case o.ANSWERING:r=l.answerHandCards,a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+JSON.stringify(r)+" "+a,this._broadcast(e,s,n);break;case o.FOLD:r=l.answerHandCards,h=l.answerCards,a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+JSON.stringify(r)+" "+JSON.stringify(h)+" "+a,this._broadcast(e,s,n);break;case o.ANSWERED:return void this.applicate("update_game_step",n);case o.VOTING:a=this._honstGameRecord.askingQuestion,s=_+" "+this._masterID+" "+a+" "+JSON.stringify(i),this._broadcast(e,s,n);break;case o.VOTED:s=_+" "+this._masterID+" "+JSON.stringify(i),this._broadcast(e,s,n)}if(console.log("gameStatusgameStatusgameStatusgameStatus:",_),this._playerID!=n)return}var u=s.split(" "),d=parseInt(u[0]);switch(this._masterID=u[1],console.log("notify_reconnect clientData:",u),d){case o.ASKED:console.log("GameStatus.ASKED"),a=u[2],console.log("UI 禁止選擇問題卡"),this.eventLockQuestionSelection(!0),this.eventShowQuestion(a),this.eventShowTip("等待答案中...");break;case o.ANSWERING:console.log("GameStatus.ANSWERING"),r=JSON.parse(u[2]),a=u[3],this.eventUpdateAnswerCards(r),this.eventShowQuestion(a),console.log("UI 進行選擇答案卡"),this.eventLockAnswerSelection(!1),this.eventShowTip("填空並送出");break;case o.FOLD:r=JSON.parse(u[2]),h=JSON.parse(u[3]),a=u[4],this.eventShowQuestion(a);var p=h.length-1;this.eventAnswerCardFold(r,p),this.eventShowTip("請棄掉牌"+p+"張牌[FOLD]");break;case o.ANSWERED:this.eventShowTip("等待其他人…");break;case o.REVIEW:console.log("GameStatus.REVIEW"),a=u[2],this.eventShowQuestion(a),i=JSON.parse(u[3]),this.eventShowAllQuestionAnswer(i);break;case o.VOTING:console.log("GameStatus.VOTING"),a=u[2],this.eventShowQuestion(a),i=JSON.parse(u[3]),this.eventShowAllQuestionAnswer(i);var g=this._playerID===this._masterID;this.eventChooseQuestionAnswer(g);break;case o.VOTED:console.log("GameStatus.VOTED"),i=JSON.parse(u[2]),this.eventShowAllQuestionAnswer(i);var m=this._playerID===this._masterID;this.eventChooseQuestionAnswer(m);break;default:console.log("未設定 reconnet 該做的事")}},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/YellowCardHandler2.ts",["cc","./SocketBridge.ts","./YellowCardRecord.ts"],(function(t){var s,e,n,o,i;return{setters:[function(t){s=t.cclegacy},function(t){e=t.SocketBridge},function(t){n=t.YellowCardRecord,o=t.GameStatus,i=t.Role}],execute:function(){s._RF.push({},"ee182bk8EJJFLv4kgoFED3r","YellowCardHandler2",void 0);t("YellowCardHandler",function(){function t(t,s){this._isHonster=!1,this._roomID="",this._honstCardMax={q:2,a:13},this._masterID="",this._honstRoundPlayers=[],this._honstRoundIndex=0,this._playerID="",this._myNickname="",this._questionAnswers={},this._honstWorstList=[],this._honstGameRecord=null,this.eventUpdateQuestionCards=null,this.eventUpdateAnswerCards=null,this.eventShowQuestion=null,this.eventLockQuestionSelection=null,this.eventLockAnswerSelection=null,this.eventShowQuestionAnswer=null,this.eventShowAllQuestionAnswer=null,this.eventChooseQuestionAnswer=null,this.eventVoted=null,this.eventAnswerCardFold=null,this.eventShowBestAnswer=null,this.eventShowTip=null,this.eventClearPrevRound=null,this.eventRecordLose=null,this.eventGameEnd=null,this._playerID=t,this._myNickname=s}var s=t.prototype;return s.applicate=function(t,s){void 0===s&&(s=""),this._isHonster?this["notify_"+t](this._roomID,t,s):e.Instance.applicate(t,s)},s._broadcast=function(t,s,n){if(void 0===s&&(s=""),this._isHonster){if(n===this._playerID)return console.log(t,"事件不透過連線發給自己:",s);e.Instance.broadcast(t,s,n)}},s.startGame=function(t,s){var i=this;this._roomID=t,s&&(this._isHonster=!0,this._honstGameRecord=new n,this._honstRoundPlayers=Object.keys(s),this._honstRoundPlayers.forEach((function(t){i._honstGameRecord.add(t,s[t],o.GAMING)}))),e.Instance.addDispatcher(t,this,{game_round:this.notify_game_round,draw_question_cards:this.notify_draw_question_cards,draw_answer_cards:this.notify_draw_answer_cards,licensing:this.notify_licensing,fold_answer_card:this.notify_fold_answer_card,question:this.notify_question,answer:this.notify_answer,question_answers_result:this.notify_question_answers_result,urge:this.notify_urge,choose_best_answer:this.notify_choose_best_answer,vote:this.notify_vote,vote_result:this.notify_vote_result,alert:this.notify_alert,next_round:this.notify_next_round,game_over:this.notify_game_over,reconnect:this.notify_reconnect}),this._isHonster?(e.Instance.addHonsterConnection(t),this.updateQuestionAsync().then((function(){return console.log("已下載問題卡牌庫")})).then((function(){return i.updateAnswerAsync()})).then((function(){return console.log("已下載答案卡牌庫")})).then((function(){return i.applicate("game_round")}))):e.Instance.addClientConnection(t,this._playerID)},s.endGame=function(t){e.Instance.removeDispatcher(t,this),this._questionAnswers={},this._honstGameRecord=null,this._masterID="",this._honstRoundPlayers.length=0,this._honstRoundIndex=0,this._playerID="",this._myNickname=""},s.updateQuestionAsync=function(){var t=this,s=Math.round(3*Math.random());return e.Instance.loadAsync("Question",s.toString()).then((function(s){return t._honstGameRecord.questions=s.sort((function(){return Math.random()-.5}))}))},s.updateAnswerAsync=function(){var t=this,s=Math.round(1e3*Math.random()%2);return e.Instance.loadAsync("Answer",s.toString()).then((function(s){return t._honstGameRecord.answers=s.sort((function(){return Math.random()-.5}))}))},s.notify_game_round=function(t,s,e){var n=this;if(this._isHonster){var r=this._honstRoundPlayers[this._honstRoundIndex],a=this._honstGameRecord.get(r);a.role=i.MASTER,a.gameStatus=o.ASKING,console.log("裁判人選:",r,"master:",a),this.applicate("draw_question_cards",r),this._honstRoundPlayers.forEach((function(t){if(r!==t){var s=n._honstGameRecord.get(t);s.role=i.PLAYER,s.gameStatus=o.ANSWERING,n.applicate("draw_answer_cards",t)}})),e=""+r,this._broadcast(s,e)}var h=e.split(" ");this._masterID=h[0]},s.notify_draw_question_cards=function(t,s,e){var n;if(this._isHonster){n=e.split(" ")[0];var o=this._honstGameRecord.questions;console.log("問題卡目前張數:",o.length);var i=this._honstGameRecord.get(n).questionHandCards,r=this._honstCardMax.q-i.length;o.splice(0,r).forEach((function(t){return i.push(t)})),console.log("抽",r,"張"),console.log("問題卡分發後張數:",o.length),console.log("獲得手牌:",i),o.length<this._honstCardMax.q*this._honstRoundPlayers.length&&(this.updateQuestionAsync(),console.log("卡片庫不足重刷!")),this.applicate("licensing",n)}},s.notify_draw_answer_cards=function(t,s,e){var n;if(this._isHonster){n=e.split(" ")[0];var o=this._honstGameRecord.answers;console.log("答案卡目前張數:",o.length);var i=this._honstGameRecord.get(n).answerHandCards,r=this._honstCardMax.a-i.length;o.splice(0,r).forEach((function(t){return i.push(t)})),console.log("抽",r,"張"),console.log("答案卡分發後張數:",o.length),console.log("獲得手牌:",i),o.length<this._honstCardMax.a*this._honstRoundPlayers.length&&(this.updateAnswerAsync(),console.log("卡片庫不足重刷!")),this.applicate("licensing",n)}},s.notify_licensing=function(t,s,e){var n,r;if(this._isHonster&&(n=e.split(" ")[0],r=this._honstGameRecord.get(n),console.log("player會卡, LOG 出來看看",r),e=n+" "+JSON.stringify(r),this._broadcast(s,e,n),this._playerID!=n))return;var a=e.split(" ");if(n=a[0],this._playerID!=n)return console.error("playerID 不符合",n,"應該在honster 階段return");r=JSON.parse(a[1]),console.log("刷新牌面:",r);var h=r,l=h.gameStatus,c=h.role,_=h.nickname,u=h.questionHandCards,d=h.answerHandCards;switch(l){case o.GAMING:break;case o.ASKING:c===i.MASTER&&(console.log("我是"+_+", 正在擔任裁判並發問",r),this.eventUpdateQuestionCards(u),this.eventLockQuestionSelection(!1),this.eventShowTip("選擇題目並送出"),console.log("UI 進行選擇問題卡"));break;case o.ASKED:c===i.MASTER&&console.log("等待答案");break;case o.ANSWERING:c===i.PLAYER&&(console.log("我是"+_+", 是一般玩家",r),this.eventUpdateAnswerCards(d),this.eventShowTip("等待裁判出題"));break;case o.FOLD:c===i.PLAYER&&(this.eventUpdateAnswerCards(d),this.eventShowTip("請棄牌"));break;case o.ANSWERED:c===i.PLAYER&&this.eventShowTip("等待其他人…");break;case o.VOTING:i.PLAYER;break;case o.VOTED:}},s.notify_question=function(t,s,e){var n;if(this._isHonster){n=e,console.log("裁判送出的問題卡:",n);var r=this._honstGameRecord.get(this._masterID);if(r.role!==i.MASTER)return this._broadcast("alert","自己不是裁判，不應該問問題",this._masterID),console.log(this._masterID,"不是裁判，不應該問問題");if(r.gameStatus!==o.ASKING)return this._broadcast("alert","自己還不是問問題的狀態",this._masterID),console.log(this._masterID,"還不是問問題的狀態:",r.gameStatus);r.gameStatus=o.ASKED,this._honstGameRecord.get(this._masterID).questionHandCards.length=0,e=""+n,this._broadcast(s,e)}n=e.split(" ")[0],this.eventShowQuestion(n),this._masterID===this._playerID?(console.log("UI 禁止選擇問題卡"),this.eventLockQuestionSelection(!0)):(console.log("UI 進行選擇答案卡"),this.eventLockAnswerSelection(!1),this.eventShowTip("填空並送出"))},s.notify_answer=function(t,s,e){var n,r,a;if(this._isHonster){var h=e.split(" ");n=h[0],r=JSON.parse(h[1]),console.log("玩家送出的答案卡:",r);var l=this._honstGameRecord.get(n);if(l.role!==i.PLAYER)return this._broadcast("alert","自己不是玩家，不應該回答問題",n),console.log(n,"不是玩家，不應該回答問題");if(l.gameStatus!==o.ANSWERING)return this._broadcast("alert","自己還不是回答問題的狀態",n),console.log(n,"還不是回答問題的狀態:",l.gameStatus);l.gameStatus=r.length>1?o.FOLD:o.ANSWERED,this._questionAnswers[n]=r;var c=l.answerHandCards;console.log("手牌整理前:",c),r.forEach((function(t){var s=c.findIndex((function(s){return s===t}));s>-1?c.splice(s,1):console.log("玩家手牌無此張卡片:",t)})),console.log("手牌整理後:",c),a=this.tryAllAnswered(),e=n+" "+JSON.stringify(r)+" "+(a?"1":"0")+" "+JSON.stringify(c)+" "+JSON.stringify(this._questionAnswers),this._broadcast(s,e,n),this._broadcast(s,e,this._masterID)}var _=e.split(" ");if(n=_[0],r=JSON.parse(_[1]),a="1"===_[2],this._playerID===this._masterID)this.eventShowQuestionAnswer(n,r),a&&this.applicate("question_answers_result");else if(this._playerID===n){var u=r.length-1;if(u>0){var d=JSON.parse(_[3]);this.eventAnswerCardFold(d,u)}var f=JSON.parse(_[4]);this.eventShowAllQuestionAnswer(f)}},s.tryAllAnswered=function(){var t=this,s=this._honstRoundPlayers.every((function(s){return t._masterID===s||t._honstGameRecord.get(s).gameStatus===o.ANSWERED}));return s&&(console.log("全部都答題了，開始投票"),this._honstRoundPlayers.forEach((function(s){t._masterID!==s&&(t._honstGameRecord.get(s).gameStatus=o.VOTING)}))),s},s.notify_fold_answer_card=function(t,s,e){var n,i;if(this._isHonster){var r=e.split(" ");n=r[0],i=JSON.parse(r[1]),console.log("玩家",n,"進行棄牌:",i);var a=this._honstGameRecord.get(n),h=a.answerHandCards;i.forEach((function(t){h.splice(h.findIndex((function(s){return s===t})),1)})),console.log("棄完牌後:",h),a.gameStatus===o.FOLD?a.gameStatus=o.ANSWERED:console.error(a.gameStatus,"狀態不是",o.FOLD,"，但正在進行棄牌"),this.tryAllAnswered()&&this.applicate("question_answers_result")}},s.notify_question_answers_result=function(t,s,e){this._isHonster&&(e=""+JSON.stringify(this._questionAnswers),this._broadcast(s,e));var n=e.split(" "),o=JSON.parse(n[0]),i=this._playerID===this._masterID;i||(console.log("全員的答題清單:",o),this.eventShowAllQuestionAnswer(o)),this.eventChooseQuestionAnswer(i)},s.notify_urge=function(t,s,e){var n=this;this._isHonster&&this._honstRoundPlayers.forEach((function(t){n._masterID!==t&&(n._honstGameRecord.get(t).gameStatus===o.ANSWERING&&n._broadcast(s,"HERRY!!",t))}));var i=e.split(" ")[0];this.eventShowTip(i)},s.notify_choose_best_answer=function(t,s,e){var n,i,r=this,a=!0;if(this._isHonster){n=e.split(" ")[0];var h=[];this._honstRoundPlayers.forEach((function(t){if(r._masterID!==t){var s=r._honstGameRecord.get(t);s.gameStatus===o.VOTING&&(h.push(t),a=!1),s.gameStatus===o.VOTED&&(s.gameStatus=o.GAMING)}})),a?(console.log("全員完成投票"),this._honstGameRecord.get(n).win++,i=this._questionAnswers[n],e="1 "+JSON.stringify(i)):(console.log("提醒未投票玩家進行投票"),e="0 "+JSON.stringify(h)),this._broadcast(s,e)}var l=e.split(" ");(a="1"===l[0])?(i=JSON.parse(l[1]),this.eventShowBestAnswer(i,this._playerID===this._masterID),this.eventShowTip("裁判選出的最佳組合：")):JSON.parse(l[1]).some((function(t){return r._playerID===t}))?this.eventShowTip("快投票哦!!!大家都在等你!!!"):this._masterID===this._playerID&&this.eventShowTip("等待玩家完成最差組合投票")},s.notify_vote=function(t,s,e){var n;if(this._isHonster){var i=e.split(" ");n=i[0];var r=i[1];this._honstWorstList.push(r);var a=this._honstGameRecord.get(n);a.gameStatus===o.VOTING?(console.log("玩家"+a.nickname+"已完成投票，並修改標記"),a.gameStatus=o.VOTED):console.error("玩家"+a.nickname+"再次完成投票，標記為"+o.VOTED.toString()),console.log("糟糕清單:",this._honstWorstList);var h=1;if(this._honstWorstList.length===this._honstRoundPlayers.length-1&&(h=0,this.applicate("vote_result")),e=n+" "+h,this._broadcast(s,e,n),this._playerID!=n)return}var l="1"===e.split(" ")[1];this.eventVoted(!l)},s.notify_vote_result=function(t,s,e){var n=this,o=[],i={};if(this._isHonster){var r={};this._honstWorstList.forEach((function(t){r[t]=r[t]||0,console.log(t,":",r[t]),r[t]++}));var a=Math.max.apply(Math,Object.keys(r).map((function(t){return r[t]})));console.log("voteResult:",r,a),Object.keys(r).forEach((function(t){r[t]===a&&(o.push(t),n._honstGameRecord.get(t).lose++)})),console.log("最糟的幾個人:",o),this._honstWorstList.length=0,this._honstRoundPlayers.forEach((function(t){var s=n._honstGameRecord.get(t);i[t]=s.lose})),e=JSON.stringify(o)+" "+JSON.stringify(i),this._broadcast(s,e)}var h=e.split(" ");o=JSON.parse(h[0]),i=JSON.parse(h[1]),o.some((function(t){return n._playerID===t}))?(this.eventShowTip("恭喜，大家覺得你的問答組合是最爛的！"),this.eventRecordLose(i[this._playerID])):this._playerID!=this._masterID&&this.eventShowTip("很遺憾你的答案未獲選為最爛的問答組合…")},s.notify_next_round=function(t,s,e){var n=this,o=!1;if(this._isHonster){if(this._honstRoundIndex=(this._honstRoundIndex+1)%this._honstRoundPlayers.length,this._questionAnswers={},this._honstRoundPlayers.forEach((function(t){var s=n._honstGameRecord.get(t),e=-s.lose;e<=-5&&(o=!0),console.log(s.nickname,"score:",e)})),console.log("檢查，還沒結束就下一輪"),o)return void this.applicate("game_over");this._broadcast(s,e)}var i=this._playerID===this._masterID;this.eventClearPrevRound(),i&&this.applicate("game_round")},s.notify_game_over=function(t,s,e){var n=this,o=[];if(this._isHonster){console.log("遊戲結束,看一下誰最贏");var i=Math.max.apply(Math,this._honstRoundPlayers.map((function(t){return n._honstGameRecord.get(t).win})));this._honstRoundPlayers.forEach((function(t){i===n._honstGameRecord.get(t).win&&o.push(n._honstGameRecord.get(t).nickname)})),e=""+JSON.stringify(o),this._broadcast(s,e)}var r=e.split(" ");o=JSON.parse(r[0]),this.eventShowTip("遊戲結束，最終大贏家是"+o.join("、")),this.eventGameEnd(),this.eventRecordLose(0)},s.notify_alert=function(t,s,e){this.eventShowTip(e)},s.notify_reconnect=function(t,s,e){this._isHonster;var n=e.split(" ");JSON.parse(n[0])},t}());s._RF.pop()}}}));

System.register("chunks:///_virtual/YellowCardPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./YellowCardHandler.ts","./HandCards.ts","./FoldCards.ts"],(function(e){var n,t,i,s,o,a,r,l,d,h,u,c,w,C,f,g;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,s=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,r=e.Node,l=e.Button,d=e.Label,h=e.Vec3,u=e.RichText,c=e.instantiate,w=e.Component},function(e){C=e.YellowCardHandler},function(e){f=e.HandCards},function(e){g=e.FoldCards}],execute:function(){var _,p,v,b,m,H,Q,A,S,y,q,L,B,k,F,x,V,I,R,M,D,z,E;o._RF.push({},"7a536XvrlROxY0P5Wdjctoi","YellowCardPanel",void 0);var P=a.ccclass,T=a.property;e("YellowCardPanel",(_=P("YellowCardPanel"),p=T(f),v=T(f),b=T(r),m=T(g),H=T(r),Q=T(r),A=T(l),S=T(d),y=T(d),q=T(r),_((k=n((B=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,i(n,"questionHandCards",k,s(n)),i(n,"answerHandCards",F,s(n)),i(n,"questionBoard",x,s(n)),i(n,"foldCards",V,s(n)),i(n,"answerQuestionListView",I,s(n)),i(n,"answerQuestionViewContent",R,s(n)),i(n,"nextRoundButton",M,s(n)),i(n,"infoLabel",D,s(n)),i(n,"tipLabel",z,s(n)),i(n,"yellowCardLayout",E,s(n)),n.eventMainSceneGameEnd=null,n._playerID="",n._roomID="",n._gameHandler=null,n._questionCardButtons=[],n._answerCardButtons=[],n._answerMax=0,n._selectedQuestion="",n._selectedAnswers=[],n._questionAnswers={},n._isFolding=!1,n._selectFoldMax=0,n._selectFoldNum=0,n._selectedFloadCards=[],n}t(n,e);var o=n.prototype;return o.start=function(){this.node.setPosition(h.ZERO),this.foldCards.node.setPosition(h.ZERO),this.close()},o.close=function(){this.node.active=!1,this.questionHandCards.show(!1),this.answerHandCards.show(!1),this.questionBoard.active=!1,this.answerQuestionListView.active=!1,this.nextRoundButton.node.active=!1,this._roomID&&(this._gameHandler.endGame(this._roomID),this._gameHandler=null),this.tipLabel.string="",this._roomID="",this._playerID="",this._questionAnswers={},this._questionCardButtons.length=0,this._answerCardButtons.length=0,this._selectedAnswers.length=0,this._selectedQuestion="",this._answerMax=0,this._isFolding=!1,this._selectFoldMax=0,this._selectFoldNum=0,this._selectedFloadCards.length=0},o.init=function(e,n,t,i,s){this.node.active=!0,this._gameHandler=new C(n,t),this._gameHandler.eventUpdateQuestionCards=this.onUpdateQuestionCards.bind(this),this._gameHandler.eventLockQuestionSelection=this.onLockQuestionSelection.bind(this),this._gameHandler.eventUpdateAnswerCards=this.onUpdateAnswerCards.bind(this),this._gameHandler.eventLockAnswerSelection=this.onLockAnswerSelection.bind(this),this._gameHandler.eventShowQuestion=this.onShowQuestion.bind(this),this._gameHandler.eventShowAllQuestionAnswer=this.onShowAllQuestionAnswer.bind(this),this._gameHandler.eventShowQuestionAnswer=this.onShowQuestionAnswer.bind(this),this._gameHandler.eventChooseQuestionAnswer=this.onChooseQuestionAnswer.bind(this),this._gameHandler.eventAnswerCardFold=this.onAnswerCardFold.bind(this),this._gameHandler.eventShowBestAnswer=this.onShowBestAnswer.bind(this),this._gameHandler.eventVoted=this.onVoted.bind(this),this._gameHandler.eventShowTip=this.onShowTip.bind(this),this._gameHandler.eventClearPrevRound=this.onClearPrevRound.bind(this),this._gameHandler.eventRecordLose=this.onRecordLose.bind(this),this._gameHandler.eventGameEnd=this.onGameEnd.bind(this),this._gameHandler.startGame(e,i,s),this._roomID=e,this.infoLabel.string=e+"\n"+t+"\n("+n+")",this._playerID=n,this.questionHandCards.eventSendCallback=this.onSendQuestionClicked.bind(this),this.answerHandCards.eventSendCallback=this.onSendAnswerClicked.bind(this)},o.fillBlanks=function(e,n){var t=n.slice();return console.log("fill question:",e,n),e.replace(/_/g,(function(e){return"<color=#FFFF00><u>"+(t.shift()||"_")+"</u></c>"}))},o.onUpdateQuestionCards=function(e){var n=this;this.questionHandCards.show(!0),this.questionHandCards.selectMax=1,this.questionHandCards.list(e,(function(e,t){n.questionBoard.getComponentInChildren(u).string=e,n._selectedQuestion=e}))},o.onLockQuestionSelection=function(e){this.questionHandCards.lock(e),this.answerHandCards.show(!1)},o.onSendQuestionClicked=function(e){this.questionHandCards.show(!1),this.questionHandCards.lock(!0),this._gameHandler.applicate("question",e[0])},o.onUpdateAnswerCards=function(e){var n=this;this.answerHandCards.show(!0),this.answerHandCards.list(e,(function(e,t){var i=n.fillBlanks(n._selectedQuestion,t);console.log("content:",i),n.questionBoard.getComponentInChildren(u).string=i,console.log("\t",n.questionBoard.getComponentInChildren(u).string)}))},o.onLockAnswerSelection=function(e){this.answerHandCards.lock(e),this.questionHandCards.show(!1)},o.onSendAnswerClicked=function(e){this.answerHandCards.show(!1),this._gameHandler.applicate("answer",this._playerID+" "+JSON.stringify(e))},o.onShowQuestion=function(e){console.log("UI 顯示問題:",e);var n=e.split("_");this._answerMax=Math.max(1,n.length-1),this.answerHandCards.selectMax=this._answerMax,this._selectedQuestion=e,this.questionBoard.active=!0,this.questionBoard.getComponentInChildren(u).string=e},o.onShowQuestionAnswer=function(e,n){console.log("玩家"+e+"送入答案:",n,typeof n),this._questionAnswers[e]=n,this.onShowAllQuestionAnswer(this._questionAnswers)},o.onShowAllQuestionAnswer=function(e){var n=this;this._questionAnswers=e,console.log("顯示所有的答案卡片:",this._questionAnswers),this.answerQuestionListView.active=!0;var t=this.answerQuestionViewContent.children;t.forEach((function(e){return e.active=!1})),Object.keys(e).forEach((function(i,s){var o=t[s];o||((o=c(t[0])).parent=n.answerQuestionViewContent),o.active=!0;var a=n.fillBlanks(n._selectedQuestion,e[i]);console.log("content:",a),o.getComponentInChildren(u).string=a,console.log("\t",o.getComponentInChildren(u).string),o.getComponent(l).node.off("click")})),console.log("顯示答案送出內容，移除 answerQuestionViewContent 的按鈕事件")},o.onChooseQuestionAnswer=function(e){var n=this,t=this.answerQuestionViewContent.children,i=e?this.sendBestQuestionAnswer.bind(this):this.sendWorstQuestionAnswer.bind(this);Object.keys(this._questionAnswers).forEach((function(e,s){t[s].getComponent(l).node.on("click",(function(){return i(e)}),n)})),console.log("設定選擇問答組合，設定觸發 answerQuestionViewContent 的按鈕事件"),this.answerQuestionListView.active=!this._isFolding,this._isFolding?e?this.onShowTip("選擇最符合你提出條件的組合"):(this.onShowTip("選擇不符裁判要求的組合(請先棄完牌)"),this.foldCards.show(!0)):this.onShowTip(e?"選擇最符合你提出條件的組合":"選擇不符裁判要求的組合")},o.onVoted=function(e){this.answerQuestionViewContent.children.forEach((function(e){return e.off("click")})),console.log("已投票，移除 answerQuestionViewContent 的按鈕事件"),this.answerQuestionListView.active=!1},o.onShowBestAnswer=function(e,n){var t=this.fillBlanks(this._selectedQuestion,e);console.log("content:",t),this.questionBoard.getComponentInChildren(u).string=t,console.log("\t",this.questionBoard.getComponentInChildren(u).string),this.answerQuestionListView.active=!1,this._questionAnswers={},this._answerMax=0,this._selectedQuestion="",this.nextRoundButton.node.active=n},o.sendBestQuestionAnswer=function(e){console.log("最佳組合的玩家:",e),this._gameHandler.applicate("choose_best_answer",e+" "+Math.round(1e6*Math.random()))},o.sendWorstQuestionAnswer=function(e){console.log("最差組合的玩家:",e),this._gameHandler.applicate("vote",this._playerID+" "+e)},o.onAnswerCardFold=function(e,n){this._isFolding=!0,console.log("進入棄牌流程"),this.foldCards.show(!0),this.foldCards.selectMax=n,this.foldCards.list(e),this.foldCards.eventSendCallback=this.onSendFoldAnswerClicked.bind(this)},o.onSendFoldAnswerClicked=function(e){this.answerHandCards.show(!1),this.foldCards.show(!1),this.answerQuestionListView.active=!0,this._isFolding=!1,this._gameHandler.applicate("fold_answer_card",this._playerID+" "+JSON.stringify(e))},o.onShowTip=function(e){this.tipLabel.string=e},o.onRecordLose=function(e){var n=this.yellowCardLayout.children;n.forEach((function(e){return e.active=!1}));for(var t=0;t<e;t++){var i=n[t];i||((i=c(n[0])).parent=this.yellowCardLayout),i.active=!0}},o.onClearPrevRound=function(){this.questionHandCards.show(!1),this.answerHandCards.show(!1),this.questionBoard.active=!1,this.answerQuestionListView.active=!1,this.nextRoundButton.node.active=!1,this._questionAnswers={},this._answerMax=0,this._selectedQuestion=""},o.onGameEnd=function(){var e;null==(e=this.eventMainSceneGameEnd)||e.call(this),this.nextRoundButton.node.active=!1,this.infoLabel.string=""},o.onNextRoundClicked=function(){this._gameHandler.applicate("next_round")},n}(w)).prototype,"questionHandCards",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(B.prototype,"answerHandCards",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(B.prototype,"questionBoard",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(B.prototype,"foldCards",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(B.prototype,"answerQuestionListView",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=n(B.prototype,"answerQuestionViewContent",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(B.prototype,"nextRoundButton",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=n(B.prototype,"infoLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(B.prototype,"tipLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(B.prototype,"yellowCardLayout",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=B))||L));o._RF.pop()}}}));

System.register("chunks:///_virtual/YellowCardRecord.ts",["cc"],(function(s){var e;return{setters:[function(s){e=s.cclegacy}],execute:function(){e._RF.push({},"962bfAm9SxBtKUI3CbrHESq","YellowCardRecord",void 0);var r=s("Role",function(s){return s[s.PLAYER=0]="PLAYER",s[s.MASTER=1]="MASTER",s}({})),t="YC_GAME_RECORD_INFO";s("GameStatus",function(s){return s[s.GAMING=0]="GAMING",s[s.ASKING=1]="ASKING",s[s.ASKED=2]="ASKED",s[s.REVIEW=3]="REVIEW",s[s.ANSWER=4]="ANSWER",s[s.ANSWERING=5]="ANSWERING",s[s.FOLD=6]="FOLD",s[s.ANSWERED=7]="ANSWERED",s[s.VOTING=8]="VOTING",s[s.VOTED=9]="VOTED",s[s.PICK=10]="PICK",s}({})),s("YellowCardRecord",function(){function s(){this.masterID="",this._players={},this._roundPlayers=[],this.questions=[],this.answers=[],this.askingQuestion=""}var e=s.prototype;return e.add=function(s,e,t){this._players[s]={nickname:e,gameStatus:t,win:0,lose:0,answerCards:[],answerHandCards:[],questionHandCards:[],voted:0,role:r.PLAYER},this._roundPlayers=Object.keys(this._players)},e.del=function(s){delete this._players[s]},e.get=function(s){return this._players[s]},e.clear=function(){this._players={},this._roundPlayers=[],this.questions=[],this.answers=[],this.askingQuestion="",localStorage.removeItem(t)},e.clearAnswerCards=function(){var s=this;this._roundPlayers.forEach((function(e){return s._players[e].answerCards.length=0}))},e.clearWorstVote=function(){var s=this;this._roundPlayers.forEach((function(e){return s._players[e].voted=0}))},e.readData=function(){var s=JSON.parse(localStorage.getItem(t));console.log("YellowCardRecord read localData:",s),this.masterID=s.masterID,this._players=s.players,this._roundPlayers=s.roundPlayers,this.questions=s.questions,this.answers=s.answers,this.askingQuestion=s.askingQuestion},e.writeData=function(){var s={masterID:this.masterID,players:this._players,roundPlayers:this._roundPlayers,questions:this.questions,answers:this.answers,askingQuestion:this.askingQuestion};localStorage.setItem(t,JSON.stringify(s))},e.dropAnswerHandCards=function(s,e){this.dropHandCard(this._players[s].answerHandCards,e)},e.dropHandCard=function(s,e){return e.every((function(e){return s.find((function(s,r,t){if(s===e)return t.splice(r,1),!0}))}))},s}());e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});